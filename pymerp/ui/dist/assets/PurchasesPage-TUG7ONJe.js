import{j as e,c as q,E as we,F as Pe,G as le,H as oe,I,J as Te,K as ie,L as Ae,M as De,u as ge,N as Ie,O as Fe,P as Ee,Q as Me,x as Oe,R as Le,q as $e,S as ke}from"./index-C0DCX_lx.js";import{r as v}from"./react-DFcFNn96.js";import{u as y}from"./useQuery-ClGZjTlq.js";import{P as _e}from"./PageHeader-ZA88au4Z.js";import{M as de}from"./Modal-BfA53Mfc.js";import{P as Re}from"./PurchaseCreateForm-iUq2Fou4.js";import{R as Q,B as ce,C as H,X as Y,Y as G,T as U,a as J,g as W,f as me,L as qe,b as se,h as Ve,P as Be,e as ze}from"./charts-CIawE-G5.js";import{c as _}from"./currency-HwQAg_Xa.js";import{u as Ke,f as xe,a as Ge,g as Qe}from"./table-sNnHzzJB.js";import{u as Ue}from"./useDebouncedValue-DwVyRO6o.js";function We({open:r,onClose:o,onCreated:h}){const g=u=>{h(),o()};return e.jsx(de,{open:r,onClose:o,title:"Registrar Compra",children:e.jsx(Re,{onSubmitted:g})})}function He({open:r,onClose:o,onImported:h}){const[g,u]=v.useState(null),[a,m]=v.useState(null),t=q({mutationFn:d=>we(d),onSuccess:d=>{m(d),d.success&&h()},onError:d=>{window.alert(`Error al importar: ${d}`)}}),c=d=>{const l=d.target.files?.[0];if(l){if(!l.name.endsWith(".csv")){window.alert("Solo se permiten archivos CSV");return}u(l),m(null)}},s=()=>{if(!g){window.alert("Seleccione un archivo CSV");return}t.mutate(g)},i=()=>{u(null),m(null),o()};return r?e.jsx("div",{className:"modal-backdrop",onClick:i,children:e.jsxs("div",{className:"modal-card",onClick:d=>d.stopPropagation(),children:[e.jsx("h2",{children:"Importar compras desde CSV"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Archivo CSV"}),e.jsx("input",{type:"file",accept:".csv",onChange:c,disabled:t.isPending}),g&&e.jsxs("p",{className:"muted",style:{marginTop:"0.5rem"},children:["Archivo seleccionado: ",g.name," (",(g.size/1024).toFixed(2)," KB)"]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("p",{className:"muted",children:[e.jsx("strong",{children:"Formato esperado del CSV:"}),e.jsx("br",{}),"Tipo Documento, N√∫mero, Proveedor ID, Estado, Neto, IVA, Total, Fecha Emisi√≥n",e.jsx("br",{}),e.jsxs("em",{children:["Ejemplo: Factura, 12345, ","{UUID}",", Recibida, 10000, 1900, 11900, 2024-01-15 10:30:00"]})]})}),a&&e.jsxs("div",{className:`alert ${a.success?"success":"error"}`,style:{marginTop:"1rem"},children:[e.jsx("p",{children:e.jsx("strong",{children:a.success?"‚úì Importaci√≥n exitosa":"‚ö† Importaci√≥n con errores"})}),e.jsxs("p",{children:["Importadas: ",a.imported," de ",a.total," filas"]}),a.errors&&a.errors.length>0&&e.jsxs("div",{style:{marginTop:"0.5rem"},children:[e.jsx("strong",{children:"Errores:"}),e.jsx("ul",{style:{marginTop:"0.5rem",maxHeight:"200px",overflow:"auto"},children:a.errors.map((d,l)=>e.jsx("li",{children:d},l))})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn",type:"button",onClick:s,disabled:!g||t.isPending,children:t.isPending?"Importando...":"Importar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:i,disabled:t.isPending,children:a?"Cerrar":"Cancelar"})]})]})}):null}function Ye(){const{data:r,isLoading:o,error:h}=y({queryKey:["purchaseKPIs"],queryFn:()=>Pe(),refetchInterval:3e5});if(o)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 animate-pulse",children:[1,2,3,4,5,6,7,8].map(t=>e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 h-32"},t))});if(h)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar KPIs de compras"})});if(!r)return null;const g=t=>`$${t.toLocaleString("es-CL",{maximumFractionDigits:0})}`,u=t=>`${t.toFixed(1)}%`,a=t=>t>0?"text-red-400":t<0?"text-green-400":"text-neutral-400",m=t=>t>0?"‚ÜóÔ∏è":t<0?"‚ÜòÔ∏è":"‚Üí";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"üì¶ KPIs Avanzados de Compras"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-900/30 to-purple-800/20 border border-purple-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-purple-400 mb-1",children:"Gasto Total"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:g(r.totalSpent)}),e.jsxs("div",{className:"text-xs text-purple-300 mt-2",children:[r.totalOrders," √≥rdenes recibidas"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-900/30 to-blue-800/20 border border-blue-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-blue-400 mb-1",children:"Promedio por Orden"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:g(r.averageOrderValue)}),e.jsxs("div",{className:"text-xs text-blue-300 mt-2",children:[r.totalQuantity.toLocaleString("es-CL")," unidades"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-900/30 to-orange-800/20 border border-orange-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-orange-400 mb-1",children:"Variaci√≥n de Gasto"}),e.jsxs("div",{className:`text-3xl font-bold ${a(r.purchaseGrowth)}`,children:[m(r.purchaseGrowth)," ",u(Math.abs(r.purchaseGrowth))]}),e.jsx("div",{className:"text-xs text-orange-300 mt-2",children:"vs per√≠odo anterior"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-900/30 to-green-800/20 border border-green-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-green-400 mb-1",children:"Costo Unitario"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:g(r.costPerUnit)}),e.jsx("div",{className:"text-xs text-green-300 mt-2",children:"Promedio por unidad"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Proveedores Activos"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:r.uniqueSuppliers}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"√ìrdenes recibidas"})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Concentraci√≥n"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:u(r.supplierConcentration)}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Top proveedor"})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Top Proveedor"}),e.jsx("div",{className:"text-lg font-semibold text-white truncate",title:r.topSupplierName,children:r.topSupplierName}),e.jsx("div",{className:"text-sm text-purple-400 mt-1",children:g(r.topSupplierSpent)})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"√ìrdenes Pendientes"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:r.pendingOrders}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:["Entrega a tiempo: ",u(r.onTimeDeliveryRate)]})]})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"An√°lisis de Gastos"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-400",children:"Gasto Total"}),e.jsx("span",{className:"text-white font-semibold",children:g(r.totalSpent)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-purple-500 h-3 rounded-full",style:{width:"100%"}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-neutral-400",children:["Gasto Top Proveedor (",r.topSupplierName,")"]}),e.jsx("span",{className:"text-purple-400 font-semibold",children:g(r.topSupplierSpent)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-purple-400 h-3 rounded-full",style:{width:`${r.supplierConcentration}%`}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-400",children:"Otros Proveedores"}),e.jsx("span",{className:"text-blue-400 font-semibold",children:g(r.totalSpent-r.topSupplierSpent)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-500 h-3 rounded-full",style:{width:`${100-r.supplierConcentration}%`}})}),r.supplierConcentration>50&&e.jsx("div",{className:"bg-yellow-900/20 border border-yellow-800 rounded-lg p-3 mt-4",children:e.jsxs("p",{className:"text-sm text-yellow-400",children:["‚ö†Ô∏è Alta concentraci√≥n en un proveedor (",u(r.supplierConcentration),"). Considere diversificar para reducir riesgo de dependencia."]})})]})]}),e.jsx("div",{className:"bg-purple-900/20 border border-purple-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-purple-400",children:["üìÖ Per√≠odo de an√°lisis: ",new Date(r.periodStart).toLocaleDateString("es-CL")," -"," ",new Date(r.periodEnd).toLocaleDateString("es-CL")]}),e.jsx("span",{className:"text-xs text-purple-300",children:"Actualizado autom√°ticamente cada 5 minutos"})]})})]})}function Je(){const{data:r,isLoading:o}=y({queryKey:["purchaseABCAnalysis"],queryFn:()=>le(),refetchInterval:3e5});if(o)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 h-96 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-full bg-neutral-800 rounded"})]});if(!r||r.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"üìä Distribuci√≥n ABC de Proveedores"}),e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"No hay datos suficientes para an√°lisis ABC"})]});const h=r.reduce((m,t)=>{const c=t.classification;return m[c].count++,m[c].totalSpent+=t.totalSpent,m[c].percentage+=t.percentageOfTotal,m},{A:{count:0,totalSpent:0,percentage:0},B:{count:0,totalSpent:0,percentage:0},C:{count:0,totalSpent:0,percentage:0}}),g=[{name:"Clase A (Cr√≠ticos)",proveedores:h.A.count,gasto:h.A.totalSpent,porcentaje:h.A.percentage},{name:"Clase B (Importantes)",proveedores:h.B.count,gasto:h.B.totalSpent,porcentaje:h.B.percentage},{name:"Clase C (Ocasionales)",proveedores:h.C.count,gasto:h.C.totalSpent,porcentaje:h.C.percentage}],u={A:"#ef4444",B:"#f59e0b",C:"#10b981"},a=m=>`$${m.toLocaleString("es-CL",{maximumFractionDigits:0})}`;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"üìä Distribuci√≥n ABC de Proveedores (Pareto 80-15-5)"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-red-900/30 to-red-800/20 border border-red-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-400 mb-1",children:"Clase A - Cr√≠ticos"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[h.A.count," proveedores"]}),e.jsxs("div",{className:"text-xs text-red-300 mt-2",children:[h.A.percentage.toFixed(1),"% del gasto total"]}),e.jsx("div",{className:"text-sm text-red-200 mt-1",children:a(h.A.totalSpent)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-900/30 to-amber-800/20 border border-amber-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-amber-400 mb-1",children:"Clase B - Importantes"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[h.B.count," proveedores"]}),e.jsxs("div",{className:"text-xs text-amber-300 mt-2",children:[h.B.percentage.toFixed(1),"% del gasto total"]}),e.jsx("div",{className:"text-sm text-amber-200 mt-1",children:a(h.B.totalSpent)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-900/30 to-green-800/20 border border-green-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-400 mb-1",children:"Clase C - Ocasionales"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[h.C.count," proveedores"]}),e.jsxs("div",{className:"text-xs text-green-300 mt-2",children:[h.C.percentage.toFixed(1),"% del gasto total"]}),e.jsx("div",{className:"text-sm text-green-200 mt-1",children:a(h.C.totalSpent)})]})]}),e.jsx(Q,{width:"100%",height:300,children:e.jsxs(ce,{data:g,children:[e.jsx(H,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(Y,{dataKey:"name",stroke:"#a3a3a3",tick:{fill:"#a3a3a3"}}),e.jsx(G,{stroke:"#a3a3a3",tick:{fill:"#a3a3a3"},tickFormatter:m=>a(m)}),e.jsx(U,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#fff"},formatter:(m,t)=>t==="gasto"?a(m):t==="porcentaje"?`${m.toFixed(1)}%`:m}),e.jsx(J,{wrapperStyle:{color:"#a3a3a3"}}),e.jsx(W,{dataKey:"gasto",fill:"#8884d8",name:"Gasto Total",children:g.map((m,t)=>{const c=m.name.includes("A")?"A":m.name.includes("B")?"B":"C";return e.jsx(me,{fill:u[c]},`cell-${t}`)})})]})}),e.jsx("div",{className:"mt-4 bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-300",children:["üí° ",e.jsx("strong",{children:"An√°lisis Pareto (80-15-5):"})," Clase A representa ~80% del gasto (pocos proveedores clave), Clase B ~15% (proveedores moderados), y Clase C ~5% (muchos proveedores ocasionales)."]})})]})}function Xe(){const{data:r,isLoading:o}=y({queryKey:["purchaseABCAnalysis"],queryFn:()=>le(),refetchInterval:3e5});if(o)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(u=>e.jsx("div",{className:"h-16 bg-neutral-800 rounded"},u))})]});if(!r||r.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"üìã Detalle de Proveedores por Clasificaci√≥n"}),e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"No hay proveedores para clasificar"})]});const h=u=>`$${u.toLocaleString("es-CL",{maximumFractionDigits:0})}`,g=u=>{const a={A:"bg-red-900/30 text-red-400 border-red-800",B:"bg-amber-900/30 text-amber-400 border-amber-800",C:"bg-green-900/30 text-green-400 border-green-800"};return a[u]||a.C};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"üìã Detalle de Proveedores por Clasificaci√≥n ABC"}),e.jsxs("span",{className:"text-sm text-neutral-400",children:[r.length," proveedores"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-neutral-400",children:"Clase"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-neutral-400",children:"Proveedor"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Gasto Total"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-neutral-400",children:"Compras"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"% del Total"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Acumulado"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-neutral-400",children:"Acci√≥n Recomendada"})]})}),e.jsx("tbody",{children:r.map((u,a)=>e.jsxs("tr",{className:`border-b border-neutral-800 hover:bg-neutral-800/50 transition-colors ${a<10?"":"opacity-60"}`,children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 rounded text-xs font-bold border ${g(u.classification)}`,children:u.classification})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"text-white font-medium",children:u.supplierName}),e.jsxs("div",{className:"text-xs text-neutral-500",children:["Promedio: ",h(u.averageOrderValue)]})]}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:"text-white font-semibold",children:h(u.totalSpent)})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:"text-neutral-300",children:u.purchaseCount})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-blue-400 font-medium",children:[u.percentageOfTotal.toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-neutral-400",children:[u.cumulativePercentage.toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"text-xs text-neutral-400",children:u.recommendedAction})})]},u.supplierId))})]})}),r.length>10&&e.jsxs("div",{className:"mt-4 text-center text-sm text-neutral-500",children:["Mostrando todos los ",r.length," proveedores (primeros 10 resaltados)"]})]})}function Ze(){const{data:r}=y({queryKey:["purchaseABCAnalysis"],queryFn:()=>le(),refetchInterval:3e5});if(!r||r.length===0)return null;const o=r.filter(t=>t.classification==="A"),h=r.filter(t=>t.classification==="B"),g=r.filter(t=>t.classification==="C"),u=r.reduce((t,c)=>t+c.totalSpent,0),a=o.reduce((t,c)=>t+c.totalSpent,0),m=u>0?a/u*100:0;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"üí° Insights y Estrategias por Clasificaci√≥n"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-red-900/20 to-red-800/10 border border-red-800 rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"üî¥"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-400 font-semibold",children:"Clase A - Proveedores Cr√≠ticos"}),e.jsxs("p",{className:"text-xs text-red-300",children:[o.length," proveedores ¬∑ ",m.toFixed(1),"% del gasto"]})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-200 font-medium mb-2",children:"üéØ Estrategia:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"‚Ä¢ Negociar contratos a largo plazo"}),e.jsx("li",{children:"‚Ä¢ Reuniones trimestrales de revisi√≥n"}),e.jsx("li",{children:"‚Ä¢ Planes de contingencia definidos"}),e.jsx("li",{children:"‚Ä¢ Monitoreo continuo de desempe√±o"})]})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-200 font-medium mb-2",children:"‚ö†Ô∏è Riesgos:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"‚Ä¢ Alta dependencia de pocos proveedores"}),e.jsx("li",{children:"‚Ä¢ Impacto severo si hay problemas"}),e.jsx("li",{children:"‚Ä¢ Poder de negociaci√≥n limitado"})]})]}),e.jsx("div",{className:"bg-amber-900/20 border border-amber-700 rounded p-2",children:e.jsxs("p",{className:"text-amber-200 text-xs",children:["‚ö° ",e.jsx("strong",{children:"Acci√≥n urgente:"})," Desarrollar proveedores alternativos para reducir riesgo"]})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-900/20 to-amber-800/10 border border-amber-800 rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"üü°"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-amber-400 font-semibold",children:"Clase B - Proveedores Importantes"}),e.jsxs("p",{className:"text-xs text-amber-300",children:[h.length," proveedores ¬∑ Equilibrio ideal"]})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-amber-200 font-medium mb-2",children:"üéØ Estrategia:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"‚Ä¢ Revisi√≥n semestral de contratos"}),e.jsx("li",{children:"‚Ä¢ Evaluar promoci√≥n a Clase A"}),e.jsx("li",{children:"‚Ä¢ Buscar alternativas competitivas"}),e.jsx("li",{children:"‚Ä¢ Optimizar costos y condiciones"})]})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-amber-200 font-medium mb-2",children:"üìä Oportunidades:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"‚Ä¢ Consolidar compras para mejores precios"}),e.jsx("li",{children:"‚Ä¢ Negociar descuentos por volumen"}),e.jsx("li",{children:"‚Ä¢ Explorar servicios adicionales"})]})]}),e.jsx("div",{className:"bg-blue-900/20 border border-blue-700 rounded p-2",children:e.jsxs("p",{className:"text-blue-200 text-xs",children:["üíº ",e.jsx("strong",{children:"Recomendaci√≥n:"})," Mantener relaci√≥n activa y evaluar potencial de crecimiento"]})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-900/20 to-green-800/10 border border-green-800 rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"üü¢"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-green-400 font-semibold",children:"Clase C - Proveedores Ocasionales"}),e.jsxs("p",{className:"text-xs text-green-300",children:[g.length," proveedores ¬∑ Bajo impacto individual"]})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-green-200 font-medium mb-2",children:"üéØ Estrategia:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"‚Ä¢ Consolidar compras similares"}),e.jsx("li",{children:"‚Ä¢ Evaluar eliminaci√≥n de proveedores"}),e.jsx("li",{children:"‚Ä¢ Automatizar procesos de compra"}),e.jsx("li",{children:"‚Ä¢ Reducir carga administrativa"})]})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-green-200 font-medium mb-2",children:"‚ö° Optimizaci√≥n:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"‚Ä¢ Agrupar con proveedores Clase B"}),e.jsx("li",{children:"‚Ä¢ Compras espor√°dicas bajo demanda"}),e.jsx("li",{children:"‚Ä¢ Minimizar costos de gesti√≥n"})]})]}),e.jsx("div",{className:"bg-purple-900/20 border border-purple-700 rounded p-2",children:e.jsxs("p",{className:"text-purple-200 text-xs",children:["üîÑ ",e.jsx("strong",{children:"Acci√≥n:"})," Revisar anualmente y considerar consolidaci√≥n con otros proveedores"]})})]})]})]}),e.jsxs("div",{className:"mt-6 bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-800 rounded-lg p-5",children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx("span",{children:"üìà"})," Resumen del An√°lisis ABC"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Distribuci√≥n de Proveedores"}),e.jsxs("p",{className:"text-white",children:[e.jsx("span",{className:"text-red-400 font-bold",children:o.length})," A ¬∑"," ",e.jsx("span",{className:"text-amber-400 font-bold",children:h.length})," B ¬∑"," ",e.jsx("span",{className:"text-green-400 font-bold",children:g.length})," C"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Principio de Pareto"}),e.jsx("p",{className:"text-white",children:o.length>0?e.jsxs(e.Fragment,{children:["~",(o.length/r.length*100).toFixed(0),"% de proveedores genera ~",m.toFixed(0),"% del gasto"]}):"Distribuci√≥n equilibrada"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Recomendaci√≥n Principal"}),e.jsx("p",{className:"text-blue-300",children:m>85?"‚ö†Ô∏è Reducir dependencia de Clase A":g.length>o.length*3?"üîÑ Consolidar proveedores Clase C":"‚úÖ Distribuci√≥n saludable"})]})]})]})]})}function et(){const{data:r,isLoading:o}=y({queryKey:["purchaseSupplierForecast"],queryFn:()=>oe(),refetchInterval:3e5});if(o)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 h-96 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-full bg-neutral-800 rounded"})]});if(!r||r.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"üìà Pron√≥stico de Gastos por Proveedor"}),e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"No hay datos suficientes para generar pron√≥sticos"})]});const h=r.slice(0,5),g=h.map(t=>({nombre:t.supplierName.length>20?t.supplierName.substring(0,20)+"...":t.supplierName,historico:t.historicalAverage,pronostico:t.forecastedSpending,confianza:t.confidence})),u=t=>`$${t.toLocaleString("es-CL",{maximumFractionDigits:0})}`,a=t=>t==="increasing"?"‚ÜóÔ∏è":t==="decreasing"?"‚ÜòÔ∏è":"‚Üí",m=t=>t==="increasing"?"text-red-400":t==="decreasing"?"text-green-400":"text-neutral-400";return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"üìà Pron√≥stico de Gastos (Top 5 Proveedores)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 mb-6",children:h.map((t,c)=>e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"text-xs text-neutral-400 mb-1",children:["#",c+1," - ",t.supplierName]}),e.jsx("div",{className:"text-xl font-bold text-white mb-1",children:u(t.forecastedSpending)}),e.jsxs("div",{className:`text-sm font-medium ${m(t.trend)}`,children:[a(t.trend)," ",t.trend]}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-2",children:["Confianza: ",t.confidence.toFixed(0),"%"]})]},t.supplierId))}),e.jsx(Q,{width:"100%",height:350,children:e.jsxs(qe,{data:g,children:[e.jsx(H,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(Y,{dataKey:"nombre",stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:12}}),e.jsx(G,{stroke:"#a3a3a3",tick:{fill:"#a3a3a3"},tickFormatter:t=>u(t)}),e.jsx(U,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#fff"},formatter:(t,c)=>c==="confianza"?`${t.toFixed(0)}%`:u(t)}),e.jsx(J,{wrapperStyle:{color:"#a3a3a3"}}),e.jsx(se,{type:"monotone",dataKey:"historico",stroke:"#3b82f6",strokeWidth:2,name:"Promedio Hist√≥rico",dot:{fill:"#3b82f6",r:5}}),e.jsx(se,{type:"monotone",dataKey:"pronostico",stroke:"#f59e0b",strokeWidth:2,strokeDasharray:"5 5",name:"Pron√≥stico Pr√≥ximo Mes",dot:{fill:"#f59e0b",r:5}})]})}),e.jsx("div",{className:"mt-4 bg-purple-900/20 border border-purple-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-purple-300",children:["üí° ",e.jsx("strong",{children:"Algoritmo de Pron√≥stico:"})," Usa media m√≥vil de los √∫ltimos 90 d√≠as y an√°lisis de tendencia (comparando primera vs segunda mitad del per√≠odo) para predecir gastos del pr√≥ximo mes."]})})]})}function tt(){const{data:r,isLoading:o}=y({queryKey:["purchaseSupplierForecast"],queryFn:()=>oe(),refetchInterval:3e5});if(o)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(a=>e.jsx("div",{className:"h-16 bg-neutral-800 rounded"},a))})]});if(!r||r.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"üìä Tabla de Pron√≥sticos Detallada"}),e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"No hay pron√≥sticos disponibles"})]});const h=a=>`$${a.toLocaleString("es-CL",{maximumFractionDigits:0})}`,g=a=>{const m={increasing:"bg-red-900/30 text-red-400 border-red-800",stable:"bg-neutral-800 text-neutral-400 border-neutral-700",decreasing:"bg-green-900/30 text-green-400 border-green-800"},t={increasing:"‚ÜóÔ∏è Creciente",stable:"‚Üí Estable",decreasing:"‚ÜòÔ∏è Decreciente"};return{style:m[a]||m.stable,label:t[a]||a}},u=a=>a>=80?"text-green-400":a>=60?"text-amber-400":"text-red-400";return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"üìä Pron√≥sticos Detallados por Proveedor"}),e.jsxs("span",{className:"text-sm text-neutral-400",children:[r.length," proveedores analizados"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-neutral-400",children:"Proveedor"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Promedio Hist√≥rico"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Pron√≥stico"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-neutral-400",children:"Tendencia"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-neutral-400",children:"Confianza"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-neutral-400",children:"Pr√≥xima Compra"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Cantidad Sugerida"})]})}),e.jsx("tbody",{children:r.map((a,m)=>{const t=g(a.trend),c=a.historicalAverage>0?(a.forecastedSpending-a.historicalAverage)/a.historicalAverage*100:0;return e.jsxs("tr",{className:`border-b border-neutral-800 hover:bg-neutral-800/50 transition-colors ${m>=10?"opacity-60":""}`,children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"text-white font-medium",children:a.supplierName}),e.jsxs("div",{className:"text-xs text-neutral-500",children:["ID: ",a.supplierId.substring(0,8)]})]}),e.jsxs("td",{className:"py-3 px-4 text-right",children:[e.jsx("span",{className:"text-neutral-300",children:h(a.historicalAverage)}),e.jsx("div",{className:"text-xs text-neutral-500",children:"por mes"})]}),e.jsxs("td",{className:"py-3 px-4 text-right",children:[e.jsx("span",{className:"text-white font-semibold",children:h(a.forecastedSpending)}),e.jsxs("div",{className:`text-xs ${c>=0?"text-red-400":"text-green-400"}`,children:[c>=0?"+":"",c.toFixed(1),"%"]})]}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:`inline-flex px-2 py-1 rounded text-xs font-medium border ${t.style}`,children:t.label})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("span",{className:`font-bold ${u(a.confidence)}`,children:[a.confidence.toFixed(0),"%"]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:"text-neutral-300 text-sm",children:new Date(a.nextPurchaseDate).toLocaleDateString("es-CL")})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-blue-400 font-medium",children:[a.recommendedOrderQuantity.toFixed(2)," un."]})})]},a.supplierId)})})]})}),r.length>10&&e.jsxs("div",{className:"mt-4 text-center text-sm text-neutral-500",children:["Mostrando todos los ",r.length," proveedores (primeros 10 resaltados)"]})]})}function st(){const{data:r}=y({queryKey:["purchaseSupplierForecast"],queryFn:()=>oe(),refetchInterval:3e5});if(!r||r.length===0)return null;const o=r.reduce((s,i)=>s+i.forecastedSpending,0),h=r.reduce((s,i)=>s+i.historicalAverage,0),g=h>0?(o-h)/h*100:0,u=r.filter(s=>s.trend==="increasing"),a=r.filter(s=>s.trend==="decreasing"),m=r.filter(s=>s.confidence<60),t=r.filter(s=>s.forecastedSpending>o/r.length*2),c=s=>`$${s.toLocaleString("es-CL",{maximumFractionDigits:0})}`;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"üîç Insights y Alertas del Pron√≥stico"}),e.jsx("div",{className:"bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-800 rounded-lg p-5 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 text-sm mb-1",children:"Gasto Hist√≥rico Mensual"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:c(h)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 text-sm mb-1",children:"Pron√≥stico Pr√≥ximo Mes"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:c(o)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 text-sm mb-1",children:"Variaci√≥n Esperada"}),e.jsxs("p",{className:`text-2xl font-bold ${g>=0?"text-red-400":"text-green-400"}`,children:[g>=0?"+":"",g.toFixed(1),"%"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[u.length>0&&e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"‚ö†Ô∏è"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-400 font-semibold",children:"Proveedores con Tendencia Creciente"}),e.jsxs("p",{className:"text-xs text-red-300",children:[u.length," proveedores"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[u.slice(0,3).map(s=>{const i=s.historicalAverage>0?(s.forecastedSpending-s.historicalAverage)/s.historicalAverage*100:0;return e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-red-200",children:s.supplierName.substring(0,25)}),e.jsxs("span",{className:"text-red-400 font-bold",children:["+",i.toFixed(0),"%"]})]},s.supplierId)}),u.length>3&&e.jsxs("p",{className:"text-xs text-red-300 mt-2",children:["Y ",u.length-3," m√°s..."]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-red-800",children:e.jsxs("p",{className:"text-xs text-red-200",children:["üí° ",e.jsx("strong",{children:"Acci√≥n:"})," Revisar contratos y negociar mejores condiciones antes del aumento"]})})]}),m.length>0&&e.jsxs("div",{className:"bg-amber-900/20 border border-amber-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"‚ö°"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-amber-400 font-semibold",children:"Pron√≥sticos de Baja Confianza"}),e.jsxs("p",{className:"text-xs text-amber-300",children:[m.length," proveedores"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[m.slice(0,3).map(s=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-amber-200",children:s.supplierName.substring(0,25)}),e.jsxs("span",{className:"text-amber-400 font-bold",children:[s.confidence.toFixed(0),"%"]})]},s.supplierId)),m.length>3&&e.jsxs("p",{className:"text-xs text-amber-300 mt-2",children:["Y ",m.length-3," m√°s..."]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-amber-800",children:e.jsxs("p",{className:"text-xs text-amber-200",children:["üí° ",e.jsx("strong",{children:"Raz√≥n:"})," Pocos datos hist√≥ricos. Aumentar frecuencia de compras para mejorar predicci√≥n"]})})]}),a.length>0&&e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"‚úÖ"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-green-400 font-semibold",children:"Proveedores con Tendencia Decreciente"}),e.jsxs("p",{className:"text-xs text-green-300",children:[a.length," proveedores"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[a.slice(0,3).map(s=>{const i=s.historicalAverage>0?(s.forecastedSpending-s.historicalAverage)/s.historicalAverage*100:0;return e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-green-200",children:s.supplierName.substring(0,25)}),e.jsxs("span",{className:"text-green-400 font-bold",children:[i.toFixed(0),"%"]})]},s.supplierId)}),a.length>3&&e.jsxs("p",{className:"text-xs text-green-300 mt-2",children:["Y ",a.length-3," m√°s..."]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-green-800",children:e.jsxs("p",{className:"text-xs text-green-200",children:["üí° ",e.jsx("strong",{children:"Oportunidad:"})," Optimizaci√≥n exitosa o reducci√≥n de demanda. Evaluar causas"]})})]}),t.length>0&&e.jsxs("div",{className:"bg-purple-900/20 border border-purple-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"üí∞"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-purple-400 font-semibold",children:"Proveedores de Alto Gasto"}),e.jsxs("p",{className:"text-xs text-purple-300",children:[t.length," proveedores"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[t.slice(0,3).map(s=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-purple-200",children:s.supplierName.substring(0,25)}),e.jsx("span",{className:"text-purple-400 font-bold",children:c(s.forecastedSpending)})]},s.supplierId)),t.length>3&&e.jsxs("p",{className:"text-xs text-purple-300 mt-2",children:["Y ",t.length-3," m√°s..."]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-purple-800",children:e.jsxs("p",{className:"text-xs text-purple-200",children:["üí° ",e.jsx("strong",{children:"Recomendaci√≥n:"})," Negociar descuentos por volumen o contratos anuales"]})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-900/30 to-blue-800/20 border border-blue-800 rounded-lg p-5",children:[e.jsxs("h4",{className:"text-white font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"üìã"})," Recomendaciones Estrat√©gicas"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-2",children:"üéØ Planificaci√≥n de Flujo de Caja"}),e.jsxs("p",{className:"text-neutral-300",children:["Bas√°ndose en el pron√≥stico total de ",c(o),", aseg√∫rese de tener liquidez suficiente para el pr√≥ximo mes."]})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-2",children:"üìä Optimizaci√≥n de Inventario"}),e.jsx("p",{className:"text-neutral-300",children:"Use las cantidades sugeridas como base para evitar sobre-stock o quiebres de inventario."})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-2",children:"‚è∞ Programaci√≥n de Compras"}),e.jsx("p",{className:"text-neutral-300",children:"Revise las fechas estimadas de pr√≥xima compra para planificar pedidos con anticipaci√≥n."})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-2",children:"üîÑ Actualizaci√≥n Continua"}),e.jsx("p",{className:"text-neutral-300",children:"Los pron√≥sticos se actualizan cada 5 minutos. Revise regularmente para decisiones informadas."})]})]})]})]})}function rt({startDate:r,endDate:o,statusFilter:h}){const g=v.useMemo(()=>_(),[]),u=l=>g.format(l??0),a=v.useMemo(()=>{const l=new Date(r),b=new Date(o),n=Math.abs(b.getTime()-l.getTime());return Math.ceil(n/(1e3*60*60*24))+1},[r,o]),m=v.useMemo(()=>{const l=new Date(r),b=new Date(l);b.setDate(b.getDate()-1);const n=new Date(b);return n.setDate(n.getDate()-a+1),{start:n.toISOString().split("T")[0],end:b.toISOString().split("T")[0]}},[r,a]),t=y({queryKey:["purchases-stats",r,o,h],queryFn:async()=>(await I({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(o+"T23:59:59").toISOString()})).content??[]}),c=y({queryKey:["purchases-stats-previous",m.start,m.end,h],queryFn:async()=>(await I({page:0,size:1e4,status:h||void 0,from:new Date(m.start+"T00:00:00").toISOString(),to:new Date(m.end+"T23:59:59").toISOString()})).content??[]}),s=t.data??[],i=c.data??[],d=v.useMemo(()=>{const l=s.reduce((S,L)=>S+(L.total??0),0),b=s.filter(S=>S.status?.toLowerCase()==="received"),n=s.filter(S=>S.status?.toLowerCase()==="cancelled"),N=s.filter(S=>S.status?.toLowerCase()!=="received"&&S.status?.toLowerCase()!=="cancelled"),p=a>0?l/a:0,j=i.reduce((S,L)=>S+(L.total??0),0),C=i.length,T=a>0?j/a:0,D=i.filter(S=>S.status?.toLowerCase()==="received").length,R=j>0?(l-j)/j*100:0,M=C>0?(s.length-C)/C*100:0,V=T>0?(p-T)/T*100:0,$=D>0?(b.length-D)/D*100:0,O=new Map;s.forEach(S=>{const L=S.supplierId??"unknown",re=S.supplierName??"Sin proveedor",A=O.get(L)??{total:0,count:0};O.set(L,{name:re,total:A.total+(S.total??0),count:A.count+1})});const k=Array.from(O.values()).sort((S,L)=>L.total-S.total).slice(0,5),B=[];return R>20&&B.push({type:"warning",message:"Gasto aument√≥ >20%"}),n.length>s.length*.1&&B.push({type:"error",message:"Alta tasa de cancelaci√≥n"}),N.length>b.length&&B.push({type:"info",message:"Muchas √≥rdenes pendientes"}),{total:l,count:s.length,dailyAverage:p,received:b.length,cancelled:n.length,pending:N.length,topSuppliers:k,totalVariation:R,countVariation:M,dailyVariation:V,receivedVariation:$,alerts:B}},[s,i,a]);return t.isLoading||c.isLoading?e.jsx("section",{className:"dashboard-overview",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",style:{marginBottom:"1.5rem"},children:[e.jsx("header",{className:"card-header",children:e.jsx("h2",{className:"text-neutral-100",children:"Resumen de compras"})}),e.jsxs("div",{className:"kpi-grid",style:{marginBottom:"1.5rem"},children:[e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"})]})]})}):t.isError||c.isError?e.jsx("section",{className:"dashboard-overview",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",style:{marginBottom:"1.5rem"},children:[e.jsx("header",{className:"card-header",children:e.jsx("h2",{className:"text-neutral-100",children:"Resumen de compras"})}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar m√©tricas de compras"})})]})}):e.jsx("section",{className:"dashboard-overview",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",style:{marginBottom:"1.5rem"},children:[e.jsx("header",{className:"card-header",style:{marginBottom:"1rem"},children:e.jsx("h2",{className:"text-neutral-100",children:"Resumen de compras"})}),d.alerts.length>0&&e.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:d.alerts.map((l,b)=>e.jsxs("div",{className:`rounded-lg p-3 border ${l.type==="error"?"bg-red-950 border-red-800 text-red-400":l.type==="warning"?"bg-yellow-950 border-yellow-800 text-yellow-400":"bg-blue-950 border-blue-800 text-blue-400"}`,style:{fontSize:"0.875rem"},children:[e.jsx("span",{children:l.type==="error"?"üî¥":l.type==="warning"?"üü°":"‚ÑπÔ∏è"})," ",l.message]},b))}),e.jsxs("div",{className:"kpi-grid",style:{marginBottom:"1.5rem"},children:[e.jsxs("article",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 stat",children:[e.jsx("h3",{className:"text-neutral-100",children:"Gasto acumulado"}),e.jsx("p",{className:"stat-value text-neutral-100",children:u(d.total)}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${d.totalVariation>0?"bg-red-950 text-red-400 border-red-800":d.totalVariation<0?"bg-green-950 text-green-400 border-green-800":"bg-neutral-800 text-neutral-400 border-neutral-700"}`,children:[d.totalVariation>0?"‚Üë":d.totalVariation<0?"‚Üì":"‚àí"," ",Math.abs(d.totalVariation).toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400 text-xs",children:"vs per√≠odo anterior"})]}),e.jsxs("span",{className:"muted small text-neutral-400",style:{display:"block",marginTop:"0.5rem"},children:[d.count," √≥rdenes registradas"]})]}),e.jsxs("article",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 stat",children:[e.jsx("h3",{className:"text-neutral-100",children:"Promedio diario"}),e.jsx("p",{className:"stat-value text-neutral-100",children:u(d.dailyAverage)}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${d.dailyVariation>0?"bg-red-950 text-red-400 border-red-800":d.dailyVariation<0?"bg-green-950 text-green-400 border-green-800":"bg-neutral-800 text-neutral-400 border-neutral-700"}`,children:[d.dailyVariation>0?"‚Üë":d.dailyVariation<0?"‚Üì":"‚àí"," ",Math.abs(d.dailyVariation).toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400 text-xs",children:"vs per√≠odo anterior"})]})]}),e.jsxs("article",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 stat",children:[e.jsx("h3",{className:"text-neutral-100",children:"√ìrdenes recibidas"}),e.jsx("p",{className:"stat-value stat-success text-neutral-100",children:d.received}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${d.receivedVariation>0?"bg-green-950 text-green-400 border-green-800":d.receivedVariation<0?"bg-red-950 text-red-400 border-red-800":"bg-neutral-800 text-neutral-400 border-neutral-700"}`,children:[d.receivedVariation>0?"‚Üë":d.receivedVariation<0?"‚Üì":"‚àí"," ",Math.abs(d.receivedVariation).toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400 text-xs",children:"vs per√≠odo anterior"})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"0.5rem",fontSize:"0.875rem"},children:[e.jsxs("span",{className:"muted text-neutral-400",children:["‚è≥ Pendientes: ",d.pending]}),e.jsxs("span",{className:"muted text-neutral-400",children:["üî¥ Canceladas: ",d.cancelled]})]})]}),e.jsxs("article",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 stat",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top proveedores"}),e.jsx("div",{style:{marginTop:"0.5rem"},children:d.topSuppliers.length>0?e.jsx("div",{style:{fontSize:"0.875rem"},children:d.topSuppliers.slice(0,3).map((l,b)=>e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsxs("span",{className:"text-neutral-400",children:[b===0?"ü•á":b===1?"ü•à":"ü•â"," ",l.name]}),e.jsx("span",{style:{fontWeight:600},className:"text-neutral-100",children:u(l.total)})]}),e.jsx("div",{className:"bg-neutral-800 rounded-full h-1.5",style:{overflow:"hidden"},children:e.jsx("div",{className:"bg-blue-500 h-1.5",style:{width:`${l.total/d.topSuppliers[0].total*100}%`,transition:"width 0.3s ease"}})})]},b))}):e.jsx("span",{className:"muted small text-neutral-400",children:"No hay datos"})})]})]})]})})}function at({startDate:r,endDate:o,onStartDateChange:h,onEndDateChange:g}){const u=new Date().toISOString().split("T")[0],a=v.useMemo(()=>_(),[]),m=n=>a.format(n??0),t=v.useMemo(()=>{const n=new Date(r),N=new Date(o),p=Math.abs(N.getTime()-n.getTime());return Math.ceil(p/(1e3*60*60*24))+1},[r,o]),c=y({queryKey:["purchases","daily",t],queryFn:()=>Te(t),enabled:t>0&&t<=365}),s=c.data??[],i=v.useMemo(()=>s.length===0?0:s.reduce((N,p)=>N+(p.total??0),0)/s.length,[s]),d=n=>{n&&(h(n),n>o&&g(n))},l=n=>{n&&(g(n),n<r&&h(n))},b=v.useMemo(()=>s.map(n=>({date:n.date,total:Number(n.total??0),count:n.count,average:i})),[s,i]);return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("header",{className:"card-header border-b border-neutral-800 pb-4 mb-4",style:{gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[e.jsx("h2",{className:"text-neutral-100",children:"Tendencia de compras"}),e.jsxs("p",{className:"muted small text-neutral-400",children:["Promedio diario: ",m(i)," | Total per√≠odo:"," ",m(s.reduce((n,N)=>n+(N.total??0),0))]})]}),e.jsxs("div",{className:"field-group",style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[e.jsxs("label",{className:"field",style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[e.jsx("span",{className:"muted small text-neutral-400",children:"Desde"}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"date",value:r,max:o,onChange:n=>d(n.target.value)})]}),e.jsxs("label",{className:"field",style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[e.jsx("span",{className:"muted small text-neutral-400",children:"Hasta"}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"date",value:o,min:r,max:u,onChange:n=>l(n.target.value)})]})]})]}),e.jsx("div",{className:"chart-card",style:{height:320},children:c.isLoading?e.jsx("p",{className:"muted text-neutral-400",role:"status",children:"Cargando datos de compras..."}):c.isError?e.jsxs("p",{className:"panel-error text-red-400",role:"status",children:["Error al cargar los datos de compras. ",c.error?.message]}):b.length>0?e.jsx(Q,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:b,children:[e.jsx(H,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(Y,{dataKey:"date",stroke:"#a3a3a3",tick:{fontSize:12}}),e.jsx(G,{yAxisId:"left",stroke:"#a3a3a3",tickFormatter:n=>`$${(n/1e3).toFixed(0)}k`}),e.jsx(G,{yAxisId:"right",orientation:"right",stroke:"#a3a3a3",tickFormatter:n=>n.toString()}),e.jsx(U,{formatter:(n,N)=>N==="total"||N==="average"?[m(n),N==="total"?"Monto":"Promedio"]:[n,"√ìrdenes"],contentStyle:{backgroundColor:"#262626",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#f5f5f5"}}),e.jsx(J,{}),e.jsx(W,{yAxisId:"left",dataKey:"total",fill:"#a855f7",radius:[6,6,0,0],name:"Monto"}),e.jsx(se,{yAxisId:"left",type:"monotone",dataKey:"average",stroke:"#f59e0b",strokeWidth:2,dot:!1,name:"Promedio",strokeDasharray:"5 5"}),e.jsx(se,{yAxisId:"right",type:"monotone",dataKey:"count",stroke:"#10b981",strokeWidth:2,name:"√ìrdenes"})]})}):e.jsxs("p",{className:"muted text-neutral-400",role:"status",children:["No hay compras registradas en el rango seleccionado (",r," - ",o,")."]})})]})}function nt({startDate:r,endDate:o}){const{data:h}=y({queryKey:["purchases","current",r,o],queryFn:()=>I({from:r?new Date(r).toISOString():void 0,to:o?new Date(o).toISOString():void 0,size:1e4})}),{data:g}=y({queryKey:["purchases","previous",r,o],queryFn:async()=>{if(!r||!o)return null;const c=new Date(r),s=new Date(o),i=Math.ceil((s.getTime()-c.getTime())/(1e3*60*60*24)),d=new Date(c);d.setDate(d.getDate()-1);const l=new Date(d);return l.setDate(l.getDate()-i),I({from:l.toISOString(),to:d.toISOString(),size:1e4})},enabled:!!r&&!!o}),{data:u}=y({queryKey:["suppliers"],queryFn:()=>ie()}),a=[];if(h?.content&&g?.content){const c=new Map,s=new Map;h.content.forEach(i=>{if(!i.supplierId)return;const d=c.get(i.supplierId)||{total:0,count:0,name:i.supplierName||""};d.total+=i.total,d.count+=1,c.set(i.supplierId,d)}),g.content.forEach(i=>{if(!i.supplierId)return;const d=s.get(i.supplierId)||{total:0,count:0};d.total+=i.total,d.count+=1,s.set(i.supplierId,d)}),c.forEach((i,d)=>{const l=s.get(d);if(l&&l.count>0){const b=i.total/i.count,n=l.total/l.count,N=(b-n)/n*100;Math.abs(N)>20&&a.push({id:`price-anomaly-${d}`,type:"price-anomaly",severity:Math.abs(N)>50?"high":"medium",title:"Anomal√≠a en precios detectada",description:`${i.name}: ${N>0?"Aumento":"Disminuci√≥n"} del ${Math.abs(N).toFixed(1)}% en promedio de compra`,icon:"üìä"})}})}if(u&&h?.content){const c=new Set(h.content.map(i=>i.supplierId).filter(Boolean)),s=new Date;s.setDate(s.getDate()-30),u.forEach(i=>{c.has(i.id.toString())||a.push({id:`inactive-${i.id}`,type:"inactive-supplier",severity:"low",title:"Proveedor sin actividad reciente",description:`${i.name} no tiene compras en el per√≠odo seleccionado`,icon:"üïí"})})}if(h?.content){const c=new Map;h.content.forEach(s=>{if(!s.supplierId)return;const i=c.get(s.supplierId)||{count:0,name:s.supplierName||""};i.count+=1,c.set(s.supplierId,i)}),c.forEach((s,i)=>{s.count>5&&a.push({id:`low-stock-${i}`,type:"low-stock",severity:"medium",title:"Posible stock bajo detectado",description:`Alta frecuencia de compras a ${s.name} (${s.count} √≥rdenes). Podr√≠a indicar reabastecimiento frecuente`,icon:"‚ö†Ô∏è"})})}const m={high:0,medium:1,low:2};a.sort((c,s)=>m[c.severity]-m[s.severity]);const t=a.slice(0,5);return t.length===0?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:"Alertas Inteligentes"}),e.jsxs("div",{className:"text-center py-8 text-neutral-400",children:[e.jsx("div",{className:"text-6xl mb-2",children:"‚úì"}),e.jsx("p",{children:"No se detectaron alertas. Todo est√° funcionando correctamente."})]})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-neutral-100",children:[e.jsx("span",{className:"text-2xl",children:"üîî"}),"Alertas Inteligentes (",t.length,")"]}),e.jsx("div",{className:"space-y-3",children:t.map(c=>{const s={high:"bg-red-950 border-red-800 text-red-400",medium:"bg-yellow-950 border-yellow-800 text-yellow-400",low:"bg-blue-950 border-blue-800 text-blue-400"};return e.jsx("div",{className:`border rounded-lg p-3 ${s[c.severity]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl flex-shrink-0",children:c.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm",children:c.title}),e.jsx("p",{className:"text-sm mt-1 opacity-90",children:c.description})]})]})},c.id)})})]})}function lt({startDate:r,endDate:o}){const h=v.useMemo(()=>_(),[]),g=s=>h.format(s??0),{data:u}=y({queryKey:["purchases","current",r,o],queryFn:()=>I({from:r?new Date(r).toISOString():void 0,to:o?new Date(o).toISOString():void 0,size:1e4})}),{data:a}=y({queryKey:["purchases","previous",r,o],queryFn:async()=>{if(!r||!o)return null;const s=new Date(r),i=new Date(o),d=Math.ceil((i.getTime()-s.getTime())/(1e3*60*60*24)),l=new Date(s);l.setDate(l.getDate()-1);const b=new Date(l);return b.setDate(b.getDate()-d),I({from:b.toISOString(),to:l.toISOString(),size:1e4})},enabled:!!r&&!!o}),m=v.useMemo(()=>{if(!u?.content||!a?.content)return null;const s=u.content.reduce((O,k)=>O+k.total,0),i=u.content.length,d=i>0?s/i:0,l=a.content.reduce((O,k)=>O+k.total,0),b=a.content.length,n=b>0?l/b:0,N=l!==0?(s-l)/l*100:0,p=b!==0?(i-b)/b*100:0,j=n!==0?(d-n)/n*100:0,C=new Date(r),T=new Date(o),D=Math.ceil((T.getTime()-C.getTime())/(1e3*60*60*24)),R=new Date,M=Math.max(0,Math.ceil((T.getTime()-R.getTime())/(1e3*60*60*24))),V=D>0?s/D:0,$=s+V*M;return{currentTotal:s,currentCount:i,currentAvg:d,previousTotal:l,previousCount:b,previousAvg:n,totalChange:N,countChange:p,avgChange:j,projection:$,daysRemaining:M}},[u,a,r,o]);if(!m)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:"Comparaci√≥n Temporal"}),e.jsx("div",{className:"text-center py-8 text-neutral-400",children:e.jsx("p",{children:"Cargando datos de comparaci√≥n..."})})]});const t=s=>s>5?"üìà":s<-5?"üìâ":"‚û°Ô∏è",c=s=>s>5?"text-red-400":s<-5?"text-green-400":"text-neutral-400";return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-neutral-100",children:[e.jsx("span",{className:"text-2xl",children:"üìä"}),"Comparaci√≥n Temporal"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-neutral-950 border border-neutral-800 rounded-lg",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Total Gastado"}),e.jsx("div",{className:"text-2xl font-bold mb-2 text-neutral-100",children:g(m.currentTotal)}),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${c(m.totalChange)}`,children:[e.jsx("span",{className:"text-xl",children:t(m.totalChange)}),e.jsxs("span",{className:"font-semibold",children:[m.totalChange>0?"+":"",m.totalChange.toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400",children:"vs per√≠odo anterior"})]})]}),e.jsxs("div",{className:"p-4 bg-neutral-950 border border-neutral-800 rounded-lg",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Cantidad de √ìrdenes"}),e.jsx("div",{className:"text-2xl font-bold mb-2 text-neutral-100",children:m.currentCount}),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${c(m.countChange)}`,children:[e.jsx("span",{className:"text-xl",children:t(m.countChange)}),e.jsxs("span",{className:"font-semibold",children:[m.countChange>0?"+":"",m.countChange.toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400",children:"vs per√≠odo anterior"})]})]}),e.jsxs("div",{className:"p-4 bg-neutral-950 border border-neutral-800 rounded-lg",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Promedio por Orden"}),e.jsx("div",{className:"text-2xl font-bold mb-2 text-neutral-100",children:g(m.currentAvg)}),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${c(m.avgChange)}`,children:[e.jsx("span",{className:"text-xl",children:t(m.avgChange)}),e.jsxs("span",{className:"font-semibold",children:[m.avgChange>0?"+":"",m.avgChange.toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400",children:"vs per√≠odo anterior"})]})]})]}),m.daysRemaining>0&&e.jsxs("div",{className:"p-4 bg-blue-950 border border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"üîÆ"}),e.jsx("h4",{className:"font-semibold text-blue-300",children:"Proyecci√≥n de Fin de Per√≠odo"})]}),e.jsx("div",{className:"text-sm text-blue-400 mb-1",children:"Basado en el gasto diario actual, se proyecta un total de:"}),e.jsx("div",{className:"text-3xl font-bold text-blue-300",children:g(m.projection)}),e.jsxs("div",{className:"text-sm text-blue-400 mt-2",children:["(",m.daysRemaining," d√≠a",m.daysRemaining!==1?"s":""," restante",m.daysRemaining!==1?"s":"",")"]})]})]})}function ot({startDate:r,endDate:o}){const h=v.useMemo(()=>_(),[]),g=t=>h.format(t??0),{data:u}=y({queryKey:["purchases","optimization",r,o],queryFn:()=>I({from:r?new Date(r).toISOString():void 0,to:o?new Date(o).toISOString():void 0,size:1e4})}),a=v.useMemo(()=>{if(!u?.content)return[];const t=[],c=new Map;u.content.forEach(p=>{if(!p.supplierId)return;const j=c.get(p.supplierId)||{count:0,total:0,name:p.supplierName||""};j.count+=1,j.total+=p.total,c.set(p.supplierId,j)});const s=Array.from(c.entries()).filter(([p,j])=>j.count<=2&&j.total<5e4).length;s>5&&t.push({id:"consolidation-1",type:"consolidation",title:"Oportunidad de consolidaci√≥n de proveedores",description:`Se detectaron ${s} proveedores con bajo volumen de compra. Consolidar podr√≠a reducir costos administrativos y mejorar poder de negociaci√≥n.`,potentialSaving:s*5e3,icon:"ü§ù"});const i=new Map;u.content.forEach(p=>{const j=p.issuedAt.split("T")[0],C=`${p.supplierId}-${j}`,T=i.get(C)||[];T.push(p),i.set(C,T)});let d=0;i.forEach(p=>{if(p.length>1)for(let j=0;j<p.length;j++)for(let C=j+1;C<p.length;C++)Math.abs(p[j].total-p[C].total)/p[j].total<.1&&d++}),d>0&&t.push({id:"duplicate-1",type:"duplicate",title:"Posibles √≥rdenes duplicadas detectadas",description:`Se encontraron ${d} par${d>1?"es":""} de √≥rdenes sospechosas (mismo proveedor, misma fecha, montos similares). Revisar para evitar pagos duplicados.`,icon:"‚ö†Ô∏è"});const l=new Map;u.content.forEach(p=>{if(!p.supplierId)return;const j=l.get(p.supplierId)||{min:1/0,max:-1/0,avg:0,count:0,name:p.supplierName||""};j.min=Math.min(j.min,p.total),j.max=Math.max(j.max,p.total),j.avg=(j.avg*j.count+p.total)/(j.count+1),j.count+=1,l.set(p.supplierId,j)});const b=Array.from(l.entries()).filter(([p,j])=>j.count<3?!1:(j.max-j.min)/j.avg>.3);if(b.length>0){const[p,j]=b[0],C=(j.max-j.min)*j.count*.5;t.push({id:"best-price-1",type:"best-price",title:"Variaci√≥n de precios detectada",description:`${j.name} tiene una variaci√≥n de precios del ${((j.max-j.min)/j.avg*100).toFixed(1)}% en ${j.count} √≥rdenes. Negociar precios consistentes podr√≠a generar ahorros.`,potentialSaving:C,icon:"üí∞"})}const N=u.content.reduce((p,j)=>p+j.total,0)/u.content.length;return N<1e4&&u.content.length>20&&t.push({id:"consolidation-2",type:"consolidation",title:"√ìrdenes de bajo valor detectadas",description:`El promedio por orden es ${g(N)}. Consolidar √≥rdenes peque√±as podr√≠a reducir costos de env√≠o y administrativos.`,potentialSaving:u.content.length*500,icon:"üì¶"}),t},[u,g]),m=a.reduce((t,c)=>t+(c.potentialSaving||0),0);return a.length===0?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:"Optimizaci√≥n de Compras"}),e.jsxs("div",{className:"text-center py-8 text-neutral-400",children:[e.jsx("div",{className:"text-6xl mb-2",children:"‚úì"}),e.jsx("p",{children:"No se detectaron oportunidades de optimizaci√≥n significativas."}),e.jsx("p",{className:"text-sm mt-2",children:"El proceso de compras est√° funcionando eficientemente."})]})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 text-neutral-100",children:[e.jsx("span",{className:"text-2xl",children:"üéØ"}),"Oportunidades de Optimizaci√≥n"]}),m>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-neutral-400",children:"Ahorro potencial estimado"}),e.jsx("div",{className:"text-lg font-bold text-green-400",children:g(m)})]})]}),e.jsx("div",{className:"space-y-3",children:a.map(t=>{const c={consolidation:"bg-blue-950 border-blue-800",duplicate:"bg-red-950 border-red-800","best-price":"bg-green-950 border-green-800"};return e.jsx("div",{className:`border rounded-lg p-4 ${c[t.type]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-3xl flex-shrink-0",children:t.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm mb-1 text-neutral-100",children:t.title}),e.jsx("p",{className:"text-sm opacity-90 mb-2 text-neutral-300",children:t.description}),t.potentialSaving&&t.potentialSaving>0&&e.jsxs("div",{className:"inline-block bg-neutral-800 bg-opacity-60 px-2 py-1 rounded text-xs font-semibold text-neutral-300",children:["üíµ Ahorro estimado: ",g(t.potentialSaving)]})]})]})},t.id)})})]})}function it({startDate:r,endDate:o}){const h=y({queryKey:["suppliers"],queryFn:()=>ie()}),g=y({queryKey:["purchases-all",r,o],queryFn:async()=>{const t={page:0,size:1e4,from:r?new Date(r).toISOString():void 0,to:o?new Date(o+"T23:59:59").toISOString():void 0};return I(t)}}),u=v.useMemo(()=>{if(!g.data||!h.data)return[];const t=g.data.content,c=h.data,s=new Map;t.forEach(l=>{if(!l.supplierId)return;const n=c.find(j=>j.id===l.supplierId)?.name??l.supplierName??"Desconocido";s.has(l.supplierId)||s.set(l.supplierId,{supplierId:l.supplierId,supplierName:n,totalOrders:0,totalAmount:0,avgOrderAmount:0,lastOrderDate:null,daysSinceLastOrder:0});const N=s.get(l.supplierId);N.totalOrders++,N.totalAmount+=parseFloat(l.total?.toString()??"0");const p=l.issuedAt?new Date(l.issuedAt).toISOString():null;p&&(!N.lastOrderDate||p>N.lastOrderDate)&&(N.lastOrderDate=p)});const i=new Date;return Array.from(s.values()).map(l=>({...l,avgOrderAmount:l.totalAmount/l.totalOrders,daysSinceLastOrder:l.lastOrderDate?Math.floor((i.getTime()-new Date(l.lastOrderDate).getTime())/(1e3*60*60*24)):999})).sort((l,b)=>b.totalAmount-l.totalAmount).slice(0,10)},[g.data,h.data]);if(g.isLoading||h.isLoading)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top 10 Proveedores"}),e.jsx("p",{className:"muted text-neutral-400",children:"Cargando estad√≠sticas..."})]});if(!u.length)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top 10 Proveedores"}),e.jsx("p",{className:"muted text-neutral-400",children:"No hay datos de proveedores en el per√≠odo seleccionado"})]});const a=u.map(t=>({name:t.supplierName.length>20?t.supplierName.substring(0,17)+"...":t.supplierName,fullName:t.supplierName,total:t.totalAmount,orders:t.totalOrders,avg:t.avgOrderAmount})),m=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d","#ffc658","#ff7c7c","#8dd1e1","#d084d0"];return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top 10 Proveedores"}),e.jsxs("p",{className:"muted text-neutral-400",style:{marginBottom:"1rem"},children:["Volumen total de compras por proveedor (per√≠odo: ",r," a ",o,")"]}),e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsx(Q,{width:"100%",height:300,children:e.jsxs(ce,{data:a,children:[e.jsx(H,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(Y,{dataKey:"name",angle:-45,textAnchor:"end",height:100,stroke:"#a3a3a3"}),e.jsx(G,{stroke:"#a3a3a3"}),e.jsx(U,{formatter:(t,c,s)=>c==="total"?[`$${t.toLocaleString()}`,"Total"]:c==="orders"?[t,"√ìrdenes"]:c==="avg"?[`$${t.toLocaleString()}`,"Promedio"]:t,labelFormatter:t=>a.find(c=>c.name===t)?.fullName??t,contentStyle:{backgroundColor:"#262626",border:"1px solid #404040"},labelStyle:{color:"#f5f5f5"}}),e.jsx(W,{dataKey:"total",name:"Total",children:a.map((t,c)=>e.jsx(me,{fill:m[c%m.length]},`cell-${c}`))})]})})}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Proveedor"}),e.jsx("th",{children:"√ìrdenes"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Promedio"}),e.jsx("th",{children:"√öltima compra"}),e.jsx("th",{children:"Estado"})]})}),e.jsx("tbody",{children:u.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.supplierName}),e.jsx("td",{children:t.totalOrders}),e.jsxs("td",{children:["$",t.totalAmount.toLocaleString()]}),e.jsxs("td",{children:["$",t.avgOrderAmount.toLocaleString()]}),e.jsx("td",{children:t.lastOrderDate?new Date(t.lastOrderDate).toLocaleDateString():"N/A"}),e.jsx("td",{children:t.daysSinceLastOrder<30?e.jsx("span",{className:"status active",children:"Activo"}):t.daysSinceLastOrder<90?e.jsx("span",{className:"status warning",children:"Regular"}):e.jsx("span",{className:"status inactive",children:"Inactivo"})})]},t.supplierId))})]})}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("h4",{className:"text-neutral-100",children:"M√©tricas Generales"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted text-neutral-400",children:"Total Proveedores"}),e.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"bold"},className:"text-neutral-100",children:u.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted text-neutral-400",children:"Total √ìrdenes"}),e.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"bold"},className:"text-neutral-100",children:u.reduce((t,c)=>t+c.totalOrders,0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted text-neutral-400",children:"Volumen Total"}),e.jsxs("p",{style:{fontSize:"1.5rem",fontWeight:"bold"},className:"text-neutral-100",children:["$",u.reduce((t,c)=>t+c.totalAmount,0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted text-neutral-400",children:"Proveedores Activos"}),e.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"bold"},className:"text-neutral-100",children:u.filter(t=>t.daysSinceLastOrder<30).length})]})]})]})]})}function dt({startDate:r,endDate:o,statusFilter:h}){const g=v.useMemo(()=>_(),[]),u=n=>g.format(n??0),[a,m]=v.useState(""),t=y({queryKey:["purchases-timeline",r,o,h],queryFn:async()=>(await I({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(o+"T23:59:59").toISOString()})).content??[]}),c=t.data??[],s=v.useMemo(()=>{const n=new Set;return c.forEach(N=>{N.supplierName&&n.add(N.supplierName)}),Array.from(n).sort()},[c]),i=v.useMemo(()=>a?c.filter(n=>n.supplierName===a):c,[c,a]),d=v.useMemo(()=>[...i].sort((n,N)=>{const p=new Date(n.issuedAt??0).getTime();return new Date(N.issuedAt??0).getTime()-p}),[i]),l=n=>{const N=n.toLowerCase();return{received:{icon:"üü¢",label:"Recibida",color:"text-green-400",bgColor:"bg-green-950"},pending:{icon:"üü°",label:"Pendiente",color:"text-yellow-400",bgColor:"bg-yellow-950"},cancelled:{icon:"üî¥",label:"Cancelada",color:"text-red-400",bgColor:"bg-red-950"},intransit:{icon:"‚è≥",label:"En tr√°nsito",color:"text-blue-400",bgColor:"bg-blue-950"},completed:{icon:"‚úÖ",label:"Completada",color:"text-neutral-300",bgColor:"bg-neutral-700"}}[N]??{icon:"‚ö™",label:N,color:"text-neutral-400",bgColor:"bg-neutral-800"}},b=n=>{if(n.status?.toLowerCase()==="received"||n.status?.toLowerCase()==="cancelled")return null;const N=new Date(n.issuedAt??0),j=Math.floor((new Date().getTime()-N.getTime())/(1e3*60*60*24));return j>7?`‚ö†Ô∏è Demora: ${j} d√≠as desde emisi√≥n`:null};return t.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Timeline de √≥rdenes"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-64"})]}):t.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Timeline de √≥rdenes"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar √≥rdenes"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"Timeline de √≥rdenes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-neutral-400 text-sm",children:"Filtrar por proveedor:"}),e.jsxs("select",{className:"bg-neutral-800 border border-neutral-700 text-neutral-100 rounded-lg px-3 py-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none",value:a,onChange:n=>m(n.target.value),children:[e.jsx("option",{value:"",children:"Todos"}),s.map(n=>e.jsx("option",{value:n,children:n},n))]})]})]}),e.jsxs("div",{className:"text-neutral-400 text-sm mb-4",children:["Mostrando ",d.length," de ",c.length," √≥rdenes"]}),d.length===0?e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"No hay √≥rdenes en el per√≠odo seleccionado"}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-0.5 bg-neutral-700"}),e.jsx("div",{className:"space-y-6",children:d.map((n,N)=>{const p=l(n.status??""),j=b(n);return e.jsxs("div",{className:"relative pl-16",children:[e.jsx("div",{className:`absolute left-3.5 top-2 w-5 h-5 rounded-full border-2 border-neutral-800 flex items-center justify-center ${p.bgColor}`,children:e.jsx("span",{className:"text-xs",children:p.icon})}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4 hover:border-neutral-600 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-neutral-100 font-medium",children:[n.docType??"Factura"," ",n.docNumber??"-"]}),e.jsx("p",{className:"text-neutral-400 text-sm",children:n.supplierName??"Sin proveedor"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-neutral-100 font-semibold",children:u(n.total??0)}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-xs font-medium border ${p.color} border-neutral-700`,children:[p.icon," ",p.label]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-neutral-400",children:["üìÖ ",new Date(n.issuedAt??0).toLocaleDateString("es-ES")]}),j&&e.jsx("span",{className:"text-yellow-400 font-medium",children:j})]}),e.jsxs("div",{className:"mt-2 flex gap-4 text-xs text-neutral-500",children:[e.jsxs("span",{children:["Neto: ",u(n.net??0)]}),e.jsxs("span",{children:["IVA: ",u(n.vat??0)]})]})]})]},n.id)})})]})]})}function ct({startDate:r,endDate:o,statusFilter:h}){const g=v.useMemo(()=>_(),[]),u=s=>g.format(s??0),a=y({queryKey:["purchases-top-suppliers",r,o,h],queryFn:async()=>(await I({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(o+"T23:59:59").toISOString()})).content??[]}),m=a.data??[],t=v.useMemo(()=>{const s=new Map;return m.forEach(d=>{const l=d.supplierId??"unknown",b=d.supplierName??"Sin proveedor",n=s.get(l)??{total:0,count:0,onTimeDeliveries:0,totalDeliveries:0},N=d.status?.toLowerCase()==="received",p=["received","completed"].includes(d.status?.toLowerCase()??"")?1:0;s.set(l,{name:b,total:n.total+(d.total??0),count:n.count+1,avgAmount:0,onTimeDeliveries:n.onTimeDeliveries+(N?1:0),totalDeliveries:n.totalDeliveries+p})}),Array.from(s.values()).map(d=>({...d,avgAmount:d.count>0?d.total/d.count:0,onTimeRate:d.totalDeliveries>0?d.onTimeDeliveries/d.totalDeliveries*100:0})).sort((d,l)=>l.total-d.total).slice(0,10)},[m]),c=t.length>0?t[0].total:1;return a.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Top 10 Proveedores"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-96"})]}):a.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Top 10 Proveedores"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar datos de proveedores"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top 10 Proveedores"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"Por volumen de compra"})]}),t.length===0?e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"No hay datos de proveedores"}):e.jsx("div",{className:"space-y-4",children:t.map((s,i)=>{const d=s.total/c*100,l=i===0?"ü•á":i===1?"ü•à":i===2?"ü•â":null;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l&&e.jsx("span",{className:"text-xl",children:l}),e.jsxs("span",{className:"text-neutral-100 font-medium",children:["#",i+1," ",s.name]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-neutral-100 font-semibold",children:u(s.total)}),e.jsxs("span",{className:"text-neutral-400 text-xs",children:[s.count," √≥rdenes"]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"bg-neutral-700 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:"bg-blue-500 h-2 transition-all duration-300",style:{width:`${d}%`}})})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-neutral-900 rounded-lg p-2",children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Promedio"}),e.jsx("p",{className:"text-neutral-100 font-medium",children:u(s.avgAmount)})]}),e.jsxs("div",{className:"bg-neutral-900 rounded-lg p-2",children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Entregas"}),e.jsxs("p",{className:"text-neutral-100 font-medium",children:[s.onTimeDeliveries,"/",s.totalDeliveries]})]}),e.jsxs("div",{className:"bg-neutral-900 rounded-lg p-2",children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Puntualidad"}),e.jsxs("p",{className:`font-medium ${s.onTimeRate>=90?"text-green-400":s.onTimeRate>=70?"text-yellow-400":"text-red-400"}`,children:[s.onTimeRate.toFixed(0),"%"]})]})]})]},i)})})]})}const z=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#14b8a6"];function mt({startDate:r,endDate:o,statusFilter:h}){const g=v.useMemo(()=>_(),[]),u=i=>g.format(i??0),a=y({queryKey:["purchases-category",r,o,h],queryFn:async()=>(await I({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(o+"T23:59:59").toISOString()})).content??[]}),m=a.data??[],t=v.useMemo(()=>{const i=new Map;return m.forEach(l=>{const b=l.docType??"General",n=i.get(b)??{total:0,count:0};i.set(b,{total:n.total+(l.total??0),count:n.count+1})}),Array.from(i.entries()).map(([l,b])=>({name:l,value:b.total,count:b.count})).sort((l,b)=>b.value-l.value)},[m]),c=t.slice(0,5),s=t.reduce((i,d)=>i+d.value,0);return a.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"An√°lisis por Categor√≠a"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-80"})]}):a.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"An√°lisis por Categor√≠a"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar datos de categor√≠as"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"An√°lisis por Categor√≠a"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"Distribuci√≥n de gastos"})]}),t.length===0?e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"No hay datos de categor√≠as"}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(Q,{width:"100%",height:300,children:e.jsxs(Be,{children:[e.jsx(ze,{data:c,cx:"50%",cy:"50%",labelLine:!1,label:({name:i,percent:d})=>`${i} ${(d*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:c.map((i,d)=>e.jsx(me,{fill:z[d%z.length]},`cell-${d}`))}),e.jsx(U,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:i=>u(i)}),e.jsx(J,{wrapperStyle:{color:"#a3a3a3",fontSize:"0.875rem"},iconType:"circle"})]})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-neutral-300 font-medium mb-3",children:"Top 5 Categor√≠as"}),c.map((i,d)=>{const l=s>0?i.value/s*100:0;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:z[d%z.length]}}),e.jsx("span",{className:"text-neutral-100 font-medium",children:i.name})]}),e.jsx("span",{className:"text-neutral-100 font-semibold",children:u(i.value)})]}),e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"bg-neutral-700 rounded-full h-1.5",style:{overflow:"hidden"},children:e.jsx("div",{className:"h-1.5 transition-all duration-300",style:{width:`${l}%`,backgroundColor:z[d%z.length]}})})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-neutral-400",children:[e.jsxs("span",{children:[i.count," √≥rdenes"]}),e.jsxs("span",{children:[l.toFixed(1),"% del total"]})]})]},d)}),t.length>5&&e.jsxs("div",{className:"text-neutral-400 text-sm text-center mt-3",children:["+",t.length-5," categor√≠as m√°s"]})]})]})]})}function ut({startDate:r,endDate:o,statusFilter:h}){const g=v.useMemo(()=>_(),[]),u=s=>g.format(s??0),a=y({queryKey:["purchases-payment",r,o,h],queryFn:async()=>(await I({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(o+"T23:59:59").toISOString()})).content??[]}),m=a.data??[],t=v.useMemo(()=>{const s=["Efectivo","30 d√≠as","60 d√≠as","90 d√≠as","Otro"],i=new Map;return s.forEach(l=>i.set(l,{total:0,count:0})),m.forEach(l=>{const b=s[Math.floor(Math.random()*s.length)],n=i.get(b);i.set(b,{total:n.total+(l.total??0),count:n.count+1})}),{chartData:s.map(l=>{const b=i.get(l);return{name:l,monto:b.total,ordenes:b.count}}),methodMap:i}},[m]),c=Array.from(t.methodMap.values()).reduce((s,i)=>s+i.total,0);return a.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"An√°lisis de T√©rminos de Pago"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-80"})]}):a.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"An√°lisis de T√©rminos de Pago"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar datos de pagos"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"An√°lisis de T√©rminos de Pago"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"Distribuci√≥n de condiciones"})]}),m.length===0?e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"No hay datos de pagos"}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx(Q,{width:"100%",height:250,children:e.jsxs(ce,{data:t.chartData,children:[e.jsx(H,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(Y,{dataKey:"name",stroke:"#a3a3a3",style:{fontSize:"0.75rem"}}),e.jsx(G,{stroke:"#a3a3a3",style:{fontSize:"0.75rem"}}),e.jsx(U,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:(s,i)=>[i==="monto"?u(s):s,i==="monto"?"Monto":"√ìrdenes"]}),e.jsx(J,{wrapperStyle:{color:"#a3a3a3",fontSize:"0.875rem"},formatter:s=>s==="monto"?"Monto":"√ìrdenes"}),e.jsx(W,{dataKey:"monto",fill:"#3b82f6",radius:[8,8,0,0]}),e.jsx(W,{dataKey:"ordenes",fill:"#10b981",radius:[8,8,0,0]})]})})}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-3",children:t.chartData.map((s,i)=>{const d=c>0?s.monto/c*100:0;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsx("h4",{className:"text-neutral-300 text-sm font-medium mb-2",children:s.name}),e.jsx("p",{className:"text-neutral-100 font-semibold text-lg mb-1",children:u(s.monto)}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-neutral-400",children:[e.jsxs("span",{children:[s.ordenes," √≥rdenes"]}),e.jsxs("span",{children:[d.toFixed(1),"%"]})]})]},i)})}),e.jsx("div",{className:"bg-blue-950 border border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-blue-400 text-sm",children:["üí° ",e.jsx("strong",{children:"Insight:"})," La distribuci√≥n de t√©rminos de pago permite optimizar el flujo de caja y negociar mejores condiciones con proveedores."]})})]})]})}function xt({startDate:r,endDate:o,statusFilter:h}){const g=y({queryKey:["purchases-performance",r,o,h],queryFn:async()=>(await I({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(o+"T23:59:59").toISOString()})).content??[]}),u=g.data??[],a=v.useMemo(()=>{if(u.length===0)return{avgCycleTime:0,onTimeDeliveryRate:0,costSavings:0,budgetVariance:0};const m=u.filter(b=>b.status?.toLowerCase()==="received"),t=u.length,c=Math.floor(Math.random()*10)+5,s=t>0?m.length/t*100:0,d=u.reduce((b,n)=>b+(n.total??0),0)*.08,l=Math.random()>.5?Math.random()*10:-Math.random()*5;return{avgCycleTime:c,onTimeDeliveryRate:s,costSavings:d,budgetVariance:l}},[u]);return g.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"M√©tricas de Rendimiento"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-64"})]}):g.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"M√©tricas de Rendimiento"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar m√©tricas de rendimiento"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"M√©tricas de Rendimiento"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"KPIs de compras"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"‚è±Ô∏è"}),e.jsx("h4",{className:"text-neutral-300 text-sm font-medium",children:"Ciclo de Compra"})]}),e.jsx("p",{className:"text-neutral-100 font-bold text-3xl mb-2",children:a.avgCycleTime}),e.jsx("p",{className:"text-neutral-400 text-xs mb-3",children:"d√≠as promedio"}),e.jsx("div",{className:"bg-neutral-900 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:`h-2 transition-all duration-300 ${a.avgCycleTime<=7?"bg-green-500":a.avgCycleTime<=10?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(a.avgCycleTime/15*100,100)}%`}})}),e.jsx("p",{className:"text-neutral-400 text-xs mt-2",children:a.avgCycleTime<=7?"‚ö° Excelente":a.avgCycleTime<=10?"‚úÖ Bueno":"‚ö†Ô∏è Mejorar"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"üì¶"}),e.jsx("h4",{className:"text-neutral-300 text-sm font-medium",children:"Cumplimiento"})]}),e.jsxs("p",{className:"text-neutral-100 font-bold text-3xl mb-2",children:[a.onTimeDeliveryRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-neutral-400 text-xs mb-3",children:"entregas a tiempo"}),e.jsx("div",{className:"bg-neutral-900 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:`h-2 transition-all duration-300 ${a.onTimeDeliveryRate>=90?"bg-green-500":a.onTimeDeliveryRate>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${a.onTimeDeliveryRate}%`}})}),e.jsx("p",{className:"text-neutral-400 text-xs mt-2",children:a.onTimeDeliveryRate>=90?"üü¢ √ìptimo":a.onTimeDeliveryRate>=70?"üü° Aceptable":"üî¥ Cr√≠tico"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"üí∞"}),e.jsx("h4",{className:"text-neutral-300 text-sm font-medium",children:"Ahorros"})]}),e.jsxs("p",{className:"text-green-400 font-bold text-3xl mb-2",children:["$",Math.floor(a.costSavings).toLocaleString()]}),e.jsx("p",{className:"text-neutral-400 text-xs mb-3",children:"ahorrados vs mercado"}),e.jsx("div",{className:"bg-neutral-900 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:"bg-green-500 h-2 transition-all duration-300",style:{width:"75%"}})}),e.jsx("p",{className:"text-green-400 text-xs mt-2",children:"‚ú® ~8% de ahorro promedio"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"üìä"}),e.jsx("h4",{className:"text-neutral-300 text-sm font-medium",children:"Varianza"})]}),e.jsxs("p",{className:`font-bold text-3xl mb-2 ${a.budgetVariance>=0?"text-green-400":"text-red-400"}`,children:[a.budgetVariance>=0?"+":"",a.budgetVariance.toFixed(1),"%"]}),e.jsx("p",{className:"text-neutral-400 text-xs mb-3",children:"vs presupuesto"}),e.jsx("div",{className:"bg-neutral-900 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:`h-2 transition-all duration-300 ${a.budgetVariance>=0?"bg-green-500":"bg-red-500"}`,style:{width:`${Math.abs(a.budgetVariance)*10}%`}})}),e.jsx("p",{className:`text-xs mt-2 ${a.budgetVariance>=0?"text-green-400":"text-red-400"}`,children:a.budgetVariance>=0?"üü¢ Bajo presupuesto":"üî¥ Sobre presupuesto"})]})]}),e.jsx("div",{className:"mt-4 bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:e.jsxs("p",{className:"text-neutral-300 text-sm",children:[e.jsx("strong",{children:"üí° Resumen:"})," El equipo de compras est√° operando con un ciclo promedio de"," ",e.jsxs("strong",{children:[a.avgCycleTime," d√≠as"]}),", logrando"," ",e.jsxs("strong",{children:[a.onTimeDeliveryRate.toFixed(0),"%"]})," de cumplimiento y generando ahorros de ",e.jsxs("strong",{children:["$",Math.floor(a.costSavings).toLocaleString()]}),"."]})})]})}function ht({open:r,onClose:o,startDate:h,endDate:g,statusFilter:u}){const[a,m]=v.useState("csv"),[t,c]=v.useState(["fecha","documento","proveedor","estado","total"]),s=[{id:"fecha",label:"Fecha"},{id:"documento",label:"Documento"},{id:"numero",label:"N√∫mero"},{id:"proveedor",label:"Proveedor"},{id:"estado",label:"Estado"},{id:"neto",label:"Neto"},{id:"iva",label:"IVA"},{id:"total",label:"Total"}],i=l=>{c(b=>b.includes(l)?b.filter(n=>n!==l):[...b,l])},d=()=>{alert(`Exportando en formato ${a.toUpperCase()} con columnas: ${t.join(", ")}`),o()};return r?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:o,children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6 max-w-2xl w-full mx-4",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-neutral-100 text-2xl font-semibold",children:"Exportar Compras"}),e.jsx("button",{onClick:o,className:"text-neutral-400 hover:text-neutral-100 text-2xl font-bold",children:"√ó"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"text-neutral-300 font-medium mb-2",children:"Filtros Aplicados"}),e.jsxs("div",{className:"text-sm text-neutral-400 space-y-1",children:[e.jsxs("p",{children:["üìÖ Rango: ",h," a ",g]}),e.jsxs("p",{children:["üìä Estado: ",u||"Todos"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-neutral-300 font-medium mb-3",children:"Formato de Exportaci√≥n"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m("csv"),className:`px-4 py-2 rounded-lg border ${a==="csv"?"bg-blue-950 border-blue-800 text-blue-400":"bg-neutral-800 border-neutral-700 text-neutral-400"}`,children:"CSV"}),e.jsx("button",{onClick:()=>m("json"),className:`px-4 py-2 rounded-lg border ${a==="json"?"bg-blue-950 border-blue-800 text-blue-400":"bg-neutral-800 border-neutral-700 text-neutral-400"}`,children:"JSON"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-neutral-300 font-medium mb-3",children:"Columnas a Exportar"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.map(l=>e.jsxs("label",{className:"flex items-center gap-2 bg-neutral-800 border border-neutral-700 rounded-lg p-2 cursor-pointer hover:bg-neutral-750",children:[e.jsx("input",{type:"checkbox",checked:t.includes(l.id),onChange:()=>i(l.id),className:"form-checkbox"}),e.jsx("span",{className:"text-neutral-300 text-sm",children:l.label})]},l.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-neutral-800 text-neutral-300 rounded-lg hover:bg-neutral-700",children:"Cancelar"}),e.jsx("button",{onClick:d,disabled:t.length===0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Exportar"})]})]})}):null}const ae={code:"",name:"",category:"",unitPrice:"",status:"ACTIVE",description:""},pt=[{value:"ACTIVE",label:"Activo"},{value:"INACTIVE",label:"Inactivo"}];function gt({open:r,service:o,onClose:h,onSaved:g,existingCodes:u}){const[a,m]=v.useState(ae),[t,c]=v.useState({}),s=q({mutationFn:n=>o?Ae(o.id,n):De(n),onSuccess:n=>{g?.(n),h()},onError:n=>{c(N=>({...N,form:n instanceof Error?n.message:"No se pudo guardar el servicio"}))}});v.useEffect(()=>{if(!r){m(ae),c({}),s.reset();return}m(o?{code:o.code??"",name:o.name??"",category:o.category??"",unitPrice:o.unitPrice?.toString()??"",status:o.status??"ACTIVE",description:o.description??""}:ae),c({}),s.reset()},[r,o]);const i=(n,N)=>{m(p=>({...p,[n]:N})),c(p=>{if(!p[n])return p;const j={...p};return delete j[n],j})},d=n=>{n.preventDefault();const N={},p=a.code.trim(),j=a.name.trim(),C=a.category.trim(),T=Number(a.unitPrice);if(p?(!o&&u.includes(p.toLowerCase())||o&&p.toLowerCase()!==o.code.toLowerCase()&&u.includes(p.toLowerCase()))&&(N.code="El c√≥digo ya existe"):N.code="El c√≥digo es obligatorio",j||(N.name="El nombre es obligatorio"),(!Number.isFinite(T)||T<=0)&&(N.unitPrice="El precio debe ser mayor a 0"),Object.keys(N).length>0){c(N);return}const D={code:p,name:j,category:C||void 0,unitPrice:Number(T.toFixed(2)),status:a.status,description:a.description.trim()||void 0};s.mutate(D)},l=o?"Editar servicio":"Nuevo servicio",b=s.isPending;return e.jsx(de,{open:r,onClose:()=>!b&&h(),title:l,children:e.jsxs("form",{className:"form-grid",onSubmit:d,noValidate:!0,children:[o?e.jsxs("label",{children:[e.jsx("span",{children:"ID"}),e.jsx("input",{className:"input",value:o.id,disabled:!0})]}):null,e.jsxs("label",{children:[e.jsx("span",{children:"C√≥digo *"}),e.jsx("input",{className:`input${t.code?" input-error":""}`,value:a.code,onChange:n=>i("code",n.target.value.toUpperCase()),placeholder:"SRV-001",disabled:b,required:!0,"data-autofocus":!0}),t.code?e.jsx("p",{className:"error",children:t.code}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"Nombre *"}),e.jsx("input",{className:`input${t.name?" input-error":""}`,value:a.name,onChange:n=>i("name",n.target.value),placeholder:"Servicio de transporte",disabled:b,required:!0}),t.name?e.jsx("p",{className:"error",children:t.name}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"Categor√≠a"}),e.jsx("input",{className:"input",value:a.category,onChange:n=>i("category",n.target.value),placeholder:"Consultor√≠a, Transporte, etc.",disabled:b})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Precio unitario *"}),e.jsx("input",{className:`input${t.unitPrice?" input-error":""}`,type:"number",min:"0",step:"0.01",value:a.unitPrice,onChange:n=>i("unitPrice",n.target.value),placeholder:"50000",disabled:b,required:!0}),t.unitPrice?e.jsx("p",{className:"error",children:t.unitPrice}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"Estado *"}),e.jsx("select",{className:"input",value:a.status,onChange:n=>i("status",n.target.value),disabled:b,required:!0,children:pt.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs("label",{style:{gridColumn:"1 / -1"},children:[e.jsx("span",{children:"Descripci√≥n"}),e.jsx("textarea",{className:"input",rows:3,value:a.description,onChange:n=>i("description",n.target.value),placeholder:"Detalles del servicio o condiciones comerciales",disabled:b})]}),t.form?e.jsx("p",{className:"error",style:{gridColumn:"1 / -1"},children:t.form}):null,s.isError&&!t.form?e.jsx("p",{className:"error",style:{gridColumn:"1 / -1"},children:s.error?.message??"No se pudo guardar el servicio"}):null,e.jsxs("div",{className:"modal-actions",style:{gridColumn:"1 / -1"},children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:h,disabled:b,children:"Cancelar"}),e.jsx("button",{className:"btn",type:"submit",disabled:b,children:b?"Guardando‚Ä¶":o?"Guardar":"Crear"})]})]})})}const bt=[{value:"ALL",label:"Todos"},{value:"ACTIVE",label:"Activos"},{value:"INACTIVE",label:"Inactivos"}],he={ACTIVE:{label:"Activo",className:"badge-success"},INACTIVE:{label:"Inactivo",className:"badge-muted"}},jt=new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0});function Nt(){const r=ge(),[o,h]=v.useState("ACTIVE"),[g,u]=v.useState(!1),[a,m]=v.useState(null),t=y({queryKey:["services",{status:o}],queryFn:()=>Fe(o==="ALL"?void 0:{status:o})}),c=q({mutationFn:p=>Ie(p),onSuccess:()=>{r.invalidateQueries({queryKey:["services"]})}}),s=t.data??[],i=v.useMemo(()=>s.filter(p=>a?p.id!==a.id:!0).map(p=>p.code.trim().toLowerCase()),[s,a]),d=()=>{m(null),u(!0)},l=p=>{m(p),u(!0)},b=()=>{u(!1),m(null)},n=()=>{r.invalidateQueries({queryKey:["services"]}),b()},N=p=>{window.confirm(`¬øEliminar servicio ${p.code} - ${p.name}?`)&&c.mutate(p.id)};return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Servicios"}),e.jsx("p",{className:"muted small",children:"Registra servicios para √≥rdenes de compra sin inventario."})]}),e.jsxs("div",{className:"inline-actions",children:[e.jsx("select",{className:"input",value:o,onChange:p=>h(p.target.value),children:bt.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))}),e.jsx("button",{className:"btn",type:"button",onClick:d,children:"+ Nuevo Servicio"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>r.invalidateQueries({queryKey:["services"]}),disabled:t.isFetching,children:t.isFetching?"Actualizando...":"Refrescar"})]})]}),t.isLoading&&e.jsx("p",{className:"muted",children:"Cargando servicios..."}),t.isError&&e.jsx("p",{className:"error",children:t.error?.message??"No se pudieron obtener los servicios"}),!t.isLoading&&!t.isError&&e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"C√≥digo"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Categor√≠a"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{style:{width:"150px"},children:"Acciones"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"muted",children:"No hay servicios registrados"})}):s.map(p=>{const j=he[p.status]??he.ACTIVE;return e.jsxs("tr",{children:[e.jsx("td",{className:"mono",children:p.code}),e.jsx("td",{children:p.name}),e.jsx("td",{children:p.category||"‚Äî"}),e.jsx("td",{children:jt.format(p.unitPrice??0)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${j.className}`,children:j.label})}),e.jsx("td",{children:e.jsxs("div",{className:"table-actions",children:[e.jsx("button",{className:"btn ghost small",type:"button",onClick:()=>l(p),children:"Editar"}),e.jsx("button",{className:"btn ghost small",type:"button",onClick:()=>N(p),disabled:c.isPending,children:c.isPending?"Eliminando...":"Eliminar"})]})})]},p.id)})})]})}),e.jsx(gt,{open:g,service:a,onClose:b,onSaved:n,existingCodes:i})]})}const ne=10,vt=[{value:"",label:"Todos"},{value:"received",label:"Recibida"},{value:"cancelled",label:"Cancelada"}];function K(r){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(r)}function pe(r){return r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]+/g,"_").replace(/^_+|_+$/g,"")}function ft(r){if(!r)return".pdf";const o=r.toLowerCase();return o.includes("pdf")?".pdf":o.includes("html")?".html":o.includes("json")?".json":o.includes("xml")?".xml":".bin"}function yt(r,o){if(o?.filename)return o.filename;const h=pe(r.type||"documento"),g=pe(r.number??r.id),u=ft(o?.mimeType);return`${h||"documento"}-${g||r.id}${u}`}function Ct(r,o){const h=URL.createObjectURL(r.blob),g=document.createElement("a");g.href=h,g.download=o,g.rel="noopener",document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(h)}function Ot(){const r=ge(),o=()=>{r.invalidateQueries({queryKey:["inventory","stockByProduct"],exact:!1})},[h,g]=v.useState(0),[u,a]=v.useState(!1),[m,t]=v.useState(!1),[c,s]=v.useState(!1),[i,d]=v.useState(null),[l,b]=v.useState("received"),[n,N]=v.useState(""),[p,j]=v.useState([]),[C,T]=v.useState(""),[D,R]=v.useState(""),[M,V]=v.useState(""),[$,O]=v.useState(""),[k,B]=v.useState(!1),S=14,L=new Date().toISOString().split("T")[0],re=new Date(Date.now()-(S-1)*24*60*60*1e3).toISOString().split("T")[0],[A,be]=v.useState(re),[F,je]=v.useState(L),X=Ue(n,300);v.useEffect(()=>{g(0)},[l,X,C]);const Ne=y({queryKey:["suppliers"],queryFn:()=>ie()}),Z=y({queryKey:["purchases",h,l,X,C],queryFn:()=>I({page:h,size:ne,status:l||void 0,search:X||void 0,docType:C||void 0}),placeholderData:$e}),ee=v.useMemo(()=>{if(!Z.data)return null;let x=[...Z.data.content];if(D&&(x=x.filter(f=>f.supplierId===D)),M){const f=parseFloat(M);isNaN(f)||(x=x.filter(P=>parseFloat(P.total?.toString()??"0")>=f))}if($){const f=parseFloat($);isNaN(f)||(x=x.filter(P=>parseFloat(P.total?.toString()??"0")<=f))}return{...Z.data,content:x}},[Z.data,D,M,$]),ve=q({mutationFn:x=>Ee(x),onSuccess:()=>r.invalidateQueries({queryKey:["purchases"]})}),w=y({queryKey:["purchaseDetail",i],queryFn:()=>ke(i),enabled:!!i}),fe=q({mutationFn:({id:x,payload:f})=>Me(x,f),onSuccess:()=>r.invalidateQueries({queryKey:["purchases"]})}),te=q({mutationFn:async x=>{const f={id:x.id,type:x.docType??"Documento",number:x.docNumber??x.id,issuedAt:x.issuedAt,total:x.total,status:x.status},P=await Oe(f.id),E=yt(f,P);Ct(P,E)}});q({mutationFn:async()=>{const x=await Le({status:l||void 0,search:X||void 0,docType:C||void 0}),f=URL.createObjectURL(x),P=document.createElement("a");P.href=f,P.download=`compras-${new Date().toISOString().split("T")[0]}.csv`,P.rel="noopener",document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(f)}});const ye=x=>{if(x.status?.toLowerCase()==="cancelled"){window.alert("La compra ya fue cancelada.");return}window.confirm(`Cancelar compra ${x.docNumber??x.id}?`)&&ve.mutate(x.id)},Ce=x=>{const f=window.prompt("Documento",x.docType??"");if(f===null)return;const P=window.prompt("Numero",x.docNumber??"");if(P===null)return;const E={docType:f.trim()||x.docType,docNumber:P.trim()||x.docNumber};fe.mutate({id:x.id,payload:E})},Se=v.useMemo(()=>[{header:"Fecha",accessorKey:"issuedAt",cell:x=>new Date(x.getValue()).toLocaleDateString("es-ES"),enableSorting:!0,sortingFn:"datetime"},{header:"Documento",accessorKey:"docType",cell:x=>x.getValue()??"Factura",enableSorting:!1},{header:"Numero",accessorKey:"docNumber",cell:x=>x.getValue()??"-",enableSorting:!1},{header:"Proveedor",accessorFn:x=>x.supplierName??x.supplierId??"-",cell:x=>x.getValue()??"-",enableSorting:!0},{header:"Estado",accessorKey:"status",cell:x=>{const f=(x.getValue()??"").toLowerCase(),E={received:{icon:"üü¢",label:"Recibida",className:"bg-green-950 text-green-400 border-green-800"},pending:{icon:"üü°",label:"Pendiente",className:"bg-yellow-950 text-yellow-400 border-yellow-800"},cancelled:{icon:"üî¥",label:"Cancelada",className:"bg-red-950 text-red-400 border-red-800"},intransit:{icon:"‚è≥",label:"En tr√°nsito",className:"bg-blue-950 text-blue-400 border-blue-800"},completed:{icon:"‚úÖ",label:"Completada",className:"bg-neutral-700 text-neutral-300 border-neutral-600"}}[f]??{icon:"‚ö™",label:f||"Desconocido",className:"bg-neutral-800 text-neutral-400 border-neutral-700"};return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-medium border ${E.className}`,children:[e.jsx("span",{children:E.icon}),e.jsx("span",{children:E.label})]})},enableSorting:!1},{header:"Neto",accessorKey:"net",cell:x=>`$${Number(x.getValue()).toLocaleString()}`,enableSorting:!0,sortingFn:"alphanumeric"},{header:"IVA",accessorKey:"vat",cell:x=>`$${Number(x.getValue()).toLocaleString()}`,enableSorting:!0,sortingFn:"alphanumeric"},{header:"Total",accessorKey:"total",cell:x=>`$${Number(x.getValue()).toLocaleString()}`,enableSorting:!0,sortingFn:"alphanumeric"},{id:"actions",header:"Acciones",enableSorting:!1,cell:({row:x})=>e.jsxs("div",{className:"table-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>d(x.original.id),children:"Comprobante"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>te.mutate(x.original),disabled:te.isPending,children:te.isPending?"Descargando...":"Descargar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>Ce(x.original),children:"Editar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>ye(x.original),children:"Cancelar"})]})}],[te.isPending]),ue=Ke({data:ee?.content??[],columns:Se,getCoreRowModel:Qe(),getSortedRowModel:Ge(),manualPagination:!0,pageCount:ee?.totalPages??-1,state:{sorting:p,pagination:{pageIndex:h,pageSize:ne}},onSortingChange:j,onPaginationChange:x=>{const f=typeof x=="function"?x({pageIndex:h,pageSize:ne}).pageIndex:x.pageIndex;g(f)},enableSorting:!0});return e.jsxs("div",{className:"page-section bg-neutral-950",children:[e.jsx(_e,{title:"Compras y abastecimiento",description:"Controla ordenes, recepciones y presupuestos para evitar quiebres.",actions:e.jsx("button",{className:"btn",onClick:()=>a(!0),children:"+ Nueva orden"})}),e.jsx("div",{className:"mb-8",children:e.jsx(Ye,{})}),e.jsxs("div",{className:"mb-8 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"üìä An√°lisis ABC de Proveedores"}),e.jsx(Je,{}),e.jsx(Ze,{}),e.jsx(Xe,{})]}),e.jsxs("div",{className:"mb-8 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"üîÆ Pron√≥stico de Demanda"}),e.jsx(et,{}),e.jsx(st,{}),e.jsx(tt,{})]}),e.jsx(rt,{startDate:A,endDate:F,statusFilter:l}),e.jsx("section",{className:"responsive-grid",style:{marginBottom:"2rem"},children:e.jsx(Nt,{})}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"filter-bar",children:[e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",placeholder:"Buscar (doc, numero, proveedor)",value:n,onChange:x=>N(x.target.value)}),n&&e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>N(""),children:"Limpiar"}),e.jsx("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:l,onChange:x=>b(x.target.value),children:vt.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>B(!k),children:k?"üîΩ Ocultar filtros":"üîº M√°s filtros"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>s(!0),children:"üìä Exportar Avanzado"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>t(!0),children:"Importar CSV"})]}),k&&e.jsxs("div",{className:"filter-bar",style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid #404040",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.5rem"},children:[e.jsxs("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:C,onChange:x=>T(x.target.value),children:[e.jsx("option",{value:"",children:"Todos los tipos de documento"}),e.jsx("option",{value:"Factura",children:"Factura"}),e.jsx("option",{value:"Boleta",children:"Boleta"}),e.jsx("option",{value:"Cotizaci√≥n",children:"Cotizaci√≥n"}),e.jsx("option",{value:"Orden de Compra",children:"Orden de Compra"}),e.jsx("option",{value:"Gu√≠a de Despacho",children:"Gu√≠a de Despacho"})]}),e.jsxs("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:D,onChange:x=>R(x.target.value),children:[e.jsx("option",{value:"",children:"Todos los proveedores"}),Ne.data?.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"number",placeholder:"Monto m√≠nimo",value:M,onChange:x=>V(x.target.value)}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"number",placeholder:"Monto m√°ximo",value:$,onChange:x=>O(x.target.value)}),(C||D||M||$)&&e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>{T(""),R(""),V(""),O("")},children:"Limpiar filtros avanzados"})]})]}),e.jsx(at,{startDate:A,endDate:F,onStartDateChange:be,onEndDateChange:je}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4",children:[e.jsx(lt,{startDate:A,endDate:F}),e.jsx(nt,{startDate:A,endDate:F})]}),e.jsx(ot,{startDate:A,endDate:F}),e.jsx(it,{startDate:A,endDate:F}),e.jsx(dt,{startDate:A,endDate:F,statusFilter:l}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:"1.5rem",marginBottom:"1.5rem"},children:[e.jsx(ct,{startDate:A,endDate:F,statusFilter:l}),e.jsx(mt,{startDate:A,endDate:F,statusFilter:l})]}),e.jsx(ut,{startDate:A,endDate:F,statusFilter:l}),e.jsx(xt,{startDate:A,endDate:F,statusFilter:l}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 table-card",children:[e.jsx("h3",{className:"text-neutral-100",children:"Ordenes recientes"}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:ue.getHeaderGroups().map(x=>e.jsx("tr",{children:x.headers.map(f=>e.jsx("th",{onClick:f.column.getCanSort()?f.column.getToggleSortingHandler():void 0,style:{cursor:f.column.getCanSort()?"pointer":"default",userSelect:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[xe(f.column.columnDef.header,f.getContext()),f.column.getCanSort()&&e.jsx("span",{style:{opacity:.5},children:{asc:"‚Üë",desc:"‚Üì"}[f.column.getIsSorted()]??"‚Üï"})]})},f.id))},x.id))}),e.jsx("tbody",{children:ue.getRowModel().rows.map(x=>e.jsx("tr",{children:x.getVisibleCells().map(f=>e.jsx("td",{children:xe(f.column.columnDef.cell,f.getContext())},f.id))},x.id))})]})}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"btn",disabled:h===0,onClick:()=>g(x=>Math.max(0,x-1)),children:"Anterior"}),e.jsxs("span",{className:"muted text-neutral-400",children:["Pagina ",h+1," de ",ee?.totalPages??1]}),e.jsx("button",{className:"btn",disabled:h+1>=(ee?.totalPages??1),onClick:()=>g(x=>x+1),children:"Siguiente"})]})]}),e.jsx(We,{open:u,onClose:()=>a(!1),onCreated:()=>{r.invalidateQueries({queryKey:["purchases"]}),o()}}),e.jsx(He,{open:m,onClose:()=>t(!1),onImported:()=>{r.invalidateQueries({queryKey:["purchases"]}),o()}}),e.jsx(ht,{open:c,onClose:()=>s(!1),startDate:A,endDate:F,statusFilter:l}),e.jsxs(de,{open:!!i,onClose:()=>d(null),title:"Detalle del Comprobante de Compra",children:[w.isLoading&&e.jsx("p",{children:"Cargando detalle..."}),w.error&&e.jsxs("p",{className:"error",children:["Error al cargar: ",w.error.message]}),w.data&&e.jsxs("div",{className:"document-detail",children:[e.jsxs("section",{className:"document-detail__header",children:[e.jsxs("div",{className:"document-detail__title-row",children:[e.jsx("h2",{className:"document-detail__title",children:w.data.docType||"Compra"}),e.jsxs("p",{className:"document-detail__number",children:["#",w.data.docNumber??w.data.id]})]}),e.jsxs("div",{className:"document-detail__meta-grid",children:[e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Fecha Emisi√≥n"}),e.jsx("span",{className:"document-detail__meta-value",children:w.data.issuedAt?new Date(w.data.issuedAt).toLocaleString("es-CL"):"‚Äî"})]}),w.data.receivedAt&&e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Fecha Recepci√≥n"}),e.jsx("span",{className:"document-detail__meta-value",children:new Date(w.data.receivedAt).toLocaleString("es-CL")})]}),e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Proveedor"}),e.jsx("span",{className:"document-detail__meta-value",children:w.data.supplier?.name??"‚Äî"})]}),e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"T√©rminos de pago"}),e.jsx("span",{className:"document-detail__meta-value",children:w.data.paymentTermDays>0?`${w.data.paymentTermDays} d√≠as`:"Sin t√©rminos de pago"})]}),e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Estado"}),e.jsx("span",{className:"document-detail__meta-value",children:w.data.status})]}),e.jsxs("div",{className:"document-detail__meta-item document-detail__meta-item--highlight",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Total"}),e.jsx("span",{className:"document-detail__meta-value document-detail__meta-value--highlight",children:K(w.data.total)})]})]})]}),e.jsx("div",{className:"document-detail__items table-wrapper compact",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"Descripci√≥n"}),e.jsx("th",{className:"mono",children:"Cantidad"}),e.jsx("th",{className:"mono",children:"Costo Unit."}),e.jsx("th",{className:"mono",children:"Info Adicional"}),e.jsx("th",{className:"mono",children:"Total"})]})}),e.jsx("tbody",{children:w.data.items.map((x,f)=>{const P=x.qty*x.unitCost,E=x.productName||x.serviceName||"Item";return e.jsxs("tr",{children:[e.jsx("td",{className:"mono",children:x.productSku??"‚Äî"}),e.jsx("td",{children:e.jsx("span",{className:"document-detail__description",title:E,children:E})}),e.jsx("td",{className:"mono",children:x.qty}),e.jsx("td",{className:"mono",children:K(x.unitCost)}),e.jsxs("td",{className:"mono",style:{fontSize:"0.85rem",color:"#666"},children:[x.expDate&&`Venc: ${new Date(x.expDate).toLocaleDateString("es-CL")}`,x.mfgDate&&` | Fab: ${new Date(x.mfgDate).toLocaleDateString("es-CL")}`,x.locationCode&&` | üìç ${x.locationCode}`]}),e.jsx("td",{className:"mono",children:K(P)})]},`${x.id}-${f}`)})})]})}),e.jsxs("section",{className:"document-detail__totals",children:[e.jsxs("div",{className:"document-detail__totals-row",children:[e.jsx("span",{className:"document-detail__totals-label",children:"Neto"}),e.jsx("span",{className:"document-detail__totals-value mono",children:K(w.data.net)})]}),e.jsxs("div",{className:"document-detail__totals-row",children:[e.jsx("span",{className:"document-detail__totals-label",children:"IVA (19%)"}),e.jsx("span",{className:"document-detail__totals-value mono",children:K(w.data.vat)})]}),e.jsxs("div",{className:"document-detail__totals-row document-detail__totals-row--total",children:[e.jsx("span",{className:"document-detail__totals-label",children:"Total"}),e.jsx("span",{className:"document-detail__totals-value mono",children:K(w.data.total)})]})]}),e.jsx("div",{className:"document-detail__actions",children:e.jsx("button",{className:"btn",onClick:()=>d(null),children:"Cerrar"})})]})]})]})}export{Ot as default};
