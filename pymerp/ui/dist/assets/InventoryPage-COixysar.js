import{c as R,j as e,Q as Je,R as et,S as Ee,T as we,u as te,U as tt,V as st,W as at,X as rt,p as nt,h as W,Y as lt,Z as it,_ as ot,$ as ct,k as dt,a0 as ut,a1 as mt,a2 as xt,a3 as ht,F as ke,a4 as gt,a5 as le,a6 as bt,a7 as pt,a8 as ie,a9 as oe,aa as jt,ab as Nt,ac as vt}from"./index-CTZ9O8lC.js";import{r as b}from"./react-D8kvZI4c.js";import{u as A}from"./useQuery-C9GbdDDb.js";import{P as ft}from"./PageHeader-CwWqOxH0.js";import{M as Z}from"./Modal-BpLUd7V9.js";import{c as ce}from"./currency-HwQAg_Xa.js";import{R as de,B as ue,C as me,X as xe,Y as he,T as ge,a as be,g as ee,f as Le}from"./charts-BH7DIlZU.js";const re={sku:"",name:"",description:"",category:"",barcode:"",imageUrl:null,imageFile:null};function yt({open:s,product:r,onClose:g,onSaved:n}){const[a,x]=b.useState(re),[t,l]=b.useState(null),[m,h]=b.useState(null),p=b.useRef(null),u=b.useRef(null);b.useEffect(()=>()=>{u.current&&u.current.startsWith("blob:")&&URL.revokeObjectURL(u.current)},[]),b.useEffect(()=>{if(!s){x(re),h(null),y(null);return}r?(x({sku:r.sku??"",name:r.name??"",description:r.description??"",category:r.category??"",barcode:r.barcode??"",imageUrl:r.imageUrl??null,imageFile:null}),h(null),y(r.imageUrl??null)):(x(re),h(null),y(null))},[s,r]);const N=R({mutationFn:v=>r?Je(r.id,v):et(v),onSuccess:v=>{n?.(v),g()}});b.useEffect(()=>{s||N.reset()},[s,N]);const o=v=>{const i=v.target.files?.[0];if(!i)return;if(i.size>512*1024){h("La imagen debe pesar 500 KB o menos"),v.target.value="";return}h(null),x(P=>({...P,imageFile:i}));const w=URL.createObjectURL(i);C(w)},j=()=>{if(h(null),a.imageFile){const v=a.imageUrl??null;x(i=>({...i,imageFile:null})),C(v)}else x(v=>({...v,imageUrl:null})),C(null);p.current&&(p.current.value="")},y=v=>{C(v)},C=v=>{u.current&&u.current.startsWith("blob:")&&URL.revokeObjectURL(u.current),u.current=v,l(v)},k=v=>{v.preventDefault();const i=a.sku.trim(),w=a.name.trim();if(!i){window.alert("El SKU es obligatorio");return}if(!w){window.alert("El nombre es obligatorio");return}const P={sku:i,name:w,description:a.description.trim()?a.description.trim():void 0,category:a.category.trim()?a.category.trim():void 0,barcode:a.barcode.trim()?a.barcode.trim():void 0};a.imageFile?(P.imageFile=a.imageFile,P.imageUrl=null):a.imageUrl===null?P.imageUrl=null:typeof a.imageUrl=="string"&&a.imageUrl.trim().length>0&&(P.imageUrl=a.imageUrl.trim()),N.mutate(P)},d=r?"Editar producto":"Nuevo producto",S=!!t;return e.jsx(Z,{open:s,title:d,onClose:()=>!N.isPending&&g(),children:e.jsxs("form",{className:"form-grid",onSubmit:k,children:[e.jsxs("label",{children:[e.jsx("span",{children:"SKU *"}),e.jsx("input",{className:"input",value:a.sku,onChange:v=>x(i=>({...i,sku:v.target.value})),placeholder:"SKU-001",disabled:N.isPending,"data-autofocus":!0})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Nombre *"}),e.jsx("input",{className:"input",value:a.name,onChange:v=>x(i=>({...i,name:v.target.value})),placeholder:"Producto demo",disabled:N.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Categoria"}),e.jsx("input",{className:"input",value:a.category,onChange:v=>x(i=>({...i,category:v.target.value})),placeholder:"Bebidas",disabled:N.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Codigo de barras"}),e.jsx("input",{className:"input",value:a.barcode,onChange:v=>x(i=>({...i,barcode:v.target.value})),placeholder:"7890000000",disabled:N.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Descripcion"}),e.jsx("textarea",{className:"input",value:a.description,onChange:v=>x(i=>({...i,description:v.target.value})),placeholder:"Notas internas",rows:3,disabled:N.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Imagen"}),S?e.jsx("div",{className:"image-preview",children:e.jsx("img",{src:t??void 0,alt:"Vista previa del producto"})}):e.jsx("p",{className:"muted small",children:"No has seleccionado una imagen"}),e.jsx("input",{ref:p,className:"input",type:"file",accept:"image/png,image/jpeg,image/webp,image/*",onChange:o,disabled:N.isPending}),e.jsx("p",{className:"muted small",children:"Formatos aceptados: PNG, JPG o WebP. Tamao mximo 500 KB."}),(a.imageFile||a.imageUrl)&&e.jsx("div",{className:"inline-actions",children:e.jsx("button",{className:"btn ghost",type:"button",onClick:j,disabled:N.isPending,children:"Quitar imagen"})}),m&&e.jsx("p",{className:"error",children:m})]}),e.jsxs("div",{className:"buttons",children:[e.jsx("button",{className:"btn",type:"submit",disabled:N.isPending,children:N.isPending?"Guardando...":"Guardar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:g,disabled:N.isPending,children:"Cancelar"})]}),N.isError&&e.jsx("p",{className:"error",children:Ct(N.error)})]})})}function Ct(s){if(Ee.isAxiosError(s)){const r=s.response?.data;if(typeof r=="string"&&r.trim().length>0)return r;if(r&&typeof r=="object"){if(typeof r.detail=="string"&&r.detail.trim().length>0)return r.detail;if(typeof r.message=="string"&&r.message.trim().length>0)return r.message;if(typeof r.error=="string"&&r.error.trim().length>0)return r.error}}return s instanceof Error&&s.message?s.message:"No se pudo guardar"}function St({open:s,product:r,pendingValue:g,submitting:n=!1,error:a,onClose:x,onSubmit:t}){const[l,m]=b.useState("0"),[h,p]=b.useState(null),u=b.useMemo(()=>{if(typeof g=="number")return g;const C=Number(r?.criticalStock??0);return Number.isFinite(C)&&C>=0?C:0},[g,r?.criticalStock]);b.useEffect(()=>{if(!s||!r){m("0"),p(null);return}m(String(u)),p(null)},[s,r?.id,u]);const N=C=>{C.preventDefault();const k=Number(l);if(!Number.isFinite(k)||k<0){p("Ingresa un stock vÃ¡lido (mayor o igual a 0)");return}p(null),t(k)},o=()=>{n||x()},j=r?`Stock crÃ­tico - ${r.name}`:"Stock crÃ­tico",y=!!h||!!a;return e.jsx(Z,{open:s,title:j,onClose:o,children:e.jsxs("form",{className:"form-grid",onSubmit:N,children:[e.jsxs("label",{children:[e.jsx("span",{children:"Stock crÃ­tico"}),e.jsx("input",{className:`input${y?" input-error":""}`,type:"number",min:"0",step:"1",value:l,onChange:C=>m(C.target.value),disabled:n,"data-autofocus":!0,inputMode:"numeric"})]}),e.jsxs("div",{className:"buttons",children:[e.jsx("button",{className:"btn",type:"submit",disabled:n,children:n?"Guardando...":"Guardar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:o,disabled:n,children:"Cancelar"})]}),h&&e.jsx("p",{className:"error",children:h}),!h&&a&&e.jsx("p",{className:"error",children:a})]})})}function wt({open:s,product:r,onClose:g}){const[n,a]=b.useState(null),[x,t]=b.useState(!1),[l,m]=b.useState(null),h=()=>{t(!1),m(null),n&&n.startsWith("blob:")&&URL.revokeObjectURL(n),a(null)};b.useEffect(()=>{if(!s||!r){h();return}return t(!0),m(null),we(r.id).then(o=>{const j=URL.createObjectURL(o);a(j)}).catch(()=>{m("No se pudo cargar el cÃ³digo QR")}).finally(()=>{t(!1)}),h},[s,r?.id]);const p=()=>{if(!n||!r)return;const o=window.open("","_blank","noopener,noreferrer");if(!o)return;const j=r.sku?`QR ${r.sku}`:"QR";o.document.write(`<!doctype html><html><head><title>${j}</title></head>`),o.document.write('<body style="margin:0;display:flex;align-items:center;justify-content:center;height:100vh;background:#fff;">'),o.document.write(`<img src="${n}" alt="${j}" style="max-width:90%;max-height:90%;" />`),o.document.write("</body></html>"),o.document.close(),o.focus(),o.print(),o.close()},u=async()=>{if(r)try{const o=await we(r.id,{download:!0}),j=URL.createObjectURL(o),y=document.createElement("a"),C=o.type==="image/svg+xml"?"svg":"png",k=(r.sku||r.id).replace(/[^a-zA-Z0-9-_]+/g,"-");y.href=j,y.download=`${k}-qr.${C}`,document.body.appendChild(y),y.click(),y.remove(),setTimeout(()=>URL.revokeObjectURL(j),500)}catch{m("No se pudo descargar el cÃ³digo QR")}},N=r&&`CÃ³digo QR ${r.sku??""}`.trim()||"CÃ³digo QR";return e.jsxs(Z,{open:s,title:N,onClose:g,children:[x&&e.jsx("p",{className:"muted",children:"Cargando cÃ³digo QR..."}),l&&e.jsx("p",{className:"error",children:l}),!x&&!l&&n&&e.jsx("div",{className:"qr-preview",children:e.jsx("img",{src:n,alt:N})}),e.jsxs("div",{className:"buttons",children:[e.jsx("button",{className:"btn",type:"button",onClick:p,disabled:!n||x,"data-autofocus":!0,children:"Imprimir"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:u,disabled:!r||x,children:"Descargar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:g,children:"Cerrar"})]})]})}function kt({open:s,product:r,imageUrl:g,onClose:n}){const a=b.useRef(null),x=b.useMemo(()=>r?`Imagen - ${r.name}`:"Imagen del producto",[r]),t=g??"";return e.jsxs(Z,{open:s,title:x,onClose:n,initialFocusRef:a,children:[e.jsx("div",{className:"image-modal__content",children:t?e.jsx("img",{src:t,alt:x,className:"image-modal__preview"}):e.jsx("p",{className:"muted",children:"Sin imagen disponible"})}),e.jsx("div",{className:"buttons",children:e.jsx("button",{ref:a,className:"btn",type:"button",onClick:n,children:"Cerrar"})})]})}const Pe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20160%20160'%20role='img'%20aria-label='Producto%20sin%20imagen'%3e%3cdefs%3e%3clinearGradient%20id='bg'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%231f2937'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23111827'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='160'%20height='160'%20fill='url(%23bg)'%20rx='24'%20ry='24'%20/%3e%3cpath%20d='M48%2052c0-8.837%207.163-16%2016-16h32c8.837%200%2016%207.163%2016%2016v56c0%208.837-7.163%2016-16%2016H64c-8.837%200-16-7.163-16-16V52zm16-4a12%2012%200%200%200-12%2012v4.382l11.172-11.172a4%204%200%200%201%205.656%200L92%2094.343l10.828-10.828a4%204%200%200%201%205.656%200L112%2086V60a12%2012%200%200%200-12-12H64zm0%2096c-13.255%200-24-10.745-24-24V60c0-13.255%2010.745-24%2024-24h32c13.255%200%2024%2010.745%2024%2024v60c0%2013.255-10.745%2024-24%2024H64z'%20fill='%2360a5fa'%20fill-opacity='0.35'%20/%3e%3ccircle%20cx='64'%20cy='64'%20r='12'%20fill='%23ffffff'%20fill-opacity='0.08'%20/%3e%3c/svg%3e",Pt=10;function Ft(){const[s,r]=b.useState(""),[g,n]=b.useState(0),[a,x]=b.useState("active"),[t,l]=b.useState(null),[m,h]=b.useState({price:0}),[p,u]=b.useState(!1),[N,o]=b.useState(null),[j,y]=b.useState(!1),[C,k]=b.useState(null),[d,S]=b.useState(!1),[v,i]=b.useState(null),[w,P]=b.useState({}),[Q,B]=b.useState({}),[E,U]=b.useState(!1),[$,K]=b.useState(null),[Ie,pe]=b.useState(!1),[De,je]=b.useState(null),[qe,Ne]=b.useState(null),T=te(),V=c=>{if(typeof c=="number")return Number.isFinite(c)?c:null;if(typeof c=="string"&&c.trim().length>0){const f=Number(c);return Number.isFinite(f)?f:null}return null},ve=c=>{const f=V(c);return f===null||f<=0?"Sin precio":`$${f.toFixed(2)}`},Y=b.useMemo(()=>Object.keys(w).length>0,[w]);b.useEffect(()=>{const c=f=>{Y&&(f.preventDefault(),f.returnValue="")};return window.addEventListener("beforeunload",c),()=>{window.removeEventListener("beforeunload",c)}},[Y]);const se=c=>{const f=V(c);return f===null||Number.isNaN(f)?0:f},ae=c=>{if(!c)return 0;const f=w[c.id];return typeof f=="number"?f:se(c.criticalStock??0)},fe=c=>c?se(c.stock??0):0,Me=c=>{const f=fe(c),D=ae(c);return D>0&&f<=D},Re=c=>Object.prototype.hasOwnProperty.call(w,c);b.useEffect(()=>{n(0)},[a]);const L=A({queryKey:["products",{q:s,page:g,status:a}],queryFn:()=>W({q:s||void 0,page:g,size:Pt,status:a}),placeholderData:nt}),Te=A({queryKey:["product-prices",t?.id],queryFn:()=>{if(!t)throw new Error("Producto no seleccionado");return lt(t.id,{size:5})},enabled:!!t}),I=A({queryKey:["product",t?.id,"stock"],queryFn:()=>{if(!t)throw new Error("Producto no seleccionado");return it(t.id)},enabled:!!t}),X=R({mutationFn:async()=>{if(!t)throw new Error("Select a product first");return tt(t.id,m)},onSuccess:()=>{T.invalidateQueries({queryKey:["products"],exact:!1}),T.invalidateQueries({queryKey:["product-prices",t?.id]}),h({price:0})}}),_=R({mutationFn:c=>st(c),onSuccess:(c,f)=>{T.invalidateQueries({queryKey:["products"],exact:!1}),T.removeQueries({queryKey:["product-prices",f],exact:!0}),t?.id===f&&(l(null),h({price:0}))}}),G=R({mutationFn:c=>{if(!t)throw new Error("Producto no seleccionado");return at(t.id,c)},onSuccess:c=>{T.invalidateQueries({queryKey:["products"],exact:!1}),l(c),h({price:V(c.currentPrice)??0})}}),Oe=()=>{o(null),u(!0)},Be=()=>{t&&(o(t),u(!0))},Ue=()=>{u(!1),o(null)},ye=c=>{const f=c??t;f&&(k(f),y(!0))},Qe=()=>{y(!1),k(null)},Ce=c=>{const f=c??t;f&&(i(f),S(!0))},$e=()=>{S(!1),i(null)},Ke=c=>{if(!v)return;const f=v.id,D=se(v.criticalStock??0);P(F=>{const O={...F};return c===D?delete O[f]:O[f]=c,O}),B(F=>{if(!F[f])return F;const{[f]:O,...z}=F;return z}),K(null),t?.id===f&&l({...t,criticalStock:c}),S(!1),i(null)},Ve=async()=>{const c=Object.entries(w);if(c.length===0||E)return;U(!0),K(null);const f={...w},D=[];for(const[F,O]of c)try{const z=await rt(F,O);D.push(z),delete f[F],B(q=>{if(!q[F])return q;const{[F]:H,...M}=q;return M})}catch(z){const q=At(z),H=L.data?.content?.find(M=>M.id===F)?.name??F;B(M=>({...M,[F]:q.fieldMessage??q.message})),P(f),K({type:"error",text:`${H}: ${q.message}`}),U(!1);return}if(P({}),K({type:"success",text:"Cambios guardados correctamente."}),U(!1),T.invalidateQueries({queryKey:["products"],exact:!1}),D.forEach(F=>{T.invalidateQueries({queryKey:["product",F.id,"stock"]})}),t){const F=D.find(O=>O.id===t.id);F&&(l(F),h({price:V(F.currentPrice)??0}))}},ze=c=>{T.invalidateQueries({queryKey:["products"],exact:!1}),l(c),h({price:V(c.currentPrice)??0}),C?.id===c.id&&k(c),P(f=>{if(!f[c.id])return f;const{[c.id]:D,...F}=f;return F}),B(f=>{if(!f[c.id])return f;const{[c.id]:D,...F}=f;return F}),T.invalidateQueries({queryKey:["product",c.id,"stock"]})},_e=c=>{const f=typeof c.imageUrl=="string"&&c.imageUrl.trim().length>0?c.imageUrl:Pe;je(c),Ne(f),pe(!0)},Ge=()=>{pe(!1),je(null),Ne(null)},He=()=>{!t||_.isPending||window.confirm(`Eliminar producto ${t.name}?`)&&_.mutate(t.id)},We=()=>{!t||G.isPending||G.mutate(!t.active)},Se=L.data?.content??[],J=L.data?.totalPages??1;b.useEffect(()=>{if(!t)return;const c=L.data?.content?.find(f=>f.id===t.id);if(!c){l(null),h({price:0});return}c!==t&&(l(c),h({price:V(c.currentPrice)??0}))},[L.data,t]);const Ye=b.useMemo(()=>t?ve(t.currentPrice):"",[t]),Xe=b.useMemo(()=>t?ae(t):0,[t,w]),Ze=c=>{if(c.preventDefault(),!!t){if(!m.price||m.price<=0){alert("Ingresa un precio valido");return}X.mutate()}};return e.jsxs("div",{className:"card products-card",children:[e.jsxs("div",{className:"products-banner",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Productos"}),e.jsx("p",{className:"muted small",children:Y?"Tienes cambios sin guardar en los stocks crÃ­ticos.":"Administra tu catÃ¡logo, imÃ¡genes y alertas de stock."})]}),e.jsx("button",{className:"btn primary",type:"button",onClick:Ve,disabled:!Y||E,children:E?"Guardando...":"Guardar cambios"})]}),$&&e.jsx("div",{className:`status-message ${$.type}`,role:"status",children:$.text}),e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"inline-actions",children:[e.jsx("input",{className:"input",placeholder:"Buscar por nombre, SKU o codigo",value:s,onChange:c=>{r(c.target.value),n(0)}}),e.jsxs("select",{className:"input",value:a,onChange:c=>x(c.target.value),children:[e.jsx("option",{value:"active",children:"Activos"}),e.jsx("option",{value:"inactive",children:"Inactivos"}),e.jsx("option",{value:"all",children:"Todos"})]}),e.jsx("button",{className:"btn",onClick:()=>T.invalidateQueries({queryKey:["products"]}),disabled:L.isFetching,children:L.isFetching?"Cargando":"Refrescar"})]})}),e.jsxs("div",{className:"inline-actions",children:[e.jsx("button",{className:"btn",type:"button",onClick:Oe,children:"+ Producto"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:Be,disabled:!t,children:"Editar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>ye(t),disabled:!t,children:"Ver QR"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:We,disabled:!t||G.isPending,children:G.isPending?"Actualizando...":t?.active?"Desactivar":"Activar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:He,disabled:!t||_.isPending,children:_.isPending?"Eliminando...":"Eliminar"})]}),Y&&e.jsx("p",{className:"muted small notice-dirty",children:"Recuerda guardar para aplicar los cambios pendientes."}),_.isError&&e.jsx("p",{className:"error",children:_.error?.message??"No se pudo eliminar el producto"}),G.isError&&e.jsx("p",{className:"error",children:G.error?.message??"No se pudo actualizar el estado"}),L.isLoading&&e.jsx("p",{children:"Loading..."}),L.isError&&e.jsx("p",{className:"error",children:L.error.message}),!L.isLoading&&!L.isError&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"products-grid",children:Se.map(c=>{w[c.id];const f=fe(c),D=ae(c),F=Q[c.id],O=typeof c.imageUrl=="string"&&c.imageUrl.trim().length>0?c.imageUrl:Pe,z=t?.id===c.id,q=Me(c),H=Re(c.id);return e.jsxs("div",{className:`product-card${z?" product-card--selected":""}${q?" product-card--critical":""}${H?" product-card--pending":""}`,onClick:()=>{l(c),h({price:V(c.currentPrice)??0})},children:[e.jsxs("div",{className:"product-card-image",onClick:M=>{M.stopPropagation(),_e(c)},children:[e.jsx("img",{src:O,alt:c.name}),!c.active&&e.jsx("div",{className:"product-badge product-badge--inactive",children:"Inactivo"}),q&&c.active&&e.jsx("div",{className:"product-badge product-badge--critical",children:"âš ï¸ Stock Bajo"})]}),e.jsxs("div",{className:"product-card-body",children:[e.jsxs("div",{className:"product-card-header",children:[e.jsx("h4",{className:"product-card-title",children:c.name}),e.jsx("span",{className:"product-card-sku mono small muted",children:c.sku})]}),e.jsxs("div",{className:"product-card-stats",children:[e.jsxs("div",{className:"product-stat",children:[e.jsx("span",{className:"product-stat-label muted small",children:"Precio"}),e.jsx("span",{className:"product-stat-value mono",children:ve(c.currentPrice)})]}),e.jsxs("div",{className:"product-stat",children:[e.jsx("span",{className:"product-stat-label muted small",children:"Stock"}),e.jsxs("span",{className:`product-stat-value ${q?"text-critical":""}`,children:[f,q&&e.jsx("span",{className:"stock-indicator",children:"âš ï¸"})]})]}),e.jsxs("div",{className:"product-stat",children:[e.jsx("span",{className:"product-stat-label muted small",children:"CrÃ­tico"}),e.jsxs("span",{className:`product-stat-value${H?" text-pending":""}`,children:[D,H&&e.jsx("span",{className:"pending-indicator",children:"â—"})]})]})]}),F&&e.jsx("p",{className:"error small",style:{marginTop:"0.5rem"},children:F}),e.jsxs("div",{className:"product-card-actions",children:[e.jsx("button",{className:"btn ghost small",type:"button",onClick:M=>{M.stopPropagation(),Ce(c)},children:"Stock crÃ­tico"}),e.jsx("button",{className:"btn ghost small",type:"button",onClick:M=>{M.stopPropagation(),ye(c)},children:"QR"})]})]})]},c.id)})}),Se.length===0&&e.jsx("div",{className:"muted",style:{textAlign:"center",padding:"2rem"},children:e.jsx("p",{children:"No se encontraron productos"})}),J>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"btn",disabled:g===0,onClick:()=>n(c=>Math.max(0,c-1)),children:"Anterior"}),e.jsxs("span",{className:"muted",children:["Pagina ",g+1," de ",J]}),e.jsx("button",{className:"btn",disabled:g>=J-1,onClick:()=>n(c=>Math.min(J-1,c+1)),children:"Siguiente"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"panel",children:[e.jsx("h3",{className:"panel-title",children:"Precio"}),e.jsxs("p",{className:"muted",children:["Actual: ",Ye]}),e.jsxs("p",{className:"muted",children:["Estado: ",t.active?"Activo":"Inactivo"]}),e.jsxs("form",{className:"form-inline",onSubmit:Ze,children:[e.jsx("input",{className:"input",type:"number",step:"0.01",min:"0",placeholder:"Nuevo precio",value:m.price,onChange:c=>h(f=>({...f,price:Number(c.target.value)}))}),e.jsx("button",{className:"btn",type:"submit",disabled:X.isPending,children:X.isPending?"Guardando...":"Actualizar"})]}),X.isError&&e.jsx("p",{className:"error",children:X.error?.message}),e.jsx("div",{className:"table-wrapper compact",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Desde"})]})}),e.jsx("tbody",{children:(Te.data?.content??[]).map(c=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono",children:`$${c.price.toFixed(2)}`}),e.jsx("td",{className:"mono small",children:new Date(c.validFrom).toLocaleString()})]},c.id))})]})})]}),e.jsxs("div",{className:"panel",children:[e.jsx("h3",{className:"panel-title",children:"Inventario"}),e.jsxs("p",{className:"muted",children:["Stock total:"," ",I.isLoading?"Cargando...":I.data?I.data.total:"Sin datos"]}),e.jsxs("p",{className:"muted",children:["Stock crÃ­tico configurado: ",Xe]}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>Ce(),children:"Definir stock crÃ­tico"}),I.isError&&e.jsx("p",{className:"error",children:I.error?.message??"No se pudo obtener el stock"}),I.isLoading&&e.jsx("p",{className:"muted",children:"Cargando lotes..."}),I.data&&I.data.lots.length>0&&e.jsx("div",{className:"table-wrapper compact",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Lote"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"UbicaciÃ³n"}),e.jsx("th",{children:"Vence"})]})}),e.jsx("tbody",{children:I.data.lots.map(c=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono small",children:c.lotId}),e.jsx("td",{className:"mono",children:c.quantity}),e.jsx("td",{children:c.location??"â€”"}),e.jsx("td",{className:"mono small",children:c.expiresAt?new Date(c.expiresAt).toLocaleDateString():"â€”"})]},c.lotId))})]})}),I.data&&I.data.lots.length===0&&!I.isLoading&&e.jsx("p",{className:"muted small",children:"No hay lotes registrados para este producto."})]})]})]}),e.jsx(yt,{open:p,product:N,onClose:Ue,onSaved:ze}),e.jsx(wt,{open:j,product:C,onClose:Qe}),e.jsx(St,{open:d,product:v,pendingValue:v?w[v.id]:void 0,error:v?Q[v.id]:void 0,submitting:E,onClose:$e,onSubmit:Ke}),e.jsx(kt,{open:Ie,product:De,imageUrl:qe,onClose:Ge})]})}function At(s){if(Ee.isAxiosError(s)){const r=s.response?.data;if(typeof r=="string"&&r.trim().length>0)return{message:r};if(r&&typeof r=="object"){const n=r.errors??{};let a;const x=n.criticalStock;return Array.isArray(x)&&x.length>0?a=x[0]:typeof x=="string"&&x.trim().length>0&&(a=x),{message:[r.detail,r.message,r.error,r.title].find(l=>typeof l=="string"&&l.trim().length>0)?.trim()??s.response?.statusText??"No se pudo guardar",fieldMessage:a}}const g=s.response?.statusText;if(g)return{message:g}}return s instanceof Error&&s.message?{message:s.message}:{message:"No se pudo guardar"}}function Et(){const[s,r]=b.useState(null),[g,n]=b.useState(!1),[a,x]=b.useState(null),[t,l]=b.useState({code:"",name:"",description:"",type:"WAREHOUSE",parentLocationId:void 0}),m=te(),h=A({queryKey:["locations"],queryFn:()=>dt()}),p=A({queryKey:["location-stock-summary"],queryFn:ut}),u=R({mutationFn:i=>ot(i),onSuccess:()=>{m.invalidateQueries({queryKey:["locations"]}),m.invalidateQueries({queryKey:["location-stock-summary"]}),n(!1),o()}}),N=R({mutationFn:i=>ct(i),onSuccess:()=>{m.invalidateQueries({queryKey:["locations"]}),m.invalidateQueries({queryKey:["location-stock-summary"]}),r(null)}}),o=()=>{l({code:"",name:"",description:"",type:"WAREHOUSE",parentLocationId:void 0}),x(null)},j=i=>{i?(x(i),l({code:i.code,name:i.name,description:i.description,type:i.type,parentLocationId:i.parentLocationId})):o(),n(!0)},y=i=>{if(i.preventDefault(),!t.code||!t.name){alert("CÃ³digo y nombre son requeridos");return}u.mutate(t)},C=()=>{s&&window.confirm(`Â¿Eliminar ubicaciÃ³n ${s.name}?`)&&N.mutate(s.id)},k=h.data??[],d=p.data??[],S=k.reduce((i,w)=>(i[w.type]||(i[w.type]=[]),i[w.type].push(w),i),{}),v=s?d.find(i=>i.locationId===s.id):null;return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Ubicaciones"}),e.jsx("p",{className:"muted small",children:"Gestiona las ubicaciones fÃ­sicas del inventario"})]}),e.jsxs("div",{className:"inline-actions",children:[e.jsx("button",{className:"btn primary",type:"button",onClick:()=>j(),children:"+ Nueva UbicaciÃ³n"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>m.invalidateQueries({queryKey:["locations"]}),disabled:h.isFetching,children:h.isFetching?"Cargando...":"Refrescar"})]}),h.isLoading&&e.jsx("p",{children:"Cargando ubicaciones..."}),h.isError&&e.jsx("p",{className:"error",children:h.error.message}),!h.isLoading&&!h.isError&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"locations-grid",children:[e.jsx("div",{className:"locations-list",children:Object.entries(S).map(([i,w])=>e.jsxs("div",{className:"location-type-section",children:[e.jsx("h3",{className:"location-type-title",children:i}),e.jsx("div",{className:"location-items",children:w.map(P=>{const B=d.find(U=>U.locationId===P.id)?.products.length??0,E=s?.id===P.id;return e.jsxs("div",{className:`location-item${E?" selected":""}`,onClick:()=>r(P),children:[e.jsxs("div",{className:"location-item-header",children:[e.jsx("span",{className:"location-code mono",children:P.code}),B>0&&e.jsxs("span",{className:"location-badge",children:[B," productos"]})]}),e.jsx("div",{className:"location-name",children:P.name}),P.description&&e.jsx("div",{className:"location-description muted small",children:P.description})]},P.id)})})]},i))}),e.jsx("div",{className:"location-details",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"panel",children:[e.jsx("h3",{className:"panel-title",children:"Detalles de UbicaciÃ³n"}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"CÃ³digo:"}),e.jsx("span",{className:"mono",children:s.code})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Nombre:"}),e.jsx("span",{children:s.name})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Tipo:"}),e.jsx("span",{children:s.type})]}),s.description&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"DescripciÃ³n:"}),e.jsx("span",{children:s.description})]}),e.jsxs("div",{className:"inline-actions",style:{marginTop:"1rem"},children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>j(s),children:"Editar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:C,disabled:N.isPending,children:N.isPending?"Eliminando...":"Eliminar"})]})]}),e.jsxs("div",{className:"panel",children:[e.jsx("h3",{className:"panel-title",children:"Productos en esta UbicaciÃ³n"}),p.isLoading&&e.jsx("p",{className:"muted",children:"Cargando stock..."}),v&&v.products.length>0?e.jsx("div",{className:"table-wrapper compact",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Lotes"})]})}),e.jsx("tbody",{children:v.products.map(i=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono small",children:i.productSku}),e.jsx("td",{children:i.productName}),e.jsx("td",{className:"mono",children:i.totalQuantity.toFixed(2)}),e.jsx("td",{className:"mono",children:i.lotCount})]},i.productId))})]})}):e.jsx("p",{className:"muted small",children:"No hay productos en esta ubicaciÃ³n"})]})]}):e.jsx("div",{className:"empty-state",children:e.jsx("p",{className:"muted",children:"Selecciona una ubicaciÃ³n para ver detalles"})})})]})}),g&&e.jsx("div",{className:"modal-overlay",onClick:()=>n(!1),children:e.jsxs("div",{className:"modal",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:a?"Editar UbicaciÃ³n":"Nueva UbicaciÃ³n"}),e.jsx("button",{className:"btn-close",onClick:()=>n(!1),children:"Ã—"})]}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"CÃ³digo *"}),e.jsx("input",{className:"input",type:"text",required:!0,value:t.code,onChange:i=>l({...t,code:i.target.value}),placeholder:"Ej: ALM-01"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre *"}),e.jsx("input",{className:"input",type:"text",required:!0,value:t.name,onChange:i=>l({...t,name:i.target.value}),placeholder:"Ej: AlmacÃ©n Principal"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tipo"}),e.jsxs("select",{className:"input",value:t.type,onChange:i=>l({...t,type:i.target.value}),children:[e.jsx("option",{value:"WAREHOUSE",children:"WAREHOUSE"}),e.jsx("option",{value:"SHELF",children:"SHELF"}),e.jsx("option",{value:"BIN",children:"BIN"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"UbicaciÃ³n Padre (opcional)"}),e.jsxs("select",{className:"input",value:t.parentLocationId??"",onChange:i=>l({...t,parentLocationId:i.target.value||void 0}),children:[e.jsx("option",{value:"",children:"-- Sin ubicaciÃ³n padre --"}),k.map(i=>e.jsxs("option",{value:i.id,children:[i.code," - ",i.name," (",i.type,")"]},i.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"DescripciÃ³n (opcional)"}),e.jsx("textarea",{className:"input",rows:3,value:t.description??"",onChange:i=>l({...t,description:i.target.value}),placeholder:"DescripciÃ³n de la ubicaciÃ³n"})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>n(!1),disabled:u.isPending,children:"Cancelar"}),e.jsx("button",{className:"btn primary",type:"submit",disabled:u.isPending,children:u.isPending?"Guardando...":a?"Actualizar":"Crear"})]}),u.isError&&e.jsx("p",{className:"error",children:u.error?.message??"Error al guardar"})]})]})})]})}function Lt(){const[s,r]=b.useState(null),[g,n]=b.useState(!1),[a,x]=b.useState(null),[t,l]=b.useState("active"),[m,h]=b.useState({code:"",name:"",description:"",active:!0}),p=te(),u=A({queryKey:["services",{status:t}],queryFn:()=>t==="all"?ke():ke(t==="active")}),N=R({mutationFn:i=>mt(i),onSuccess:i=>{p.invalidateQueries({queryKey:["services"]}),n(!1),r(i),y()}}),o=R({mutationFn:({id:i,payload:w})=>xt(i,w),onSuccess:()=>{p.invalidateQueries({queryKey:["services"]}),n(!1),y()}}),j=R({mutationFn:i=>ht(i),onSuccess:()=>{p.invalidateQueries({queryKey:["services"]}),r(null)}}),y=()=>{h({code:"",name:"",description:"",active:!0}),x(null)},C=i=>{i?(x(i),h({code:i.code,name:i.name,description:i.description,active:i.active})):y(),n(!0)},k=i=>{if(i.preventDefault(),!m.code||!m.name){alert("CÃ³digo y nombre son requeridos");return}a?o.mutate({id:a.id,payload:m}):N.mutate(m)},d=()=>{s&&window.confirm(`Â¿Eliminar servicio ${s.name}?`)&&j.mutate(s.id)},S=u.data??[],v=i=>i?new Date(i).toLocaleDateString("es-CL",{year:"numeric",month:"short",day:"numeric"}):"Nunca";return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Servicios"}),e.jsx("p",{className:"muted small",children:"Gestiona servicios que no requieren inventario"})]})}),e.jsxs("div",{className:"inline-actions",children:[e.jsxs("select",{className:"input",value:t,onChange:i=>l(i.target.value),children:[e.jsx("option",{value:"active",children:"Activos"}),e.jsx("option",{value:"inactive",children:"Inactivos"}),e.jsx("option",{value:"all",children:"Todos"})]}),e.jsx("button",{className:"btn primary",type:"button",onClick:()=>C(),children:"+ Nuevo Servicio"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>p.invalidateQueries({queryKey:["services"]}),disabled:u.isFetching,children:u.isFetching?"Cargando...":"Refrescar"})]}),u.isLoading&&e.jsx("p",{children:"Cargando servicios..."}),u.isError&&e.jsx("p",{className:"error",children:u.error.message}),!u.isLoading&&!u.isError&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"CÃ³digo"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Ãšltima Compra"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:S.map(i=>{const w=s?.id===i.id;return e.jsxs("tr",{className:w?"selected":"",onClick:()=>r(i),children:[e.jsx("td",{className:"mono",children:i.code}),e.jsx("td",{children:i.name}),e.jsx("td",{className:"mono small",children:v(i.lastPurchaseDate)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${i.active?"badge-success":"badge-muted"}`,children:i.active?"Activo":"Inactivo"})}),e.jsx("td",{children:e.jsx("button",{className:"btn ghost small",type:"button",onClick:P=>{P.stopPropagation(),C(i)},children:"Editar"})})]},i.id)})})]})}),S.length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{className:"muted",children:"No hay servicios registrados"})}),s&&e.jsxs("div",{className:"panel",children:[e.jsx("h3",{className:"panel-title",children:"Detalles del Servicio"}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"CÃ³digo:"}),e.jsx("span",{className:"mono",children:s.code})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Nombre:"}),e.jsx("span",{children:s.name})]}),s.description&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"DescripciÃ³n:"}),e.jsx("span",{children:s.description})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Ãšltima compra:"}),e.jsx("span",{children:v(s.lastPurchaseDate)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Estado:"}),e.jsx("span",{children:s.active?"Activo":"Inactivo"})]}),e.jsxs("div",{className:"inline-actions",style:{marginTop:"1rem"},children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>C(s),children:"Editar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:d,disabled:j.isPending,children:j.isPending?"Eliminando...":"Eliminar"})]})]})]}),g&&e.jsx("div",{className:"modal-overlay",onClick:()=>n(!1),children:e.jsxs("div",{className:"modal",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:a?"Editar Servicio":"Nuevo Servicio"}),e.jsx("button",{className:"btn-close",onClick:()=>n(!1),children:"Ã—"})]}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"CÃ³digo *"}),e.jsx("input",{className:"input",type:"text",required:!0,value:m.code,onChange:i=>h({...m,code:i.target.value}),placeholder:"Ej: SRV-001"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre *"}),e.jsx("input",{className:"input",type:"text",required:!0,value:m.name,onChange:i=>h({...m,name:i.target.value}),placeholder:"Ej: ConsultorÃ­a de TI"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"DescripciÃ³n (opcional)"}),e.jsx("textarea",{className:"input",rows:3,value:m.description??"",onChange:i=>h({...m,description:i.target.value}),placeholder:"DescripciÃ³n del servicio"})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:m.active??!0,onChange:i=>h({...m,active:i.target.checked})}),"Activo"]})}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>n(!1),disabled:N.isPending||o.isPending,children:"Cancelar"}),e.jsx("button",{className:"btn primary",type:"submit",disabled:N.isPending||o.isPending,children:N.isPending||o.isPending?"Guardando...":a?"Actualizar":"Crear"})]}),(N.isError||o.isError)&&e.jsx("p",{className:"error",children:(N.error||o.error)?.message??"Error al guardar"})]})]})})]})}const ne={productId:"",direction:"increase",quantity:"0",unitCost:"0",reason:"",expDate:""};function It({open:s,onClose:r,onApplied:g}){const[n,a]=b.useState(ne);b.useEffect(()=>{s||a(ne)},[s]);const x=A({queryKey:["products",{dialog:"inventory-adjustment"}],queryFn:()=>W({size:200,status:"all"}),enabled:s}),t=b.useMemo(()=>x.data?.content??[],[x.data]),l=R({mutationFn:()=>{if(!n.productId)throw new Error("Selecciona un producto");const h=Number(n.quantity);if(!Number.isFinite(h)||h<=0)throw new Error("La cantidad debe ser mayor a cero");const p=n.direction,u=Number(n.unitCost||0);if(p==="increase"&&(Number.isNaN(u)||u<0))throw new Error("El costo unitario debe ser positivo");const N={productId:n.productId,quantity:h,direction:p,reason:n.reason.trim()||"Ajuste manual",unitCost:p==="increase"?u:void 0,expDate:n.expDate||void 0};return gt(N)},onSuccess:()=>{g?.(),a(ne),r()}}),m=h=>{h.preventDefault(),!l.isPending&&l.mutate()};return e.jsx(Z,{open:s,title:"Ajuste de stock",onClose:()=>{l.isPending||r()},children:e.jsxs("form",{className:"form-grid",onSubmit:m,children:[e.jsxs("label",{children:[e.jsx("span",{children:"Producto *"}),e.jsxs("select",{className:"input",value:n.productId,onChange:h=>a(p=>({...p,productId:h.target.value})),disabled:l.isPending,required:!0,children:[e.jsx("option",{value:"",children:"Selecciona un producto"}),t.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Tipo de ajuste"}),e.jsxs("select",{className:"input",value:n.direction,onChange:h=>a(p=>({...p,direction:h.target.value})),disabled:l.isPending,children:[e.jsx("option",{value:"increase",children:"Incremento"}),e.jsx("option",{value:"decrease",children:"Disminucion"})]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Cantidad *"}),e.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",value:n.quantity,onChange:h=>a(p=>({...p,quantity:h.target.value})),disabled:l.isPending,required:!0})]}),n.direction==="increase"&&e.jsxs("label",{children:[e.jsx("span",{children:"Costo unitario"}),e.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",value:n.unitCost,onChange:h=>a(p=>({...p,unitCost:h.target.value})),disabled:l.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Fecha de vencimiento"}),e.jsx("input",{className:"input",type:"date",value:n.expDate,onChange:h=>a(p=>({...p,expDate:h.target.value})),disabled:l.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Motivo"}),e.jsx("textarea",{className:"input",rows:3,value:n.reason,onChange:h=>a(p=>({...p,reason:h.target.value})),placeholder:"Regularizacion, inventario, merma, etc.",disabled:l.isPending})]}),l.isError&&e.jsx("p",{className:"error",children:l.error?.message??"No se pudo registrar el ajuste"}),e.jsxs("div",{className:"buttons",children:[e.jsx("button",{className:"btn",type:"submit",disabled:l.isPending,children:l.isPending?"Guardando...":"Registrar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:r,disabled:l.isPending,children:"Cancelar"})]})]})})}async function Dt(s){const r=new URLSearchParams;s.productId&&r.append("productId",s.productId),s.type&&r.append("type",s.type),s.from&&r.append("from",s.from),s.to&&r.append("to",s.to),r.append("page",String(s.page??0)),r.append("size",String(s.size));const g=await fetch(`/api/v1/inventory/movements?${r}`);if(!g.ok)throw new Error("Error al cargar movimientos");return g.json()}const Fe=[{value:"",label:"Todos los tipos"},{value:"MANUAL_IN",label:"Entrada manual"},{value:"MANUAL_OUT",label:"Salida manual"},{value:"SALE_OUT",label:"Venta"},{value:"SALE_CANCEL",label:"CancelaciÃ³n venta"},{value:"PURCHASE_IN",label:"Compra"}];function qt(){const[s,r]=b.useState(0),[g,n]=b.useState(""),[a,x]=b.useState(""),[t,l]=b.useState(""),m=A({queryKey:["inventory-movements",s,g,a,t],queryFn:()=>Dt({type:g||void 0,from:a?new Date(a).toISOString():void 0,to:t?new Date(t+"T23:59:59").toISOString():void 0,page:s,size:20})}),h=u=>Fe.find(N=>N.value===u)?.label??u,p=u=>{switch(u){case"MANUAL_IN":case"PURCHASE_IN":return"status active";case"MANUAL_OUT":case"SALE_OUT":return"status cancelled";case"SALE_CANCEL":return"status warning";default:return"status"}};return e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Historial de Movimientos (AuditorÃ­a)"}),e.jsx("p",{className:"muted",style:{marginBottom:"1rem"},children:"Registro completo de todos los movimientos de inventario con trazabilidad"}),e.jsxs("div",{className:"filter-bar",style:{marginBottom:"1rem"},children:[e.jsx("select",{className:"input",value:g,onChange:u=>{n(u.target.value),r(0)},children:Fe.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))}),e.jsx("input",{type:"date",className:"input",value:a,onChange:u=>{x(u.target.value),r(0)},placeholder:"Desde"}),e.jsx("input",{type:"date",className:"input",value:t,onChange:u=>{l(u.target.value),r(0)},placeholder:"Hasta"}),(g||a||t)&&e.jsx("button",{className:"btn ghost",onClick:()=>{n(""),x(""),l(""),r(0)},children:"Limpiar filtros"})]}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Stock Anterior"}),e.jsx("th",{children:"Stock Nuevo"}),e.jsx("th",{children:"Usuario"}),e.jsx("th",{children:"IP"}),e.jsx("th",{children:"Nota"})]})}),e.jsxs("tbody",{children:[m.isLoading&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"muted",children:"Cargando movimientos..."})}),m.isError&&e.jsx("tr",{children:e.jsxs("td",{colSpan:9,className:"error",children:["Error: ",m.error.message]})}),!m.isLoading&&!m.isError&&m.data?.content.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono small",children:new Date(u.createdAt).toLocaleString("es-CL")}),e.jsx("td",{children:e.jsx("span",{className:p(u.type),children:h(u.type)})}),e.jsx("td",{children:u.productName}),e.jsxs("td",{className:"mono",children:[u.type.includes("OUT")?"-":"+",Number(u.qty).toFixed(2)]}),e.jsx("td",{className:"mono",children:u.previousQty!=null?Number(u.previousQty).toFixed(2):"-"}),e.jsx("td",{className:"mono",children:u.newQty!=null?Number(u.newQty).toFixed(2):"-"}),e.jsx("td",{className:"small",children:u.createdBy??"Sistema"}),e.jsx("td",{className:"mono small",children:u.userIp??"-"}),e.jsx("td",{className:"small",children:u.note??"-"})]},u.id)),!m.isLoading&&!m.isError&&m.data?.content.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"muted",children:"No hay movimientos"})})]})]})}),m.data&&m.data.totalPages>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"btn",disabled:s===0,onClick:()=>r(u=>Math.max(0,u-1)),children:"Anterior"}),e.jsxs("span",{className:"muted",children:["PÃ¡gina ",s+1," de ",m.data.totalPages]}),e.jsx("button",{className:"btn",disabled:s+1>=m.data.totalPages,onClick:()=>r(u=>u+1),children:"Siguiente"})]}),m.data&&e.jsx("div",{style:{marginTop:"1rem",padding:"0.75rem",background:"#f5f5f5",borderRadius:"4px"},children:e.jsxs("p",{className:"muted small",children:[e.jsx("strong",{children:"Total de registros:"})," ",m.data.totalElements," movimientos"]})})]})}function Mt(){b.useMemo(()=>ce(),[]);const s=A({queryKey:["products-rotation"],queryFn:()=>W({size:200,status:"all"})}),r=s.data?.content??[],g=b.useMemo(()=>{const n=r.map(o=>{const j=Number(o.stock??0),C=Number(o.currentPrice??0)*.7,k=j*C,d=Math.random()*20;return{id:o.id,name:o.name??"Sin nombre",stock:j,value:k,rotation:d,category:o.category??"General"}}),a=n.reduce((o,j)=>o+j.value,0),x=[...n].sort((o,j)=>j.value-o.value);let t=0;const l=x.map(o=>{t+=o.value;const j=a>0?t/a*100:0;return{...o,class:j<=80?"A":j<=95?"B":"C"}}),m=l.filter(o=>o.class==="A"),h=l.filter(o=>o.class==="B"),p=l.filter(o=>o.class==="C"),u=[...n].sort((o,j)=>j.rotation-o.rotation).slice(0,5),N=[...n].sort((o,j)=>o.rotation-j.rotation).slice(0,5);return{classA:m,classB:h,classC:p,topMovers:u,slowMovers:N,totalValue:a}},[r]);return s.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"AnÃ¡lisis de RotaciÃ³n"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-80"})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"AnÃ¡lisis de RotaciÃ³n (ABC)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-950 border border-green-800 rounded-lg p-4",children:[e.jsx("h4",{className:"text-green-400 font-medium mb-2",children:"ðŸ“Š Clase A (80%)"}),e.jsx("p",{className:"text-green-100 text-2xl font-bold",children:g.classA.length}),e.jsx("p",{className:"text-green-300 text-sm",children:"Productos crÃ­ticos"})]}),e.jsxs("div",{className:"bg-yellow-950 border border-yellow-800 rounded-lg p-4",children:[e.jsx("h4",{className:"text-yellow-400 font-medium mb-2",children:"ðŸ“ˆ Clase B (15%)"}),e.jsx("p",{className:"text-yellow-100 text-2xl font-bold",children:g.classB.length}),e.jsx("p",{className:"text-yellow-300 text-sm",children:"Productos importantes"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-neutral-300 font-medium mb-2",children:"ðŸ“‰ Clase C (5%)"}),e.jsx("p",{className:"text-neutral-100 text-2xl font-bold",children:g.classC.length}),e.jsx("p",{className:"text-neutral-400 text-sm",children:"Baja prioridad"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-neutral-300 font-medium mb-3",children:"ðŸ”¥ Top Movers"}),e.jsx("div",{className:"space-y-2",children:g.topMovers.map((n,a)=>e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-neutral-100 font-medium",children:[a===0?"ðŸ¥‡":a===1?"ðŸ¥ˆ":a===2?"ðŸ¥‰":`${a+1}.`," ",n.name]}),e.jsxs("span",{className:"text-green-400 font-semibold",children:[n.rotation.toFixed(1)," u/mes"]})]})},n.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-neutral-300 font-medium mb-3",children:"ðŸŒ Slow Movers"}),e.jsx("div",{className:"space-y-2",children:g.slowMovers.map(n=>e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-100 font-medium",children:n.name}),e.jsxs("span",{className:"text-red-400 font-semibold",children:[n.rotation.toFixed(1)," u/mes"]})]})},n.id))})]})]}),e.jsxs("div",{className:"mt-4 bg-blue-950 border border-blue-800 rounded-lg p-3 text-blue-400 text-sm",children:["ðŸ’¡ ",e.jsx("strong",{children:"Insight:"})," ClasificaciÃ³n ABC ayuda a priorizar gestiÃ³n de inventario segÃºn valor"]})]})}function Rt(){const s=b.useMemo(()=>ce(),[]),r=l=>s.format(l??0),g=A({queryKey:["inventory-summary"],queryFn:le}),n=g.data,a=Number(n?.totalValue??0),x=b.useMemo(()=>[{month:"Hace 3m",value:a*.75},{month:"Hace 2m",value:a*.85},{month:"Hace 1m",value:a*.92},{month:"Actual",value:a}],[a]),t=Math.max(...x.map(l=>l.value));return g.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"EvoluciÃ³n de ValorizaciÃ³n"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-64"})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"EvoluciÃ³n de ValorizaciÃ³n"}),e.jsxs("span",{className:"px-3 py-1 bg-blue-950 text-blue-400 border border-blue-800 rounded-full text-sm",children:["ðŸ“ˆ Tendencia: +",((a/(a*.75)-1)*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"space-y-4 mb-6",children:x.map((l,m)=>{const h=t>0?l.value/t*100:0,p=m===x.length-1;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-neutral-300 text-sm",children:l.month}),e.jsx("span",{className:"text-neutral-100 font-semibold",children:r(l.value)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-full ${p?"bg-gradient-to-r from-blue-600 to-blue-400":"bg-neutral-600"} transition-all`,style:{width:`${h}%`}})})]},l.month)})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsx("p",{className:"text-neutral-400 text-sm",children:"Valor Total"}),e.jsx("p",{className:"text-neutral-100 text-xl font-bold",children:r(a)})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsx("p",{className:"text-neutral-400 text-sm",children:"Productos"}),e.jsx("p",{className:"text-neutral-100 text-xl font-bold",children:n?.activeProducts??0})]})]})]})}function Tt(){const s=A({queryKey:["products-replenishment"],queryFn:()=>W({size:100,status:"all"})}),r=s.data?.content??[],g=b.useMemo(()=>r.map(n=>{const a=Number(n.stock??0),x=Math.random()*5+1,t=7,l=x*3,m=x*t+l,h=x*30,p=a<m,u=x>0?a/x:999,N=Math.max(0,h-a);return{id:n.id,name:n.name??"Sin nombre",stock:a,reorderPoint:m,daysOfCoverage:u,suggestedOrder:N,needsReplenishment:p,urgency:u<7?"critical":u<14?"high":"normal"}}).filter(n=>n.needsReplenishment).sort((n,a)=>n.daysOfCoverage-a.daysOfCoverage).slice(0,8),[r]);return s.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Panel de Reabastecimiento"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-80"})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"Panel de Reabastecimiento"}),e.jsxs("span",{className:"px-3 py-1 bg-orange-950 text-orange-400 border border-orange-800 rounded-full text-sm",children:[g.length," productos requieren pedido"]})]}),g.length===0?e.jsx("div",{className:"bg-green-950 border border-green-800 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-green-400",children:"âœ… Todos los productos tienen stock suficiente"})}):e.jsx("div",{className:"space-y-3",children:g.map(n=>{const a={critical:{bg:"bg-red-950",border:"border-red-800",text:"text-red-400",icon:"ðŸ”´"},high:{bg:"bg-yellow-950",border:"border-yellow-800",text:"text-yellow-400",icon:"âš ï¸"},normal:{bg:"bg-blue-950",border:"border-blue-800",text:"text-blue-400",icon:"â„¹ï¸"}}[n.urgency]||{bg:"bg-neutral-950",border:"border-neutral-800",text:"text-neutral-400",icon:"â„¹ï¸"};return e.jsxs("div",{className:`${a.bg} border ${a.border} rounded-lg p-4`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:a.icon}),e.jsx("h4",{className:"text-neutral-100 font-medium",children:n.name})]}),e.jsxs("p",{className:"text-neutral-400 text-sm",children:["Stock actual:"," ",e.jsxs("strong",{className:a.text,children:[n.stock," unidades"]})]}),e.jsxs("p",{className:"text-neutral-400 text-sm",children:["Cobertura: ",e.jsxs("strong",{children:[n.daysOfCoverage.toFixed(0)," dÃ­as"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-neutral-400 text-xs mb-1",children:"Cantidad sugerida"}),e.jsx("p",{className:`${a.text} text-2xl font-bold`,children:Math.ceil(n.suggestedOrder)})]})]}),e.jsx("button",{className:`w-full mt-2 px-4 py-2 ${a.bg} ${a.text} border ${a.border} rounded-lg hover:bg-opacity-80 transition`,children:"Generar Orden de Compra"})]},n.id)})}),e.jsxs("div",{className:"mt-4 bg-blue-950 border border-blue-800 rounded-lg p-3 text-blue-400 text-sm",children:["ðŸ’¡ ",e.jsx("strong",{children:"Sugerencia:"})," Punto de reorden calculado segÃºn consumo + plazo de entrega + stock de seguridad"]})]})}function Ot(){const s=b.useMemo(()=>ce(),[]),r=m=>s.format(m??0),g=A({queryKey:["inventory-summary"],queryFn:le}),n=A({queryKey:["products-efficiency"],queryFn:()=>W({size:200,status:"all"})}),a=g.data,x=n.data?.content??[],t=Number(a?.totalValue??0),l=b.useMemo(()=>{const m=x.length,u=x.reduce((v,i)=>v+Number(i.stock??0),0)/15,N=x.filter(v=>Number(v.stock??0)===0).length,o=m>0?N/m*100:0,j=12,y=150,C=(y-j)/y*100,S=t*.05/12;return{daysOfCoverage:u,stockOutRate:o,inventoryAccuracy:C,monthlyStorageCost:S,outOfStock:N,totalProducts:m}},[x,t]);return g.isLoading||n.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"MÃ©tricas de Eficiencia"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-64"})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"MÃ©tricas de Eficiencia"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-950 border border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-blue-400 font-medium",children:"ðŸ“… DÃ­as de Cobertura"}),e.jsx("span",{className:"text-blue-300 text-2xl font-bold",children:l.daysOfCoverage.toFixed(0)})]}),e.jsx("p",{className:"text-blue-300 text-sm",children:"Stock actual / Consumo diario promedio"}),e.jsx("div",{className:"mt-2 w-full bg-blue-900 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-full rounded-full transition-all",style:{width:`${Math.min(l.daysOfCoverage/60*100,100)}%`}})})]}),e.jsxs("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-red-400 font-medium",children:"ðŸ“‰ Tasa de Quiebre"}),e.jsxs("span",{className:"text-red-300 text-2xl font-bold",children:[l.stockOutRate.toFixed(1),"%"]})]}),e.jsxs("p",{className:"text-red-300 text-sm",children:[l.outOfStock," de ",l.totalProducts," productos sin stock"]}),e.jsx("div",{className:"mt-2 w-full bg-red-900 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-full rounded-full transition-all",style:{width:`${l.stockOutRate}%`}})})]}),e.jsxs("div",{className:"bg-green-950 border border-green-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-green-400 font-medium",children:"âœ… PrecisiÃ³n Inventario"}),e.jsxs("span",{className:"text-green-300 text-2xl font-bold",children:[l.inventoryAccuracy.toFixed(1),"%"]})]}),e.jsx("p",{className:"text-green-300 text-sm",children:"Basado en movimientos vs ajustes"}),e.jsx("div",{className:"mt-2 w-full bg-green-900 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-full rounded-full transition-all",style:{width:`${l.inventoryAccuracy}%`}})})]}),e.jsxs("div",{className:"bg-purple-950 border border-purple-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-purple-400 font-medium",children:"ðŸ’° Costo Almacenamiento"}),e.jsx("span",{className:"text-purple-300 text-2xl font-bold",children:r(l.monthlyStorageCost)})]}),e.jsx("p",{className:"text-purple-300 text-sm",children:"Estimado mensual (~5% anual del valor)"})]})]}),e.jsxs("div",{className:"mt-4 bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-neutral-100 font-medium mb-2",children:"Recomendaciones"}),e.jsxs("ul",{className:"space-y-1 text-neutral-300 text-sm",children:[l.stockOutRate>10&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400",children:"âš ï¸"}),e.jsx("span",{children:"Tasa de quiebre alta. Revisar puntos de reorden."})]}),l.daysOfCoverage>90&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-yellow-400",children:"âš ï¸"}),e.jsx("span",{children:"Sobrestock detectado. Evaluar reducciÃ³n de inventario."})]}),l.inventoryAccuracy<95&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-orange-400",children:"âš ï¸"}),e.jsx("span",{children:"Baja precisiÃ³n. Realizar conteo cÃ­clico."})]}),l.stockOutRate<=5&&l.inventoryAccuracy>=95&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400",children:"âœ…"}),e.jsx("span",{children:"Inventario en niveles Ã³ptimos. Â¡Buen trabajo!"})]})]})]})]})}function Bt(){const{data:s,isLoading:r,error:g}=A({queryKey:["inventoryKPIs"],queryFn:bt,refetchInterval:6e4});if(r)return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map((t,l)=>e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-neutral-800 rounded w-2/3 mb-3"}),e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-neutral-800 rounded w-3/4"})]},l))});if(g)return e.jsx("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar KPIs de inventario"})});const n=t=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(t),a=t=>new Intl.NumberFormat("es-CL").format(t),x=[{title:"Cobertura de Stock",value:s?.stockCoverageDays!==null&&s?.stockCoverageDays!==void 0?`${s.stockCoverageDays.toFixed(1)} dÃ­as`:"N/A",subtitle:"DuraciÃ³n estimada del inventario",color:"text-blue-400",bgColor:"bg-blue-900/20",borderColor:"border-blue-800"},{title:"Ratio de RotaciÃ³n",value:s?.turnoverRatio?s.turnoverRatio.toFixed(2):"0.00",subtitle:"Veces por aÃ±o (anualizado)",color:"text-green-400",bgColor:"bg-green-900/20",borderColor:"border-green-800"},{title:"Stock Muerto",value:n(s?.deadStockValue||0),subtitle:`${s?.deadStockCount||0} productos sin movimiento >90 dÃ­as`,color:"text-orange-400",bgColor:"bg-orange-900/20",borderColor:"border-orange-800"},{title:"Tiempo de ReposiciÃ³n",value:`${s?.averageLeadTimeDays||0} dÃ­as`,subtitle:"Tiempo promedio de lead time",color:"text-purple-400",bgColor:"bg-purple-900/20",borderColor:"border-purple-800"},{title:"Stock CrÃ­tico",value:a(s?.criticalStockProducts||0),subtitle:"Productos bajo umbral",color:"text-red-400",bgColor:"bg-red-900/20",borderColor:"border-red-800"},{title:"Sobrestock",value:n(s?.overstockValue||0),subtitle:`${s?.overstockCount||0} productos excedidos`,color:"text-yellow-400",bgColor:"bg-yellow-900/20",borderColor:"border-yellow-800"}];return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map((t,l)=>e.jsxs("div",{className:`${t.bgColor} border ${t.borderColor} rounded-lg p-6 transition-all hover:scale-[1.02]`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-400",children:t.title}),e.jsx("div",{className:`w-10 h-10 rounded-lg ${t.bgColor} border ${t.borderColor} flex items-center justify-center`,children:e.jsx("span",{className:`text-xl ${t.color}`,children:"â—"})})]}),e.jsx("div",{className:`text-2xl font-bold ${t.color} mb-1`,children:t.value}),e.jsx("p",{className:"text-xs text-neutral-500",children:t.subtitle})]},l))})}function Ut(){const{data:s,isLoading:r,error:g}=A({queryKey:["stockMovementStats"],queryFn:pt,refetchInterval:6e4});if(r)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-6"}),e.jsx("div",{className:"h-64 bg-neutral-800 rounded"})]});if(g)return e.jsx("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar estadÃ­sticas de movimiento"})});const n=t=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(t),a=t=>new Intl.NumberFormat("es-CL").format(t),x=[{name:"Entradas",valor:s?.totalInflows||0,transacciones:s?.inflowTransactions||0},{name:"Salidas",valor:s?.totalOutflows||0,transacciones:s?.outflowTransactions||0}];return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-2",children:"Resumen de Movimientos (Ãºltimos 30 dÃ­as)"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"AnÃ¡lisis de entradas y salidas de inventario"})]}),e.jsx("div",{className:"mb-8",children:e.jsx(de,{width:"100%",height:300,children:e.jsxs(ue,{data:x,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(me,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(xe,{dataKey:"name",stroke:"#a3a3a3"}),e.jsx(he,{stroke:"#a3a3a3",tickFormatter:t=>n(t)}),e.jsx(ge,{contentStyle:{backgroundColor:"#262626",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#f5f5f5"},formatter:t=>n(t)}),e.jsx(be,{}),e.jsx(ee,{dataKey:"valor",fill:"#3b82f6",name:"Valor Total",radius:[8,8,0,0]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Total Entradas"}),e.jsx("div",{className:"text-2xl font-bold text-green-400",children:n(s?.totalInflows||0)}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:[s?.inflowTransactions||0," transacciones"]})]}),e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Total Salidas"}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:n(s?.totalOutflows||0)}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:[s?.outflowTransactions||0," transacciones"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-neutral-300 mb-3",children:"Top 5 Entradas"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b border-neutral-800",children:e.jsxs("tr",{className:"text-left text-neutral-400",children:[e.jsx("th",{className:"pb-2 font-medium",children:"Producto"}),e.jsx("th",{className:"pb-2 font-medium text-right",children:"Cantidad"}),e.jsx("th",{className:"pb-2 font-medium text-right",children:"Valor"})]})}),e.jsx("tbody",{children:s?.topInflowProducts&&s.topInflowProducts.length>0?s.topInflowProducts.map((t,l)=>e.jsxs("tr",{className:"border-b border-neutral-800/50",children:[e.jsx("td",{className:"py-2 text-neutral-300",children:t.productName}),e.jsx("td",{className:"py-2 text-right text-neutral-400",children:a(t.quantity)}),e.jsx("td",{className:"py-2 text-right text-green-400",children:n(t.value)})]},l)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-4 text-center text-neutral-500",children:"Sin movimientos de entrada"})})})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-neutral-300 mb-3",children:"Top 5 Salidas"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b border-neutral-800",children:e.jsxs("tr",{className:"text-left text-neutral-400",children:[e.jsx("th",{className:"pb-2 font-medium",children:"Producto"}),e.jsx("th",{className:"pb-2 font-medium text-right",children:"Cantidad"}),e.jsx("th",{className:"pb-2 font-medium text-right",children:"Valor"})]})}),e.jsx("tbody",{children:s?.topOutflowProducts&&s.topOutflowProducts.length>0?s.topOutflowProducts.map((t,l)=>e.jsxs("tr",{className:"border-b border-neutral-800/50",children:[e.jsx("td",{className:"py-2 text-neutral-300",children:t.productName}),e.jsx("td",{className:"py-2 text-right text-neutral-400",children:a(t.quantity)}),e.jsx("td",{className:"py-2 text-right text-red-400",children:n(t.value)})]},l)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-4 text-center text-neutral-500",children:"Sin movimientos de salida"})})})]})})]})]})]})}function Qt(){const{data:s,isLoading:r,error:g}=A({queryKey:["abcAnalysis"],queryFn:()=>ie(),refetchInterval:3e5});if(r)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-6"}),e.jsx("div",{className:"h-80 bg-neutral-800 rounded"})]});if(g)return e.jsx("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar anÃ¡lisis ABC"})});if(!s||s.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-neutral-400",children:"No hay datos suficientes para anÃ¡lisis ABC"}),e.jsx("p",{className:"text-xs text-neutral-500 mt-2",children:"El anÃ¡lisis requiere productos con inventario valorizado"})]});const n=o=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),a=s.filter(o=>o.classification==="A"),x=s.filter(o=>o.classification==="B"),t=s.filter(o=>o.classification==="C"),l=a.reduce((o,j)=>o+j.totalValue,0),m=x.reduce((o,j)=>o+j.totalValue,0),h=t.reduce((o,j)=>o+j.totalValue,0),p=l+m+h,u=[{name:"Clase A",productos:a.length,valor:l,porcentaje:(l/p*100).toFixed(1)},{name:"Clase B",productos:x.length,valor:m,porcentaje:(m/p*100).toFixed(1)},{name:"Clase C",productos:t.length,valor:h,porcentaje:(h/p*100).toFixed(1)}],N={A:"#22c55e",B:"#eab308",C:"#f97316"};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-2",children:"AnÃ¡lisis ABC de Inventario"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"ClasificaciÃ³n por valor de inventario (Principio de Pareto 80-15-5)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-300",children:"Clase A"}),e.jsxs("span",{className:"px-2 py-1 bg-green-900/40 border border-green-800 rounded text-xs font-semibold text-green-400",children:[a.length," productos"]})]}),e.jsx("div",{className:"text-2xl font-bold text-green-400 mb-1",children:n(l)}),e.jsxs("div",{className:"text-xs text-neutral-400",children:[(l/p*100).toFixed(1),"% del valor total"]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-2",children:"Alta rotaciÃ³n - Control diario"})]}),e.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-300",children:"Clase B"}),e.jsxs("span",{className:"px-2 py-1 bg-yellow-900/40 border border-yellow-800 rounded text-xs font-semibold text-yellow-400",children:[x.length," productos"]})]}),e.jsx("div",{className:"text-2xl font-bold text-yellow-400 mb-1",children:n(m)}),e.jsxs("div",{className:"text-xs text-neutral-400",children:[(m/p*100).toFixed(1),"% del valor total"]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-2",children:"RotaciÃ³n media - Control semanal"})]}),e.jsxs("div",{className:"bg-orange-900/20 border border-orange-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-300",children:"Clase C"}),e.jsxs("span",{className:"px-2 py-1 bg-orange-900/40 border border-orange-800 rounded text-xs font-semibold text-orange-400",children:[t.length," productos"]})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-400 mb-1",children:n(h)}),e.jsxs("div",{className:"text-xs text-neutral-400",children:[(h/p*100).toFixed(1),"% del valor total"]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-2",children:"Baja rotaciÃ³n - Control mensual"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-neutral-300 mb-3",children:"DistribuciÃ³n de Valor por ClasificaciÃ³n"}),e.jsx(de,{width:"100%",height:300,children:e.jsxs(ue,{data:u,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(me,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(xe,{dataKey:"name",stroke:"#a3a3a3"}),e.jsx(he,{stroke:"#a3a3a3",tickFormatter:o=>n(o)}),e.jsx(ge,{contentStyle:{backgroundColor:"#262626",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#f5f5f5"},formatter:o=>n(o)}),e.jsx(be,{}),e.jsx(ee,{dataKey:"valor",name:"Valor Total",radius:[8,8,0,0],children:u.map((o,j)=>e.jsx(Le,{fill:j===0?N.A:j===1?N.B:N.C},`cell-${j}`))})]})})]}),e.jsx("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"Total Productos"}),e.jsx("div",{className:"text-lg font-semibold text-neutral-100",children:s.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"Valor Total Inventario"}),e.jsx("div",{className:"text-lg font-semibold text-neutral-100",children:n(p)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"ConcentraciÃ³n Clase A"}),e.jsxs("div",{className:"text-lg font-semibold text-green-400",children:[(a.length/s.length*100).toFixed(1),"% productos"]})]})]})})]})}function $t(){const[s,r]=b.useState("all"),[g,n]=b.useState(""),[a,x]=b.useState(1),t=10,{data:l,isLoading:m,error:h}=A({queryKey:["abcAnalysis"],queryFn:()=>ie(),refetchInterval:3e5});if(m)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((d,S)=>e.jsx("div",{className:"h-12 bg-neutral-800 rounded"},S))})]});if(h||!l)return e.jsx("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar productos"})});const p=d=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(d),u=d=>d?new Date(d).toLocaleDateString("es-CL"):"N/A",N=l.filter(d=>{const S=s==="all"||d.classification===s,v=d.productName.toLowerCase().includes(g.toLowerCase())||d.category.toLowerCase().includes(g.toLowerCase());return S&&v}),o=Math.ceil(N.length/t),j=(a-1)*t,y=j+t,C=N.slice(j,y),k=d=>{switch(d){case"A":return"bg-green-900/40 border-green-800 text-green-400";case"B":return"bg-yellow-900/40 border-yellow-800 text-yellow-400";case"C":return"bg-orange-900/40 border-orange-800 text-orange-400";default:return"bg-neutral-800 border-neutral-700 text-neutral-400"}};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-100 mb-4",children:"Productos por ClasificaciÃ³n ABC"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Buscar producto o categorÃ­a...",value:g,onChange:d=>{n(d.target.value),x(1)},className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-100 placeholder-neutral-500 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{r("all"),x(1)},className:`px-3 py-2 rounded-lg text-xs font-medium border transition-colors ${s==="all"?"bg-blue-900/40 border-blue-800 text-blue-400":"bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700"}`,children:["Todos (",l.length,")"]}),e.jsx("button",{onClick:()=>{r("A"),x(1)},className:`px-3 py-2 rounded-lg text-xs font-medium border transition-colors ${s==="A"?"bg-green-900/40 border-green-800 text-green-400":"bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700"}`,children:"Clase A"}),e.jsx("button",{onClick:()=>{r("B"),x(1)},className:`px-3 py-2 rounded-lg text-xs font-medium border transition-colors ${s==="B"?"bg-yellow-900/40 border-yellow-800 text-yellow-400":"bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700"}`,children:"Clase B"}),e.jsx("button",{onClick:()=>{r("C"),x(1)},className:`px-3 py-2 rounded-lg text-xs font-medium border transition-colors ${s==="C"?"bg-orange-900/40 border-orange-800 text-orange-400":"bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700"}`,children:"Clase C"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b border-neutral-800",children:e.jsxs("tr",{className:"text-left text-neutral-400",children:[e.jsx("th",{className:"pb-3 font-medium",children:"Clase"}),e.jsx("th",{className:"pb-3 font-medium",children:"Producto"}),e.jsx("th",{className:"pb-3 font-medium",children:"CategorÃ­a"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"Valor Total"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"% del Total"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"Cantidad"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"Frecuencia"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"Ãšltima Mov."})]})}),e.jsx("tbody",{children:C.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"py-8 text-center text-neutral-500",children:"No se encontraron productos"})}):C.map(d=>e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-800/30",children:[e.jsx("td",{className:"py-3",children:e.jsx("span",{className:`inline-flex px-2.5 py-1 rounded-md text-xs font-semibold border ${k(d.classification)}`,children:d.classification})}),e.jsx("td",{className:"py-3 text-neutral-100 font-medium",children:d.productName}),e.jsx("td",{className:"py-3 text-neutral-400",children:d.category}),e.jsx("td",{className:"py-3 text-right text-neutral-100 font-medium",children:p(d.totalValue)}),e.jsxs("td",{className:"py-3 text-right text-neutral-400",children:[d.percentageOfTotalValue.toFixed(2),"%"]}),e.jsx("td",{className:"py-3 text-right text-neutral-400",children:d.totalQuantity.toLocaleString("es-CL")}),e.jsx("td",{className:"py-3 text-right text-neutral-400",children:d.salesFrequency}),e.jsx("td",{className:"py-3 text-right text-neutral-400 text-xs",children:u(d.lastMovementDate)})]},d.productId))})]})}),o>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-neutral-500",children:["Mostrando ",j+1,"-",Math.min(y,N.length)," de"," ",N.length," productos"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>x(d=>Math.max(1,d-1)),disabled:a===1,className:"px-3 py-1 bg-neutral-800 border border-neutral-700 rounded text-xs text-neutral-400 hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsxs("span",{className:"px-3 py-1 text-xs text-neutral-400",children:["PÃ¡gina ",a," de ",o]}),e.jsx("button",{onClick:()=>x(d=>Math.min(o,d+1)),disabled:a===o,className:"px-3 py-1 bg-neutral-800 border border-neutral-700 rounded text-xs text-neutral-400 hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"})]})]})]})}function Kt(){const{data:s,isLoading:r}=A({queryKey:["abcAnalysis"],queryFn:()=>ie(),refetchInterval:3e5});if(r)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-2/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((t,l)=>e.jsx("div",{className:"h-24 bg-neutral-800 rounded"},l))})]});const g=s?.filter(t=>t.classification==="A")||[],n=s?.filter(t=>t.classification==="B")||[],a=s?.filter(t=>t.classification==="C")||[],x=[{classification:"A",title:"Productos Clase A - Alta Prioridad",color:"green",bgColor:"bg-green-900/20",borderColor:"border-green-800",textColor:"text-green-400",count:g.length,strategies:[{icon:"ðŸ“Š",title:"Monitoreo Continuo",description:"Control diario de niveles de inventario y rotaciÃ³n"},{icon:"ðŸŽ¯",title:"Stock Ã“ptimo",description:"Mantener niveles Ã³ptimos para evitar quiebres"},{icon:"ðŸ”„",title:"ReposiciÃ³n Frecuente",description:"RevisiÃ³n y pedidos cada 1-3 dÃ­as segÃºn demanda"},{icon:"ðŸ“ˆ",title:"PrevisiÃ³n Exacta",description:"Usar modelos de forecasting para proyectar demanda"}]},{classification:"B",title:"Productos Clase B - Prioridad Media",color:"yellow",bgColor:"bg-yellow-900/20",borderColor:"border-yellow-800",textColor:"text-yellow-400",count:n.length,strategies:[{icon:"ðŸ“…",title:"Control Semanal",description:"RevisiÃ³n de inventario cada 5-7 dÃ­as"},{icon:"âš–ï¸",title:"Stock Balanceado",description:"Mantener inventario moderado sin excesos"},{icon:"ðŸ””",title:"Alertas AutomÃ¡ticas",description:"Configurar notificaciones de stock bajo"},{icon:"ðŸ“Š",title:"AnÃ¡lisis Trimestral",description:"Evaluar tendencias y ajustar polÃ­ticas"}]},{classification:"C",title:"Productos Clase C - Baja Prioridad",color:"orange",bgColor:"bg-orange-900/20",borderColor:"border-orange-800",textColor:"text-orange-400",count:a.length,strategies:[{icon:"ðŸ“†",title:"RevisiÃ³n Mensual",description:"Control bÃ¡sico mensual o bimestral"},{icon:"ðŸ“‰",title:"Minimizar Inventario",description:"Reducir stock al mÃ­nimo necesario"},{icon:"ðŸ”",title:"Evaluar DescontinuaciÃ³n",description:"Considerar eliminar productos de baja rotaciÃ³n"},{icon:"ðŸ’¡",title:"Pedidos por Demanda",description:"Comprar solo cuando hay orden confirmada"}]}];return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-100 mb-2",children:"Estrategias de GestiÃ³n por ClasificaciÃ³n"}),e.jsx("p",{className:"text-xs text-neutral-400",children:"Recomendaciones operativas basadas en el anÃ¡lisis ABC"})]}),e.jsx("div",{className:"space-y-4",children:x.map(t=>e.jsxs("div",{className:`${t.bgColor} border ${t.borderColor} rounded-lg p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:`text-sm font-semibold ${t.textColor}`,children:t.title}),e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-semibold ${t.bgColor} border ${t.borderColor} ${t.textColor}`,children:[t.count," productos"]})]}),e.jsx("div",{className:"space-y-2",children:t.strategies.map((l,m)=>e.jsxs("div",{className:"flex items-start gap-3 bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xl flex-shrink-0",children:l.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-neutral-200 mb-1",children:l.title}),e.jsx("div",{className:"text-xs text-neutral-400",children:l.description})]})]},m))})]},t.classification))}),e.jsx("div",{className:"mt-6 bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ’¡"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-400 mb-2",children:"Mejores PrÃ¡cticas"}),e.jsxs("ul",{className:"text-xs text-neutral-300 space-y-1",children:[e.jsx("li",{children:"â€¢ Concentrar esfuerzos en productos Clase A (80% del valor)"}),e.jsx("li",{children:"â€¢ Automatizar controles para productos Clase B"}),e.jsx("li",{children:"â€¢ Simplificar gestiÃ³n de productos Clase C"}),e.jsx("li",{children:"â€¢ Revisar clasificaciÃ³n ABC cada 3-6 meses"}),e.jsx("li",{children:"â€¢ Ajustar estrategias segÃºn estacionalidad"})]})]})]})})]})}function Vt(){const{data:s,isLoading:r,error:g}=A({queryKey:["forecastAnalysis"],queryFn:()=>oe(),refetchInterval:3e5});if(r)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-neutral-800 rounded"})]});if(g)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("p",{className:"text-red-400",children:["Error al cargar pronÃ³sticos: ",String(g)]})});if(!s||s.length===0)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-neutral-400",children:"No hay datos suficientes para generar pronÃ³sticos"})});const n=s.length,a=s.filter(o=>o.stockStatus==="understocked").length,x=s.filter(o=>o.stockStatus==="overstocked").length,t=s.filter(o=>o.stockStatus==="optimal").length,l=s.reduce((o,j)=>o+j.predictedDemand,0),m=s.reduce((o,j)=>o+j.currentStock,0),h=s.reduce((o,j)=>o+j.recommendedOrderQty,0),p=s.reduce((o,j)=>o+j.confidence,0)/n,u=s.slice(0,10).map(o=>({name:o.productName.length>20?o.productName.substring(0,20)+"...":o.productName,demandaPredicha:o.predictedDemand,stockActual:o.currentStock,status:o.stockStatus})),N=o=>{switch(o){case"understocked":return"#ef4444";case"overstocked":return"#f97316";case"optimal":return"#22c55e";default:return"#6b7280"}};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"ðŸ“ˆ PronÃ³stico de Demanda (PrÃ³ximos 30 dÃ­as)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Productos Analizados"}),e.jsx("div",{className:"text-2xl font-bold text-white mt-1",children:n})]}),e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-400",children:"Stock Bajo"}),e.jsx("div",{className:"text-2xl font-bold text-red-400 mt-1",children:a}),e.jsx("div",{className:"text-xs text-red-500 mt-1",children:"Requieren reposiciÃ³n"})]}),e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-400",children:"Stock Ã“ptimo"}),e.jsx("div",{className:"text-2xl font-bold text-green-400 mt-1",children:t}),e.jsx("div",{className:"text-xs text-green-500 mt-1",children:"Niveles adecuados"})]}),e.jsxs("div",{className:"bg-orange-900/20 border border-orange-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-orange-400",children:"Sobre-stock"}),e.jsx("div",{className:"text-2xl font-bold text-orange-400 mt-1",children:x}),e.jsx("div",{className:"text-xs text-orange-500 mt-1",children:"Exceso de inventario"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Demanda Predicha Total"}),e.jsxs("div",{className:"text-xl font-bold text-white mt-1",children:[l.toFixed(0)," unidades"]})]}),e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Stock Actual Total"}),e.jsxs("div",{className:"text-xl font-bold text-white mt-1",children:[m.toFixed(0)," unidades"]})]}),e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Orden Recomendada Total"}),e.jsxs("div",{className:"text-xl font-bold text-blue-400 mt-1",children:[h.toFixed(0)," unidades"]})]})]}),e.jsxs("div",{className:"bg-neutral-800/30 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"Top 10 Productos: Demanda Predicha vs Stock Actual"}),e.jsx(de,{width:"100%",height:400,children:e.jsxs(ue,{data:u,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(me,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(xe,{dataKey:"name",angle:-45,textAnchor:"end",height:100,stroke:"#a3a3a3",style:{fontSize:"12px"}}),e.jsx(he,{stroke:"#a3a3a3"}),e.jsx(ge,{contentStyle:{backgroundColor:"#262626",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#fff"}}),e.jsx(be,{wrapperStyle:{paddingTop:"20px"},iconType:"circle"}),e.jsx(ee,{dataKey:"demandaPredicha",name:"Demanda Predicha",fill:"#3b82f6"}),e.jsx(ee,{dataKey:"stockActual",name:"Stock Actual",children:u.map((o,j)=>e.jsx(Le,{fill:N(o.status)},`cell-${j}`))})]})})]}),e.jsx("div",{className:"bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-blue-400",children:"Confianza Promedio del Modelo"}),e.jsx("div",{className:"text-xs text-neutral-400 mt-1",children:"Basado en historial de 90 dÃ­as"})]}),e.jsxs("div",{className:"text-3xl font-bold text-blue-400",children:[p.toFixed(0),"%"]})]})})]})}function zt(){const[s,r]=b.useState("all"),[g,n]=b.useState("all"),[a,x]=b.useState(""),[t,l]=b.useState(1),m=10,{data:h,isLoading:p,error:u}=A({queryKey:["forecastAnalysis"],queryFn:()=>oe(),refetchInterval:300*1e3});if(p)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-96 bg-neutral-800 rounded"})]});if(u)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar pronÃ³sticos"})});if(!h||h.length===0)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-neutral-400",children:"No hay pronÃ³sticos disponibles"})});const N=h.filter(d=>{const S=s==="all"||d.stockStatus===s,v=g==="all"||d.trend===g,i=d.productName.toLowerCase().includes(a.toLowerCase())||d.category.toLowerCase().includes(a.toLowerCase());return S&&v&&i}),o=Math.ceil(N.length/m),j=(t-1)*m,y=N.slice(j,j+m),C=d=>{switch(d){case"understocked":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-red-900/40 border border-red-800 text-red-400",children:"Stock Bajo"});case"overstocked":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-orange-900/40 border border-orange-800 text-orange-400",children:"Sobre-stock"});case"optimal":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-900/40 border border-green-800 text-green-400",children:"Ã“ptimo"});default:return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-neutral-800 border border-neutral-700 text-neutral-400",children:d})}},k=d=>{switch(d){case"increasing":return e.jsx("span",{className:"text-green-400",children:"â†—ï¸ Creciente"});case"decreasing":return e.jsx("span",{className:"text-red-400",children:"â†˜ï¸ Decreciente"});case"stable":return e.jsx("span",{className:"text-blue-400",children:"â†’ Estable"});default:return e.jsx("span",{className:"text-neutral-400",children:d})}};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"ðŸŽ¯ Tabla de PronÃ³sticos"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r("all"),className:`px-3 py-1.5 text-sm rounded-lg border transition ${s==="all"?"bg-blue-600 border-blue-500 text-white":"bg-neutral-800 border-neutral-700 text-neutral-300 hover:bg-neutral-700"}`,children:"Todos"}),e.jsx("button",{onClick:()=>r("understocked"),className:`px-3 py-1.5 text-sm rounded-lg border transition ${s==="understocked"?"bg-red-600 border-red-500 text-white":"bg-neutral-800 border-neutral-700 text-neutral-300 hover:bg-neutral-700"}`,children:"Stock Bajo"}),e.jsx("button",{onClick:()=>r("optimal"),className:`px-3 py-1.5 text-sm rounded-lg border transition ${s==="optimal"?"bg-green-600 border-green-500 text-white":"bg-neutral-800 border-neutral-700 text-neutral-300 hover:bg-neutral-700"}`,children:"Ã“ptimo"}),e.jsx("button",{onClick:()=>r("overstocked"),className:`px-3 py-1.5 text-sm rounded-lg border transition ${s==="overstocked"?"bg-orange-600 border-orange-500 text-white":"bg-neutral-800 border-neutral-700 text-neutral-300 hover:bg-neutral-700"}`,children:"Sobre-stock"})]}),e.jsx("input",{type:"text",placeholder:"Buscar producto o categorÃ­a...",value:a,onChange:d=>{x(d.target.value),l(1)},className:"flex-1 px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white placeholder-neutral-500 focus:outline-none focus:border-blue-500"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-neutral-400",children:"Estado"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-neutral-400",children:"Producto"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-neutral-400",children:"CategorÃ­a"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"Stock Actual"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"Demanda (30d)"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"DÃ­as Stock"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-neutral-400",children:"Tendencia"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"Orden Recomendada"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"Confianza"})]})}),e.jsx("tbody",{children:y.map((d,S)=>e.jsxs("tr",{className:"border-b border-neutral-800 hover:bg-neutral-800/30 transition",children:[e.jsx("td",{className:"p-3",children:C(d.stockStatus)}),e.jsx("td",{className:"p-3 text-white font-medium",children:d.productName}),e.jsx("td",{className:"p-3 text-neutral-300",children:d.category}),e.jsx("td",{className:"p-3 text-right text-white",children:d.currentStock.toFixed(0)}),e.jsx("td",{className:"p-3 text-right text-blue-400 font-semibold",children:d.predictedDemand.toFixed(0)}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("span",{className:d.daysOfStock<15?"text-red-400 font-semibold":d.daysOfStock>60?"text-orange-400":"text-green-400",children:[d.daysOfStock," dÃ­as"]})}),e.jsx("td",{className:"p-3 text-center text-sm",children:k(d.trend)}),e.jsx("td",{className:"p-3 text-right",children:d.recommendedOrderQty>0?e.jsx("span",{className:"text-yellow-400 font-semibold",children:d.recommendedOrderQty.toFixed(0)}):e.jsx("span",{className:"text-neutral-500",children:"-"})}),e.jsxs("td",{className:"p-3 text-right text-neutral-400",children:[d.confidence.toFixed(0),"%"]})]},S))})]})}),o>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"text-sm text-neutral-400",children:["Mostrando ",j+1,"-",Math.min(j+m,N.length)," de"," ",N.length]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>l(d=>Math.max(1,d-1)),disabled:t===1,className:"px-3 py-1.5 text-sm bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsxs("span",{className:"px-3 py-1.5 text-sm text-neutral-300",children:["PÃ¡gina ",t," de ",o]}),e.jsx("button",{onClick:()=>l(d=>Math.min(o,d+1)),disabled:t===o,className:"px-3 py-1.5 text-sm bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"})]})]}),N.length===0&&e.jsx("div",{className:"text-center py-8 text-neutral-400",children:"No se encontraron pronÃ³sticos con los filtros aplicados"})]})}function _t(){const{data:s,isLoading:r}=A({queryKey:["forecastAnalysis"],queryFn:()=>oe(),refetchInterval:3e5});if(r)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-20 bg-neutral-800 rounded"}),e.jsx("div",{className:"h-20 bg-neutral-800 rounded"}),e.jsx("div",{className:"h-20 bg-neutral-800 rounded"})]})]});if(!s||s.length===0)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-neutral-400",children:"No hay recomendaciones disponibles"})});const g=s.filter(t=>t.stockStatus==="understocked").sort((t,l)=>t.daysOfStock-l.daysOfStock).slice(0,5),n=s.filter(t=>t.trend==="increasing").sort((t,l)=>l.predictedDemand-t.predictedDemand).slice(0,3),a=s.filter(t=>t.stockStatus==="overstocked").sort((t,l)=>l.daysOfStock-t.daysOfStock).slice(0,3),x=s.filter(t=>t.recommendedOrderQty>0).reduce((t,l)=>t+l.recommendedOrderQty,0);return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"ðŸ’¡ Recomendaciones EstratÃ©gicas"}),g.length>0&&e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸš¨"}),e.jsx("h4",{className:"text-lg font-semibold text-red-400",children:"AcciÃ³n Urgente Requerida"})]}),e.jsx("div",{className:"space-y-2",children:g.map((t,l)=>e.jsx("div",{className:"bg-neutral-900/50 rounded-lg p-3 border border-red-800/30",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:t.productName}),e.jsxs("div",{className:"text-sm text-red-400 mt-1",children:["Stock actual: ",t.currentStock.toFixed(0)," unidades (",t.daysOfStock," dÃ­as)"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Ordenar"}),e.jsxs("div",{className:"text-lg font-bold text-yellow-400",children:[t.recommendedOrderQty.toFixed(0)," unidades"]})]})]})},l))}),e.jsx("div",{className:"pt-2 border-t border-red-800/30",children:e.jsx("div",{className:"text-sm text-red-300",children:"âš ï¸ Estos productos necesitan reposiciÃ³n inmediata para evitar quiebres de stock"})})]}),n.length>0&&e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“ˆ"}),e.jsx("h4",{className:"text-lg font-semibold text-green-400",children:"Productos con Demanda Creciente"})]}),e.jsx("div",{className:"space-y-2",children:n.map((t,l)=>e.jsxs("div",{className:"flex justify-between items-center bg-neutral-900/50 rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:t.productName}),e.jsxs("div",{className:"text-sm text-green-400 mt-1",children:["Demanda predicha: ",t.predictedDemand.toFixed(0)," unidades (â†—ï¸ Aumentando)"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Promedio diario"}),e.jsx("div",{className:"text-white font-semibold",children:t.historicalAverage.toFixed(1)})]})]},l))}),e.jsx("div",{className:"pt-2 border-t border-green-800/30",children:e.jsx("div",{className:"text-sm text-green-300",children:"ðŸ’¡ Considere aumentar niveles de stock de seguridad para estos productos"})})]}),a.length>0&&e.jsxs("div",{className:"bg-orange-900/20 border border-orange-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"âš ï¸"}),e.jsx("h4",{className:"text-lg font-semibold text-orange-400",children:"OptimizaciÃ³n de Inventario"})]}),e.jsx("div",{className:"space-y-2",children:a.map((t,l)=>e.jsxs("div",{className:"flex justify-between items-center bg-neutral-900/50 rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:t.productName}),e.jsxs("div",{className:"text-sm text-orange-400 mt-1",children:["Stock excesivo: ",t.daysOfStock," dÃ­as de inventario"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Stock actual"}),e.jsx("div",{className:"text-white font-semibold",children:t.currentStock.toFixed(0)})]})]},l))}),e.jsx("div",{className:"pt-2 border-t border-orange-800/30",children:e.jsx("div",{className:"text-sm text-orange-300",children:"ðŸ’¡ EvalÃºe promociones o redistribuciÃ³n para optimizar capital de trabajo"})})]}),x>0&&e.jsx("div",{className:"bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ›’"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-blue-400",children:"Orden de Compra Sugerida"}),e.jsx("div",{className:"text-sm text-neutral-400 mt-1",children:"Total de unidades a ordenar"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-400",children:x.toFixed(0)}),e.jsx("div",{className:"text-sm text-neutral-400",children:"unidades"})]})]})}),e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4 space-y-2",children:[e.jsxs("h4",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“‹"}),"Mejores PrÃ¡cticas de GestiÃ³n Predictiva"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-neutral-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Revisar pronÃ³sticos semanalmente para ajustar niveles de stock"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Priorizar reposiciÃ³n de productos con menos de 15 dÃ­as de inventario"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Considerar estacionalidad y eventos especiales en planificaciÃ³n"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Validar precisiÃ³n del modelo comparando pronÃ³sticos con demanda real"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Optimizar frecuencia de pedidos para productos de alta rotaciÃ³n"})]})]})]})]})}const Ae=10;function Gt(s){const r=Number(s);return Number.isFinite(r)?`$${r.toLocaleString("es-CL",{maximumFractionDigits:0})}`:"$0"}function ts(){const s=te(),[r,g]=b.useState(!1),[n,a]=b.useState(null),[x,t]=b.useState(""),l=A({queryKey:["products",{view:"inventory"}],queryFn:()=>W({size:200,status:"all"})}),m=A({queryKey:["inventory","settings"],queryFn:Nt});b.useEffect(()=>{if(m.data){const d=Number(m.data.lowStockThreshold??0);if(Number.isFinite(d)&&d>0){n===null&&a(d),t(S=>S||String(d));return}}!m.isLoading&&n===null&&(a(Ae),t(String(Ae)))},[m.data,m.isLoading,n]);const h=A({queryKey:["inventory","summary"],queryFn:le}),p=A({queryKey:["inventory","alerts",n],enabled:n!==null,queryFn:()=>vt(n??void 0)}),u=R({mutationFn:d=>jt({lowStockThreshold:d}),onSuccess:d=>{const S=Number(d.lowStockThreshold??0);Number.isFinite(S)&&S>0&&(a(S),t(String(S))),s.invalidateQueries({queryKey:["inventory","summary"]}),s.invalidateQueries({queryKey:["inventory","alerts"]}),s.setQueryData(["inventory","settings"],d)}}),N=()=>{const d=Number(x);if(!Number.isFinite(d)||d<=0){window.alert("Ingresa un umbral mayor a cero");return}u.mutate(d)},o=()=>{s.invalidateQueries({queryKey:["inventory","summary"]}),s.invalidateQueries({queryKey:["inventory","alerts"]}),s.invalidateQueries({queryKey:["products"],exact:!1}),g(!1)},j=b.useMemo(()=>new Map((l.data?.content??[]).map(d=>[d.id,d])),[l.data]),y=h.data;Gt(y?.totalValue??0);const C=y?.activeProducts??0,k=y?.lowStockAlerts??p.data?.length??0;return y?.lowStockThreshold??n??Number(x||0),e.jsxs("div",{className:"page-section",children:[e.jsx(ft,{title:"Inventario",description:"Visibiliza catalogo, lotes y alertas de stock para garantizar disponibilidad.",actions:e.jsx("button",{className:"btn",onClick:()=>g(!0),children:"+ Ajuste de stock"})}),!h.isLoading&&e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[k>5&&e.jsxs("div",{className:"bg-red-950 border border-red-800 rounded-lg p-3 text-red-400 text-sm",children:["ðŸ”´ ",e.jsx("strong",{children:"CrÃ­tico:"})," ",k," productos con stock bajo - requiere atenciÃ³n inmediata"]}),C===0&&e.jsxs("div",{className:"bg-yellow-950 border border-yellow-800 rounded-lg p-3 text-yellow-400 text-sm",children:["âš ï¸ ",e.jsx("strong",{children:"Advertencia:"})," No hay productos activos en el inventario"]})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"ðŸ“Š KPIs de Inventario"}),e.jsx(Bt,{})]}),e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsx(Ut,{})}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"ðŸŽ¯ AnÃ¡lisis ABC de Inventario"}),e.jsx("div",{style:{marginBottom:"1.5rem"},children:e.jsx(Qt,{})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsx($t,{}),e.jsx(Kt,{})]})]}),e.jsxs("div",{style:{marginBottom:"2rem",marginTop:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.5rem",fontWeight:"600",marginBottom:"1rem"},children:"ðŸ“ˆ PronÃ³stico de Demanda e Inteligencia Predictiva"}),e.jsx("div",{style:{marginBottom:"1.25rem"},children:e.jsx(Vt,{})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsx(zt,{}),e.jsx(_t,{})]})]}),e.jsxs("section",{className:"responsive-grid",children:[e.jsx("div",{className:"card",children:e.jsx(Ft,{})}),e.jsx("div",{className:"card",children:e.jsx(Et,{})}),e.jsx("div",{className:"card",children:e.jsx(Lt,{})})]}),e.jsxs("div",{style:{marginBottom:"2rem",marginTop:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"ðŸ“Š AnÃ¡lisis de Inventario"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsx(Mt,{}),e.jsx(Rt,{})]})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"âš™ï¸ GestiÃ³n Operativa"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsx(Tt,{}),e.jsx(Ot,{})]})]}),e.jsx("section",{className:"responsive-grid",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 table-card",children:[e.jsx("h3",{className:"text-neutral-100",children:"Lotes con stock crÃ­tico"}),e.jsxs("div",{className:"inline-actions",style:{marginBottom:"0.75rem"},children:[e.jsx("label",{className:"muted small text-neutral-400",htmlFor:"low-stock-threshold",children:"Umbral"}),e.jsx("input",{id:"low-stock-threshold",className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"number",step:"0.1",min:"0.1",value:x,onChange:d=>t(d.target.value),disabled:u.isPending}),e.jsx("button",{className:"btn",type:"button",onClick:N,disabled:u.isPending,children:u.isPending?"Guardando...":"Guardar"})]}),u.isError&&e.jsx("p",{className:"error",children:u.error?.message??"No se pudo actualizar el umbral"}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Lote"}),e.jsx("th",{children:"Disponible"}),e.jsx("th",{children:"Expira"}),e.jsx("th",{children:"Creado"}),e.jsx("th",{children:"AcciÃ³n"})]})}),e.jsxs("tbody",{children:[p.isLoading&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"muted text-neutral-400",children:"Cargando alertas..."})}),p.isError&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"error text-red-400",children:p.error?.message??"No se pudieron obtener alertas"})}),!p.isLoading&&!p.isError&&(p.data??[]).map(d=>{const S=j.get(d.productId),v=Number(d.qtyAvailable),i=n??10,w=v<5||v<i*.1,P=v>=5&&v<=i,Q=d.expDate?new Date(d.expDate):null,B=new Date,E=Q?Math.floor((Q.getTime()-B.getTime())/(1e3*60*60*24)):null,U=E!==null&&E<=30&&E>=0,$=E!==null&&E<0,K=w?{icon:"ðŸ”´",label:"CrÃ­tico",className:"bg-red-950 text-red-400 border-red-800"}:P?{icon:"ðŸŸ¡",label:"Bajo",className:"bg-yellow-950 text-yellow-400 border-yellow-800"}:{icon:"ðŸŸ¢",label:"Normal",className:"bg-green-950 text-green-400 border-green-800"};return e.jsxs("tr",{className:$?"bg-red-950/20":U?"bg-yellow-950/20":"",children:[e.jsx("td",{children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-medium border ${K.className}`,children:[e.jsx("span",{children:K.icon}),e.jsx("span",{children:K.label})]})}),e.jsx("td",{className:"text-neutral-100",children:S?.name??d.productId}),e.jsx("td",{className:"mono text-neutral-300",children:d.lotId}),e.jsx("td",{className:`mono font-semibold ${w?"text-red-400":P?"text-yellow-400":"text-neutral-100"}`,children:v.toFixed(2)}),e.jsxs("td",{className:`mono ${$?"text-red-400 font-semibold":U?"text-yellow-400 font-semibold":"text-neutral-300"}`,children:[Q?Q.toLocaleDateString():"-",$&&e.jsx("span",{className:"ml-2",children:"âŒ Vencido"}),U&&!$&&e.jsxs("span",{className:"ml-2",children:["âš ï¸ ",E,"d"]})]}),e.jsx("td",{className:"mono small text-neutral-400",children:new Date(d.createdAt).toLocaleDateString()}),e.jsx("td",{children:e.jsx("button",{className:"btn ghost text-xs",type:"button",onClick:()=>{g(!0)},title:"Reabastecimiento rÃ¡pido",children:"+ Stock"})})]},d.lotId)}),!p.isLoading&&!p.isError&&(p.data??[]).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"muted text-neutral-400 text-center py-8",children:"âœ… Sin alertas de stock crÃ­tico"})})]})]})})]})}),e.jsx(qt,{}),e.jsx(It,{open:r,onClose:()=>g(!1),onApplied:o})]})}export{ts as default};
