import{c as U,j as e,D as Ee,E as Le,h as Re,F as qe,G as ge,k as ze,H as Be,I as Ve,J as fe,K as ye,L as k,M as Ke,u as Ge,N as Qe,O as We,w as Ue,P as He,p as _e}from"./index-CTZ9O8lC.js";import{r as j}from"./react-D8kvZI4c.js";import{u as S}from"./useQuery-C9GbdDDb.js";import{P as Ye}from"./PageHeader-CwWqOxH0.js";import{M as Xe}from"./Modal-BpLUd7V9.js";import{R as te,B as Ce,C as de,X as ce,Y as ee,T as se,a as me,g as ie,f as Se,L as Je,b as he,h as Ze,P as et,e as tt}from"./charts-BH7DIlZU.js";import{c as G}from"./currency-HwQAg_Xa.js";import{u as st,f as Ie,a as rt,g as at}from"./table-DbsuG4jc.js";import{u as nt}from"./useDebouncedValue-DnjRONvw.js";const lt=["Factura","Boleta","CotizaciÃ³n","Orden de Compra","GuÃ­a de Despacho"];function ot({open:r,onClose:c,onCreated:h}){const[g,x]=j.useState(""),[a,m]=j.useState(!1),[t,i]=j.useState(""),[s,o]=j.useState(""),[l,n]=j.useState("Factura"),[b,u]=j.useState(""),[f,N]=j.useState(()=>new Date().toISOString().slice(0,16)),[v,A]=j.useState(()=>new Date().toISOString().slice(0,16)),[w,M]=j.useState([]),[T,E]=j.useState("product"),[L,z]=j.useState(""),[O,R]=j.useState(""),[q,C]=j.useState(1),[F,I]=j.useState(0),[H,re]=j.useState(19),[ue,V]=j.useState(""),[Q,ae]=j.useState(""),[_,W]=j.useState(!0),[K,xe]=j.useState("amount"),[Y,ne]=j.useState(0),[p,y]=j.useState(null),P=S({queryKey:["products",{dialog:"purchases"}],queryFn:()=>Re({size:200}),enabled:r}),$=S({queryKey:["services",{dialog:"purchases"}],queryFn:()=>qe(!0),enabled:r}),we=S({queryKey:["suppliers",{dialog:"purchases"}],queryFn:()=>ge(),enabled:r}),Ae=S({queryKey:["locations",{dialog:"purchases"}],queryFn:()=>ze(),enabled:r}),be=U({mutationFn:d=>Ee(d),onSuccess:d=>{x(d.id),m(!1),i(""),o(""),we.refetch()}});j.useEffect(()=>{if(r){const d=new Date().toISOString().slice(0,16);N(d),A(d)}},[r]);const le=U({mutationFn:d=>Le(d.payload,d.file),onSuccess:()=>{h(),Pe(),c()}}),Te=P.data?.content??[],Fe=we.data??[],B=j.useMemo(()=>{const d=w.reduce((ve,pe)=>ve+pe.qty*pe.unitCost,0);let D=0;K==="percentage"?D=d*(Y/100):D=Y;const X=d-D,J=_?X*.19:0,je=X+J;return{subtotal:d,discountAmount:D,net:X,vat:J,total:je}},[w,_,K,Y]),ke=()=>{if(T==="product"&&!L||T==="service"&&!O||q<=0||F<=0)return;const d={qty:q,unitCost:F,vatRate:H};T==="product"?(d.productId=L,d.expDate=ue||void 0,d.locationId=Q||void 0):d.serviceId=O,M(D=>[...D,d]),z(""),R(""),C(1),I(0),V(""),ae("")},Me=d=>{M(D=>D.filter((X,J)=>J!==d))},Pe=()=>{x(""),m(!1),i(""),o(""),n("Factura"),u(""),M([]),E("product"),z(""),R(""),C(1),I(0),V(""),ae(""),W(!0),xe("amount"),ne(0),y(null)},Oe=()=>{!t.trim()||!s.trim()||be.mutate({name:t,rut:s})},$e=d=>{if(d.preventDefault(),!g||w.length===0)return;const D={supplierId:g,docType:l,docNumber:b,issuedAt:new Date(f).toISOString(),receivedAt:v?new Date(v).toISOString():void 0,net:Number(B.net.toFixed(2)),vat:Number(B.vat.toFixed(2)),total:Number(B.total.toFixed(2)),items:w};le.mutate({payload:D,file:p||void 0})};return e.jsx(Xe,{open:r,onClose:c,title:"Registrar Compra",children:e.jsxs("form",{className:"form-grid",onSubmit:$e,children:[e.jsx("div",{style:{gridColumn:"1 / -1"},children:e.jsx("h3",{style:{marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"600"},children:"InformaciÃ³n del Proveedor"})}),a?e.jsxs(e.Fragment,{children:[e.jsxs("label",{style:{gridColumn:"1 / -1"},children:[e.jsx("span",{children:"Nombre Proveedor *"}),e.jsx("input",{className:"input",value:t,onChange:d=>i(d.target.value),placeholder:"Nombre del proveedor"})]}),e.jsxs("label",{style:{gridColumn:"1 / -1"},children:[e.jsx("span",{children:"RUT *"}),e.jsx("input",{className:"input",value:s,onChange:d=>o(d.target.value),placeholder:"12.345.678-9"})]}),e.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",className:"btn",onClick:Oe,disabled:be.isPending,children:be.isPending?"Creando...":"Crear Proveedor"}),e.jsx("button",{type:"button",className:"btn ghost",onClick:()=>{m(!1),i(""),o("")},children:"Cancelar"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("label",{style:{gridColumn:"1 / -1"},children:[e.jsx("span",{children:"Proveedor *"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("select",{className:"input",value:g,onChange:d=>x(d.target.value),required:!0,style:{flex:1},children:[e.jsx("option",{value:"",children:"Selecciona proveedor"}),Fe.map(d=>e.jsxs("option",{value:d.id,children:[d.name," ",d.rut?`(${d.rut})`:""]},d.id))]}),e.jsx("button",{type:"button",className:"btn",onClick:()=>m(!0),style:{whiteSpace:"nowrap"},children:"+ Nuevo"})]})]})}),e.jsx("div",{className:"line",style:{gridColumn:"1 / -1"}}),e.jsx("div",{style:{gridColumn:"1 / -1"},children:e.jsx("h3",{style:{marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"600"},children:"InformaciÃ³n del Documento"})}),e.jsxs("label",{children:[e.jsx("span",{children:"Tipo de Documento *"}),e.jsx("select",{className:"input",value:l,onChange:d=>n(d.target.value),required:!0,children:lt.map(d=>e.jsx("option",{value:d,children:d},d))})]}),e.jsxs("label",{children:[e.jsx("span",{children:"NÃºmero de Documento"}),e.jsx("input",{className:"input",value:b,onChange:d=>u(d.target.value.slice(0,35)),maxLength:35,placeholder:"Ej: OC-2025-001 o 12345"})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Fecha de EmisiÃ³n *"}),e.jsx("input",{className:"input",type:"datetime-local",value:f,onChange:d=>N(d.target.value),required:!0})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Fecha de RecepciÃ³n"}),e.jsx("input",{className:"input",type:"datetime-local",value:v,onChange:d=>A(d.target.value)})]}),e.jsxs("label",{style:{gridColumn:"1 / -1"},children:[e.jsx("span",{children:"ğŸ“ Adjuntar Documento PDF (opcional)"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.25rem"},children:[e.jsx("input",{type:"file",accept:".pdf,application/pdf",onChange:d=>{const D=d.target.files?.[0];if(D){if(D.size>10*1024*1024){alert("El archivo es demasiado grande. MÃ¡ximo 10MB."),d.target.value="";return}y(D)}},style:{flex:1}}),p&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",backgroundColor:"#e3f2fd",borderRadius:"4px",fontSize:"0.85rem"},children:[e.jsxs("span",{children:["ğŸ“„ ",p.name]}),e.jsx("button",{type:"button",className:"btn ghost",onClick:()=>y(null),style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem"},children:"âœ•"})]})]}),e.jsx("small",{className:"muted",style:{display:"block",marginTop:"0.25rem"},children:"Formatos aceptados: PDF. TamaÃ±o mÃ¡ximo: 10MB"})]}),e.jsx("div",{className:"line",style:{gridColumn:"1 / -1"}}),e.jsx("div",{style:{gridColumn:"1 / -1"},children:e.jsx("h3",{style:{marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"600"},children:"Items de Compra"})}),e.jsxs("div",{className:"item-builder",style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"0.5rem"},children:[e.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",gap:"1rem",marginBottom:"0.5rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:"itemType",value:"product",checked:T==="product",onChange:d=>E(d.target.value)}),e.jsx("span",{children:"Producto"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:"itemType",value:"service",checked:T==="service",onChange:d=>E(d.target.value)}),e.jsx("span",{children:"Servicio"})]})]}),T==="product"?e.jsxs("select",{className:"input",value:L,onChange:d=>z(d.target.value),style:{gridColumn:"1 / -1"},children:[e.jsx("option",{value:"",children:"Seleccionar producto"}),Te.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]}):e.jsxs("select",{className:"input",value:O,onChange:d=>R(d.target.value),style:{gridColumn:"1 / -1"},children:[e.jsx("option",{value:"",children:"Seleccionar servicio"}),$.data?.map(d=>e.jsxs("option",{value:d.id,children:[d.code," - ",d.name]},d.id))]}),e.jsx("input",{className:"input",type:"number",min:1,value:q,onChange:d=>C(Number(d.target.value)),placeholder:"Cantidad"}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:0,value:F,onChange:d=>I(Number(d.target.value)),placeholder:"Costo unitario"}),T==="product"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"0.25rem",display:"block"},children:"Vencimiento"}),e.jsx("input",{className:"input",type:"date",value:ue,onChange:d=>V(d.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"0.25rem",display:"block"},children:"UbicaciÃ³n"}),e.jsxs("select",{className:"input",value:Q,onChange:d=>ae(d.target.value),children:[e.jsx("option",{value:"",children:"Sin ubicaciÃ³n"}),Ae.data?.map(d=>e.jsxs("option",{value:d.id,children:[d.code," - ",d.name," (",d.type,")"]},d.id))]})]})]}),e.jsxs("button",{type:"button",className:"btn",onClick:ke,style:{gridColumn:"1 / -1"},children:["+ Agregar ",T==="product"?"Producto":"Servicio"]})]}),w.length>0&&e.jsx("div",{style:{gridColumn:"1 / -1",overflowX:"auto"},children:e.jsxs("table",{className:"table",style:{minWidth:"600px"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Item"}),e.jsx("th",{style:{textAlign:"right"},children:"Cantidad"}),e.jsx("th",{style:{textAlign:"right"},children:"Costo Unit."}),e.jsx("th",{style:{textAlign:"right"},children:"Subtotal"}),e.jsx("th",{children:"Info"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:w.map((d,D)=>{const X=d.productId?Te.find(oe=>oe.id===d.productId):null,J=d.serviceId?$.data?.find(oe=>oe.id===d.serviceId):null,je=d.qty*d.unitCost,ve=X?.name??J?.name??(d.productId||d.serviceId),pe=d.productId?"Producto":"Servicio";return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"badge",style:{backgroundColor:d.productId?"#e3f2fd":"#fff3e0",color:d.productId?"#1976d2":"#f57c00"},children:pe})}),e.jsx("td",{children:ve}),e.jsx("td",{className:"mono",style:{textAlign:"right"},children:d.qty}),e.jsxs("td",{className:"mono",style:{textAlign:"right"},children:["$",d.unitCost.toFixed(2)]}),e.jsxs("td",{className:"mono",style:{textAlign:"right",fontWeight:"600"},children:["$",je.toFixed(2)]}),e.jsxs("td",{className:"mono",style:{fontSize:"0.85rem",color:"#666"},children:[d.productId&&d.expDate&&`Venc: ${new Date(d.expDate).toLocaleDateString("es-CL")}`,d.productId&&d.locationId&&Ae.data?.find(oe=>oe.id===d.locationId)?.code,d.serviceId&&"-"]}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn ghost",onClick:()=>Me(D),style:{padding:"0.25rem 0.5rem"},children:"Quitar"})})]},`item-${D}`)})})]})}),e.jsx("div",{className:"line",style:{gridColumn:"1 / -1"}}),e.jsx("div",{style:{gridColumn:"1 / -1"},children:e.jsx("h3",{style:{marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"600"},children:"Descuentos e Impuestos"})}),e.jsxs("label",{style:{gridColumn:"span 1"},children:[e.jsx("span",{children:"Tipo de Descuento"}),e.jsxs("select",{className:"input",value:K,onChange:d=>xe(d.target.value),children:[e.jsx("option",{value:"amount",children:"Monto Fijo ($)"}),e.jsx("option",{value:"percentage",children:"Porcentaje (%)"})]})]}),e.jsxs("label",{style:{gridColumn:"span 1"},children:[e.jsxs("span",{children:["Descuento ",K==="percentage"?"(%)":"($)"]}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:0,max:K==="percentage"?100:void 0,value:Y,onChange:d=>ne(Number(d.target.value)),placeholder:K==="percentage"?"0-100":"0.00"})]}),e.jsxs("label",{style:{gridColumn:"1 / -1",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:_,onChange:d=>W(d.target.checked),style:{width:"auto"}}),e.jsx("span",{style:{fontWeight:"600"},children:"Aplicar IVA 19%"})]}),e.jsx("div",{style:{gridColumn:"1 / -1",backgroundColor:"#f8f9fa",padding:"1rem",borderRadius:"8px",marginTop:"0.5rem"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"muted small",children:"Subtotal"}),e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:"600"},children:["$",B.subtotal.toFixed(2)]})]}),B.discountAmount>0&&e.jsxs("div",{children:[e.jsx("span",{className:"muted small",children:"Descuento"}),e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:"600",color:"#dc3545"},children:["-$",B.discountAmount.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"muted small",children:"Neto"}),e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:"600"},children:["$",B.net.toFixed(2)]})]}),_&&e.jsxs("div",{children:[e.jsx("span",{className:"muted small",children:"IVA (19%)"}),e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:"600"},children:["$",B.vat.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"muted small",children:"Total"}),e.jsxs("div",{style:{fontSize:"1.3rem",fontWeight:"700",color:"#0066cc"},children:["$",B.total.toFixed(2)]})]})]})}),le.isError&&e.jsx("p",{className:"error",style:{gridColumn:"1 / -1"},children:le.error.message}),e.jsxs("div",{className:"buttons",style:{gridColumn:"1 / -1"},children:[e.jsx("button",{className:"btn",type:"submit",disabled:le.isPending||w.length===0,children:le.isPending?"Guardando...":"Registrar Compra"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:Pe,children:"Limpiar Formulario"})]})]})})}function it({open:r,onClose:c,onImported:h}){const[g,x]=j.useState(null),[a,m]=j.useState(null),t=U({mutationFn:l=>Be(l),onSuccess:l=>{m(l),l.success&&h()},onError:l=>{window.alert(`Error al importar: ${l}`)}}),i=l=>{const n=l.target.files?.[0];if(n){if(!n.name.endsWith(".csv")){window.alert("Solo se permiten archivos CSV");return}x(n),m(null)}},s=()=>{if(!g){window.alert("Seleccione un archivo CSV");return}t.mutate(g)},o=()=>{x(null),m(null),c()};return r?e.jsx("div",{className:"modal-backdrop",onClick:o,children:e.jsxs("div",{className:"modal-card",onClick:l=>l.stopPropagation(),children:[e.jsx("h2",{children:"Importar compras desde CSV"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Archivo CSV"}),e.jsx("input",{type:"file",accept:".csv",onChange:i,disabled:t.isPending}),g&&e.jsxs("p",{className:"muted",style:{marginTop:"0.5rem"},children:["Archivo seleccionado: ",g.name," (",(g.size/1024).toFixed(2)," KB)"]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("p",{className:"muted",children:[e.jsx("strong",{children:"Formato esperado del CSV:"}),e.jsx("br",{}),"Tipo Documento, NÃºmero, Proveedor ID, Estado, Neto, IVA, Total, Fecha EmisiÃ³n",e.jsx("br",{}),e.jsxs("em",{children:["Ejemplo: Factura, 12345, ","{UUID}",", Recibida, 10000, 1900, 11900, 2024-01-15 10:30:00"]})]})}),a&&e.jsxs("div",{className:`alert ${a.success?"success":"error"}`,style:{marginTop:"1rem"},children:[e.jsx("p",{children:e.jsx("strong",{children:a.success?"âœ“ ImportaciÃ³n exitosa":"âš  ImportaciÃ³n con errores"})}),e.jsxs("p",{children:["Importadas: ",a.imported," de ",a.total," filas"]}),a.errors&&a.errors.length>0&&e.jsxs("div",{style:{marginTop:"0.5rem"},children:[e.jsx("strong",{children:"Errores:"}),e.jsx("ul",{style:{marginTop:"0.5rem",maxHeight:"200px",overflow:"auto"},children:a.errors.map((l,n)=>e.jsx("li",{children:l},n))})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn",type:"button",onClick:s,disabled:!g||t.isPending,children:t.isPending?"Importando...":"Importar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:o,disabled:t.isPending,children:a?"Cerrar":"Cancelar"})]})]})}):null}function dt(){const{data:r,isLoading:c,error:h}=S({queryKey:["purchaseKPIs"],queryFn:()=>Ve(),refetchInterval:3e5});if(c)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 animate-pulse",children:[1,2,3,4,5,6,7,8].map(t=>e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 h-32"},t))});if(h)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar KPIs de compras"})});if(!r)return null;const g=t=>`$${t.toLocaleString("es-CL",{maximumFractionDigits:0})}`,x=t=>`${t.toFixed(1)}%`,a=t=>t>0?"text-red-400":t<0?"text-green-400":"text-neutral-400",m=t=>t>0?"â†—ï¸":t<0?"â†˜ï¸":"â†’";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"ğŸ“¦ KPIs Avanzados de Compras"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-900/30 to-purple-800/20 border border-purple-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-purple-400 mb-1",children:"Gasto Total"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:g(r.totalSpent)}),e.jsxs("div",{className:"text-xs text-purple-300 mt-2",children:[r.totalOrders," Ã³rdenes recibidas"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-900/30 to-blue-800/20 border border-blue-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-blue-400 mb-1",children:"Promedio por Orden"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:g(r.averageOrderValue)}),e.jsxs("div",{className:"text-xs text-blue-300 mt-2",children:[r.totalQuantity.toLocaleString("es-CL")," unidades"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-900/30 to-orange-800/20 border border-orange-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-orange-400 mb-1",children:"VariaciÃ³n de Gasto"}),e.jsxs("div",{className:`text-3xl font-bold ${a(r.purchaseGrowth)}`,children:[m(r.purchaseGrowth)," ",x(Math.abs(r.purchaseGrowth))]}),e.jsx("div",{className:"text-xs text-orange-300 mt-2",children:"vs perÃ­odo anterior"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-900/30 to-green-800/20 border border-green-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-green-400 mb-1",children:"Costo Unitario"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:g(r.costPerUnit)}),e.jsx("div",{className:"text-xs text-green-300 mt-2",children:"Promedio por unidad"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Proveedores Activos"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:r.uniqueSuppliers}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Ã“rdenes recibidas"})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"ConcentraciÃ³n"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:x(r.supplierConcentration)}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Top proveedor"})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Top Proveedor"}),e.jsx("div",{className:"text-lg font-semibold text-white truncate",title:r.topSupplierName,children:r.topSupplierName}),e.jsx("div",{className:"text-sm text-purple-400 mt-1",children:g(r.topSupplierSpent)})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Ã“rdenes Pendientes"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:r.pendingOrders}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:["Entrega a tiempo: ",x(r.onTimeDeliveryRate)]})]})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"AnÃ¡lisis de Gastos"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-400",children:"Gasto Total"}),e.jsx("span",{className:"text-white font-semibold",children:g(r.totalSpent)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-purple-500 h-3 rounded-full",style:{width:"100%"}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-neutral-400",children:["Gasto Top Proveedor (",r.topSupplierName,")"]}),e.jsx("span",{className:"text-purple-400 font-semibold",children:g(r.topSupplierSpent)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-purple-400 h-3 rounded-full",style:{width:`${r.supplierConcentration}%`}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-400",children:"Otros Proveedores"}),e.jsx("span",{className:"text-blue-400 font-semibold",children:g(r.totalSpent-r.topSupplierSpent)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-500 h-3 rounded-full",style:{width:`${100-r.supplierConcentration}%`}})}),r.supplierConcentration>50&&e.jsx("div",{className:"bg-yellow-900/20 border border-yellow-800 rounded-lg p-3 mt-4",children:e.jsxs("p",{className:"text-sm text-yellow-400",children:["âš ï¸ Alta concentraciÃ³n en un proveedor (",x(r.supplierConcentration),"). Considere diversificar para reducir riesgo de dependencia."]})})]})]}),e.jsx("div",{className:"bg-purple-900/20 border border-purple-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-purple-400",children:["ğŸ“… PerÃ­odo de anÃ¡lisis: ",new Date(r.periodStart).toLocaleDateString("es-CL")," -"," ",new Date(r.periodEnd).toLocaleDateString("es-CL")]}),e.jsx("span",{className:"text-xs text-purple-300",children:"Actualizado automÃ¡ticamente cada 5 minutos"})]})})]})}function ct(){const{data:r,isLoading:c}=S({queryKey:["purchaseABCAnalysis"],queryFn:()=>fe(),refetchInterval:3e5});if(c)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 h-96 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-full bg-neutral-800 rounded"})]});if(!r||r.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"ğŸ“Š DistribuciÃ³n ABC de Proveedores"}),e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"No hay datos suficientes para anÃ¡lisis ABC"})]});const h=r.reduce((m,t)=>{const i=t.classification;return m[i].count++,m[i].totalSpent+=t.totalSpent,m[i].percentage+=t.percentageOfTotal,m},{A:{count:0,totalSpent:0,percentage:0},B:{count:0,totalSpent:0,percentage:0},C:{count:0,totalSpent:0,percentage:0}}),g=[{name:"Clase A (CrÃ­ticos)",proveedores:h.A.count,gasto:h.A.totalSpent,porcentaje:h.A.percentage},{name:"Clase B (Importantes)",proveedores:h.B.count,gasto:h.B.totalSpent,porcentaje:h.B.percentage},{name:"Clase C (Ocasionales)",proveedores:h.C.count,gasto:h.C.totalSpent,porcentaje:h.C.percentage}],x={A:"#ef4444",B:"#f59e0b",C:"#10b981"},a=m=>`$${m.toLocaleString("es-CL",{maximumFractionDigits:0})}`;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"ğŸ“Š DistribuciÃ³n ABC de Proveedores (Pareto 80-15-5)"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-red-900/30 to-red-800/20 border border-red-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-400 mb-1",children:"Clase A - CrÃ­ticos"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[h.A.count," proveedores"]}),e.jsxs("div",{className:"text-xs text-red-300 mt-2",children:[h.A.percentage.toFixed(1),"% del gasto total"]}),e.jsx("div",{className:"text-sm text-red-200 mt-1",children:a(h.A.totalSpent)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-900/30 to-amber-800/20 border border-amber-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-amber-400 mb-1",children:"Clase B - Importantes"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[h.B.count," proveedores"]}),e.jsxs("div",{className:"text-xs text-amber-300 mt-2",children:[h.B.percentage.toFixed(1),"% del gasto total"]}),e.jsx("div",{className:"text-sm text-amber-200 mt-1",children:a(h.B.totalSpent)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-900/30 to-green-800/20 border border-green-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-400 mb-1",children:"Clase C - Ocasionales"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[h.C.count," proveedores"]}),e.jsxs("div",{className:"text-xs text-green-300 mt-2",children:[h.C.percentage.toFixed(1),"% del gasto total"]}),e.jsx("div",{className:"text-sm text-green-200 mt-1",children:a(h.C.totalSpent)})]})]}),e.jsx(te,{width:"100%",height:300,children:e.jsxs(Ce,{data:g,children:[e.jsx(de,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(ce,{dataKey:"name",stroke:"#a3a3a3",tick:{fill:"#a3a3a3"}}),e.jsx(ee,{stroke:"#a3a3a3",tick:{fill:"#a3a3a3"},tickFormatter:m=>a(m)}),e.jsx(se,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#fff"},formatter:(m,t)=>t==="gasto"?a(m):t==="porcentaje"?`${m.toFixed(1)}%`:m}),e.jsx(me,{wrapperStyle:{color:"#a3a3a3"}}),e.jsx(ie,{dataKey:"gasto",fill:"#8884d8",name:"Gasto Total",children:g.map((m,t)=>{const i=m.name.includes("A")?"A":m.name.includes("B")?"B":"C";return e.jsx(Se,{fill:x[i]},`cell-${t}`)})})]})}),e.jsx("div",{className:"mt-4 bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-300",children:["ğŸ’¡ ",e.jsx("strong",{children:"AnÃ¡lisis Pareto (80-15-5):"})," Clase A representa ~80% del gasto (pocos proveedores clave), Clase B ~15% (proveedores moderados), y Clase C ~5% (muchos proveedores ocasionales)."]})})]})}function mt(){const{data:r,isLoading:c}=S({queryKey:["purchaseABCAnalysis"],queryFn:()=>fe(),refetchInterval:3e5});if(c)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(x=>e.jsx("div",{className:"h-16 bg-neutral-800 rounded"},x))})]});if(!r||r.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"ğŸ“‹ Detalle de Proveedores por ClasificaciÃ³n"}),e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"No hay proveedores para clasificar"})]});const h=x=>`$${x.toLocaleString("es-CL",{maximumFractionDigits:0})}`,g=x=>{const a={A:"bg-red-900/30 text-red-400 border-red-800",B:"bg-amber-900/30 text-amber-400 border-amber-800",C:"bg-green-900/30 text-green-400 border-green-800"};return a[x]||a.C};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"ğŸ“‹ Detalle de Proveedores por ClasificaciÃ³n ABC"}),e.jsxs("span",{className:"text-sm text-neutral-400",children:[r.length," proveedores"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-neutral-400",children:"Clase"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-neutral-400",children:"Proveedor"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Gasto Total"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-neutral-400",children:"Compras"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"% del Total"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Acumulado"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-neutral-400",children:"AcciÃ³n Recomendada"})]})}),e.jsx("tbody",{children:r.map((x,a)=>e.jsxs("tr",{className:`border-b border-neutral-800 hover:bg-neutral-800/50 transition-colors ${a<10?"":"opacity-60"}`,children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 rounded text-xs font-bold border ${g(x.classification)}`,children:x.classification})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"text-white font-medium",children:x.supplierName}),e.jsxs("div",{className:"text-xs text-neutral-500",children:["Promedio: ",h(x.averageOrderValue)]})]}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:"text-white font-semibold",children:h(x.totalSpent)})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:"text-neutral-300",children:x.purchaseCount})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-blue-400 font-medium",children:[x.percentageOfTotal.toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-neutral-400",children:[x.cumulativePercentage.toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"text-xs text-neutral-400",children:x.recommendedAction})})]},x.supplierId))})]})}),r.length>10&&e.jsxs("div",{className:"mt-4 text-center text-sm text-neutral-500",children:["Mostrando todos los ",r.length," proveedores (primeros 10 resaltados)"]})]})}function ut(){const{data:r}=S({queryKey:["purchaseABCAnalysis"],queryFn:()=>fe(),refetchInterval:3e5});if(!r||r.length===0)return null;const c=r.filter(t=>t.classification==="A"),h=r.filter(t=>t.classification==="B"),g=r.filter(t=>t.classification==="C"),x=r.reduce((t,i)=>t+i.totalSpent,0),a=c.reduce((t,i)=>t+i.totalSpent,0),m=x>0?a/x*100:0;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"ğŸ’¡ Insights y Estrategias por ClasificaciÃ³n"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-red-900/20 to-red-800/10 border border-red-800 rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"ğŸ”´"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-400 font-semibold",children:"Clase A - Proveedores CrÃ­ticos"}),e.jsxs("p",{className:"text-xs text-red-300",children:[c.length," proveedores Â· ",m.toFixed(1),"% del gasto"]})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-200 font-medium mb-2",children:"ğŸ¯ Estrategia:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"â€¢ Negociar contratos a largo plazo"}),e.jsx("li",{children:"â€¢ Reuniones trimestrales de revisiÃ³n"}),e.jsx("li",{children:"â€¢ Planes de contingencia definidos"}),e.jsx("li",{children:"â€¢ Monitoreo continuo de desempeÃ±o"})]})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-200 font-medium mb-2",children:"âš ï¸ Riesgos:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"â€¢ Alta dependencia de pocos proveedores"}),e.jsx("li",{children:"â€¢ Impacto severo si hay problemas"}),e.jsx("li",{children:"â€¢ Poder de negociaciÃ³n limitado"})]})]}),e.jsx("div",{className:"bg-amber-900/20 border border-amber-700 rounded p-2",children:e.jsxs("p",{className:"text-amber-200 text-xs",children:["âš¡ ",e.jsx("strong",{children:"AcciÃ³n urgente:"})," Desarrollar proveedores alternativos para reducir riesgo"]})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-900/20 to-amber-800/10 border border-amber-800 rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"ğŸŸ¡"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-amber-400 font-semibold",children:"Clase B - Proveedores Importantes"}),e.jsxs("p",{className:"text-xs text-amber-300",children:[h.length," proveedores Â· Equilibrio ideal"]})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-amber-200 font-medium mb-2",children:"ğŸ¯ Estrategia:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"â€¢ RevisiÃ³n semestral de contratos"}),e.jsx("li",{children:"â€¢ Evaluar promociÃ³n a Clase A"}),e.jsx("li",{children:"â€¢ Buscar alternativas competitivas"}),e.jsx("li",{children:"â€¢ Optimizar costos y condiciones"})]})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-amber-200 font-medium mb-2",children:"ğŸ“Š Oportunidades:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"â€¢ Consolidar compras para mejores precios"}),e.jsx("li",{children:"â€¢ Negociar descuentos por volumen"}),e.jsx("li",{children:"â€¢ Explorar servicios adicionales"})]})]}),e.jsx("div",{className:"bg-blue-900/20 border border-blue-700 rounded p-2",children:e.jsxs("p",{className:"text-blue-200 text-xs",children:["ğŸ’¼ ",e.jsx("strong",{children:"RecomendaciÃ³n:"})," Mantener relaciÃ³n activa y evaluar potencial de crecimiento"]})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-900/20 to-green-800/10 border border-green-800 rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"ğŸŸ¢"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-green-400 font-semibold",children:"Clase C - Proveedores Ocasionales"}),e.jsxs("p",{className:"text-xs text-green-300",children:[g.length," proveedores Â· Bajo impacto individual"]})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-green-200 font-medium mb-2",children:"ğŸ¯ Estrategia:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"â€¢ Consolidar compras similares"}),e.jsx("li",{children:"â€¢ Evaluar eliminaciÃ³n de proveedores"}),e.jsx("li",{children:"â€¢ Automatizar procesos de compra"}),e.jsx("li",{children:"â€¢ Reducir carga administrativa"})]})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-green-200 font-medium mb-2",children:"âš¡ OptimizaciÃ³n:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"â€¢ Agrupar con proveedores Clase B"}),e.jsx("li",{children:"â€¢ Compras esporÃ¡dicas bajo demanda"}),e.jsx("li",{children:"â€¢ Minimizar costos de gestiÃ³n"})]})]}),e.jsx("div",{className:"bg-purple-900/20 border border-purple-700 rounded p-2",children:e.jsxs("p",{className:"text-purple-200 text-xs",children:["ğŸ”„ ",e.jsx("strong",{children:"AcciÃ³n:"})," Revisar anualmente y considerar consolidaciÃ³n con otros proveedores"]})})]})]})]}),e.jsxs("div",{className:"mt-6 bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-800 rounded-lg p-5",children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx("span",{children:"ğŸ“ˆ"})," Resumen del AnÃ¡lisis ABC"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"DistribuciÃ³n de Proveedores"}),e.jsxs("p",{className:"text-white",children:[e.jsx("span",{className:"text-red-400 font-bold",children:c.length})," A Â·"," ",e.jsx("span",{className:"text-amber-400 font-bold",children:h.length})," B Â·"," ",e.jsx("span",{className:"text-green-400 font-bold",children:g.length})," C"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Principio de Pareto"}),e.jsx("p",{className:"text-white",children:c.length>0?e.jsxs(e.Fragment,{children:["~",(c.length/r.length*100).toFixed(0),"% de proveedores genera ~",m.toFixed(0),"% del gasto"]}):"DistribuciÃ³n equilibrada"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"RecomendaciÃ³n Principal"}),e.jsx("p",{className:"text-blue-300",children:m>85?"âš ï¸ Reducir dependencia de Clase A":g.length>c.length*3?"ğŸ”„ Consolidar proveedores Clase C":"âœ… DistribuciÃ³n saludable"})]})]})]})]})}function xt(){const{data:r,isLoading:c}=S({queryKey:["purchaseSupplierForecast"],queryFn:()=>ye(),refetchInterval:3e5});if(c)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 h-96 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-full bg-neutral-800 rounded"})]});if(!r||r.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"ğŸ“ˆ PronÃ³stico de Gastos por Proveedor"}),e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"No hay datos suficientes para generar pronÃ³sticos"})]});const h=r.slice(0,5),g=h.map(t=>({nombre:t.supplierName.length>20?t.supplierName.substring(0,20)+"...":t.supplierName,historico:t.historicalAverage,pronostico:t.forecastedSpending,confianza:t.confidence})),x=t=>`$${t.toLocaleString("es-CL",{maximumFractionDigits:0})}`,a=t=>t==="increasing"?"â†—ï¸":t==="decreasing"?"â†˜ï¸":"â†’",m=t=>t==="increasing"?"text-red-400":t==="decreasing"?"text-green-400":"text-neutral-400";return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"ğŸ“ˆ PronÃ³stico de Gastos (Top 5 Proveedores)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 mb-6",children:h.map((t,i)=>e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"text-xs text-neutral-400 mb-1",children:["#",i+1," - ",t.supplierName]}),e.jsx("div",{className:"text-xl font-bold text-white mb-1",children:x(t.forecastedSpending)}),e.jsxs("div",{className:`text-sm font-medium ${m(t.trend)}`,children:[a(t.trend)," ",t.trend]}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-2",children:["Confianza: ",t.confidence.toFixed(0),"%"]})]},t.supplierId))}),e.jsx(te,{width:"100%",height:350,children:e.jsxs(Je,{data:g,children:[e.jsx(de,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(ce,{dataKey:"nombre",stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:12}}),e.jsx(ee,{stroke:"#a3a3a3",tick:{fill:"#a3a3a3"},tickFormatter:t=>x(t)}),e.jsx(se,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#fff"},formatter:(t,i)=>i==="confianza"?`${t.toFixed(0)}%`:x(t)}),e.jsx(me,{wrapperStyle:{color:"#a3a3a3"}}),e.jsx(he,{type:"monotone",dataKey:"historico",stroke:"#3b82f6",strokeWidth:2,name:"Promedio HistÃ³rico",dot:{fill:"#3b82f6",r:5}}),e.jsx(he,{type:"monotone",dataKey:"pronostico",stroke:"#f59e0b",strokeWidth:2,strokeDasharray:"5 5",name:"PronÃ³stico PrÃ³ximo Mes",dot:{fill:"#f59e0b",r:5}})]})}),e.jsx("div",{className:"mt-4 bg-purple-900/20 border border-purple-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-purple-300",children:["ğŸ’¡ ",e.jsx("strong",{children:"Algoritmo de PronÃ³stico:"})," Usa media mÃ³vil de los Ãºltimos 90 dÃ­as y anÃ¡lisis de tendencia (comparando primera vs segunda mitad del perÃ­odo) para predecir gastos del prÃ³ximo mes."]})})]})}function pt(){const{data:r,isLoading:c}=S({queryKey:["purchaseSupplierForecast"],queryFn:()=>ye(),refetchInterval:3e5});if(c)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(a=>e.jsx("div",{className:"h-16 bg-neutral-800 rounded"},a))})]});if(!r||r.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"ğŸ“Š Tabla de PronÃ³sticos Detallada"}),e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"No hay pronÃ³sticos disponibles"})]});const h=a=>`$${a.toLocaleString("es-CL",{maximumFractionDigits:0})}`,g=a=>{const m={increasing:"bg-red-900/30 text-red-400 border-red-800",stable:"bg-neutral-800 text-neutral-400 border-neutral-700",decreasing:"bg-green-900/30 text-green-400 border-green-800"},t={increasing:"â†—ï¸ Creciente",stable:"â†’ Estable",decreasing:"â†˜ï¸ Decreciente"};return{style:m[a]||m.stable,label:t[a]||a}},x=a=>a>=80?"text-green-400":a>=60?"text-amber-400":"text-red-400";return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"ğŸ“Š PronÃ³sticos Detallados por Proveedor"}),e.jsxs("span",{className:"text-sm text-neutral-400",children:[r.length," proveedores analizados"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-neutral-400",children:"Proveedor"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Promedio HistÃ³rico"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"PronÃ³stico"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-neutral-400",children:"Tendencia"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-neutral-400",children:"Confianza"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-neutral-400",children:"PrÃ³xima Compra"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Cantidad Sugerida"})]})}),e.jsx("tbody",{children:r.map((a,m)=>{const t=g(a.trend),i=a.historicalAverage>0?(a.forecastedSpending-a.historicalAverage)/a.historicalAverage*100:0;return e.jsxs("tr",{className:`border-b border-neutral-800 hover:bg-neutral-800/50 transition-colors ${m>=10?"opacity-60":""}`,children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"text-white font-medium",children:a.supplierName}),e.jsxs("div",{className:"text-xs text-neutral-500",children:["ID: ",a.supplierId.substring(0,8)]})]}),e.jsxs("td",{className:"py-3 px-4 text-right",children:[e.jsx("span",{className:"text-neutral-300",children:h(a.historicalAverage)}),e.jsx("div",{className:"text-xs text-neutral-500",children:"por mes"})]}),e.jsxs("td",{className:"py-3 px-4 text-right",children:[e.jsx("span",{className:"text-white font-semibold",children:h(a.forecastedSpending)}),e.jsxs("div",{className:`text-xs ${i>=0?"text-red-400":"text-green-400"}`,children:[i>=0?"+":"",i.toFixed(1),"%"]})]}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:`inline-flex px-2 py-1 rounded text-xs font-medium border ${t.style}`,children:t.label})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("span",{className:`font-bold ${x(a.confidence)}`,children:[a.confidence.toFixed(0),"%"]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:"text-neutral-300 text-sm",children:new Date(a.nextPurchaseDate).toLocaleDateString("es-CL")})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-blue-400 font-medium",children:[a.recommendedOrderQuantity.toFixed(2)," un."]})})]},a.supplierId)})})]})}),r.length>10&&e.jsxs("div",{className:"mt-4 text-center text-sm text-neutral-500",children:["Mostrando todos los ",r.length," proveedores (primeros 10 resaltados)"]})]})}function ht(){const{data:r}=S({queryKey:["purchaseSupplierForecast"],queryFn:()=>ye(),refetchInterval:3e5});if(!r||r.length===0)return null;const c=r.reduce((s,o)=>s+o.forecastedSpending,0),h=r.reduce((s,o)=>s+o.historicalAverage,0),g=h>0?(c-h)/h*100:0,x=r.filter(s=>s.trend==="increasing"),a=r.filter(s=>s.trend==="decreasing"),m=r.filter(s=>s.confidence<60),t=r.filter(s=>s.forecastedSpending>c/r.length*2),i=s=>`$${s.toLocaleString("es-CL",{maximumFractionDigits:0})}`;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"ğŸ” Insights y Alertas del PronÃ³stico"}),e.jsx("div",{className:"bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-800 rounded-lg p-5 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 text-sm mb-1",children:"Gasto HistÃ³rico Mensual"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:i(h)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 text-sm mb-1",children:"PronÃ³stico PrÃ³ximo Mes"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:i(c)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 text-sm mb-1",children:"VariaciÃ³n Esperada"}),e.jsxs("p",{className:`text-2xl font-bold ${g>=0?"text-red-400":"text-green-400"}`,children:[g>=0?"+":"",g.toFixed(1),"%"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[x.length>0&&e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-400 font-semibold",children:"Proveedores con Tendencia Creciente"}),e.jsxs("p",{className:"text-xs text-red-300",children:[x.length," proveedores"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[x.slice(0,3).map(s=>{const o=s.historicalAverage>0?(s.forecastedSpending-s.historicalAverage)/s.historicalAverage*100:0;return e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-red-200",children:s.supplierName.substring(0,25)}),e.jsxs("span",{className:"text-red-400 font-bold",children:["+",o.toFixed(0),"%"]})]},s.supplierId)}),x.length>3&&e.jsxs("p",{className:"text-xs text-red-300 mt-2",children:["Y ",x.length-3," mÃ¡s..."]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-red-800",children:e.jsxs("p",{className:"text-xs text-red-200",children:["ğŸ’¡ ",e.jsx("strong",{children:"AcciÃ³n:"})," Revisar contratos y negociar mejores condiciones antes del aumento"]})})]}),m.length>0&&e.jsxs("div",{className:"bg-amber-900/20 border border-amber-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"âš¡"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-amber-400 font-semibold",children:"PronÃ³sticos de Baja Confianza"}),e.jsxs("p",{className:"text-xs text-amber-300",children:[m.length," proveedores"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[m.slice(0,3).map(s=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-amber-200",children:s.supplierName.substring(0,25)}),e.jsxs("span",{className:"text-amber-400 font-bold",children:[s.confidence.toFixed(0),"%"]})]},s.supplierId)),m.length>3&&e.jsxs("p",{className:"text-xs text-amber-300 mt-2",children:["Y ",m.length-3," mÃ¡s..."]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-amber-800",children:e.jsxs("p",{className:"text-xs text-amber-200",children:["ğŸ’¡ ",e.jsx("strong",{children:"RazÃ³n:"})," Pocos datos histÃ³ricos. Aumentar frecuencia de compras para mejorar predicciÃ³n"]})})]}),a.length>0&&e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"âœ…"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-green-400 font-semibold",children:"Proveedores con Tendencia Decreciente"}),e.jsxs("p",{className:"text-xs text-green-300",children:[a.length," proveedores"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[a.slice(0,3).map(s=>{const o=s.historicalAverage>0?(s.forecastedSpending-s.historicalAverage)/s.historicalAverage*100:0;return e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-green-200",children:s.supplierName.substring(0,25)}),e.jsxs("span",{className:"text-green-400 font-bold",children:[o.toFixed(0),"%"]})]},s.supplierId)}),a.length>3&&e.jsxs("p",{className:"text-xs text-green-300 mt-2",children:["Y ",a.length-3," mÃ¡s..."]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-green-800",children:e.jsxs("p",{className:"text-xs text-green-200",children:["ğŸ’¡ ",e.jsx("strong",{children:"Oportunidad:"})," OptimizaciÃ³n exitosa o reducciÃ³n de demanda. Evaluar causas"]})})]}),t.length>0&&e.jsxs("div",{className:"bg-purple-900/20 border border-purple-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"ğŸ’°"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-purple-400 font-semibold",children:"Proveedores de Alto Gasto"}),e.jsxs("p",{className:"text-xs text-purple-300",children:[t.length," proveedores"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[t.slice(0,3).map(s=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-purple-200",children:s.supplierName.substring(0,25)}),e.jsx("span",{className:"text-purple-400 font-bold",children:i(s.forecastedSpending)})]},s.supplierId)),t.length>3&&e.jsxs("p",{className:"text-xs text-purple-300 mt-2",children:["Y ",t.length-3," mÃ¡s..."]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-purple-800",children:e.jsxs("p",{className:"text-xs text-purple-200",children:["ğŸ’¡ ",e.jsx("strong",{children:"RecomendaciÃ³n:"})," Negociar descuentos por volumen o contratos anuales"]})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-900/30 to-blue-800/20 border border-blue-800 rounded-lg p-5",children:[e.jsxs("h4",{className:"text-white font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ğŸ“‹"})," Recomendaciones EstratÃ©gicas"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-2",children:"ğŸ¯ PlanificaciÃ³n de Flujo de Caja"}),e.jsxs("p",{className:"text-neutral-300",children:["BasÃ¡ndose en el pronÃ³stico total de ",i(c),", asegÃºrese de tener liquidez suficiente para el prÃ³ximo mes."]})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-2",children:"ğŸ“Š OptimizaciÃ³n de Inventario"}),e.jsx("p",{className:"text-neutral-300",children:"Use las cantidades sugeridas como base para evitar sobre-stock o quiebres de inventario."})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-2",children:"â° ProgramaciÃ³n de Compras"}),e.jsx("p",{className:"text-neutral-300",children:"Revise las fechas estimadas de prÃ³xima compra para planificar pedidos con anticipaciÃ³n."})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-2",children:"ğŸ”„ ActualizaciÃ³n Continua"}),e.jsx("p",{className:"text-neutral-300",children:"Los pronÃ³sticos se actualizan cada 5 minutos. Revise regularmente para decisiones informadas."})]})]})]})]})}function gt({startDate:r,endDate:c,statusFilter:h}){const g=j.useMemo(()=>G(),[]),x=n=>g.format(n??0),a=j.useMemo(()=>{const n=new Date(r),b=new Date(c),u=Math.abs(b.getTime()-n.getTime());return Math.ceil(u/(1e3*60*60*24))+1},[r,c]),m=j.useMemo(()=>{const n=new Date(r),b=new Date(n);b.setDate(b.getDate()-1);const u=new Date(b);return u.setDate(u.getDate()-a+1),{start:u.toISOString().split("T")[0],end:b.toISOString().split("T")[0]}},[r,a]),t=S({queryKey:["purchases-stats",r,c,h],queryFn:async()=>(await k({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(c+"T23:59:59").toISOString()})).content??[]}),i=S({queryKey:["purchases-stats-previous",m.start,m.end,h],queryFn:async()=>(await k({page:0,size:1e4,status:h||void 0,from:new Date(m.start+"T00:00:00").toISOString(),to:new Date(m.end+"T23:59:59").toISOString()})).content??[]}),s=t.data??[],o=i.data??[],l=j.useMemo(()=>{const n=s.reduce((C,F)=>C+(F.total??0),0),b=s.filter(C=>C.status?.toLowerCase()==="received"),u=s.filter(C=>C.status?.toLowerCase()==="cancelled"),f=s.filter(C=>C.status?.toLowerCase()!=="received"&&C.status?.toLowerCase()!=="cancelled"),N=a>0?n/a:0,v=o.reduce((C,F)=>C+(F.total??0),0),A=o.length,w=a>0?v/a:0,M=o.filter(C=>C.status?.toLowerCase()==="received").length,T=v>0?(n-v)/v*100:0,E=A>0?(s.length-A)/A*100:0,L=w>0?(N-w)/w*100:0,z=M>0?(b.length-M)/M*100:0,O=new Map;s.forEach(C=>{const F=C.supplierId??"unknown",I=C.supplierName??"Sin proveedor",H=O.get(F)??{total:0,count:0};O.set(F,{name:I,total:H.total+(C.total??0),count:H.count+1})});const R=Array.from(O.values()).sort((C,F)=>F.total-C.total).slice(0,5),q=[];return T>20&&q.push({type:"warning",message:"Gasto aumentÃ³ >20%"}),u.length>s.length*.1&&q.push({type:"error",message:"Alta tasa de cancelaciÃ³n"}),f.length>b.length&&q.push({type:"info",message:"Muchas Ã³rdenes pendientes"}),{total:n,count:s.length,dailyAverage:N,received:b.length,cancelled:u.length,pending:f.length,topSuppliers:R,totalVariation:T,countVariation:E,dailyVariation:L,receivedVariation:z,alerts:q}},[s,o,a]);return t.isLoading||i.isLoading?e.jsx("section",{className:"dashboard-overview",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",style:{marginBottom:"1.5rem"},children:[e.jsx("header",{className:"card-header",children:e.jsx("h2",{className:"text-neutral-100",children:"Resumen de compras"})}),e.jsxs("div",{className:"kpi-grid",style:{marginBottom:"1.5rem"},children:[e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"})]})]})}):t.isError||i.isError?e.jsx("section",{className:"dashboard-overview",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",style:{marginBottom:"1.5rem"},children:[e.jsx("header",{className:"card-header",children:e.jsx("h2",{className:"text-neutral-100",children:"Resumen de compras"})}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar mÃ©tricas de compras"})})]})}):e.jsx("section",{className:"dashboard-overview",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",style:{marginBottom:"1.5rem"},children:[e.jsx("header",{className:"card-header",style:{marginBottom:"1rem"},children:e.jsx("h2",{className:"text-neutral-100",children:"Resumen de compras"})}),l.alerts.length>0&&e.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:l.alerts.map((n,b)=>e.jsxs("div",{className:`rounded-lg p-3 border ${n.type==="error"?"bg-red-950 border-red-800 text-red-400":n.type==="warning"?"bg-yellow-950 border-yellow-800 text-yellow-400":"bg-blue-950 border-blue-800 text-blue-400"}`,style:{fontSize:"0.875rem"},children:[e.jsx("span",{children:n.type==="error"?"ğŸ”´":n.type==="warning"?"ğŸŸ¡":"â„¹ï¸"})," ",n.message]},b))}),e.jsxs("div",{className:"kpi-grid",style:{marginBottom:"1.5rem"},children:[e.jsxs("article",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 stat",children:[e.jsx("h3",{className:"text-neutral-100",children:"Gasto acumulado"}),e.jsx("p",{className:"stat-value text-neutral-100",children:x(l.total)}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${l.totalVariation>0?"bg-red-950 text-red-400 border-red-800":l.totalVariation<0?"bg-green-950 text-green-400 border-green-800":"bg-neutral-800 text-neutral-400 border-neutral-700"}`,children:[l.totalVariation>0?"â†‘":l.totalVariation<0?"â†“":"âˆ’"," ",Math.abs(l.totalVariation).toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400 text-xs",children:"vs perÃ­odo anterior"})]}),e.jsxs("span",{className:"muted small text-neutral-400",style:{display:"block",marginTop:"0.5rem"},children:[l.count," Ã³rdenes registradas"]})]}),e.jsxs("article",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 stat",children:[e.jsx("h3",{className:"text-neutral-100",children:"Promedio diario"}),e.jsx("p",{className:"stat-value text-neutral-100",children:x(l.dailyAverage)}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${l.dailyVariation>0?"bg-red-950 text-red-400 border-red-800":l.dailyVariation<0?"bg-green-950 text-green-400 border-green-800":"bg-neutral-800 text-neutral-400 border-neutral-700"}`,children:[l.dailyVariation>0?"â†‘":l.dailyVariation<0?"â†“":"âˆ’"," ",Math.abs(l.dailyVariation).toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400 text-xs",children:"vs perÃ­odo anterior"})]})]}),e.jsxs("article",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 stat",children:[e.jsx("h3",{className:"text-neutral-100",children:"Ã“rdenes recibidas"}),e.jsx("p",{className:"stat-value stat-success text-neutral-100",children:l.received}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${l.receivedVariation>0?"bg-green-950 text-green-400 border-green-800":l.receivedVariation<0?"bg-red-950 text-red-400 border-red-800":"bg-neutral-800 text-neutral-400 border-neutral-700"}`,children:[l.receivedVariation>0?"â†‘":l.receivedVariation<0?"â†“":"âˆ’"," ",Math.abs(l.receivedVariation).toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400 text-xs",children:"vs perÃ­odo anterior"})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"0.5rem",fontSize:"0.875rem"},children:[e.jsxs("span",{className:"muted text-neutral-400",children:["â³ Pendientes: ",l.pending]}),e.jsxs("span",{className:"muted text-neutral-400",children:["ğŸ”´ Canceladas: ",l.cancelled]})]})]}),e.jsxs("article",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 stat",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top proveedores"}),e.jsx("div",{style:{marginTop:"0.5rem"},children:l.topSuppliers.length>0?e.jsx("div",{style:{fontSize:"0.875rem"},children:l.topSuppliers.slice(0,3).map((n,b)=>e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsxs("span",{className:"text-neutral-400",children:[b===0?"ğŸ¥‡":b===1?"ğŸ¥ˆ":"ğŸ¥‰"," ",n.name]}),e.jsx("span",{style:{fontWeight:600},className:"text-neutral-100",children:x(n.total)})]}),e.jsx("div",{className:"bg-neutral-800 rounded-full h-1.5",style:{overflow:"hidden"},children:e.jsx("div",{className:"bg-blue-500 h-1.5",style:{width:`${n.total/l.topSuppliers[0].total*100}%`,transition:"width 0.3s ease"}})})]},b))}):e.jsx("span",{className:"muted small text-neutral-400",children:"No hay datos"})})]})]})]})})}function bt({startDate:r,endDate:c,onStartDateChange:h,onEndDateChange:g}){const x=new Date().toISOString().split("T")[0],a=j.useMemo(()=>G(),[]),m=u=>a.format(u??0),t=j.useMemo(()=>{const u=new Date(r),f=new Date(c),N=Math.abs(f.getTime()-u.getTime());return Math.ceil(N/(1e3*60*60*24))+1},[r,c]),i=S({queryKey:["purchases","daily",t],queryFn:()=>Ke(t),enabled:t>0&&t<=365}),s=i.data??[],o=j.useMemo(()=>s.length===0?0:s.reduce((f,N)=>f+(N.total??0),0)/s.length,[s]),l=u=>{u&&(h(u),u>c&&g(u))},n=u=>{u&&(g(u),u<r&&h(u))},b=j.useMemo(()=>s.map(u=>({date:u.date,total:Number(u.total??0),count:u.count,average:o})),[s,o]);return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("header",{className:"card-header border-b border-neutral-800 pb-4 mb-4",style:{gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[e.jsx("h2",{className:"text-neutral-100",children:"Tendencia de compras"}),e.jsxs("p",{className:"muted small text-neutral-400",children:["Promedio diario: ",m(o)," | Total perÃ­odo:"," ",m(s.reduce((u,f)=>u+(f.total??0),0))]})]}),e.jsxs("div",{className:"field-group",style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[e.jsxs("label",{className:"field",style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[e.jsx("span",{className:"muted small text-neutral-400",children:"Desde"}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"date",value:r,max:c,onChange:u=>l(u.target.value)})]}),e.jsxs("label",{className:"field",style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[e.jsx("span",{className:"muted small text-neutral-400",children:"Hasta"}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"date",value:c,min:r,max:x,onChange:u=>n(u.target.value)})]})]})]}),e.jsx("div",{className:"chart-card",style:{height:320},children:i.isLoading?e.jsx("p",{className:"muted text-neutral-400",role:"status",children:"Cargando datos de compras..."}):i.isError?e.jsxs("p",{className:"panel-error text-red-400",role:"status",children:["Error al cargar los datos de compras. ",i.error?.message]}):b.length>0?e.jsx(te,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:b,children:[e.jsx(de,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(ce,{dataKey:"date",stroke:"#a3a3a3",tick:{fontSize:12}}),e.jsx(ee,{yAxisId:"left",stroke:"#a3a3a3",tickFormatter:u=>`$${(u/1e3).toFixed(0)}k`}),e.jsx(ee,{yAxisId:"right",orientation:"right",stroke:"#a3a3a3",tickFormatter:u=>u.toString()}),e.jsx(se,{formatter:(u,f)=>f==="total"||f==="average"?[m(u),f==="total"?"Monto":"Promedio"]:[u,"Ã“rdenes"],contentStyle:{backgroundColor:"#262626",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#f5f5f5"}}),e.jsx(me,{}),e.jsx(ie,{yAxisId:"left",dataKey:"total",fill:"#a855f7",radius:[6,6,0,0],name:"Monto"}),e.jsx(he,{yAxisId:"left",type:"monotone",dataKey:"average",stroke:"#f59e0b",strokeWidth:2,dot:!1,name:"Promedio",strokeDasharray:"5 5"}),e.jsx(he,{yAxisId:"right",type:"monotone",dataKey:"count",stroke:"#10b981",strokeWidth:2,name:"Ã“rdenes"})]})}):e.jsxs("p",{className:"muted text-neutral-400",role:"status",children:["No hay compras registradas en el rango seleccionado (",r," - ",c,")."]})})]})}function jt({startDate:r,endDate:c}){const{data:h}=S({queryKey:["purchases","current",r,c],queryFn:()=>k({from:r?new Date(r).toISOString():void 0,to:c?new Date(c).toISOString():void 0,size:1e4})}),{data:g}=S({queryKey:["purchases","previous",r,c],queryFn:async()=>{if(!r||!c)return null;const i=new Date(r),s=new Date(c),o=Math.ceil((s.getTime()-i.getTime())/(1e3*60*60*24)),l=new Date(i);l.setDate(l.getDate()-1);const n=new Date(l);return n.setDate(n.getDate()-o),k({from:n.toISOString(),to:l.toISOString(),size:1e4})},enabled:!!r&&!!c}),{data:x}=S({queryKey:["suppliers"],queryFn:()=>ge()}),a=[];if(h?.content&&g?.content){const i=new Map,s=new Map;h.content.forEach(o=>{if(!o.supplierId)return;const l=i.get(o.supplierId)||{total:0,count:0,name:o.supplierName||""};l.total+=o.total,l.count+=1,i.set(o.supplierId,l)}),g.content.forEach(o=>{if(!o.supplierId)return;const l=s.get(o.supplierId)||{total:0,count:0};l.total+=o.total,l.count+=1,s.set(o.supplierId,l)}),i.forEach((o,l)=>{const n=s.get(l);if(n&&n.count>0){const b=o.total/o.count,u=n.total/n.count,f=(b-u)/u*100;Math.abs(f)>20&&a.push({id:`price-anomaly-${l}`,type:"price-anomaly",severity:Math.abs(f)>50?"high":"medium",title:"AnomalÃ­a en precios detectada",description:`${o.name}: ${f>0?"Aumento":"DisminuciÃ³n"} del ${Math.abs(f).toFixed(1)}% en promedio de compra`,icon:"ğŸ“Š"})}})}if(x&&h?.content){const i=new Set(h.content.map(o=>o.supplierId).filter(Boolean)),s=new Date;s.setDate(s.getDate()-30),x.forEach(o=>{i.has(o.id.toString())||a.push({id:`inactive-${o.id}`,type:"inactive-supplier",severity:"low",title:"Proveedor sin actividad reciente",description:`${o.name} no tiene compras en el perÃ­odo seleccionado`,icon:"ğŸ•’"})})}if(h?.content){const i=new Map;h.content.forEach(s=>{if(!s.supplierId)return;const o=i.get(s.supplierId)||{count:0,name:s.supplierName||""};o.count+=1,i.set(s.supplierId,o)}),i.forEach((s,o)=>{s.count>5&&a.push({id:`low-stock-${o}`,type:"low-stock",severity:"medium",title:"Posible stock bajo detectado",description:`Alta frecuencia de compras a ${s.name} (${s.count} Ã³rdenes). PodrÃ­a indicar reabastecimiento frecuente`,icon:"âš ï¸"})})}const m={high:0,medium:1,low:2};a.sort((i,s)=>m[i.severity]-m[s.severity]);const t=a.slice(0,5);return t.length===0?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:"Alertas Inteligentes"}),e.jsxs("div",{className:"text-center py-8 text-neutral-400",children:[e.jsx("div",{className:"text-6xl mb-2",children:"âœ“"}),e.jsx("p",{children:"No se detectaron alertas. Todo estÃ¡ funcionando correctamente."})]})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-neutral-100",children:[e.jsx("span",{className:"text-2xl",children:"ğŸ””"}),"Alertas Inteligentes (",t.length,")"]}),e.jsx("div",{className:"space-y-3",children:t.map(i=>{const s={high:"bg-red-950 border-red-800 text-red-400",medium:"bg-yellow-950 border-yellow-800 text-yellow-400",low:"bg-blue-950 border-blue-800 text-blue-400"};return e.jsx("div",{className:`border rounded-lg p-3 ${s[i.severity]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl flex-shrink-0",children:i.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm",children:i.title}),e.jsx("p",{className:"text-sm mt-1 opacity-90",children:i.description})]})]})},i.id)})})]})}function vt({startDate:r,endDate:c}){const h=j.useMemo(()=>G(),[]),g=s=>h.format(s??0),{data:x}=S({queryKey:["purchases","current",r,c],queryFn:()=>k({from:r?new Date(r).toISOString():void 0,to:c?new Date(c).toISOString():void 0,size:1e4})}),{data:a}=S({queryKey:["purchases","previous",r,c],queryFn:async()=>{if(!r||!c)return null;const s=new Date(r),o=new Date(c),l=Math.ceil((o.getTime()-s.getTime())/(1e3*60*60*24)),n=new Date(s);n.setDate(n.getDate()-1);const b=new Date(n);return b.setDate(b.getDate()-l),k({from:b.toISOString(),to:n.toISOString(),size:1e4})},enabled:!!r&&!!c}),m=j.useMemo(()=>{if(!x?.content||!a?.content)return null;const s=x.content.reduce((O,R)=>O+R.total,0),o=x.content.length,l=o>0?s/o:0,n=a.content.reduce((O,R)=>O+R.total,0),b=a.content.length,u=b>0?n/b:0,f=n!==0?(s-n)/n*100:0,N=b!==0?(o-b)/b*100:0,v=u!==0?(l-u)/u*100:0,A=new Date(r),w=new Date(c),M=Math.ceil((w.getTime()-A.getTime())/(1e3*60*60*24)),T=new Date,E=Math.max(0,Math.ceil((w.getTime()-T.getTime())/(1e3*60*60*24))),L=M>0?s/M:0,z=s+L*E;return{currentTotal:s,currentCount:o,currentAvg:l,previousTotal:n,previousCount:b,previousAvg:u,totalChange:f,countChange:N,avgChange:v,projection:z,daysRemaining:E}},[x,a,r,c]);if(!m)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:"ComparaciÃ³n Temporal"}),e.jsx("div",{className:"text-center py-8 text-neutral-400",children:e.jsx("p",{children:"Cargando datos de comparaciÃ³n..."})})]});const t=s=>s>5?"ğŸ“ˆ":s<-5?"ğŸ“‰":"â¡ï¸",i=s=>s>5?"text-red-400":s<-5?"text-green-400":"text-neutral-400";return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-neutral-100",children:[e.jsx("span",{className:"text-2xl",children:"ğŸ“Š"}),"ComparaciÃ³n Temporal"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-neutral-950 border border-neutral-800 rounded-lg",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Total Gastado"}),e.jsx("div",{className:"text-2xl font-bold mb-2 text-neutral-100",children:g(m.currentTotal)}),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${i(m.totalChange)}`,children:[e.jsx("span",{className:"text-xl",children:t(m.totalChange)}),e.jsxs("span",{className:"font-semibold",children:[m.totalChange>0?"+":"",m.totalChange.toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400",children:"vs perÃ­odo anterior"})]})]}),e.jsxs("div",{className:"p-4 bg-neutral-950 border border-neutral-800 rounded-lg",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Cantidad de Ã“rdenes"}),e.jsx("div",{className:"text-2xl font-bold mb-2 text-neutral-100",children:m.currentCount}),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${i(m.countChange)}`,children:[e.jsx("span",{className:"text-xl",children:t(m.countChange)}),e.jsxs("span",{className:"font-semibold",children:[m.countChange>0?"+":"",m.countChange.toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400",children:"vs perÃ­odo anterior"})]})]}),e.jsxs("div",{className:"p-4 bg-neutral-950 border border-neutral-800 rounded-lg",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Promedio por Orden"}),e.jsx("div",{className:"text-2xl font-bold mb-2 text-neutral-100",children:g(m.currentAvg)}),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${i(m.avgChange)}`,children:[e.jsx("span",{className:"text-xl",children:t(m.avgChange)}),e.jsxs("span",{className:"font-semibold",children:[m.avgChange>0?"+":"",m.avgChange.toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400",children:"vs perÃ­odo anterior"})]})]})]}),m.daysRemaining>0&&e.jsxs("div",{className:"p-4 bg-blue-950 border border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ğŸ”®"}),e.jsx("h4",{className:"font-semibold text-blue-300",children:"ProyecciÃ³n de Fin de PerÃ­odo"})]}),e.jsx("div",{className:"text-sm text-blue-400 mb-1",children:"Basado en el gasto diario actual, se proyecta un total de:"}),e.jsx("div",{className:"text-3xl font-bold text-blue-300",children:g(m.projection)}),e.jsxs("div",{className:"text-sm text-blue-400 mt-2",children:["(",m.daysRemaining," dÃ­a",m.daysRemaining!==1?"s":""," restante",m.daysRemaining!==1?"s":"",")"]})]})]})}function Nt({startDate:r,endDate:c}){const h=j.useMemo(()=>G(),[]),g=t=>h.format(t??0),{data:x}=S({queryKey:["purchases","optimization",r,c],queryFn:()=>k({from:r?new Date(r).toISOString():void 0,to:c?new Date(c).toISOString():void 0,size:1e4})}),a=j.useMemo(()=>{if(!x?.content)return[];const t=[],i=new Map;x.content.forEach(N=>{if(!N.supplierId)return;const v=i.get(N.supplierId)||{count:0,total:0,name:N.supplierName||""};v.count+=1,v.total+=N.total,i.set(N.supplierId,v)});const s=Array.from(i.entries()).filter(([N,v])=>v.count<=2&&v.total<5e4).length;s>5&&t.push({id:"consolidation-1",type:"consolidation",title:"Oportunidad de consolidaciÃ³n de proveedores",description:`Se detectaron ${s} proveedores con bajo volumen de compra. Consolidar podrÃ­a reducir costos administrativos y mejorar poder de negociaciÃ³n.`,potentialSaving:s*5e3,icon:"ğŸ¤"});const o=new Map;x.content.forEach(N=>{const v=N.issuedAt.split("T")[0],A=`${N.supplierId}-${v}`,w=o.get(A)||[];w.push(N),o.set(A,w)});let l=0;o.forEach(N=>{if(N.length>1)for(let v=0;v<N.length;v++)for(let A=v+1;A<N.length;A++)Math.abs(N[v].total-N[A].total)/N[v].total<.1&&l++}),l>0&&t.push({id:"duplicate-1",type:"duplicate",title:"Posibles Ã³rdenes duplicadas detectadas",description:`Se encontraron ${l} par${l>1?"es":""} de Ã³rdenes sospechosas (mismo proveedor, misma fecha, montos similares). Revisar para evitar pagos duplicados.`,icon:"âš ï¸"});const n=new Map;x.content.forEach(N=>{if(!N.supplierId)return;const v=n.get(N.supplierId)||{min:1/0,max:-1/0,avg:0,count:0,name:N.supplierName||""};v.min=Math.min(v.min,N.total),v.max=Math.max(v.max,N.total),v.avg=(v.avg*v.count+N.total)/(v.count+1),v.count+=1,n.set(N.supplierId,v)});const b=Array.from(n.entries()).filter(([N,v])=>v.count<3?!1:(v.max-v.min)/v.avg>.3);if(b.length>0){const[N,v]=b[0],A=(v.max-v.min)*v.count*.5;t.push({id:"best-price-1",type:"best-price",title:"VariaciÃ³n de precios detectada",description:`${v.name} tiene una variaciÃ³n de precios del ${((v.max-v.min)/v.avg*100).toFixed(1)}% en ${v.count} Ã³rdenes. Negociar precios consistentes podrÃ­a generar ahorros.`,potentialSaving:A,icon:"ğŸ’°"})}const f=x.content.reduce((N,v)=>N+v.total,0)/x.content.length;return f<1e4&&x.content.length>20&&t.push({id:"consolidation-2",type:"consolidation",title:"Ã“rdenes de bajo valor detectadas",description:`El promedio por orden es ${g(f)}. Consolidar Ã³rdenes pequeÃ±as podrÃ­a reducir costos de envÃ­o y administrativos.`,potentialSaving:x.content.length*500,icon:"ğŸ“¦"}),t},[x,g]),m=a.reduce((t,i)=>t+(i.potentialSaving||0),0);return a.length===0?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:"OptimizaciÃ³n de Compras"}),e.jsxs("div",{className:"text-center py-8 text-neutral-400",children:[e.jsx("div",{className:"text-6xl mb-2",children:"âœ“"}),e.jsx("p",{children:"No se detectaron oportunidades de optimizaciÃ³n significativas."}),e.jsx("p",{className:"text-sm mt-2",children:"El proceso de compras estÃ¡ funcionando eficientemente."})]})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 text-neutral-100",children:[e.jsx("span",{className:"text-2xl",children:"ğŸ¯"}),"Oportunidades de OptimizaciÃ³n"]}),m>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-neutral-400",children:"Ahorro potencial estimado"}),e.jsx("div",{className:"text-lg font-bold text-green-400",children:g(m)})]})]}),e.jsx("div",{className:"space-y-3",children:a.map(t=>{const i={consolidation:"bg-blue-950 border-blue-800",duplicate:"bg-red-950 border-red-800","best-price":"bg-green-950 border-green-800"};return e.jsx("div",{className:`border rounded-lg p-4 ${i[t.type]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-3xl flex-shrink-0",children:t.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm mb-1 text-neutral-100",children:t.title}),e.jsx("p",{className:"text-sm opacity-90 mb-2 text-neutral-300",children:t.description}),t.potentialSaving&&t.potentialSaving>0&&e.jsxs("div",{className:"inline-block bg-neutral-800 bg-opacity-60 px-2 py-1 rounded text-xs font-semibold text-neutral-300",children:["ğŸ’µ Ahorro estimado: ",g(t.potentialSaving)]})]})]})},t.id)})})]})}function ft({startDate:r,endDate:c}){const h=S({queryKey:["suppliers"],queryFn:()=>ge()}),g=S({queryKey:["purchases-all",r,c],queryFn:async()=>{const t={page:0,size:1e4,from:r?new Date(r).toISOString():void 0,to:c?new Date(c+"T23:59:59").toISOString():void 0};return k(t)}}),x=j.useMemo(()=>{if(!g.data||!h.data)return[];const t=g.data.content,i=h.data,s=new Map;t.forEach(n=>{if(!n.supplierId)return;const u=i.find(v=>v.id===n.supplierId)?.name??n.supplierName??"Desconocido";s.has(n.supplierId)||s.set(n.supplierId,{supplierId:n.supplierId,supplierName:u,totalOrders:0,totalAmount:0,avgOrderAmount:0,lastOrderDate:null,daysSinceLastOrder:0});const f=s.get(n.supplierId);f.totalOrders++,f.totalAmount+=parseFloat(n.total?.toString()??"0");const N=n.issuedAt?new Date(n.issuedAt).toISOString():null;N&&(!f.lastOrderDate||N>f.lastOrderDate)&&(f.lastOrderDate=N)});const o=new Date;return Array.from(s.values()).map(n=>({...n,avgOrderAmount:n.totalAmount/n.totalOrders,daysSinceLastOrder:n.lastOrderDate?Math.floor((o.getTime()-new Date(n.lastOrderDate).getTime())/(1e3*60*60*24)):999})).sort((n,b)=>b.totalAmount-n.totalAmount).slice(0,10)},[g.data,h.data]);if(g.isLoading||h.isLoading)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top 10 Proveedores"}),e.jsx("p",{className:"muted text-neutral-400",children:"Cargando estadÃ­sticas..."})]});if(!x.length)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top 10 Proveedores"}),e.jsx("p",{className:"muted text-neutral-400",children:"No hay datos de proveedores en el perÃ­odo seleccionado"})]});const a=x.map(t=>({name:t.supplierName.length>20?t.supplierName.substring(0,17)+"...":t.supplierName,fullName:t.supplierName,total:t.totalAmount,orders:t.totalOrders,avg:t.avgOrderAmount})),m=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d","#ffc658","#ff7c7c","#8dd1e1","#d084d0"];return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top 10 Proveedores"}),e.jsxs("p",{className:"muted text-neutral-400",style:{marginBottom:"1rem"},children:["Volumen total de compras por proveedor (perÃ­odo: ",r," a ",c,")"]}),e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsx(te,{width:"100%",height:300,children:e.jsxs(Ce,{data:a,children:[e.jsx(de,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(ce,{dataKey:"name",angle:-45,textAnchor:"end",height:100,stroke:"#a3a3a3"}),e.jsx(ee,{stroke:"#a3a3a3"}),e.jsx(se,{formatter:(t,i,s)=>i==="total"?[`$${t.toLocaleString()}`,"Total"]:i==="orders"?[t,"Ã“rdenes"]:i==="avg"?[`$${t.toLocaleString()}`,"Promedio"]:t,labelFormatter:t=>a.find(i=>i.name===t)?.fullName??t,contentStyle:{backgroundColor:"#262626",border:"1px solid #404040"},labelStyle:{color:"#f5f5f5"}}),e.jsx(ie,{dataKey:"total",name:"Total",children:a.map((t,i)=>e.jsx(Se,{fill:m[i%m.length]},`cell-${i}`))})]})})}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Proveedor"}),e.jsx("th",{children:"Ã“rdenes"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Promedio"}),e.jsx("th",{children:"Ãšltima compra"}),e.jsx("th",{children:"Estado"})]})}),e.jsx("tbody",{children:x.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.supplierName}),e.jsx("td",{children:t.totalOrders}),e.jsxs("td",{children:["$",t.totalAmount.toLocaleString()]}),e.jsxs("td",{children:["$",t.avgOrderAmount.toLocaleString()]}),e.jsx("td",{children:t.lastOrderDate?new Date(t.lastOrderDate).toLocaleDateString():"N/A"}),e.jsx("td",{children:t.daysSinceLastOrder<30?e.jsx("span",{className:"status active",children:"Activo"}):t.daysSinceLastOrder<90?e.jsx("span",{className:"status warning",children:"Regular"}):e.jsx("span",{className:"status inactive",children:"Inactivo"})})]},t.supplierId))})]})}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("h4",{className:"text-neutral-100",children:"MÃ©tricas Generales"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted text-neutral-400",children:"Total Proveedores"}),e.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"bold"},className:"text-neutral-100",children:x.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted text-neutral-400",children:"Total Ã“rdenes"}),e.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"bold"},className:"text-neutral-100",children:x.reduce((t,i)=>t+i.totalOrders,0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted text-neutral-400",children:"Volumen Total"}),e.jsxs("p",{style:{fontSize:"1.5rem",fontWeight:"bold"},className:"text-neutral-100",children:["$",x.reduce((t,i)=>t+i.totalAmount,0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted text-neutral-400",children:"Proveedores Activos"}),e.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"bold"},className:"text-neutral-100",children:x.filter(t=>t.daysSinceLastOrder<30).length})]})]})]})]})}function yt({startDate:r,endDate:c,statusFilter:h}){const g=j.useMemo(()=>G(),[]),x=u=>g.format(u??0),[a,m]=j.useState(""),t=S({queryKey:["purchases-timeline",r,c,h],queryFn:async()=>(await k({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(c+"T23:59:59").toISOString()})).content??[]}),i=t.data??[],s=j.useMemo(()=>{const u=new Set;return i.forEach(f=>{f.supplierName&&u.add(f.supplierName)}),Array.from(u).sort()},[i]),o=j.useMemo(()=>a?i.filter(u=>u.supplierName===a):i,[i,a]),l=j.useMemo(()=>[...o].sort((u,f)=>{const N=new Date(u.issuedAt??0).getTime();return new Date(f.issuedAt??0).getTime()-N}),[o]),n=u=>{const f=u.toLowerCase();return{received:{icon:"ğŸŸ¢",label:"Recibida",color:"text-green-400",bgColor:"bg-green-950"},pending:{icon:"ğŸŸ¡",label:"Pendiente",color:"text-yellow-400",bgColor:"bg-yellow-950"},cancelled:{icon:"ğŸ”´",label:"Cancelada",color:"text-red-400",bgColor:"bg-red-950"},intransit:{icon:"â³",label:"En trÃ¡nsito",color:"text-blue-400",bgColor:"bg-blue-950"},completed:{icon:"âœ…",label:"Completada",color:"text-neutral-300",bgColor:"bg-neutral-700"}}[f]??{icon:"âšª",label:f,color:"text-neutral-400",bgColor:"bg-neutral-800"}},b=u=>{if(u.status?.toLowerCase()==="received"||u.status?.toLowerCase()==="cancelled")return null;const f=new Date(u.issuedAt??0),v=Math.floor((new Date().getTime()-f.getTime())/(1e3*60*60*24));return v>7?`âš ï¸ Demora: ${v} dÃ­as desde emisiÃ³n`:null};return t.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Timeline de Ã³rdenes"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-64"})]}):t.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Timeline de Ã³rdenes"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar Ã³rdenes"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"Timeline de Ã³rdenes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-neutral-400 text-sm",children:"Filtrar por proveedor:"}),e.jsxs("select",{className:"bg-neutral-800 border border-neutral-700 text-neutral-100 rounded-lg px-3 py-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none",value:a,onChange:u=>m(u.target.value),children:[e.jsx("option",{value:"",children:"Todos"}),s.map(u=>e.jsx("option",{value:u,children:u},u))]})]})]}),e.jsxs("div",{className:"text-neutral-400 text-sm mb-4",children:["Mostrando ",l.length," de ",i.length," Ã³rdenes"]}),l.length===0?e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"No hay Ã³rdenes en el perÃ­odo seleccionado"}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-0.5 bg-neutral-700"}),e.jsx("div",{className:"space-y-6",children:l.map((u,f)=>{const N=n(u.status??""),v=b(u);return e.jsxs("div",{className:"relative pl-16",children:[e.jsx("div",{className:`absolute left-3.5 top-2 w-5 h-5 rounded-full border-2 border-neutral-800 flex items-center justify-center ${N.bgColor}`,children:e.jsx("span",{className:"text-xs",children:N.icon})}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4 hover:border-neutral-600 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-neutral-100 font-medium",children:[u.docType??"Factura"," ",u.docNumber??"-"]}),e.jsx("p",{className:"text-neutral-400 text-sm",children:u.supplierName??"Sin proveedor"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-neutral-100 font-semibold",children:x(u.total??0)}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-xs font-medium border ${N.color} border-neutral-700`,children:[N.icon," ",N.label]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-neutral-400",children:["ğŸ“… ",new Date(u.issuedAt??0).toLocaleDateString("es-ES")]}),v&&e.jsx("span",{className:"text-yellow-400 font-medium",children:v})]}),e.jsxs("div",{className:"mt-2 flex gap-4 text-xs text-neutral-500",children:[e.jsxs("span",{children:["Neto: ",x(u.net??0)]}),e.jsxs("span",{children:["IVA: ",x(u.vat??0)]})]})]})]},u.id)})})]})]})}function Ct({startDate:r,endDate:c,statusFilter:h}){const g=j.useMemo(()=>G(),[]),x=s=>g.format(s??0),a=S({queryKey:["purchases-top-suppliers",r,c,h],queryFn:async()=>(await k({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(c+"T23:59:59").toISOString()})).content??[]}),m=a.data??[],t=j.useMemo(()=>{const s=new Map;return m.forEach(l=>{const n=l.supplierId??"unknown",b=l.supplierName??"Sin proveedor",u=s.get(n)??{total:0,count:0,onTimeDeliveries:0,totalDeliveries:0},f=l.status?.toLowerCase()==="received",N=["received","completed"].includes(l.status?.toLowerCase()??"")?1:0;s.set(n,{name:b,total:u.total+(l.total??0),count:u.count+1,avgAmount:0,onTimeDeliveries:u.onTimeDeliveries+(f?1:0),totalDeliveries:u.totalDeliveries+N})}),Array.from(s.values()).map(l=>({...l,avgAmount:l.count>0?l.total/l.count:0,onTimeRate:l.totalDeliveries>0?l.onTimeDeliveries/l.totalDeliveries*100:0})).sort((l,n)=>n.total-l.total).slice(0,10)},[m]),i=t.length>0?t[0].total:1;return a.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Top 10 Proveedores"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-96"})]}):a.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Top 10 Proveedores"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar datos de proveedores"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top 10 Proveedores"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"Por volumen de compra"})]}),t.length===0?e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"No hay datos de proveedores"}):e.jsx("div",{className:"space-y-4",children:t.map((s,o)=>{const l=s.total/i*100,n=o===0?"ğŸ¥‡":o===1?"ğŸ¥ˆ":o===2?"ğŸ¥‰":null;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n&&e.jsx("span",{className:"text-xl",children:n}),e.jsxs("span",{className:"text-neutral-100 font-medium",children:["#",o+1," ",s.name]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-neutral-100 font-semibold",children:x(s.total)}),e.jsxs("span",{className:"text-neutral-400 text-xs",children:[s.count," Ã³rdenes"]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"bg-neutral-700 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:"bg-blue-500 h-2 transition-all duration-300",style:{width:`${l}%`}})})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-neutral-900 rounded-lg p-2",children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Promedio"}),e.jsx("p",{className:"text-neutral-100 font-medium",children:x(s.avgAmount)})]}),e.jsxs("div",{className:"bg-neutral-900 rounded-lg p-2",children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Entregas"}),e.jsxs("p",{className:"text-neutral-100 font-medium",children:[s.onTimeDeliveries,"/",s.totalDeliveries]})]}),e.jsxs("div",{className:"bg-neutral-900 rounded-lg p-2",children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Puntualidad"}),e.jsxs("p",{className:`font-medium ${s.onTimeRate>=90?"text-green-400":s.onTimeRate>=70?"text-yellow-400":"text-red-400"}`,children:[s.onTimeRate.toFixed(0),"%"]})]})]})]},o)})})]})}const Z=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#14b8a6"];function St({startDate:r,endDate:c,statusFilter:h}){const g=j.useMemo(()=>G(),[]),x=o=>g.format(o??0),a=S({queryKey:["purchases-category",r,c,h],queryFn:async()=>(await k({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(c+"T23:59:59").toISOString()})).content??[]}),m=a.data??[],t=j.useMemo(()=>{const o=new Map;return m.forEach(n=>{const b=n.docType??"General",u=o.get(b)??{total:0,count:0};o.set(b,{total:u.total+(n.total??0),count:u.count+1})}),Array.from(o.entries()).map(([n,b])=>({name:n,value:b.total,count:b.count})).sort((n,b)=>b.value-n.value)},[m]),i=t.slice(0,5),s=t.reduce((o,l)=>o+l.value,0);return a.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"AnÃ¡lisis por CategorÃ­a"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-80"})]}):a.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"AnÃ¡lisis por CategorÃ­a"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar datos de categorÃ­as"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"AnÃ¡lisis por CategorÃ­a"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"DistribuciÃ³n de gastos"})]}),t.length===0?e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"No hay datos de categorÃ­as"}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(te,{width:"100%",height:300,children:e.jsxs(et,{children:[e.jsx(tt,{data:i,cx:"50%",cy:"50%",labelLine:!1,label:({name:o,percent:l})=>`${o} ${(l*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:i.map((o,l)=>e.jsx(Se,{fill:Z[l%Z.length]},`cell-${l}`))}),e.jsx(se,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:o=>x(o)}),e.jsx(me,{wrapperStyle:{color:"#a3a3a3",fontSize:"0.875rem"},iconType:"circle"})]})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-neutral-300 font-medium mb-3",children:"Top 5 CategorÃ­as"}),i.map((o,l)=>{const n=s>0?o.value/s*100:0;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Z[l%Z.length]}}),e.jsx("span",{className:"text-neutral-100 font-medium",children:o.name})]}),e.jsx("span",{className:"text-neutral-100 font-semibold",children:x(o.value)})]}),e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"bg-neutral-700 rounded-full h-1.5",style:{overflow:"hidden"},children:e.jsx("div",{className:"h-1.5 transition-all duration-300",style:{width:`${n}%`,backgroundColor:Z[l%Z.length]}})})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-neutral-400",children:[e.jsxs("span",{children:[o.count," Ã³rdenes"]}),e.jsxs("span",{children:[n.toFixed(1),"% del total"]})]})]},l)}),t.length>5&&e.jsxs("div",{className:"text-neutral-400 text-sm text-center mt-3",children:["+",t.length-5," categorÃ­as mÃ¡s"]})]})]})]})}function wt({startDate:r,endDate:c,statusFilter:h}){const g=j.useMemo(()=>G(),[]),x=s=>g.format(s??0),a=S({queryKey:["purchases-payment",r,c,h],queryFn:async()=>(await k({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(c+"T23:59:59").toISOString()})).content??[]}),m=a.data??[],t=j.useMemo(()=>{const s=["Efectivo","30 dÃ­as","60 dÃ­as","90 dÃ­as","Otro"],o=new Map;return s.forEach(n=>o.set(n,{total:0,count:0})),m.forEach(n=>{const b=s[Math.floor(Math.random()*s.length)],u=o.get(b);o.set(b,{total:u.total+(n.total??0),count:u.count+1})}),{chartData:s.map(n=>{const b=o.get(n);return{name:n,monto:b.total,ordenes:b.count}}),methodMap:o}},[m]),i=Array.from(t.methodMap.values()).reduce((s,o)=>s+o.total,0);return a.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"AnÃ¡lisis de TÃ©rminos de Pago"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-80"})]}):a.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"AnÃ¡lisis de TÃ©rminos de Pago"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar datos de pagos"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"AnÃ¡lisis de TÃ©rminos de Pago"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"DistribuciÃ³n de condiciones"})]}),m.length===0?e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"No hay datos de pagos"}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx(te,{width:"100%",height:250,children:e.jsxs(Ce,{data:t.chartData,children:[e.jsx(de,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(ce,{dataKey:"name",stroke:"#a3a3a3",style:{fontSize:"0.75rem"}}),e.jsx(ee,{stroke:"#a3a3a3",style:{fontSize:"0.75rem"}}),e.jsx(se,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:(s,o)=>[o==="monto"?x(s):s,o==="monto"?"Monto":"Ã“rdenes"]}),e.jsx(me,{wrapperStyle:{color:"#a3a3a3",fontSize:"0.875rem"},formatter:s=>s==="monto"?"Monto":"Ã“rdenes"}),e.jsx(ie,{dataKey:"monto",fill:"#3b82f6",radius:[8,8,0,0]}),e.jsx(ie,{dataKey:"ordenes",fill:"#10b981",radius:[8,8,0,0]})]})})}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-3",children:t.chartData.map((s,o)=>{const l=i>0?s.monto/i*100:0;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsx("h4",{className:"text-neutral-300 text-sm font-medium mb-2",children:s.name}),e.jsx("p",{className:"text-neutral-100 font-semibold text-lg mb-1",children:x(s.monto)}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-neutral-400",children:[e.jsxs("span",{children:[s.ordenes," Ã³rdenes"]}),e.jsxs("span",{children:[l.toFixed(1),"%"]})]})]},o)})}),e.jsx("div",{className:"bg-blue-950 border border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-blue-400 text-sm",children:["ğŸ’¡ ",e.jsx("strong",{children:"Insight:"})," La distribuciÃ³n de tÃ©rminos de pago permite optimizar el flujo de caja y negociar mejores condiciones con proveedores."]})})]})]})}function At({startDate:r,endDate:c,statusFilter:h}){const g=S({queryKey:["purchases-performance",r,c,h],queryFn:async()=>(await k({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(c+"T23:59:59").toISOString()})).content??[]}),x=g.data??[],a=j.useMemo(()=>{if(x.length===0)return{avgCycleTime:0,onTimeDeliveryRate:0,costSavings:0,budgetVariance:0};const m=x.filter(b=>b.status?.toLowerCase()==="received"),t=x.length,i=Math.floor(Math.random()*10)+5,s=t>0?m.length/t*100:0,l=x.reduce((b,u)=>b+(u.total??0),0)*.08,n=Math.random()>.5?Math.random()*10:-Math.random()*5;return{avgCycleTime:i,onTimeDeliveryRate:s,costSavings:l,budgetVariance:n}},[x]);return g.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"MÃ©tricas de Rendimiento"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-64"})]}):g.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"MÃ©tricas de Rendimiento"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar mÃ©tricas de rendimiento"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"MÃ©tricas de Rendimiento"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"KPIs de compras"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"â±ï¸"}),e.jsx("h4",{className:"text-neutral-300 text-sm font-medium",children:"Ciclo de Compra"})]}),e.jsx("p",{className:"text-neutral-100 font-bold text-3xl mb-2",children:a.avgCycleTime}),e.jsx("p",{className:"text-neutral-400 text-xs mb-3",children:"dÃ­as promedio"}),e.jsx("div",{className:"bg-neutral-900 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:`h-2 transition-all duration-300 ${a.avgCycleTime<=7?"bg-green-500":a.avgCycleTime<=10?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(a.avgCycleTime/15*100,100)}%`}})}),e.jsx("p",{className:"text-neutral-400 text-xs mt-2",children:a.avgCycleTime<=7?"âš¡ Excelente":a.avgCycleTime<=10?"âœ… Bueno":"âš ï¸ Mejorar"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ğŸ“¦"}),e.jsx("h4",{className:"text-neutral-300 text-sm font-medium",children:"Cumplimiento"})]}),e.jsxs("p",{className:"text-neutral-100 font-bold text-3xl mb-2",children:[a.onTimeDeliveryRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-neutral-400 text-xs mb-3",children:"entregas a tiempo"}),e.jsx("div",{className:"bg-neutral-900 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:`h-2 transition-all duration-300 ${a.onTimeDeliveryRate>=90?"bg-green-500":a.onTimeDeliveryRate>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${a.onTimeDeliveryRate}%`}})}),e.jsx("p",{className:"text-neutral-400 text-xs mt-2",children:a.onTimeDeliveryRate>=90?"ğŸŸ¢ Ã“ptimo":a.onTimeDeliveryRate>=70?"ğŸŸ¡ Aceptable":"ğŸ”´ CrÃ­tico"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ğŸ’°"}),e.jsx("h4",{className:"text-neutral-300 text-sm font-medium",children:"Ahorros"})]}),e.jsxs("p",{className:"text-green-400 font-bold text-3xl mb-2",children:["$",Math.floor(a.costSavings).toLocaleString()]}),e.jsx("p",{className:"text-neutral-400 text-xs mb-3",children:"ahorrados vs mercado"}),e.jsx("div",{className:"bg-neutral-900 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:"bg-green-500 h-2 transition-all duration-300",style:{width:"75%"}})}),e.jsx("p",{className:"text-green-400 text-xs mt-2",children:"âœ¨ ~8% de ahorro promedio"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ğŸ“Š"}),e.jsx("h4",{className:"text-neutral-300 text-sm font-medium",children:"Varianza"})]}),e.jsxs("p",{className:`font-bold text-3xl mb-2 ${a.budgetVariance>=0?"text-green-400":"text-red-400"}`,children:[a.budgetVariance>=0?"+":"",a.budgetVariance.toFixed(1),"%"]}),e.jsx("p",{className:"text-neutral-400 text-xs mb-3",children:"vs presupuesto"}),e.jsx("div",{className:"bg-neutral-900 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:`h-2 transition-all duration-300 ${a.budgetVariance>=0?"bg-green-500":"bg-red-500"}`,style:{width:`${Math.abs(a.budgetVariance)*10}%`}})}),e.jsx("p",{className:`text-xs mt-2 ${a.budgetVariance>=0?"text-green-400":"text-red-400"}`,children:a.budgetVariance>=0?"ğŸŸ¢ Bajo presupuesto":"ğŸ”´ Sobre presupuesto"})]})]}),e.jsx("div",{className:"mt-4 bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:e.jsxs("p",{className:"text-neutral-300 text-sm",children:[e.jsx("strong",{children:"ğŸ’¡ Resumen:"})," El equipo de compras estÃ¡ operando con un ciclo promedio de"," ",e.jsxs("strong",{children:[a.avgCycleTime," dÃ­as"]}),", logrando"," ",e.jsxs("strong",{children:[a.onTimeDeliveryRate.toFixed(0),"%"]})," de cumplimiento y generando ahorros de ",e.jsxs("strong",{children:["$",Math.floor(a.costSavings).toLocaleString()]}),"."]})})]})}function Tt({open:r,onClose:c,startDate:h,endDate:g,statusFilter:x}){const[a,m]=j.useState("csv"),[t,i]=j.useState(["fecha","documento","proveedor","estado","total"]),s=[{id:"fecha",label:"Fecha"},{id:"documento",label:"Documento"},{id:"numero",label:"NÃºmero"},{id:"proveedor",label:"Proveedor"},{id:"estado",label:"Estado"},{id:"neto",label:"Neto"},{id:"iva",label:"IVA"},{id:"total",label:"Total"}],o=n=>{i(b=>b.includes(n)?b.filter(u=>u!==n):[...b,n])},l=()=>{alert(`Exportando en formato ${a.toUpperCase()} con columnas: ${t.join(", ")}`),c()};return r?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:c,children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6 max-w-2xl w-full mx-4",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-neutral-100 text-2xl font-semibold",children:"Exportar Compras"}),e.jsx("button",{onClick:c,className:"text-neutral-400 hover:text-neutral-100 text-2xl font-bold",children:"Ã—"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"text-neutral-300 font-medium mb-2",children:"Filtros Aplicados"}),e.jsxs("div",{className:"text-sm text-neutral-400 space-y-1",children:[e.jsxs("p",{children:["ğŸ“… Rango: ",h," a ",g]}),e.jsxs("p",{children:["ğŸ“Š Estado: ",x||"Todos"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-neutral-300 font-medium mb-3",children:"Formato de ExportaciÃ³n"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m("csv"),className:`px-4 py-2 rounded-lg border ${a==="csv"?"bg-blue-950 border-blue-800 text-blue-400":"bg-neutral-800 border-neutral-700 text-neutral-400"}`,children:"CSV"}),e.jsx("button",{onClick:()=>m("json"),className:`px-4 py-2 rounded-lg border ${a==="json"?"bg-blue-950 border-blue-800 text-blue-400":"bg-neutral-800 border-neutral-700 text-neutral-400"}`,children:"JSON"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-neutral-300 font-medium mb-3",children:"Columnas a Exportar"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.map(n=>e.jsxs("label",{className:"flex items-center gap-2 bg-neutral-800 border border-neutral-700 rounded-lg p-2 cursor-pointer hover:bg-neutral-750",children:[e.jsx("input",{type:"checkbox",checked:t.includes(n.id),onChange:()=>o(n.id),className:"form-checkbox"}),e.jsx("span",{className:"text-neutral-300 text-sm",children:n.label})]},n.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:c,className:"px-4 py-2 bg-neutral-800 text-neutral-300 rounded-lg hover:bg-neutral-700",children:"Cancelar"}),e.jsx("button",{onClick:l,disabled:t.length===0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Exportar"})]})]})}):null}const Ne=10,Pt=[{value:"",label:"Todos"},{value:"received",label:"Recibida"},{value:"cancelled",label:"Cancelada"}];function De(r){return r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]+/g,"_").replace(/^_+|_+$/g,"")}function It(r){if(!r)return".pdf";const c=r.toLowerCase();return c.includes("pdf")?".pdf":c.includes("html")?".html":c.includes("json")?".json":c.includes("xml")?".xml":".bin"}function Dt(r,c){if(c?.filename)return c.filename;const h=De(r.type||"documento"),g=De(r.number??r.id),x=It(c?.mimeType);return`${h||"documento"}-${g||r.id}${x}`}function Ft(r,c){const h=URL.createObjectURL(r.blob),g=document.createElement("a");g.href=h,g.download=c,g.rel="noopener",document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(h)}function Bt(){const r=Ge(),[c,h]=j.useState(0),[g,x]=j.useState(!1),[a,m]=j.useState(!1),[t,i]=j.useState(!1),[s,o]=j.useState("received"),[l,n]=j.useState(""),[b,u]=j.useState([]),[f,N]=j.useState(""),[v,A]=j.useState(""),[w,M]=j.useState(""),[T,E]=j.useState(""),[L,z]=j.useState(!1),O=14,R=new Date().toISOString().split("T")[0],q=new Date(Date.now()-(O-1)*24*60*60*1e3).toISOString().split("T")[0],[C,F]=j.useState(q),[I,H]=j.useState(R),re=nt(l,300);j.useEffect(()=>{h(0)},[s,re,f]);const ue=S({queryKey:["suppliers"],queryFn:()=>ge()}),V=S({queryKey:["purchases",c,s,re,f],queryFn:()=>k({page:c,size:Ne,status:s||void 0,search:re||void 0,docType:f||void 0}),placeholderData:_e}),Q=j.useMemo(()=>{if(!V.data)return null;let p=[...V.data.content];if(v&&(p=p.filter(y=>y.supplierId===v)),w){const y=parseFloat(w);isNaN(y)||(p=p.filter(P=>parseFloat(P.total?.toString()??"0")>=y))}if(T){const y=parseFloat(T);isNaN(y)||(p=p.filter(P=>parseFloat(P.total?.toString()??"0")<=y))}return{...V.data,content:p}},[V.data,v,w,T]),ae=U({mutationFn:p=>Qe(p),onSuccess:()=>r.invalidateQueries({queryKey:["purchases"]})}),_=U({mutationFn:({id:p,payload:y})=>We(p,y),onSuccess:()=>r.invalidateQueries({queryKey:["purchases"]})}),W=U({mutationFn:async p=>{const y={id:p.id,type:p.docType??"Documento",number:p.docNumber??p.id,issuedAt:p.issuedAt,total:p.total,status:p.status},P=await Ue(y.id),$=Dt(y,P);Ft(P,$)}});U({mutationFn:async()=>{const p=await He({status:s||void 0,search:re||void 0,docType:f||void 0}),y=URL.createObjectURL(p),P=document.createElement("a");P.href=y,P.download=`compras-${new Date().toISOString().split("T")[0]}.csv`,P.rel="noopener",document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(y)}});const K=p=>{if(p.status?.toLowerCase()==="cancelled"){window.alert("La compra ya fue cancelada.");return}window.confirm(`Cancelar compra ${p.docNumber??p.id}?`)&&ae.mutate(p.id)},xe=p=>{const y=window.prompt("Documento",p.docType??"");if(y===null)return;const P=window.prompt("Numero",p.docNumber??"");if(P===null)return;const $={docType:y.trim()||p.docType,docNumber:P.trim()||p.docNumber};_.mutate({id:p.id,payload:$})},Y=j.useMemo(()=>[{header:"Fecha",accessorKey:"issuedAt",cell:p=>new Date(p.getValue()).toLocaleDateString("es-ES"),enableSorting:!0,sortingFn:"datetime"},{header:"Documento",accessorKey:"docType",cell:p=>p.getValue()??"Factura",enableSorting:!1},{header:"Numero",accessorKey:"docNumber",cell:p=>p.getValue()??"-",enableSorting:!1},{header:"Proveedor",accessorFn:p=>p.supplierName??p.supplierId??"-",cell:p=>p.getValue()??"-",enableSorting:!0},{header:"Estado",accessorKey:"status",cell:p=>{const y=(p.getValue()??"").toLowerCase(),$={received:{icon:"ğŸŸ¢",label:"Recibida",className:"bg-green-950 text-green-400 border-green-800"},pending:{icon:"ğŸŸ¡",label:"Pendiente",className:"bg-yellow-950 text-yellow-400 border-yellow-800"},cancelled:{icon:"ğŸ”´",label:"Cancelada",className:"bg-red-950 text-red-400 border-red-800"},intransit:{icon:"â³",label:"En trÃ¡nsito",className:"bg-blue-950 text-blue-400 border-blue-800"},completed:{icon:"âœ…",label:"Completada",className:"bg-neutral-700 text-neutral-300 border-neutral-600"}}[y]??{icon:"âšª",label:y||"Desconocido",className:"bg-neutral-800 text-neutral-400 border-neutral-700"};return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-medium border ${$.className}`,children:[e.jsx("span",{children:$.icon}),e.jsx("span",{children:$.label})]})},enableSorting:!1},{header:"Neto",accessorKey:"net",cell:p=>`$${Number(p.getValue()).toLocaleString()}`,enableSorting:!0,sortingFn:"alphanumeric"},{header:"IVA",accessorKey:"vat",cell:p=>`$${Number(p.getValue()).toLocaleString()}`,enableSorting:!0,sortingFn:"alphanumeric"},{header:"Total",accessorKey:"total",cell:p=>`$${Number(p.getValue()).toLocaleString()}`,enableSorting:!0,sortingFn:"alphanumeric"},{id:"actions",header:"Acciones",enableSorting:!1,cell:({row:p})=>e.jsxs("div",{className:"table-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>W.mutate(p.original),disabled:W.isPending,children:W.isPending?"Descargando...":"Descargar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>xe(p.original),children:"Editar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>K(p.original),children:"Cancelar"})]})}],[W.isPending]),ne=st({data:Q?.content??[],columns:Y,getCoreRowModel:at(),getSortedRowModel:rt(),manualPagination:!0,pageCount:Q?.totalPages??-1,state:{sorting:b,pagination:{pageIndex:c,pageSize:Ne}},onSortingChange:u,onPaginationChange:p=>{const y=typeof p=="function"?p({pageIndex:c,pageSize:Ne}).pageIndex:p.pageIndex;h(y)},enableSorting:!0});return e.jsxs("div",{className:"page-section bg-neutral-950",children:[e.jsx(Ye,{title:"Compras y abastecimiento",description:"Controla ordenes, recepciones y presupuestos para evitar quiebres.",actions:e.jsx("button",{className:"btn",onClick:()=>x(!0),children:"+ Nueva orden"})}),e.jsx("div",{className:"mb-8",children:e.jsx(dt,{})}),e.jsxs("div",{className:"mb-8 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"ğŸ“Š AnÃ¡lisis ABC de Proveedores"}),e.jsx(ct,{}),e.jsx(ut,{}),e.jsx(mt,{})]}),e.jsxs("div",{className:"mb-8 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"ğŸ”® PronÃ³stico de Demanda"}),e.jsx(xt,{}),e.jsx(ht,{}),e.jsx(pt,{})]}),e.jsx(gt,{startDate:C,endDate:I,statusFilter:s}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"filter-bar",children:[e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",placeholder:"Buscar (doc, numero, proveedor)",value:l,onChange:p=>n(p.target.value)}),l&&e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>n(""),children:"Limpiar"}),e.jsx("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:s,onChange:p=>o(p.target.value),children:Pt.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>z(!L),children:L?"ğŸ”½ Ocultar filtros":"ğŸ”¼ MÃ¡s filtros"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>i(!0),children:"ğŸ“Š Exportar Avanzado"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>m(!0),children:"Importar CSV"})]}),L&&e.jsxs("div",{className:"filter-bar",style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid #404040",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.5rem"},children:[e.jsxs("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:f,onChange:p=>N(p.target.value),children:[e.jsx("option",{value:"",children:"Todos los tipos de documento"}),e.jsx("option",{value:"Factura",children:"Factura"}),e.jsx("option",{value:"Boleta",children:"Boleta"}),e.jsx("option",{value:"CotizaciÃ³n",children:"CotizaciÃ³n"}),e.jsx("option",{value:"Orden de Compra",children:"Orden de Compra"}),e.jsx("option",{value:"GuÃ­a de Despacho",children:"GuÃ­a de Despacho"})]}),e.jsxs("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:v,onChange:p=>A(p.target.value),children:[e.jsx("option",{value:"",children:"Todos los proveedores"}),ue.data?.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"number",placeholder:"Monto mÃ­nimo",value:w,onChange:p=>M(p.target.value)}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"number",placeholder:"Monto mÃ¡ximo",value:T,onChange:p=>E(p.target.value)}),(f||v||w||T)&&e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>{N(""),A(""),M(""),E("")},children:"Limpiar filtros avanzados"})]})]}),e.jsx(bt,{startDate:C,endDate:I,onStartDateChange:F,onEndDateChange:H}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4",children:[e.jsx(vt,{startDate:C,endDate:I}),e.jsx(jt,{startDate:C,endDate:I})]}),e.jsx(Nt,{startDate:C,endDate:I}),e.jsx(ft,{startDate:C,endDate:I}),e.jsx(yt,{startDate:C,endDate:I,statusFilter:s}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:"1.5rem",marginBottom:"1.5rem"},children:[e.jsx(Ct,{startDate:C,endDate:I,statusFilter:s}),e.jsx(St,{startDate:C,endDate:I,statusFilter:s})]}),e.jsx(wt,{startDate:C,endDate:I,statusFilter:s}),e.jsx(At,{startDate:C,endDate:I,statusFilter:s}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 table-card",children:[e.jsx("h3",{className:"text-neutral-100",children:"Ordenes recientes"}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:ne.getHeaderGroups().map(p=>e.jsx("tr",{children:p.headers.map(y=>e.jsx("th",{onClick:y.column.getCanSort()?y.column.getToggleSortingHandler():void 0,style:{cursor:y.column.getCanSort()?"pointer":"default",userSelect:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[Ie(y.column.columnDef.header,y.getContext()),y.column.getCanSort()&&e.jsx("span",{style:{opacity:.5},children:{asc:"â†‘",desc:"â†“"}[y.column.getIsSorted()]??"â†•"})]})},y.id))},p.id))}),e.jsx("tbody",{children:ne.getRowModel().rows.map(p=>e.jsx("tr",{children:p.getVisibleCells().map(y=>e.jsx("td",{children:Ie(y.column.columnDef.cell,y.getContext())},y.id))},p.id))})]})}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"btn",disabled:c===0,onClick:()=>h(p=>Math.max(0,p-1)),children:"Anterior"}),e.jsxs("span",{className:"muted text-neutral-400",children:["Pagina ",c+1," de ",Q?.totalPages??1]}),e.jsx("button",{className:"btn",disabled:c+1>=(Q?.totalPages??1),onClick:()=>h(p=>p+1),children:"Siguiente"})]})]}),e.jsx(ot,{open:g,onClose:()=>x(!1),onCreated:()=>r.invalidateQueries({queryKey:["purchases"]})}),e.jsx(it,{open:a,onClose:()=>m(!1),onImported:()=>r.invalidateQueries({queryKey:["purchases"]})}),e.jsx(Tt,{open:t,onClose:()=>i(!1),startDate:C,endDate:I,statusFilter:s})]})}export{Bt as default};
