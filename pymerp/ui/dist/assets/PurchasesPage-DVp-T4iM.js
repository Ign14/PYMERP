import{c as Y,j as e,E as Ke,F as Ge,k as Qe,G as We,H as ve,m as Ue,I as He,J as Ye,K as Te,L as Ae,M as E,N as Xe,u as Je,O as Ze,P as et,x as tt,Q as st,q as rt,R as at}from"./index-BtVHljoa.js";import{r as b}from"./react-D8kvZI4c.js";import{u as C}from"./useQuery-Dnian6zg.js";import{P as nt}from"./PageHeader-BlxDVWRK.js";import{M as Ee}from"./Modal-B2h9NkJO.js";import{R as re,B as De,C as ce,X as me,Y as se,T as ae,a as ue,g as de,f as Pe,L as lt,b as je,h as ot,P as it,e as dt}from"./charts-BH7DIlZU.js";import{c as W}from"./currency-HwQAg_Xa.js";import{u as ct,f as $e,a as mt,g as ut}from"./table-DbsuG4jc.js";import{u as xt}from"./useDebouncedValue-DnjRONvw.js";const pt=["Factura","Boleta","Cotizaci√≥n","Orden de Compra","Gu√≠a de Despacho"];function ht({open:r,onClose:u,onCreated:h}){const[g,p]=b.useState(""),[a,x]=b.useState(!1),[t,d]=b.useState(""),[s,i]=b.useState(""),[n,o]=b.useState("Factura"),[j,m]=b.useState(""),[f,N]=b.useState(null),[v,A]=b.useState(()=>new Date().toISOString().slice(0,16)),[D,R]=b.useState(()=>new Date().toISOString().slice(0,16)),[I,_]=b.useState([]),[P,z]=b.useState("product"),[$,q]=b.useState(""),[B,S]=b.useState(""),[L,F]=b.useState(1),[G,M]=b.useState(0),[Ne,ne]=b.useState(19),[xe,Q]=b.useState(""),[U,pe]=b.useState(""),[w,he]=b.useState(""),[H,le]=b.useState(""),[X,ge]=b.useState(!0),[V,c]=b.useState("amount"),[y,T]=b.useState(0),[O,fe]=b.useState(null),Re=C({queryKey:["products",{dialog:"purchases"}],queryFn:()=>Qe({size:200}),enabled:r}),Ie=C({queryKey:["services",{dialog:"purchases"}],queryFn:()=>We(!0),enabled:r}),Fe=C({queryKey:["suppliers",{dialog:"purchases"}],queryFn:()=>ve(),enabled:r}),ke=C({queryKey:["locations",{dialog:"purchases"}],queryFn:()=>Ue(),enabled:r}),ye=Y({mutationFn:l=>Ke(l),onSuccess:l=>{p(l.id),x(!1),d(""),i(""),Fe.refetch()}});b.useEffect(()=>{if(r){const l=new Date().toISOString().slice(0,16);A(l),R(l)}},[r]);const oe=Y({mutationFn:l=>Ge(l.payload,l.file),onSuccess:()=>{h(),Oe(),u()}}),Me=Re.data?.content??[],_e=Fe.data??[],K=b.useMemo(()=>{const l=I.reduce((Se,be)=>Se+be.qty*be.unitCost,0);let k=0;V==="percentage"?k=l*(y/100):k=y;const J=l-k,Z=X?J*.19:0,Ce=J+Z;return{subtotal:l,discountAmount:k,net:J,vat:Z,total:Ce}},[I,X,V,y]),qe=()=>{if(P==="product"&&!$||P==="service"&&!B||L<=0||G<=0)return;const l={qty:L,unitCost:G,vatRate:Ne};P==="product"?(l.productId=$,l.mfgDate=U||void 0,l.expDate=xe||void 0,l.locationId=H||void 0):l.serviceId=B,_(k=>[...k,l]),q(""),S(""),F(1),M(0),Q(""),pe(""),he(""),le("")},ze=l=>{_(k=>k.filter((J,Z)=>Z!==l))},Oe=()=>{p(""),x(!1),d(""),i(""),o("Factura"),m(""),_([]),z("product"),q(""),S(""),F(1),M(0),Q(""),le(""),ge(!0),c("amount"),T(0),fe(null),N(null)},Be=()=>{!t.trim()||!s.trim()||ye.mutate({name:t,rut:s})},Ve=l=>{if(l.preventDefault(),!g||I.length===0)return;const k={supplierId:g,docType:n,docNumber:j,issuedAt:new Date(v).toISOString(),receivedAt:D?new Date(D).toISOString():void 0,paymentTermDays:f??void 0,net:Number(K.net.toFixed(2)),vat:Number(K.vat.toFixed(2)),total:Number(K.total.toFixed(2)),items:I};oe.mutate({payload:k,file:O||void 0})};return e.jsx(Ee,{open:r,onClose:u,title:"Registrar Compra",children:e.jsxs("form",{className:"form-grid",onSubmit:Ve,children:[e.jsx("div",{style:{gridColumn:"1 / -1"},children:e.jsx("h3",{style:{marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"600"},children:"Informaci√≥n del Proveedor"})}),a?e.jsxs(e.Fragment,{children:[e.jsxs("label",{style:{gridColumn:"1 / -1"},children:[e.jsx("span",{children:"Nombre Proveedor *"}),e.jsx("input",{className:"input",value:t,onChange:l=>d(l.target.value),placeholder:"Nombre del proveedor"})]}),e.jsxs("label",{style:{gridColumn:"1 / -1"},children:[e.jsx("span",{children:"RUT *"}),e.jsx("input",{className:"input",value:s,onChange:l=>i(l.target.value),placeholder:"12.345.678-9"})]}),e.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",className:"btn",onClick:Be,disabled:ye.isPending,children:ye.isPending?"Creando...":"Crear Proveedor"}),e.jsx("button",{type:"button",className:"btn ghost",onClick:()=>{x(!1),d(""),i("")},children:"Cancelar"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("label",{style:{gridColumn:"1 / -1"},children:[e.jsx("span",{children:"Proveedor *"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("select",{className:"input",value:g,onChange:l=>p(l.target.value),required:!0,style:{flex:1},children:[e.jsx("option",{value:"",children:"Selecciona proveedor"}),_e.map(l=>e.jsxs("option",{value:l.id,children:[l.name," ",l.rut?`(${l.rut})`:""]},l.id))]}),e.jsx("button",{type:"button",className:"btn",onClick:()=>x(!0),style:{whiteSpace:"nowrap"},children:"+ Nuevo"})]})]})}),e.jsx("div",{className:"line",style:{gridColumn:"1 / -1"}}),e.jsx("div",{style:{gridColumn:"1 / -1"},children:e.jsx("h3",{style:{marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"600"},children:"Informaci√≥n del Documento"})}),e.jsxs("label",{children:[e.jsx("span",{children:"Tipo de Documento *"}),e.jsx("select",{className:"input",value:n,onChange:l=>o(l.target.value),required:!0,children:pt.map(l=>e.jsx("option",{value:l,children:l},l))})]}),e.jsxs("label",{children:[e.jsx("span",{children:"N√∫mero de Documento"}),e.jsx("input",{className:"input",value:j,onChange:l=>m(l.target.value.slice(0,35)),maxLength:35,placeholder:"Ej: OC-2025-001 o 12345"})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Fecha de Emisi√≥n *"}),e.jsx("input",{className:"input",type:"datetime-local",value:v,onChange:l=>A(l.target.value),required:!0})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Fecha de Recepci√≥n"}),e.jsx("input",{className:"input",type:"datetime-local",value:D,onChange:l=>R(l.target.value)})]}),e.jsxs("label",{children:[e.jsx("span",{children:"T√©rminos de pago (opcional)"}),e.jsxs("select",{className:"input",value:f??"",onChange:l=>N(l.target.value?Number(l.target.value):null),children:[e.jsx("option",{value:"",children:"Sin t√©rminos de pago"}),e.jsx("option",{value:"7",children:"7 d√≠as"}),e.jsx("option",{value:"15",children:"15 d√≠as"}),e.jsx("option",{value:"30",children:"30 d√≠as"}),e.jsx("option",{value:"60",children:"60 d√≠as"})]})]}),e.jsxs("label",{style:{gridColumn:"1 / -1"},children:[e.jsx("span",{children:"üìé Adjuntar Documento PDF (opcional)"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.25rem"},children:[e.jsx("input",{type:"file",accept:".pdf,application/pdf",onChange:l=>{const k=l.target.files?.[0];if(k){if(k.size>10*1024*1024){alert("El archivo es demasiado grande. M√°ximo 10MB."),l.target.value="";return}fe(k)}},style:{flex:1}}),O&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",backgroundColor:"#e3f2fd",borderRadius:"4px",fontSize:"0.85rem"},children:[e.jsxs("span",{children:["üìÑ ",O.name]}),e.jsx("button",{type:"button",className:"btn ghost",onClick:()=>fe(null),style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem"},children:"‚úï"})]})]}),e.jsx("small",{className:"muted",style:{display:"block",marginTop:"0.25rem"},children:"Formatos aceptados: PDF. Tama√±o m√°ximo: 10MB"})]}),e.jsx("div",{className:"line",style:{gridColumn:"1 / -1"}}),e.jsx("div",{style:{gridColumn:"1 / -1"},children:e.jsx("h3",{style:{marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"600"},children:"Items de Compra"})}),e.jsxs("div",{className:"item-builder",style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"0.75rem"},children:[e.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",gap:"1rem",marginBottom:"0.5rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:"itemType",value:"product",checked:P==="product",onChange:l=>z(l.target.value)}),e.jsx("span",{children:"Producto"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:"itemType",value:"service",checked:P==="service",onChange:l=>z(l.target.value)}),e.jsx("span",{children:"Servicio"})]})]}),e.jsxs("label",{style:{gridColumn:"1 / -1"},children:[e.jsx("span",{children:P==="product"?"Producto *":"Servicio *"}),P==="product"?e.jsxs("select",{className:"input",value:$,onChange:l=>q(l.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar producto"}),Me.map(l=>e.jsxs("option",{value:l.id,children:[l.name," ",l.sku?`(${l.sku})`:""]},l.id))]}):e.jsxs("select",{className:"input",value:B,onChange:l=>S(l.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar servicio"}),Ie.data?.map(l=>e.jsxs("option",{value:l.id,children:[l.code," - ",l.name]},l.id))]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Cantidad *"}),e.jsx("input",{className:"input",type:"number",min:1,value:L,onChange:l=>F(Number(l.target.value)),placeholder:"Cantidad"})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Costo unitario *"}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:0,value:G,onChange:l=>M(Number(l.target.value)),placeholder:"Costo unitario"})]}),P==="product"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{children:[e.jsx("span",{children:"Nombre del lote (opcional)"}),e.jsx("input",{className:"input",type:"text",value:w,onChange:l=>he(l.target.value),placeholder:"Ej: LOTE-2025-001"})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Ubicaci√≥n de destino"}),e.jsxs("select",{className:"input",value:H,onChange:l=>le(l.target.value),children:[e.jsx("option",{value:"",children:"Sin ubicaci√≥n"}),ke.data?.map(l=>e.jsxs("option",{value:l.id,children:[l.code," - ",l.name," (",l.type,")"]},l.id))]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Fecha de fabricaci√≥n"}),e.jsx("input",{className:"input",type:"date",value:U,onChange:l=>pe(l.target.value)})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Fecha de vencimiento"}),e.jsx("input",{className:"input",type:"date",value:xe,onChange:l=>Q(l.target.value)})]})]}),e.jsxs("button",{type:"button",className:"btn",onClick:qe,style:{gridColumn:"1 / -1"},children:["+ Agregar ",P==="product"?"Producto":"Servicio"]})]}),I.length>0&&e.jsx("div",{style:{gridColumn:"1 / -1",overflowX:"auto"},children:e.jsxs("table",{className:"table",style:{minWidth:"600px"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Item"}),e.jsx("th",{style:{textAlign:"right"},children:"Cantidad"}),e.jsx("th",{style:{textAlign:"right"},children:"Costo Unit."}),e.jsx("th",{style:{textAlign:"right"},children:"Subtotal"}),e.jsx("th",{children:"Info"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:I.map((l,k)=>{const J=l.productId?Me.find(ie=>ie.id===l.productId):null,Z=l.serviceId?Ie.data?.find(ie=>ie.id===l.serviceId):null,Ce=l.qty*l.unitCost,Se=J?.name??Z?.name??(l.productId||l.serviceId),be=l.productId?"Producto":"Servicio";return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"badge",style:{backgroundColor:l.productId?"#e3f2fd":"#fff3e0",color:l.productId?"#1976d2":"#f57c00"},children:be})}),e.jsx("td",{children:Se}),e.jsx("td",{className:"mono",style:{textAlign:"right"},children:l.qty}),e.jsxs("td",{className:"mono",style:{textAlign:"right"},children:["$",l.unitCost.toFixed(2)]}),e.jsxs("td",{className:"mono",style:{textAlign:"right",fontWeight:"600"},children:["$",Ce.toFixed(2)]}),e.jsxs("td",{className:"mono",style:{fontSize:"0.85rem",color:"#666"},children:[l.productId&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[l.locationId&&e.jsxs("span",{children:["üìç"," ",ke.data?.find(ie=>ie.id===l.locationId)?.code]}),l.mfgDate&&e.jsxs("span",{children:["üè≠ Fab: ",new Date(l.mfgDate).toLocaleDateString("es-CL")]}),l.expDate&&e.jsxs("span",{children:["‚è∞ Venc: ",new Date(l.expDate).toLocaleDateString("es-CL")]}),!l.locationId&&!l.mfgDate&&!l.expDate&&"-"]}),l.serviceId&&"-"]}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn ghost",onClick:()=>ze(k),style:{padding:"0.25rem 0.5rem"},children:"Quitar"})})]},`item-${k}`)})})]})}),e.jsx("div",{className:"line",style:{gridColumn:"1 / -1"}}),e.jsx("div",{style:{gridColumn:"1 / -1"},children:e.jsx("h3",{style:{marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"600"},children:"Descuentos e Impuestos"})}),e.jsxs("label",{style:{gridColumn:"span 1"},children:[e.jsx("span",{children:"Tipo de Descuento"}),e.jsxs("select",{className:"input",value:V,onChange:l=>c(l.target.value),children:[e.jsx("option",{value:"amount",children:"Monto Fijo ($)"}),e.jsx("option",{value:"percentage",children:"Porcentaje (%)"})]})]}),e.jsxs("label",{style:{gridColumn:"span 1"},children:[e.jsxs("span",{children:["Descuento ",V==="percentage"?"(%)":"($)"]}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:0,max:V==="percentage"?100:void 0,value:y,onChange:l=>T(Number(l.target.value)),placeholder:V==="percentage"?"0-100":"0.00"})]}),e.jsxs("label",{style:{gridColumn:"1 / -1",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:X,onChange:l=>ge(l.target.checked),style:{width:"auto"}}),e.jsx("span",{style:{fontWeight:"600"},children:"Aplicar IVA 19%"})]}),e.jsx("div",{style:{gridColumn:"1 / -1",backgroundColor:"#f8f9fa",padding:"1rem",borderRadius:"8px",marginTop:"0.5rem"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"muted small",children:"Subtotal"}),e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:"600"},children:["$",K.subtotal.toFixed(2)]})]}),K.discountAmount>0&&e.jsxs("div",{children:[e.jsx("span",{className:"muted small",children:"Descuento"}),e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:"600",color:"#dc3545"},children:["-$",K.discountAmount.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"muted small",children:"Neto"}),e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:"600"},children:["$",K.net.toFixed(2)]})]}),X&&e.jsxs("div",{children:[e.jsx("span",{className:"muted small",children:"IVA (19%)"}),e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:"600"},children:["$",K.vat.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"muted small",children:"Total"}),e.jsxs("div",{style:{fontSize:"1.3rem",fontWeight:"700",color:"#0066cc"},children:["$",K.total.toFixed(2)]})]})]})}),oe.isError&&e.jsx("p",{className:"error",style:{gridColumn:"1 / -1"},children:oe.error.message}),e.jsxs("div",{className:"buttons",style:{gridColumn:"1 / -1"},children:[e.jsx("button",{className:"btn",type:"submit",disabled:oe.isPending||I.length===0,children:oe.isPending?"Guardando...":"Registrar Compra"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:Oe,children:"Limpiar Formulario"})]})]})})}function gt({open:r,onClose:u,onImported:h}){const[g,p]=b.useState(null),[a,x]=b.useState(null),t=Y({mutationFn:n=>He(n),onSuccess:n=>{x(n),n.success&&h()},onError:n=>{window.alert(`Error al importar: ${n}`)}}),d=n=>{const o=n.target.files?.[0];if(o){if(!o.name.endsWith(".csv")){window.alert("Solo se permiten archivos CSV");return}p(o),x(null)}},s=()=>{if(!g){window.alert("Seleccione un archivo CSV");return}t.mutate(g)},i=()=>{p(null),x(null),u()};return r?e.jsx("div",{className:"modal-backdrop",onClick:i,children:e.jsxs("div",{className:"modal-card",onClick:n=>n.stopPropagation(),children:[e.jsx("h2",{children:"Importar compras desde CSV"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Archivo CSV"}),e.jsx("input",{type:"file",accept:".csv",onChange:d,disabled:t.isPending}),g&&e.jsxs("p",{className:"muted",style:{marginTop:"0.5rem"},children:["Archivo seleccionado: ",g.name," (",(g.size/1024).toFixed(2)," KB)"]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("p",{className:"muted",children:[e.jsx("strong",{children:"Formato esperado del CSV:"}),e.jsx("br",{}),"Tipo Documento, N√∫mero, Proveedor ID, Estado, Neto, IVA, Total, Fecha Emisi√≥n",e.jsx("br",{}),e.jsxs("em",{children:["Ejemplo: Factura, 12345, ","{UUID}",", Recibida, 10000, 1900, 11900, 2024-01-15 10:30:00"]})]})}),a&&e.jsxs("div",{className:`alert ${a.success?"success":"error"}`,style:{marginTop:"1rem"},children:[e.jsx("p",{children:e.jsx("strong",{children:a.success?"‚úì Importaci√≥n exitosa":"‚ö† Importaci√≥n con errores"})}),e.jsxs("p",{children:["Importadas: ",a.imported," de ",a.total," filas"]}),a.errors&&a.errors.length>0&&e.jsxs("div",{style:{marginTop:"0.5rem"},children:[e.jsx("strong",{children:"Errores:"}),e.jsx("ul",{style:{marginTop:"0.5rem",maxHeight:"200px",overflow:"auto"},children:a.errors.map((n,o)=>e.jsx("li",{children:n},o))})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn",type:"button",onClick:s,disabled:!g||t.isPending,children:t.isPending?"Importando...":"Importar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:i,disabled:t.isPending,children:a?"Cerrar":"Cancelar"})]})]})}):null}function bt(){const{data:r,isLoading:u,error:h}=C({queryKey:["purchaseKPIs"],queryFn:()=>Ye(),refetchInterval:3e5});if(u)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 animate-pulse",children:[1,2,3,4,5,6,7,8].map(t=>e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 h-32"},t))});if(h)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar KPIs de compras"})});if(!r)return null;const g=t=>`$${t.toLocaleString("es-CL",{maximumFractionDigits:0})}`,p=t=>`${t.toFixed(1)}%`,a=t=>t>0?"text-red-400":t<0?"text-green-400":"text-neutral-400",x=t=>t>0?"‚ÜóÔ∏è":t<0?"‚ÜòÔ∏è":"‚Üí";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"üì¶ KPIs Avanzados de Compras"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-900/30 to-purple-800/20 border border-purple-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-purple-400 mb-1",children:"Gasto Total"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:g(r.totalSpent)}),e.jsxs("div",{className:"text-xs text-purple-300 mt-2",children:[r.totalOrders," √≥rdenes recibidas"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-900/30 to-blue-800/20 border border-blue-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-blue-400 mb-1",children:"Promedio por Orden"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:g(r.averageOrderValue)}),e.jsxs("div",{className:"text-xs text-blue-300 mt-2",children:[r.totalQuantity.toLocaleString("es-CL")," unidades"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-900/30 to-orange-800/20 border border-orange-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-orange-400 mb-1",children:"Variaci√≥n de Gasto"}),e.jsxs("div",{className:`text-3xl font-bold ${a(r.purchaseGrowth)}`,children:[x(r.purchaseGrowth)," ",p(Math.abs(r.purchaseGrowth))]}),e.jsx("div",{className:"text-xs text-orange-300 mt-2",children:"vs per√≠odo anterior"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-900/30 to-green-800/20 border border-green-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-green-400 mb-1",children:"Costo Unitario"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:g(r.costPerUnit)}),e.jsx("div",{className:"text-xs text-green-300 mt-2",children:"Promedio por unidad"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Proveedores Activos"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:r.uniqueSuppliers}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"√ìrdenes recibidas"})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Concentraci√≥n"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:p(r.supplierConcentration)}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Top proveedor"})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Top Proveedor"}),e.jsx("div",{className:"text-lg font-semibold text-white truncate",title:r.topSupplierName,children:r.topSupplierName}),e.jsx("div",{className:"text-sm text-purple-400 mt-1",children:g(r.topSupplierSpent)})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"√ìrdenes Pendientes"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:r.pendingOrders}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:["Entrega a tiempo: ",p(r.onTimeDeliveryRate)]})]})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"An√°lisis de Gastos"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-400",children:"Gasto Total"}),e.jsx("span",{className:"text-white font-semibold",children:g(r.totalSpent)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-purple-500 h-3 rounded-full",style:{width:"100%"}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-neutral-400",children:["Gasto Top Proveedor (",r.topSupplierName,")"]}),e.jsx("span",{className:"text-purple-400 font-semibold",children:g(r.topSupplierSpent)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-purple-400 h-3 rounded-full",style:{width:`${r.supplierConcentration}%`}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-400",children:"Otros Proveedores"}),e.jsx("span",{className:"text-blue-400 font-semibold",children:g(r.totalSpent-r.topSupplierSpent)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-500 h-3 rounded-full",style:{width:`${100-r.supplierConcentration}%`}})}),r.supplierConcentration>50&&e.jsx("div",{className:"bg-yellow-900/20 border border-yellow-800 rounded-lg p-3 mt-4",children:e.jsxs("p",{className:"text-sm text-yellow-400",children:["‚ö†Ô∏è Alta concentraci√≥n en un proveedor (",p(r.supplierConcentration),"). Considere diversificar para reducir riesgo de dependencia."]})})]})]}),e.jsx("div",{className:"bg-purple-900/20 border border-purple-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-purple-400",children:["üìÖ Per√≠odo de an√°lisis: ",new Date(r.periodStart).toLocaleDateString("es-CL")," -"," ",new Date(r.periodEnd).toLocaleDateString("es-CL")]}),e.jsx("span",{className:"text-xs text-purple-300",children:"Actualizado autom√°ticamente cada 5 minutos"})]})})]})}function jt(){const{data:r,isLoading:u}=C({queryKey:["purchaseABCAnalysis"],queryFn:()=>Te(),refetchInterval:3e5});if(u)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 h-96 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-full bg-neutral-800 rounded"})]});if(!r||r.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"üìä Distribuci√≥n ABC de Proveedores"}),e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"No hay datos suficientes para an√°lisis ABC"})]});const h=r.reduce((x,t)=>{const d=t.classification;return x[d].count++,x[d].totalSpent+=t.totalSpent,x[d].percentage+=t.percentageOfTotal,x},{A:{count:0,totalSpent:0,percentage:0},B:{count:0,totalSpent:0,percentage:0},C:{count:0,totalSpent:0,percentage:0}}),g=[{name:"Clase A (Cr√≠ticos)",proveedores:h.A.count,gasto:h.A.totalSpent,porcentaje:h.A.percentage},{name:"Clase B (Importantes)",proveedores:h.B.count,gasto:h.B.totalSpent,porcentaje:h.B.percentage},{name:"Clase C (Ocasionales)",proveedores:h.C.count,gasto:h.C.totalSpent,porcentaje:h.C.percentage}],p={A:"#ef4444",B:"#f59e0b",C:"#10b981"},a=x=>`$${x.toLocaleString("es-CL",{maximumFractionDigits:0})}`;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"üìä Distribuci√≥n ABC de Proveedores (Pareto 80-15-5)"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-red-900/30 to-red-800/20 border border-red-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-400 mb-1",children:"Clase A - Cr√≠ticos"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[h.A.count," proveedores"]}),e.jsxs("div",{className:"text-xs text-red-300 mt-2",children:[h.A.percentage.toFixed(1),"% del gasto total"]}),e.jsx("div",{className:"text-sm text-red-200 mt-1",children:a(h.A.totalSpent)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-900/30 to-amber-800/20 border border-amber-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-amber-400 mb-1",children:"Clase B - Importantes"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[h.B.count," proveedores"]}),e.jsxs("div",{className:"text-xs text-amber-300 mt-2",children:[h.B.percentage.toFixed(1),"% del gasto total"]}),e.jsx("div",{className:"text-sm text-amber-200 mt-1",children:a(h.B.totalSpent)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-900/30 to-green-800/20 border border-green-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-400 mb-1",children:"Clase C - Ocasionales"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[h.C.count," proveedores"]}),e.jsxs("div",{className:"text-xs text-green-300 mt-2",children:[h.C.percentage.toFixed(1),"% del gasto total"]}),e.jsx("div",{className:"text-sm text-green-200 mt-1",children:a(h.C.totalSpent)})]})]}),e.jsx(re,{width:"100%",height:300,children:e.jsxs(De,{data:g,children:[e.jsx(ce,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(me,{dataKey:"name",stroke:"#a3a3a3",tick:{fill:"#a3a3a3"}}),e.jsx(se,{stroke:"#a3a3a3",tick:{fill:"#a3a3a3"},tickFormatter:x=>a(x)}),e.jsx(ae,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#fff"},formatter:(x,t)=>t==="gasto"?a(x):t==="porcentaje"?`${x.toFixed(1)}%`:x}),e.jsx(ue,{wrapperStyle:{color:"#a3a3a3"}}),e.jsx(de,{dataKey:"gasto",fill:"#8884d8",name:"Gasto Total",children:g.map((x,t)=>{const d=x.name.includes("A")?"A":x.name.includes("B")?"B":"C";return e.jsx(Pe,{fill:p[d]},`cell-${t}`)})})]})}),e.jsx("div",{className:"mt-4 bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-300",children:["üí° ",e.jsx("strong",{children:"An√°lisis Pareto (80-15-5):"})," Clase A representa ~80% del gasto (pocos proveedores clave), Clase B ~15% (proveedores moderados), y Clase C ~5% (muchos proveedores ocasionales)."]})})]})}function vt(){const{data:r,isLoading:u}=C({queryKey:["purchaseABCAnalysis"],queryFn:()=>Te(),refetchInterval:3e5});if(u)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(p=>e.jsx("div",{className:"h-16 bg-neutral-800 rounded"},p))})]});if(!r||r.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"üìã Detalle de Proveedores por Clasificaci√≥n"}),e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"No hay proveedores para clasificar"})]});const h=p=>`$${p.toLocaleString("es-CL",{maximumFractionDigits:0})}`,g=p=>{const a={A:"bg-red-900/30 text-red-400 border-red-800",B:"bg-amber-900/30 text-amber-400 border-amber-800",C:"bg-green-900/30 text-green-400 border-green-800"};return a[p]||a.C};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"üìã Detalle de Proveedores por Clasificaci√≥n ABC"}),e.jsxs("span",{className:"text-sm text-neutral-400",children:[r.length," proveedores"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-neutral-400",children:"Clase"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-neutral-400",children:"Proveedor"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Gasto Total"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-neutral-400",children:"Compras"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"% del Total"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Acumulado"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-neutral-400",children:"Acci√≥n Recomendada"})]})}),e.jsx("tbody",{children:r.map((p,a)=>e.jsxs("tr",{className:`border-b border-neutral-800 hover:bg-neutral-800/50 transition-colors ${a<10?"":"opacity-60"}`,children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 rounded text-xs font-bold border ${g(p.classification)}`,children:p.classification})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"text-white font-medium",children:p.supplierName}),e.jsxs("div",{className:"text-xs text-neutral-500",children:["Promedio: ",h(p.averageOrderValue)]})]}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:"text-white font-semibold",children:h(p.totalSpent)})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:"text-neutral-300",children:p.purchaseCount})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-blue-400 font-medium",children:[p.percentageOfTotal.toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-neutral-400",children:[p.cumulativePercentage.toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"text-xs text-neutral-400",children:p.recommendedAction})})]},p.supplierId))})]})}),r.length>10&&e.jsxs("div",{className:"mt-4 text-center text-sm text-neutral-500",children:["Mostrando todos los ",r.length," proveedores (primeros 10 resaltados)"]})]})}function Nt(){const{data:r}=C({queryKey:["purchaseABCAnalysis"],queryFn:()=>Te(),refetchInterval:3e5});if(!r||r.length===0)return null;const u=r.filter(t=>t.classification==="A"),h=r.filter(t=>t.classification==="B"),g=r.filter(t=>t.classification==="C"),p=r.reduce((t,d)=>t+d.totalSpent,0),a=u.reduce((t,d)=>t+d.totalSpent,0),x=p>0?a/p*100:0;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"üí° Insights y Estrategias por Clasificaci√≥n"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-red-900/20 to-red-800/10 border border-red-800 rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"üî¥"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-400 font-semibold",children:"Clase A - Proveedores Cr√≠ticos"}),e.jsxs("p",{className:"text-xs text-red-300",children:[u.length," proveedores ¬∑ ",x.toFixed(1),"% del gasto"]})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-200 font-medium mb-2",children:"üéØ Estrategia:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"‚Ä¢ Negociar contratos a largo plazo"}),e.jsx("li",{children:"‚Ä¢ Reuniones trimestrales de revisi√≥n"}),e.jsx("li",{children:"‚Ä¢ Planes de contingencia definidos"}),e.jsx("li",{children:"‚Ä¢ Monitoreo continuo de desempe√±o"})]})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-200 font-medium mb-2",children:"‚ö†Ô∏è Riesgos:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"‚Ä¢ Alta dependencia de pocos proveedores"}),e.jsx("li",{children:"‚Ä¢ Impacto severo si hay problemas"}),e.jsx("li",{children:"‚Ä¢ Poder de negociaci√≥n limitado"})]})]}),e.jsx("div",{className:"bg-amber-900/20 border border-amber-700 rounded p-2",children:e.jsxs("p",{className:"text-amber-200 text-xs",children:["‚ö° ",e.jsx("strong",{children:"Acci√≥n urgente:"})," Desarrollar proveedores alternativos para reducir riesgo"]})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-900/20 to-amber-800/10 border border-amber-800 rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"üü°"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-amber-400 font-semibold",children:"Clase B - Proveedores Importantes"}),e.jsxs("p",{className:"text-xs text-amber-300",children:[h.length," proveedores ¬∑ Equilibrio ideal"]})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-amber-200 font-medium mb-2",children:"üéØ Estrategia:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"‚Ä¢ Revisi√≥n semestral de contratos"}),e.jsx("li",{children:"‚Ä¢ Evaluar promoci√≥n a Clase A"}),e.jsx("li",{children:"‚Ä¢ Buscar alternativas competitivas"}),e.jsx("li",{children:"‚Ä¢ Optimizar costos y condiciones"})]})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-amber-200 font-medium mb-2",children:"üìä Oportunidades:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"‚Ä¢ Consolidar compras para mejores precios"}),e.jsx("li",{children:"‚Ä¢ Negociar descuentos por volumen"}),e.jsx("li",{children:"‚Ä¢ Explorar servicios adicionales"})]})]}),e.jsx("div",{className:"bg-blue-900/20 border border-blue-700 rounded p-2",children:e.jsxs("p",{className:"text-blue-200 text-xs",children:["üíº ",e.jsx("strong",{children:"Recomendaci√≥n:"})," Mantener relaci√≥n activa y evaluar potencial de crecimiento"]})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-900/20 to-green-800/10 border border-green-800 rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"üü¢"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-green-400 font-semibold",children:"Clase C - Proveedores Ocasionales"}),e.jsxs("p",{className:"text-xs text-green-300",children:[g.length," proveedores ¬∑ Bajo impacto individual"]})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-green-200 font-medium mb-2",children:"üéØ Estrategia:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"‚Ä¢ Consolidar compras similares"}),e.jsx("li",{children:"‚Ä¢ Evaluar eliminaci√≥n de proveedores"}),e.jsx("li",{children:"‚Ä¢ Automatizar procesos de compra"}),e.jsx("li",{children:"‚Ä¢ Reducir carga administrativa"})]})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-green-200 font-medium mb-2",children:"‚ö° Optimizaci√≥n:"}),e.jsxs("ul",{className:"text-neutral-300 space-y-1 text-xs",children:[e.jsx("li",{children:"‚Ä¢ Agrupar con proveedores Clase B"}),e.jsx("li",{children:"‚Ä¢ Compras espor√°dicas bajo demanda"}),e.jsx("li",{children:"‚Ä¢ Minimizar costos de gesti√≥n"})]})]}),e.jsx("div",{className:"bg-purple-900/20 border border-purple-700 rounded p-2",children:e.jsxs("p",{className:"text-purple-200 text-xs",children:["üîÑ ",e.jsx("strong",{children:"Acci√≥n:"})," Revisar anualmente y considerar consolidaci√≥n con otros proveedores"]})})]})]})]}),e.jsxs("div",{className:"mt-6 bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-800 rounded-lg p-5",children:[e.jsxs("h4",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[e.jsx("span",{children:"üìà"})," Resumen del An√°lisis ABC"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Distribuci√≥n de Proveedores"}),e.jsxs("p",{className:"text-white",children:[e.jsx("span",{className:"text-red-400 font-bold",children:u.length})," A ¬∑"," ",e.jsx("span",{className:"text-amber-400 font-bold",children:h.length})," B ¬∑"," ",e.jsx("span",{className:"text-green-400 font-bold",children:g.length})," C"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Principio de Pareto"}),e.jsx("p",{className:"text-white",children:u.length>0?e.jsxs(e.Fragment,{children:["~",(u.length/r.length*100).toFixed(0),"% de proveedores genera ~",x.toFixed(0),"% del gasto"]}):"Distribuci√≥n equilibrada"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Recomendaci√≥n Principal"}),e.jsx("p",{className:"text-blue-300",children:x>85?"‚ö†Ô∏è Reducir dependencia de Clase A":g.length>u.length*3?"üîÑ Consolidar proveedores Clase C":"‚úÖ Distribuci√≥n saludable"})]})]})]})]})}function ft(){const{data:r,isLoading:u}=C({queryKey:["purchaseSupplierForecast"],queryFn:()=>Ae(),refetchInterval:3e5});if(u)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 h-96 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-full bg-neutral-800 rounded"})]});if(!r||r.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"üìà Pron√≥stico de Gastos por Proveedor"}),e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"No hay datos suficientes para generar pron√≥sticos"})]});const h=r.slice(0,5),g=h.map(t=>({nombre:t.supplierName.length>20?t.supplierName.substring(0,20)+"...":t.supplierName,historico:t.historicalAverage,pronostico:t.forecastedSpending,confianza:t.confidence})),p=t=>`$${t.toLocaleString("es-CL",{maximumFractionDigits:0})}`,a=t=>t==="increasing"?"‚ÜóÔ∏è":t==="decreasing"?"‚ÜòÔ∏è":"‚Üí",x=t=>t==="increasing"?"text-red-400":t==="decreasing"?"text-green-400":"text-neutral-400";return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"üìà Pron√≥stico de Gastos (Top 5 Proveedores)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 mb-6",children:h.map((t,d)=>e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"text-xs text-neutral-400 mb-1",children:["#",d+1," - ",t.supplierName]}),e.jsx("div",{className:"text-xl font-bold text-white mb-1",children:p(t.forecastedSpending)}),e.jsxs("div",{className:`text-sm font-medium ${x(t.trend)}`,children:[a(t.trend)," ",t.trend]}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-2",children:["Confianza: ",t.confidence.toFixed(0),"%"]})]},t.supplierId))}),e.jsx(re,{width:"100%",height:350,children:e.jsxs(lt,{data:g,children:[e.jsx(ce,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(me,{dataKey:"nombre",stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:12}}),e.jsx(se,{stroke:"#a3a3a3",tick:{fill:"#a3a3a3"},tickFormatter:t=>p(t)}),e.jsx(ae,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#fff"},formatter:(t,d)=>d==="confianza"?`${t.toFixed(0)}%`:p(t)}),e.jsx(ue,{wrapperStyle:{color:"#a3a3a3"}}),e.jsx(je,{type:"monotone",dataKey:"historico",stroke:"#3b82f6",strokeWidth:2,name:"Promedio Hist√≥rico",dot:{fill:"#3b82f6",r:5}}),e.jsx(je,{type:"monotone",dataKey:"pronostico",stroke:"#f59e0b",strokeWidth:2,strokeDasharray:"5 5",name:"Pron√≥stico Pr√≥ximo Mes",dot:{fill:"#f59e0b",r:5}})]})}),e.jsx("div",{className:"mt-4 bg-purple-900/20 border border-purple-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-purple-300",children:["üí° ",e.jsx("strong",{children:"Algoritmo de Pron√≥stico:"})," Usa media m√≥vil de los √∫ltimos 90 d√≠as y an√°lisis de tendencia (comparando primera vs segunda mitad del per√≠odo) para predecir gastos del pr√≥ximo mes."]})})]})}function yt(){const{data:r,isLoading:u}=C({queryKey:["purchaseSupplierForecast"],queryFn:()=>Ae(),refetchInterval:3e5});if(u)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(a=>e.jsx("div",{className:"h-16 bg-neutral-800 rounded"},a))})]});if(!r||r.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"üìä Tabla de Pron√≥sticos Detallada"}),e.jsx("p",{className:"text-neutral-400 text-center py-8",children:"No hay pron√≥sticos disponibles"})]});const h=a=>`$${a.toLocaleString("es-CL",{maximumFractionDigits:0})}`,g=a=>{const x={increasing:"bg-red-900/30 text-red-400 border-red-800",stable:"bg-neutral-800 text-neutral-400 border-neutral-700",decreasing:"bg-green-900/30 text-green-400 border-green-800"},t={increasing:"‚ÜóÔ∏è Creciente",stable:"‚Üí Estable",decreasing:"‚ÜòÔ∏è Decreciente"};return{style:x[a]||x.stable,label:t[a]||a}},p=a=>a>=80?"text-green-400":a>=60?"text-amber-400":"text-red-400";return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"üìä Pron√≥sticos Detallados por Proveedor"}),e.jsxs("span",{className:"text-sm text-neutral-400",children:[r.length," proveedores analizados"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-neutral-400",children:"Proveedor"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Promedio Hist√≥rico"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Pron√≥stico"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-neutral-400",children:"Tendencia"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-neutral-400",children:"Confianza"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-neutral-400",children:"Pr√≥xima Compra"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-neutral-400",children:"Cantidad Sugerida"})]})}),e.jsx("tbody",{children:r.map((a,x)=>{const t=g(a.trend),d=a.historicalAverage>0?(a.forecastedSpending-a.historicalAverage)/a.historicalAverage*100:0;return e.jsxs("tr",{className:`border-b border-neutral-800 hover:bg-neutral-800/50 transition-colors ${x>=10?"opacity-60":""}`,children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"text-white font-medium",children:a.supplierName}),e.jsxs("div",{className:"text-xs text-neutral-500",children:["ID: ",a.supplierId.substring(0,8)]})]}),e.jsxs("td",{className:"py-3 px-4 text-right",children:[e.jsx("span",{className:"text-neutral-300",children:h(a.historicalAverage)}),e.jsx("div",{className:"text-xs text-neutral-500",children:"por mes"})]}),e.jsxs("td",{className:"py-3 px-4 text-right",children:[e.jsx("span",{className:"text-white font-semibold",children:h(a.forecastedSpending)}),e.jsxs("div",{className:`text-xs ${d>=0?"text-red-400":"text-green-400"}`,children:[d>=0?"+":"",d.toFixed(1),"%"]})]}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:`inline-flex px-2 py-1 rounded text-xs font-medium border ${t.style}`,children:t.label})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("span",{className:`font-bold ${p(a.confidence)}`,children:[a.confidence.toFixed(0),"%"]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:"text-neutral-300 text-sm",children:new Date(a.nextPurchaseDate).toLocaleDateString("es-CL")})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-blue-400 font-medium",children:[a.recommendedOrderQuantity.toFixed(2)," un."]})})]},a.supplierId)})})]})}),r.length>10&&e.jsxs("div",{className:"mt-4 text-center text-sm text-neutral-500",children:["Mostrando todos los ",r.length," proveedores (primeros 10 resaltados)"]})]})}function Ct(){const{data:r}=C({queryKey:["purchaseSupplierForecast"],queryFn:()=>Ae(),refetchInterval:3e5});if(!r||r.length===0)return null;const u=r.reduce((s,i)=>s+i.forecastedSpending,0),h=r.reduce((s,i)=>s+i.historicalAverage,0),g=h>0?(u-h)/h*100:0,p=r.filter(s=>s.trend==="increasing"),a=r.filter(s=>s.trend==="decreasing"),x=r.filter(s=>s.confidence<60),t=r.filter(s=>s.forecastedSpending>u/r.length*2),d=s=>`$${s.toLocaleString("es-CL",{maximumFractionDigits:0})}`;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"üîç Insights y Alertas del Pron√≥stico"}),e.jsx("div",{className:"bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-800 rounded-lg p-5 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 text-sm mb-1",children:"Gasto Hist√≥rico Mensual"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:d(h)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 text-sm mb-1",children:"Pron√≥stico Pr√≥ximo Mes"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:d(u)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 text-sm mb-1",children:"Variaci√≥n Esperada"}),e.jsxs("p",{className:`text-2xl font-bold ${g>=0?"text-red-400":"text-green-400"}`,children:[g>=0?"+":"",g.toFixed(1),"%"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[p.length>0&&e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"‚ö†Ô∏è"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-400 font-semibold",children:"Proveedores con Tendencia Creciente"}),e.jsxs("p",{className:"text-xs text-red-300",children:[p.length," proveedores"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[p.slice(0,3).map(s=>{const i=s.historicalAverage>0?(s.forecastedSpending-s.historicalAverage)/s.historicalAverage*100:0;return e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-red-200",children:s.supplierName.substring(0,25)}),e.jsxs("span",{className:"text-red-400 font-bold",children:["+",i.toFixed(0),"%"]})]},s.supplierId)}),p.length>3&&e.jsxs("p",{className:"text-xs text-red-300 mt-2",children:["Y ",p.length-3," m√°s..."]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-red-800",children:e.jsxs("p",{className:"text-xs text-red-200",children:["üí° ",e.jsx("strong",{children:"Acci√≥n:"})," Revisar contratos y negociar mejores condiciones antes del aumento"]})})]}),x.length>0&&e.jsxs("div",{className:"bg-amber-900/20 border border-amber-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"‚ö°"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-amber-400 font-semibold",children:"Pron√≥sticos de Baja Confianza"}),e.jsxs("p",{className:"text-xs text-amber-300",children:[x.length," proveedores"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[x.slice(0,3).map(s=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-amber-200",children:s.supplierName.substring(0,25)}),e.jsxs("span",{className:"text-amber-400 font-bold",children:[s.confidence.toFixed(0),"%"]})]},s.supplierId)),x.length>3&&e.jsxs("p",{className:"text-xs text-amber-300 mt-2",children:["Y ",x.length-3," m√°s..."]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-amber-800",children:e.jsxs("p",{className:"text-xs text-amber-200",children:["üí° ",e.jsx("strong",{children:"Raz√≥n:"})," Pocos datos hist√≥ricos. Aumentar frecuencia de compras para mejorar predicci√≥n"]})})]}),a.length>0&&e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"‚úÖ"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-green-400 font-semibold",children:"Proveedores con Tendencia Decreciente"}),e.jsxs("p",{className:"text-xs text-green-300",children:[a.length," proveedores"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[a.slice(0,3).map(s=>{const i=s.historicalAverage>0?(s.forecastedSpending-s.historicalAverage)/s.historicalAverage*100:0;return e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-green-200",children:s.supplierName.substring(0,25)}),e.jsxs("span",{className:"text-green-400 font-bold",children:[i.toFixed(0),"%"]})]},s.supplierId)}),a.length>3&&e.jsxs("p",{className:"text-xs text-green-300 mt-2",children:["Y ",a.length-3," m√°s..."]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-green-800",children:e.jsxs("p",{className:"text-xs text-green-200",children:["üí° ",e.jsx("strong",{children:"Oportunidad:"})," Optimizaci√≥n exitosa o reducci√≥n de demanda. Evaluar causas"]})})]}),t.length>0&&e.jsxs("div",{className:"bg-purple-900/20 border border-purple-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"üí∞"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-purple-400 font-semibold",children:"Proveedores de Alto Gasto"}),e.jsxs("p",{className:"text-xs text-purple-300",children:[t.length," proveedores"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[t.slice(0,3).map(s=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-purple-200",children:s.supplierName.substring(0,25)}),e.jsx("span",{className:"text-purple-400 font-bold",children:d(s.forecastedSpending)})]},s.supplierId)),t.length>3&&e.jsxs("p",{className:"text-xs text-purple-300 mt-2",children:["Y ",t.length-3," m√°s..."]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-purple-800",children:e.jsxs("p",{className:"text-xs text-purple-200",children:["üí° ",e.jsx("strong",{children:"Recomendaci√≥n:"})," Negociar descuentos por volumen o contratos anuales"]})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-900/30 to-blue-800/20 border border-blue-800 rounded-lg p-5",children:[e.jsxs("h4",{className:"text-white font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"üìã"})," Recomendaciones Estrat√©gicas"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-2",children:"üéØ Planificaci√≥n de Flujo de Caja"}),e.jsxs("p",{className:"text-neutral-300",children:["Bas√°ndose en el pron√≥stico total de ",d(u),", aseg√∫rese de tener liquidez suficiente para el pr√≥ximo mes."]})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-2",children:"üìä Optimizaci√≥n de Inventario"}),e.jsx("p",{className:"text-neutral-300",children:"Use las cantidades sugeridas como base para evitar sobre-stock o quiebres de inventario."})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-2",children:"‚è∞ Programaci√≥n de Compras"}),e.jsx("p",{className:"text-neutral-300",children:"Revise las fechas estimadas de pr√≥xima compra para planificar pedidos con anticipaci√≥n."})]}),e.jsxs("div",{className:"bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-blue-300 font-medium mb-2",children:"üîÑ Actualizaci√≥n Continua"}),e.jsx("p",{className:"text-neutral-300",children:"Los pron√≥sticos se actualizan cada 5 minutos. Revise regularmente para decisiones informadas."})]})]})]})]})}function St({startDate:r,endDate:u,statusFilter:h}){const g=b.useMemo(()=>W(),[]),p=o=>g.format(o??0),a=b.useMemo(()=>{const o=new Date(r),j=new Date(u),m=Math.abs(j.getTime()-o.getTime());return Math.ceil(m/(1e3*60*60*24))+1},[r,u]),x=b.useMemo(()=>{const o=new Date(r),j=new Date(o);j.setDate(j.getDate()-1);const m=new Date(j);return m.setDate(m.getDate()-a+1),{start:m.toISOString().split("T")[0],end:j.toISOString().split("T")[0]}},[r,a]),t=C({queryKey:["purchases-stats",r,u,h],queryFn:async()=>(await E({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(u+"T23:59:59").toISOString()})).content??[]}),d=C({queryKey:["purchases-stats-previous",x.start,x.end,h],queryFn:async()=>(await E({page:0,size:1e4,status:h||void 0,from:new Date(x.start+"T00:00:00").toISOString(),to:new Date(x.end+"T23:59:59").toISOString()})).content??[]}),s=t.data??[],i=d.data??[],n=b.useMemo(()=>{const o=s.reduce((S,L)=>S+(L.total??0),0),j=s.filter(S=>S.status?.toLowerCase()==="received"),m=s.filter(S=>S.status?.toLowerCase()==="cancelled"),f=s.filter(S=>S.status?.toLowerCase()!=="received"&&S.status?.toLowerCase()!=="cancelled"),N=a>0?o/a:0,v=i.reduce((S,L)=>S+(L.total??0),0),A=i.length,D=a>0?v/a:0,R=i.filter(S=>S.status?.toLowerCase()==="received").length,I=v>0?(o-v)/v*100:0,_=A>0?(s.length-A)/A*100:0,P=D>0?(N-D)/D*100:0,z=R>0?(j.length-R)/R*100:0,$=new Map;s.forEach(S=>{const L=S.supplierId??"unknown",F=S.supplierName??"Sin proveedor",G=$.get(L)??{total:0,count:0};$.set(L,{name:F,total:G.total+(S.total??0),count:G.count+1})});const q=Array.from($.values()).sort((S,L)=>L.total-S.total).slice(0,5),B=[];return I>20&&B.push({type:"warning",message:"Gasto aument√≥ >20%"}),m.length>s.length*.1&&B.push({type:"error",message:"Alta tasa de cancelaci√≥n"}),f.length>j.length&&B.push({type:"info",message:"Muchas √≥rdenes pendientes"}),{total:o,count:s.length,dailyAverage:N,received:j.length,cancelled:m.length,pending:f.length,topSuppliers:q,totalVariation:I,countVariation:_,dailyVariation:P,receivedVariation:z,alerts:B}},[s,i,a]);return t.isLoading||d.isLoading?e.jsx("section",{className:"dashboard-overview",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",style:{marginBottom:"1.5rem"},children:[e.jsx("header",{className:"card-header",children:e.jsx("h2",{className:"text-neutral-100",children:"Resumen de compras"})}),e.jsxs("div",{className:"kpi-grid",style:{marginBottom:"1.5rem"},children:[e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"})]})]})}):t.isError||d.isError?e.jsx("section",{className:"dashboard-overview",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",style:{marginBottom:"1.5rem"},children:[e.jsx("header",{className:"card-header",children:e.jsx("h2",{className:"text-neutral-100",children:"Resumen de compras"})}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar m√©tricas de compras"})})]})}):e.jsx("section",{className:"dashboard-overview",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",style:{marginBottom:"1.5rem"},children:[e.jsx("header",{className:"card-header",style:{marginBottom:"1rem"},children:e.jsx("h2",{className:"text-neutral-100",children:"Resumen de compras"})}),n.alerts.length>0&&e.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:n.alerts.map((o,j)=>e.jsxs("div",{className:`rounded-lg p-3 border ${o.type==="error"?"bg-red-950 border-red-800 text-red-400":o.type==="warning"?"bg-yellow-950 border-yellow-800 text-yellow-400":"bg-blue-950 border-blue-800 text-blue-400"}`,style:{fontSize:"0.875rem"},children:[e.jsx("span",{children:o.type==="error"?"üî¥":o.type==="warning"?"üü°":"‚ÑπÔ∏è"})," ",o.message]},j))}),e.jsxs("div",{className:"kpi-grid",style:{marginBottom:"1.5rem"},children:[e.jsxs("article",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 stat",children:[e.jsx("h3",{className:"text-neutral-100",children:"Gasto acumulado"}),e.jsx("p",{className:"stat-value text-neutral-100",children:p(n.total)}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${n.totalVariation>0?"bg-red-950 text-red-400 border-red-800":n.totalVariation<0?"bg-green-950 text-green-400 border-green-800":"bg-neutral-800 text-neutral-400 border-neutral-700"}`,children:[n.totalVariation>0?"‚Üë":n.totalVariation<0?"‚Üì":"‚àí"," ",Math.abs(n.totalVariation).toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400 text-xs",children:"vs per√≠odo anterior"})]}),e.jsxs("span",{className:"muted small text-neutral-400",style:{display:"block",marginTop:"0.5rem"},children:[n.count," √≥rdenes registradas"]})]}),e.jsxs("article",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 stat",children:[e.jsx("h3",{className:"text-neutral-100",children:"Promedio diario"}),e.jsx("p",{className:"stat-value text-neutral-100",children:p(n.dailyAverage)}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${n.dailyVariation>0?"bg-red-950 text-red-400 border-red-800":n.dailyVariation<0?"bg-green-950 text-green-400 border-green-800":"bg-neutral-800 text-neutral-400 border-neutral-700"}`,children:[n.dailyVariation>0?"‚Üë":n.dailyVariation<0?"‚Üì":"‚àí"," ",Math.abs(n.dailyVariation).toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400 text-xs",children:"vs per√≠odo anterior"})]})]}),e.jsxs("article",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 stat",children:[e.jsx("h3",{className:"text-neutral-100",children:"√ìrdenes recibidas"}),e.jsx("p",{className:"stat-value stat-success text-neutral-100",children:n.received}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${n.receivedVariation>0?"bg-green-950 text-green-400 border-green-800":n.receivedVariation<0?"bg-red-950 text-red-400 border-red-800":"bg-neutral-800 text-neutral-400 border-neutral-700"}`,children:[n.receivedVariation>0?"‚Üë":n.receivedVariation<0?"‚Üì":"‚àí"," ",Math.abs(n.receivedVariation).toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400 text-xs",children:"vs per√≠odo anterior"})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"0.5rem",fontSize:"0.875rem"},children:[e.jsxs("span",{className:"muted text-neutral-400",children:["‚è≥ Pendientes: ",n.pending]}),e.jsxs("span",{className:"muted text-neutral-400",children:["üî¥ Canceladas: ",n.cancelled]})]})]}),e.jsxs("article",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 stat",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top proveedores"}),e.jsx("div",{style:{marginTop:"0.5rem"},children:n.topSuppliers.length>0?e.jsx("div",{style:{fontSize:"0.875rem"},children:n.topSuppliers.slice(0,3).map((o,j)=>e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsxs("span",{className:"text-neutral-400",children:[j===0?"ü•á":j===1?"ü•à":"ü•â"," ",o.name]}),e.jsx("span",{style:{fontWeight:600},className:"text-neutral-100",children:p(o.total)})]}),e.jsx("div",{className:"bg-neutral-800 rounded-full h-1.5",style:{overflow:"hidden"},children:e.jsx("div",{className:"bg-blue-500 h-1.5",style:{width:`${o.total/n.topSuppliers[0].total*100}%`,transition:"width 0.3s ease"}})})]},j))}):e.jsx("span",{className:"muted small text-neutral-400",children:"No hay datos"})})]})]})]})})}function wt({startDate:r,endDate:u,onStartDateChange:h,onEndDateChange:g}){const p=new Date().toISOString().split("T")[0],a=b.useMemo(()=>W(),[]),x=m=>a.format(m??0),t=b.useMemo(()=>{const m=new Date(r),f=new Date(u),N=Math.abs(f.getTime()-m.getTime());return Math.ceil(N/(1e3*60*60*24))+1},[r,u]),d=C({queryKey:["purchases","daily",t],queryFn:()=>Xe(t),enabled:t>0&&t<=365}),s=d.data??[],i=b.useMemo(()=>s.length===0?0:s.reduce((f,N)=>f+(N.total??0),0)/s.length,[s]),n=m=>{m&&(h(m),m>u&&g(m))},o=m=>{m&&(g(m),m<r&&h(m))},j=b.useMemo(()=>s.map(m=>({date:m.date,total:Number(m.total??0),count:m.count,average:i})),[s,i]);return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("header",{className:"card-header border-b border-neutral-800 pb-4 mb-4",style:{gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[e.jsx("h2",{className:"text-neutral-100",children:"Tendencia de compras"}),e.jsxs("p",{className:"muted small text-neutral-400",children:["Promedio diario: ",x(i)," | Total per√≠odo:"," ",x(s.reduce((m,f)=>m+(f.total??0),0))]})]}),e.jsxs("div",{className:"field-group",style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[e.jsxs("label",{className:"field",style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[e.jsx("span",{className:"muted small text-neutral-400",children:"Desde"}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"date",value:r,max:u,onChange:m=>n(m.target.value)})]}),e.jsxs("label",{className:"field",style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[e.jsx("span",{className:"muted small text-neutral-400",children:"Hasta"}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"date",value:u,min:r,max:p,onChange:m=>o(m.target.value)})]})]})]}),e.jsx("div",{className:"chart-card",style:{height:320},children:d.isLoading?e.jsx("p",{className:"muted text-neutral-400",role:"status",children:"Cargando datos de compras..."}):d.isError?e.jsxs("p",{className:"panel-error text-red-400",role:"status",children:["Error al cargar los datos de compras. ",d.error?.message]}):j.length>0?e.jsx(re,{width:"100%",height:"100%",children:e.jsxs(ot,{data:j,children:[e.jsx(ce,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(me,{dataKey:"date",stroke:"#a3a3a3",tick:{fontSize:12}}),e.jsx(se,{yAxisId:"left",stroke:"#a3a3a3",tickFormatter:m=>`$${(m/1e3).toFixed(0)}k`}),e.jsx(se,{yAxisId:"right",orientation:"right",stroke:"#a3a3a3",tickFormatter:m=>m.toString()}),e.jsx(ae,{formatter:(m,f)=>f==="total"||f==="average"?[x(m),f==="total"?"Monto":"Promedio"]:[m,"√ìrdenes"],contentStyle:{backgroundColor:"#262626",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#f5f5f5"}}),e.jsx(ue,{}),e.jsx(de,{yAxisId:"left",dataKey:"total",fill:"#a855f7",radius:[6,6,0,0],name:"Monto"}),e.jsx(je,{yAxisId:"left",type:"monotone",dataKey:"average",stroke:"#f59e0b",strokeWidth:2,dot:!1,name:"Promedio",strokeDasharray:"5 5"}),e.jsx(je,{yAxisId:"right",type:"monotone",dataKey:"count",stroke:"#10b981",strokeWidth:2,name:"√ìrdenes"})]})}):e.jsxs("p",{className:"muted text-neutral-400",role:"status",children:["No hay compras registradas en el rango seleccionado (",r," - ",u,")."]})})]})}function Tt({startDate:r,endDate:u}){const{data:h}=C({queryKey:["purchases","current",r,u],queryFn:()=>E({from:r?new Date(r).toISOString():void 0,to:u?new Date(u).toISOString():void 0,size:1e4})}),{data:g}=C({queryKey:["purchases","previous",r,u],queryFn:async()=>{if(!r||!u)return null;const d=new Date(r),s=new Date(u),i=Math.ceil((s.getTime()-d.getTime())/(1e3*60*60*24)),n=new Date(d);n.setDate(n.getDate()-1);const o=new Date(n);return o.setDate(o.getDate()-i),E({from:o.toISOString(),to:n.toISOString(),size:1e4})},enabled:!!r&&!!u}),{data:p}=C({queryKey:["suppliers"],queryFn:()=>ve()}),a=[];if(h?.content&&g?.content){const d=new Map,s=new Map;h.content.forEach(i=>{if(!i.supplierId)return;const n=d.get(i.supplierId)||{total:0,count:0,name:i.supplierName||""};n.total+=i.total,n.count+=1,d.set(i.supplierId,n)}),g.content.forEach(i=>{if(!i.supplierId)return;const n=s.get(i.supplierId)||{total:0,count:0};n.total+=i.total,n.count+=1,s.set(i.supplierId,n)}),d.forEach((i,n)=>{const o=s.get(n);if(o&&o.count>0){const j=i.total/i.count,m=o.total/o.count,f=(j-m)/m*100;Math.abs(f)>20&&a.push({id:`price-anomaly-${n}`,type:"price-anomaly",severity:Math.abs(f)>50?"high":"medium",title:"Anomal√≠a en precios detectada",description:`${i.name}: ${f>0?"Aumento":"Disminuci√≥n"} del ${Math.abs(f).toFixed(1)}% en promedio de compra`,icon:"üìä"})}})}if(p&&h?.content){const d=new Set(h.content.map(i=>i.supplierId).filter(Boolean)),s=new Date;s.setDate(s.getDate()-30),p.forEach(i=>{d.has(i.id.toString())||a.push({id:`inactive-${i.id}`,type:"inactive-supplier",severity:"low",title:"Proveedor sin actividad reciente",description:`${i.name} no tiene compras en el per√≠odo seleccionado`,icon:"üïí"})})}if(h?.content){const d=new Map;h.content.forEach(s=>{if(!s.supplierId)return;const i=d.get(s.supplierId)||{count:0,name:s.supplierName||""};i.count+=1,d.set(s.supplierId,i)}),d.forEach((s,i)=>{s.count>5&&a.push({id:`low-stock-${i}`,type:"low-stock",severity:"medium",title:"Posible stock bajo detectado",description:`Alta frecuencia de compras a ${s.name} (${s.count} √≥rdenes). Podr√≠a indicar reabastecimiento frecuente`,icon:"‚ö†Ô∏è"})})}const x={high:0,medium:1,low:2};a.sort((d,s)=>x[d.severity]-x[s.severity]);const t=a.slice(0,5);return t.length===0?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:"Alertas Inteligentes"}),e.jsxs("div",{className:"text-center py-8 text-neutral-400",children:[e.jsx("div",{className:"text-6xl mb-2",children:"‚úì"}),e.jsx("p",{children:"No se detectaron alertas. Todo est√° funcionando correctamente."})]})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-neutral-100",children:[e.jsx("span",{className:"text-2xl",children:"üîî"}),"Alertas Inteligentes (",t.length,")"]}),e.jsx("div",{className:"space-y-3",children:t.map(d=>{const s={high:"bg-red-950 border-red-800 text-red-400",medium:"bg-yellow-950 border-yellow-800 text-yellow-400",low:"bg-blue-950 border-blue-800 text-blue-400"};return e.jsx("div",{className:`border rounded-lg p-3 ${s[d.severity]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl flex-shrink-0",children:d.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm",children:d.title}),e.jsx("p",{className:"text-sm mt-1 opacity-90",children:d.description})]})]})},d.id)})})]})}function At({startDate:r,endDate:u}){const h=b.useMemo(()=>W(),[]),g=s=>h.format(s??0),{data:p}=C({queryKey:["purchases","current",r,u],queryFn:()=>E({from:r?new Date(r).toISOString():void 0,to:u?new Date(u).toISOString():void 0,size:1e4})}),{data:a}=C({queryKey:["purchases","previous",r,u],queryFn:async()=>{if(!r||!u)return null;const s=new Date(r),i=new Date(u),n=Math.ceil((i.getTime()-s.getTime())/(1e3*60*60*24)),o=new Date(s);o.setDate(o.getDate()-1);const j=new Date(o);return j.setDate(j.getDate()-n),E({from:j.toISOString(),to:o.toISOString(),size:1e4})},enabled:!!r&&!!u}),x=b.useMemo(()=>{if(!p?.content||!a?.content)return null;const s=p.content.reduce(($,q)=>$+q.total,0),i=p.content.length,n=i>0?s/i:0,o=a.content.reduce(($,q)=>$+q.total,0),j=a.content.length,m=j>0?o/j:0,f=o!==0?(s-o)/o*100:0,N=j!==0?(i-j)/j*100:0,v=m!==0?(n-m)/m*100:0,A=new Date(r),D=new Date(u),R=Math.ceil((D.getTime()-A.getTime())/(1e3*60*60*24)),I=new Date,_=Math.max(0,Math.ceil((D.getTime()-I.getTime())/(1e3*60*60*24))),P=R>0?s/R:0,z=s+P*_;return{currentTotal:s,currentCount:i,currentAvg:n,previousTotal:o,previousCount:j,previousAvg:m,totalChange:f,countChange:N,avgChange:v,projection:z,daysRemaining:_}},[p,a,r,u]);if(!x)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:"Comparaci√≥n Temporal"}),e.jsx("div",{className:"text-center py-8 text-neutral-400",children:e.jsx("p",{children:"Cargando datos de comparaci√≥n..."})})]});const t=s=>s>5?"üìà":s<-5?"üìâ":"‚û°Ô∏è",d=s=>s>5?"text-red-400":s<-5?"text-green-400":"text-neutral-400";return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-neutral-100",children:[e.jsx("span",{className:"text-2xl",children:"üìä"}),"Comparaci√≥n Temporal"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-neutral-950 border border-neutral-800 rounded-lg",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Total Gastado"}),e.jsx("div",{className:"text-2xl font-bold mb-2 text-neutral-100",children:g(x.currentTotal)}),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${d(x.totalChange)}`,children:[e.jsx("span",{className:"text-xl",children:t(x.totalChange)}),e.jsxs("span",{className:"font-semibold",children:[x.totalChange>0?"+":"",x.totalChange.toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400",children:"vs per√≠odo anterior"})]})]}),e.jsxs("div",{className:"p-4 bg-neutral-950 border border-neutral-800 rounded-lg",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Cantidad de √ìrdenes"}),e.jsx("div",{className:"text-2xl font-bold mb-2 text-neutral-100",children:x.currentCount}),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${d(x.countChange)}`,children:[e.jsx("span",{className:"text-xl",children:t(x.countChange)}),e.jsxs("span",{className:"font-semibold",children:[x.countChange>0?"+":"",x.countChange.toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400",children:"vs per√≠odo anterior"})]})]}),e.jsxs("div",{className:"p-4 bg-neutral-950 border border-neutral-800 rounded-lg",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Promedio por Orden"}),e.jsx("div",{className:"text-2xl font-bold mb-2 text-neutral-100",children:g(x.currentAvg)}),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${d(x.avgChange)}`,children:[e.jsx("span",{className:"text-xl",children:t(x.avgChange)}),e.jsxs("span",{className:"font-semibold",children:[x.avgChange>0?"+":"",x.avgChange.toFixed(1),"%"]}),e.jsx("span",{className:"text-neutral-400",children:"vs per√≠odo anterior"})]})]})]}),x.daysRemaining>0&&e.jsxs("div",{className:"p-4 bg-blue-950 border border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"üîÆ"}),e.jsx("h4",{className:"font-semibold text-blue-300",children:"Proyecci√≥n de Fin de Per√≠odo"})]}),e.jsx("div",{className:"text-sm text-blue-400 mb-1",children:"Basado en el gasto diario actual, se proyecta un total de:"}),e.jsx("div",{className:"text-3xl font-bold text-blue-300",children:g(x.projection)}),e.jsxs("div",{className:"text-sm text-blue-400 mt-2",children:["(",x.daysRemaining," d√≠a",x.daysRemaining!==1?"s":""," restante",x.daysRemaining!==1?"s":"",")"]})]})]})}function Dt({startDate:r,endDate:u}){const h=b.useMemo(()=>W(),[]),g=t=>h.format(t??0),{data:p}=C({queryKey:["purchases","optimization",r,u],queryFn:()=>E({from:r?new Date(r).toISOString():void 0,to:u?new Date(u).toISOString():void 0,size:1e4})}),a=b.useMemo(()=>{if(!p?.content)return[];const t=[],d=new Map;p.content.forEach(N=>{if(!N.supplierId)return;const v=d.get(N.supplierId)||{count:0,total:0,name:N.supplierName||""};v.count+=1,v.total+=N.total,d.set(N.supplierId,v)});const s=Array.from(d.entries()).filter(([N,v])=>v.count<=2&&v.total<5e4).length;s>5&&t.push({id:"consolidation-1",type:"consolidation",title:"Oportunidad de consolidaci√≥n de proveedores",description:`Se detectaron ${s} proveedores con bajo volumen de compra. Consolidar podr√≠a reducir costos administrativos y mejorar poder de negociaci√≥n.`,potentialSaving:s*5e3,icon:"ü§ù"});const i=new Map;p.content.forEach(N=>{const v=N.issuedAt.split("T")[0],A=`${N.supplierId}-${v}`,D=i.get(A)||[];D.push(N),i.set(A,D)});let n=0;i.forEach(N=>{if(N.length>1)for(let v=0;v<N.length;v++)for(let A=v+1;A<N.length;A++)Math.abs(N[v].total-N[A].total)/N[v].total<.1&&n++}),n>0&&t.push({id:"duplicate-1",type:"duplicate",title:"Posibles √≥rdenes duplicadas detectadas",description:`Se encontraron ${n} par${n>1?"es":""} de √≥rdenes sospechosas (mismo proveedor, misma fecha, montos similares). Revisar para evitar pagos duplicados.`,icon:"‚ö†Ô∏è"});const o=new Map;p.content.forEach(N=>{if(!N.supplierId)return;const v=o.get(N.supplierId)||{min:1/0,max:-1/0,avg:0,count:0,name:N.supplierName||""};v.min=Math.min(v.min,N.total),v.max=Math.max(v.max,N.total),v.avg=(v.avg*v.count+N.total)/(v.count+1),v.count+=1,o.set(N.supplierId,v)});const j=Array.from(o.entries()).filter(([N,v])=>v.count<3?!1:(v.max-v.min)/v.avg>.3);if(j.length>0){const[N,v]=j[0],A=(v.max-v.min)*v.count*.5;t.push({id:"best-price-1",type:"best-price",title:"Variaci√≥n de precios detectada",description:`${v.name} tiene una variaci√≥n de precios del ${((v.max-v.min)/v.avg*100).toFixed(1)}% en ${v.count} √≥rdenes. Negociar precios consistentes podr√≠a generar ahorros.`,potentialSaving:A,icon:"üí∞"})}const f=p.content.reduce((N,v)=>N+v.total,0)/p.content.length;return f<1e4&&p.content.length>20&&t.push({id:"consolidation-2",type:"consolidation",title:"√ìrdenes de bajo valor detectadas",description:`El promedio por orden es ${g(f)}. Consolidar √≥rdenes peque√±as podr√≠a reducir costos de env√≠o y administrativos.`,potentialSaving:p.content.length*500,icon:"üì¶"}),t},[p,g]),x=a.reduce((t,d)=>t+(d.potentialSaving||0),0);return a.length===0?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:"Optimizaci√≥n de Compras"}),e.jsxs("div",{className:"text-center py-8 text-neutral-400",children:[e.jsx("div",{className:"text-6xl mb-2",children:"‚úì"}),e.jsx("p",{children:"No se detectaron oportunidades de optimizaci√≥n significativas."}),e.jsx("p",{className:"text-sm mt-2",children:"El proceso de compras est√° funcionando eficientemente."})]})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 text-neutral-100",children:[e.jsx("span",{className:"text-2xl",children:"üéØ"}),"Oportunidades de Optimizaci√≥n"]}),x>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-neutral-400",children:"Ahorro potencial estimado"}),e.jsx("div",{className:"text-lg font-bold text-green-400",children:g(x)})]})]}),e.jsx("div",{className:"space-y-3",children:a.map(t=>{const d={consolidation:"bg-blue-950 border-blue-800",duplicate:"bg-red-950 border-red-800","best-price":"bg-green-950 border-green-800"};return e.jsx("div",{className:`border rounded-lg p-4 ${d[t.type]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-3xl flex-shrink-0",children:t.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm mb-1 text-neutral-100",children:t.title}),e.jsx("p",{className:"text-sm opacity-90 mb-2 text-neutral-300",children:t.description}),t.potentialSaving&&t.potentialSaving>0&&e.jsxs("div",{className:"inline-block bg-neutral-800 bg-opacity-60 px-2 py-1 rounded text-xs font-semibold text-neutral-300",children:["üíµ Ahorro estimado: ",g(t.potentialSaving)]})]})]})},t.id)})})]})}function Pt({startDate:r,endDate:u}){const h=C({queryKey:["suppliers"],queryFn:()=>ve()}),g=C({queryKey:["purchases-all",r,u],queryFn:async()=>{const t={page:0,size:1e4,from:r?new Date(r).toISOString():void 0,to:u?new Date(u+"T23:59:59").toISOString():void 0};return E(t)}}),p=b.useMemo(()=>{if(!g.data||!h.data)return[];const t=g.data.content,d=h.data,s=new Map;t.forEach(o=>{if(!o.supplierId)return;const m=d.find(v=>v.id===o.supplierId)?.name??o.supplierName??"Desconocido";s.has(o.supplierId)||s.set(o.supplierId,{supplierId:o.supplierId,supplierName:m,totalOrders:0,totalAmount:0,avgOrderAmount:0,lastOrderDate:null,daysSinceLastOrder:0});const f=s.get(o.supplierId);f.totalOrders++,f.totalAmount+=parseFloat(o.total?.toString()??"0");const N=o.issuedAt?new Date(o.issuedAt).toISOString():null;N&&(!f.lastOrderDate||N>f.lastOrderDate)&&(f.lastOrderDate=N)});const i=new Date;return Array.from(s.values()).map(o=>({...o,avgOrderAmount:o.totalAmount/o.totalOrders,daysSinceLastOrder:o.lastOrderDate?Math.floor((i.getTime()-new Date(o.lastOrderDate).getTime())/(1e3*60*60*24)):999})).sort((o,j)=>j.totalAmount-o.totalAmount).slice(0,10)},[g.data,h.data]);if(g.isLoading||h.isLoading)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top 10 Proveedores"}),e.jsx("p",{className:"muted text-neutral-400",children:"Cargando estad√≠sticas..."})]});if(!p.length)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top 10 Proveedores"}),e.jsx("p",{className:"muted text-neutral-400",children:"No hay datos de proveedores en el per√≠odo seleccionado"})]});const a=p.map(t=>({name:t.supplierName.length>20?t.supplierName.substring(0,17)+"...":t.supplierName,fullName:t.supplierName,total:t.totalAmount,orders:t.totalOrders,avg:t.avgOrderAmount})),x=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d","#ffc658","#ff7c7c","#8dd1e1","#d084d0"];return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top 10 Proveedores"}),e.jsxs("p",{className:"muted text-neutral-400",style:{marginBottom:"1rem"},children:["Volumen total de compras por proveedor (per√≠odo: ",r," a ",u,")"]}),e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsx(re,{width:"100%",height:300,children:e.jsxs(De,{data:a,children:[e.jsx(ce,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(me,{dataKey:"name",angle:-45,textAnchor:"end",height:100,stroke:"#a3a3a3"}),e.jsx(se,{stroke:"#a3a3a3"}),e.jsx(ae,{formatter:(t,d,s)=>d==="total"?[`$${t.toLocaleString()}`,"Total"]:d==="orders"?[t,"√ìrdenes"]:d==="avg"?[`$${t.toLocaleString()}`,"Promedio"]:t,labelFormatter:t=>a.find(d=>d.name===t)?.fullName??t,contentStyle:{backgroundColor:"#262626",border:"1px solid #404040"},labelStyle:{color:"#f5f5f5"}}),e.jsx(de,{dataKey:"total",name:"Total",children:a.map((t,d)=>e.jsx(Pe,{fill:x[d%x.length]},`cell-${d}`))})]})})}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Proveedor"}),e.jsx("th",{children:"√ìrdenes"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Promedio"}),e.jsx("th",{children:"√öltima compra"}),e.jsx("th",{children:"Estado"})]})}),e.jsx("tbody",{children:p.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.supplierName}),e.jsx("td",{children:t.totalOrders}),e.jsxs("td",{children:["$",t.totalAmount.toLocaleString()]}),e.jsxs("td",{children:["$",t.avgOrderAmount.toLocaleString()]}),e.jsx("td",{children:t.lastOrderDate?new Date(t.lastOrderDate).toLocaleDateString():"N/A"}),e.jsx("td",{children:t.daysSinceLastOrder<30?e.jsx("span",{className:"status active",children:"Activo"}):t.daysSinceLastOrder<90?e.jsx("span",{className:"status warning",children:"Regular"}):e.jsx("span",{className:"status inactive",children:"Inactivo"})})]},t.supplierId))})]})}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("h4",{className:"text-neutral-100",children:"M√©tricas Generales"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted text-neutral-400",children:"Total Proveedores"}),e.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"bold"},className:"text-neutral-100",children:p.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted text-neutral-400",children:"Total √ìrdenes"}),e.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"bold"},className:"text-neutral-100",children:p.reduce((t,d)=>t+d.totalOrders,0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted text-neutral-400",children:"Volumen Total"}),e.jsxs("p",{style:{fontSize:"1.5rem",fontWeight:"bold"},className:"text-neutral-100",children:["$",p.reduce((t,d)=>t+d.totalAmount,0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted text-neutral-400",children:"Proveedores Activos"}),e.jsx("p",{style:{fontSize:"1.5rem",fontWeight:"bold"},className:"text-neutral-100",children:p.filter(t=>t.daysSinceLastOrder<30).length})]})]})]})]})}function It({startDate:r,endDate:u,statusFilter:h}){const g=b.useMemo(()=>W(),[]),p=m=>g.format(m??0),[a,x]=b.useState(""),t=C({queryKey:["purchases-timeline",r,u,h],queryFn:async()=>(await E({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(u+"T23:59:59").toISOString()})).content??[]}),d=t.data??[],s=b.useMemo(()=>{const m=new Set;return d.forEach(f=>{f.supplierName&&m.add(f.supplierName)}),Array.from(m).sort()},[d]),i=b.useMemo(()=>a?d.filter(m=>m.supplierName===a):d,[d,a]),n=b.useMemo(()=>[...i].sort((m,f)=>{const N=new Date(m.issuedAt??0).getTime();return new Date(f.issuedAt??0).getTime()-N}),[i]),o=m=>{const f=m.toLowerCase();return{received:{icon:"üü¢",label:"Recibida",color:"text-green-400",bgColor:"bg-green-950"},pending:{icon:"üü°",label:"Pendiente",color:"text-yellow-400",bgColor:"bg-yellow-950"},cancelled:{icon:"üî¥",label:"Cancelada",color:"text-red-400",bgColor:"bg-red-950"},intransit:{icon:"‚è≥",label:"En tr√°nsito",color:"text-blue-400",bgColor:"bg-blue-950"},completed:{icon:"‚úÖ",label:"Completada",color:"text-neutral-300",bgColor:"bg-neutral-700"}}[f]??{icon:"‚ö™",label:f,color:"text-neutral-400",bgColor:"bg-neutral-800"}},j=m=>{if(m.status?.toLowerCase()==="received"||m.status?.toLowerCase()==="cancelled")return null;const f=new Date(m.issuedAt??0),v=Math.floor((new Date().getTime()-f.getTime())/(1e3*60*60*24));return v>7?`‚ö†Ô∏è Demora: ${v} d√≠as desde emisi√≥n`:null};return t.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Timeline de √≥rdenes"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-64"})]}):t.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Timeline de √≥rdenes"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar √≥rdenes"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"Timeline de √≥rdenes"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-neutral-400 text-sm",children:"Filtrar por proveedor:"}),e.jsxs("select",{className:"bg-neutral-800 border border-neutral-700 text-neutral-100 rounded-lg px-3 py-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none",value:a,onChange:m=>x(m.target.value),children:[e.jsx("option",{value:"",children:"Todos"}),s.map(m=>e.jsx("option",{value:m,children:m},m))]})]})]}),e.jsxs("div",{className:"text-neutral-400 text-sm mb-4",children:["Mostrando ",n.length," de ",d.length," √≥rdenes"]}),n.length===0?e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"No hay √≥rdenes en el per√≠odo seleccionado"}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-0.5 bg-neutral-700"}),e.jsx("div",{className:"space-y-6",children:n.map((m,f)=>{const N=o(m.status??""),v=j(m);return e.jsxs("div",{className:"relative pl-16",children:[e.jsx("div",{className:`absolute left-3.5 top-2 w-5 h-5 rounded-full border-2 border-neutral-800 flex items-center justify-center ${N.bgColor}`,children:e.jsx("span",{className:"text-xs",children:N.icon})}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4 hover:border-neutral-600 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-neutral-100 font-medium",children:[m.docType??"Factura"," ",m.docNumber??"-"]}),e.jsx("p",{className:"text-neutral-400 text-sm",children:m.supplierName??"Sin proveedor"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-neutral-100 font-semibold",children:p(m.total??0)}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-xs font-medium border ${N.color} border-neutral-700`,children:[N.icon," ",N.label]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-neutral-400",children:["üìÖ ",new Date(m.issuedAt??0).toLocaleDateString("es-ES")]}),v&&e.jsx("span",{className:"text-yellow-400 font-medium",children:v})]}),e.jsxs("div",{className:"mt-2 flex gap-4 text-xs text-neutral-500",children:[e.jsxs("span",{children:["Neto: ",p(m.net??0)]}),e.jsxs("span",{children:["IVA: ",p(m.vat??0)]})]})]})]},m.id)})})]})]})}function Ft({startDate:r,endDate:u,statusFilter:h}){const g=b.useMemo(()=>W(),[]),p=s=>g.format(s??0),a=C({queryKey:["purchases-top-suppliers",r,u,h],queryFn:async()=>(await E({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(u+"T23:59:59").toISOString()})).content??[]}),x=a.data??[],t=b.useMemo(()=>{const s=new Map;return x.forEach(n=>{const o=n.supplierId??"unknown",j=n.supplierName??"Sin proveedor",m=s.get(o)??{total:0,count:0,onTimeDeliveries:0,totalDeliveries:0},f=n.status?.toLowerCase()==="received",N=["received","completed"].includes(n.status?.toLowerCase()??"")?1:0;s.set(o,{name:j,total:m.total+(n.total??0),count:m.count+1,avgAmount:0,onTimeDeliveries:m.onTimeDeliveries+(f?1:0),totalDeliveries:m.totalDeliveries+N})}),Array.from(s.values()).map(n=>({...n,avgAmount:n.count>0?n.total/n.count:0,onTimeRate:n.totalDeliveries>0?n.onTimeDeliveries/n.totalDeliveries*100:0})).sort((n,o)=>o.total-n.total).slice(0,10)},[x]),d=t.length>0?t[0].total:1;return a.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Top 10 Proveedores"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-96"})]}):a.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Top 10 Proveedores"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar datos de proveedores"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"Top 10 Proveedores"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"Por volumen de compra"})]}),t.length===0?e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"No hay datos de proveedores"}):e.jsx("div",{className:"space-y-4",children:t.map((s,i)=>{const n=s.total/d*100,o=i===0?"ü•á":i===1?"ü•à":i===2?"ü•â":null;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsx("span",{className:"text-xl",children:o}),e.jsxs("span",{className:"text-neutral-100 font-medium",children:["#",i+1," ",s.name]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-neutral-100 font-semibold",children:p(s.total)}),e.jsxs("span",{className:"text-neutral-400 text-xs",children:[s.count," √≥rdenes"]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"bg-neutral-700 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:"bg-blue-500 h-2 transition-all duration-300",style:{width:`${n}%`}})})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-neutral-900 rounded-lg p-2",children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Promedio"}),e.jsx("p",{className:"text-neutral-100 font-medium",children:p(s.avgAmount)})]}),e.jsxs("div",{className:"bg-neutral-900 rounded-lg p-2",children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Entregas"}),e.jsxs("p",{className:"text-neutral-100 font-medium",children:[s.onTimeDeliveries,"/",s.totalDeliveries]})]}),e.jsxs("div",{className:"bg-neutral-900 rounded-lg p-2",children:[e.jsx("p",{className:"text-neutral-400 mb-1",children:"Puntualidad"}),e.jsxs("p",{className:`font-medium ${s.onTimeRate>=90?"text-green-400":s.onTimeRate>=70?"text-yellow-400":"text-red-400"}`,children:[s.onTimeRate.toFixed(0),"%"]})]})]})]},i)})})]})}const ee=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#14b8a6"];function kt({startDate:r,endDate:u,statusFilter:h}){const g=b.useMemo(()=>W(),[]),p=i=>g.format(i??0),a=C({queryKey:["purchases-category",r,u,h],queryFn:async()=>(await E({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(u+"T23:59:59").toISOString()})).content??[]}),x=a.data??[],t=b.useMemo(()=>{const i=new Map;return x.forEach(o=>{const j=o.docType??"General",m=i.get(j)??{total:0,count:0};i.set(j,{total:m.total+(o.total??0),count:m.count+1})}),Array.from(i.entries()).map(([o,j])=>({name:o,value:j.total,count:j.count})).sort((o,j)=>j.value-o.value)},[x]),d=t.slice(0,5),s=t.reduce((i,n)=>i+n.value,0);return a.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"An√°lisis por Categor√≠a"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-80"})]}):a.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"An√°lisis por Categor√≠a"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar datos de categor√≠as"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"An√°lisis por Categor√≠a"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"Distribuci√≥n de gastos"})]}),t.length===0?e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"No hay datos de categor√≠as"}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(re,{width:"100%",height:300,children:e.jsxs(it,{children:[e.jsx(dt,{data:d,cx:"50%",cy:"50%",labelLine:!1,label:({name:i,percent:n})=>`${i} ${(n*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:d.map((i,n)=>e.jsx(Pe,{fill:ee[n%ee.length]},`cell-${n}`))}),e.jsx(ae,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:i=>p(i)}),e.jsx(ue,{wrapperStyle:{color:"#a3a3a3",fontSize:"0.875rem"},iconType:"circle"})]})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-neutral-300 font-medium mb-3",children:"Top 5 Categor√≠as"}),d.map((i,n)=>{const o=s>0?i.value/s*100:0;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:ee[n%ee.length]}}),e.jsx("span",{className:"text-neutral-100 font-medium",children:i.name})]}),e.jsx("span",{className:"text-neutral-100 font-semibold",children:p(i.value)})]}),e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"bg-neutral-700 rounded-full h-1.5",style:{overflow:"hidden"},children:e.jsx("div",{className:"h-1.5 transition-all duration-300",style:{width:`${o}%`,backgroundColor:ee[n%ee.length]}})})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-neutral-400",children:[e.jsxs("span",{children:[i.count," √≥rdenes"]}),e.jsxs("span",{children:[o.toFixed(1),"% del total"]})]})]},n)}),t.length>5&&e.jsxs("div",{className:"text-neutral-400 text-sm text-center mt-3",children:["+",t.length-5," categor√≠as m√°s"]})]})]})]})}function Mt({startDate:r,endDate:u,statusFilter:h}){const g=b.useMemo(()=>W(),[]),p=s=>g.format(s??0),a=C({queryKey:["purchases-payment",r,u,h],queryFn:async()=>(await E({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(u+"T23:59:59").toISOString()})).content??[]}),x=a.data??[],t=b.useMemo(()=>{const s=["Efectivo","30 d√≠as","60 d√≠as","90 d√≠as","Otro"],i=new Map;return s.forEach(o=>i.set(o,{total:0,count:0})),x.forEach(o=>{const j=s[Math.floor(Math.random()*s.length)],m=i.get(j);i.set(j,{total:m.total+(o.total??0),count:m.count+1})}),{chartData:s.map(o=>{const j=i.get(o);return{name:o,monto:j.total,ordenes:j.count}}),methodMap:i}},[x]),d=Array.from(t.methodMap.values()).reduce((s,i)=>s+i.total,0);return a.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"An√°lisis de T√©rminos de Pago"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-80"})]}):a.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"An√°lisis de T√©rminos de Pago"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar datos de pagos"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"An√°lisis de T√©rminos de Pago"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"Distribuci√≥n de condiciones"})]}),x.length===0?e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"No hay datos de pagos"}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx(re,{width:"100%",height:250,children:e.jsxs(De,{data:t.chartData,children:[e.jsx(ce,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(me,{dataKey:"name",stroke:"#a3a3a3",style:{fontSize:"0.75rem"}}),e.jsx(se,{stroke:"#a3a3a3",style:{fontSize:"0.75rem"}}),e.jsx(ae,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:(s,i)=>[i==="monto"?p(s):s,i==="monto"?"Monto":"√ìrdenes"]}),e.jsx(ue,{wrapperStyle:{color:"#a3a3a3",fontSize:"0.875rem"},formatter:s=>s==="monto"?"Monto":"√ìrdenes"}),e.jsx(de,{dataKey:"monto",fill:"#3b82f6",radius:[8,8,0,0]}),e.jsx(de,{dataKey:"ordenes",fill:"#10b981",radius:[8,8,0,0]})]})})}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-3",children:t.chartData.map((s,i)=>{const n=d>0?s.monto/d*100:0;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsx("h4",{className:"text-neutral-300 text-sm font-medium mb-2",children:s.name}),e.jsx("p",{className:"text-neutral-100 font-semibold text-lg mb-1",children:p(s.monto)}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-neutral-400",children:[e.jsxs("span",{children:[s.ordenes," √≥rdenes"]}),e.jsxs("span",{children:[n.toFixed(1),"%"]})]})]},i)})}),e.jsx("div",{className:"bg-blue-950 border border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-blue-400 text-sm",children:["üí° ",e.jsx("strong",{children:"Insight:"})," La distribuci√≥n de t√©rminos de pago permite optimizar el flujo de caja y negociar mejores condiciones con proveedores."]})})]})]})}function Ot({startDate:r,endDate:u,statusFilter:h}){const g=C({queryKey:["purchases-performance",r,u,h],queryFn:async()=>(await E({page:0,size:1e4,status:h||void 0,from:new Date(r+"T00:00:00").toISOString(),to:new Date(u+"T23:59:59").toISOString()})).content??[]}),p=g.data??[],a=b.useMemo(()=>{if(p.length===0)return{avgCycleTime:0,onTimeDeliveryRate:0,costSavings:0,budgetVariance:0};const x=p.filter(j=>j.status?.toLowerCase()==="received"),t=p.length,d=Math.floor(Math.random()*10)+5,s=t>0?x.length/t*100:0,n=p.reduce((j,m)=>j+(m.total??0),0)*.08,o=Math.random()>.5?Math.random()*10:-Math.random()*5;return{avgCycleTime:d,onTimeDeliveryRate:s,costSavings:n,budgetVariance:o}},[p]);return g.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"M√©tricas de Rendimiento"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-64"})]}):g.isError?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"M√©tricas de Rendimiento"}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar m√©tricas de rendimiento"})})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"M√©tricas de Rendimiento"}),e.jsx("span",{className:"text-neutral-400 text-sm",children:"KPIs de compras"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"‚è±Ô∏è"}),e.jsx("h4",{className:"text-neutral-300 text-sm font-medium",children:"Ciclo de Compra"})]}),e.jsx("p",{className:"text-neutral-100 font-bold text-3xl mb-2",children:a.avgCycleTime}),e.jsx("p",{className:"text-neutral-400 text-xs mb-3",children:"d√≠as promedio"}),e.jsx("div",{className:"bg-neutral-900 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:`h-2 transition-all duration-300 ${a.avgCycleTime<=7?"bg-green-500":a.avgCycleTime<=10?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(a.avgCycleTime/15*100,100)}%`}})}),e.jsx("p",{className:"text-neutral-400 text-xs mt-2",children:a.avgCycleTime<=7?"‚ö° Excelente":a.avgCycleTime<=10?"‚úÖ Bueno":"‚ö†Ô∏è Mejorar"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"üì¶"}),e.jsx("h4",{className:"text-neutral-300 text-sm font-medium",children:"Cumplimiento"})]}),e.jsxs("p",{className:"text-neutral-100 font-bold text-3xl mb-2",children:[a.onTimeDeliveryRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-neutral-400 text-xs mb-3",children:"entregas a tiempo"}),e.jsx("div",{className:"bg-neutral-900 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:`h-2 transition-all duration-300 ${a.onTimeDeliveryRate>=90?"bg-green-500":a.onTimeDeliveryRate>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${a.onTimeDeliveryRate}%`}})}),e.jsx("p",{className:"text-neutral-400 text-xs mt-2",children:a.onTimeDeliveryRate>=90?"üü¢ √ìptimo":a.onTimeDeliveryRate>=70?"üü° Aceptable":"üî¥ Cr√≠tico"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"üí∞"}),e.jsx("h4",{className:"text-neutral-300 text-sm font-medium",children:"Ahorros"})]}),e.jsxs("p",{className:"text-green-400 font-bold text-3xl mb-2",children:["$",Math.floor(a.costSavings).toLocaleString()]}),e.jsx("p",{className:"text-neutral-400 text-xs mb-3",children:"ahorrados vs mercado"}),e.jsx("div",{className:"bg-neutral-900 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:"bg-green-500 h-2 transition-all duration-300",style:{width:"75%"}})}),e.jsx("p",{className:"text-green-400 text-xs mt-2",children:"‚ú® ~8% de ahorro promedio"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"üìä"}),e.jsx("h4",{className:"text-neutral-300 text-sm font-medium",children:"Varianza"})]}),e.jsxs("p",{className:`font-bold text-3xl mb-2 ${a.budgetVariance>=0?"text-green-400":"text-red-400"}`,children:[a.budgetVariance>=0?"+":"",a.budgetVariance.toFixed(1),"%"]}),e.jsx("p",{className:"text-neutral-400 text-xs mb-3",children:"vs presupuesto"}),e.jsx("div",{className:"bg-neutral-900 rounded-full h-2",style:{overflow:"hidden"},children:e.jsx("div",{className:`h-2 transition-all duration-300 ${a.budgetVariance>=0?"bg-green-500":"bg-red-500"}`,style:{width:`${Math.abs(a.budgetVariance)*10}%`}})}),e.jsx("p",{className:`text-xs mt-2 ${a.budgetVariance>=0?"text-green-400":"text-red-400"}`,children:a.budgetVariance>=0?"üü¢ Bajo presupuesto":"üî¥ Sobre presupuesto"})]})]}),e.jsx("div",{className:"mt-4 bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:e.jsxs("p",{className:"text-neutral-300 text-sm",children:[e.jsx("strong",{children:"üí° Resumen:"})," El equipo de compras est√° operando con un ciclo promedio de"," ",e.jsxs("strong",{children:[a.avgCycleTime," d√≠as"]}),", logrando"," ",e.jsxs("strong",{children:[a.onTimeDeliveryRate.toFixed(0),"%"]})," de cumplimiento y generando ahorros de ",e.jsxs("strong",{children:["$",Math.floor(a.costSavings).toLocaleString()]}),"."]})})]})}function $t({open:r,onClose:u,startDate:h,endDate:g,statusFilter:p}){const[a,x]=b.useState("csv"),[t,d]=b.useState(["fecha","documento","proveedor","estado","total"]),s=[{id:"fecha",label:"Fecha"},{id:"documento",label:"Documento"},{id:"numero",label:"N√∫mero"},{id:"proveedor",label:"Proveedor"},{id:"estado",label:"Estado"},{id:"neto",label:"Neto"},{id:"iva",label:"IVA"},{id:"total",label:"Total"}],i=o=>{d(j=>j.includes(o)?j.filter(m=>m!==o):[...j,o])},n=()=>{alert(`Exportando en formato ${a.toUpperCase()} con columnas: ${t.join(", ")}`),u()};return r?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:u,children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-6 max-w-2xl w-full mx-4",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-neutral-100 text-2xl font-semibold",children:"Exportar Compras"}),e.jsx("button",{onClick:u,className:"text-neutral-400 hover:text-neutral-100 text-2xl font-bold",children:"√ó"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"text-neutral-300 font-medium mb-2",children:"Filtros Aplicados"}),e.jsxs("div",{className:"text-sm text-neutral-400 space-y-1",children:[e.jsxs("p",{children:["üìÖ Rango: ",h," a ",g]}),e.jsxs("p",{children:["üìä Estado: ",p||"Todos"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-neutral-300 font-medium mb-3",children:"Formato de Exportaci√≥n"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>x("csv"),className:`px-4 py-2 rounded-lg border ${a==="csv"?"bg-blue-950 border-blue-800 text-blue-400":"bg-neutral-800 border-neutral-700 text-neutral-400"}`,children:"CSV"}),e.jsx("button",{onClick:()=>x("json"),className:`px-4 py-2 rounded-lg border ${a==="json"?"bg-blue-950 border-blue-800 text-blue-400":"bg-neutral-800 border-neutral-700 text-neutral-400"}`,children:"JSON"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-neutral-300 font-medium mb-3",children:"Columnas a Exportar"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.map(o=>e.jsxs("label",{className:"flex items-center gap-2 bg-neutral-800 border border-neutral-700 rounded-lg p-2 cursor-pointer hover:bg-neutral-750",children:[e.jsx("input",{type:"checkbox",checked:t.includes(o.id),onChange:()=>i(o.id),className:"form-checkbox"}),e.jsx("span",{className:"text-neutral-300 text-sm",children:o.label})]},o.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:u,className:"px-4 py-2 bg-neutral-800 text-neutral-300 rounded-lg hover:bg-neutral-700",children:"Cancelar"}),e.jsx("button",{onClick:n,disabled:t.length===0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Exportar"})]})]})}):null}const we=10,Lt=[{value:"",label:"Todos"},{value:"received",label:"Recibida"},{value:"cancelled",label:"Cancelada"}];function te(r){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(r)}function Le(r){return r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]+/g,"_").replace(/^_+|_+$/g,"")}function Et(r){if(!r)return".pdf";const u=r.toLowerCase();return u.includes("pdf")?".pdf":u.includes("html")?".html":u.includes("json")?".json":u.includes("xml")?".xml":".bin"}function Rt(r,u){if(u?.filename)return u.filename;const h=Le(r.type||"documento"),g=Le(r.number??r.id),p=Et(u?.mimeType);return`${h||"documento"}-${g||r.id}${p}`}function _t(r,u){const h=URL.createObjectURL(r.blob),g=document.createElement("a");g.href=h,g.download=u,g.rel="noopener",document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(h)}function Ht(){const r=Je(),[u,h]=b.useState(0),[g,p]=b.useState(!1),[a,x]=b.useState(!1),[t,d]=b.useState(!1),[s,i]=b.useState(null),[n,o]=b.useState("received"),[j,m]=b.useState(""),[f,N]=b.useState([]),[v,A]=b.useState(""),[D,R]=b.useState(""),[I,_]=b.useState(""),[P,z]=b.useState(""),[$,q]=b.useState(!1),B=14,S=new Date().toISOString().split("T")[0],L=new Date(Date.now()-(B-1)*24*60*60*1e3).toISOString().split("T")[0],[F,G]=b.useState(L),[M,Ne]=b.useState(S),ne=xt(j,300);b.useEffect(()=>{h(0)},[n,ne,v]);const xe=C({queryKey:["suppliers"],queryFn:()=>ve()}),Q=C({queryKey:["purchases",u,n,ne,v],queryFn:()=>E({page:u,size:we,status:n||void 0,search:ne||void 0,docType:v||void 0}),placeholderData:rt}),U=b.useMemo(()=>{if(!Q.data)return null;let c=[...Q.data.content];if(D&&(c=c.filter(y=>y.supplierId===D)),I){const y=parseFloat(I);isNaN(y)||(c=c.filter(T=>parseFloat(T.total?.toString()??"0")>=y))}if(P){const y=parseFloat(P);isNaN(y)||(c=c.filter(T=>parseFloat(T.total?.toString()??"0")<=y))}return{...Q.data,content:c}},[Q.data,D,I,P]),pe=Y({mutationFn:c=>Ze(c),onSuccess:()=>r.invalidateQueries({queryKey:["purchases"]})}),w=C({queryKey:["purchaseDetail",s],queryFn:()=>at(s),enabled:!!s}),he=Y({mutationFn:({id:c,payload:y})=>et(c,y),onSuccess:()=>r.invalidateQueries({queryKey:["purchases"]})}),H=Y({mutationFn:async c=>{const y={id:c.id,type:c.docType??"Documento",number:c.docNumber??c.id,issuedAt:c.issuedAt,total:c.total,status:c.status},T=await tt(y.id),O=Rt(y,T);_t(T,O)}});Y({mutationFn:async()=>{const c=await st({status:n||void 0,search:ne||void 0,docType:v||void 0}),y=URL.createObjectURL(c),T=document.createElement("a");T.href=y,T.download=`compras-${new Date().toISOString().split("T")[0]}.csv`,T.rel="noopener",document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(y)}});const le=c=>{if(c.status?.toLowerCase()==="cancelled"){window.alert("La compra ya fue cancelada.");return}window.confirm(`Cancelar compra ${c.docNumber??c.id}?`)&&pe.mutate(c.id)},X=c=>{const y=window.prompt("Documento",c.docType??"");if(y===null)return;const T=window.prompt("Numero",c.docNumber??"");if(T===null)return;const O={docType:y.trim()||c.docType,docNumber:T.trim()||c.docNumber};he.mutate({id:c.id,payload:O})},ge=b.useMemo(()=>[{header:"Fecha",accessorKey:"issuedAt",cell:c=>new Date(c.getValue()).toLocaleDateString("es-ES"),enableSorting:!0,sortingFn:"datetime"},{header:"Documento",accessorKey:"docType",cell:c=>c.getValue()??"Factura",enableSorting:!1},{header:"Numero",accessorKey:"docNumber",cell:c=>c.getValue()??"-",enableSorting:!1},{header:"Proveedor",accessorFn:c=>c.supplierName??c.supplierId??"-",cell:c=>c.getValue()??"-",enableSorting:!0},{header:"Estado",accessorKey:"status",cell:c=>{const y=(c.getValue()??"").toLowerCase(),O={received:{icon:"üü¢",label:"Recibida",className:"bg-green-950 text-green-400 border-green-800"},pending:{icon:"üü°",label:"Pendiente",className:"bg-yellow-950 text-yellow-400 border-yellow-800"},cancelled:{icon:"üî¥",label:"Cancelada",className:"bg-red-950 text-red-400 border-red-800"},intransit:{icon:"‚è≥",label:"En tr√°nsito",className:"bg-blue-950 text-blue-400 border-blue-800"},completed:{icon:"‚úÖ",label:"Completada",className:"bg-neutral-700 text-neutral-300 border-neutral-600"}}[y]??{icon:"‚ö™",label:y||"Desconocido",className:"bg-neutral-800 text-neutral-400 border-neutral-700"};return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-medium border ${O.className}`,children:[e.jsx("span",{children:O.icon}),e.jsx("span",{children:O.label})]})},enableSorting:!1},{header:"Neto",accessorKey:"net",cell:c=>`$${Number(c.getValue()).toLocaleString()}`,enableSorting:!0,sortingFn:"alphanumeric"},{header:"IVA",accessorKey:"vat",cell:c=>`$${Number(c.getValue()).toLocaleString()}`,enableSorting:!0,sortingFn:"alphanumeric"},{header:"Total",accessorKey:"total",cell:c=>`$${Number(c.getValue()).toLocaleString()}`,enableSorting:!0,sortingFn:"alphanumeric"},{id:"actions",header:"Acciones",enableSorting:!1,cell:({row:c})=>e.jsxs("div",{className:"table-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>i(c.original.id),children:"Comprobante"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>H.mutate(c.original),disabled:H.isPending,children:H.isPending?"Descargando...":"Descargar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>X(c.original),children:"Editar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>le(c.original),children:"Cancelar"})]})}],[H.isPending]),V=ct({data:U?.content??[],columns:ge,getCoreRowModel:ut(),getSortedRowModel:mt(),manualPagination:!0,pageCount:U?.totalPages??-1,state:{sorting:f,pagination:{pageIndex:u,pageSize:we}},onSortingChange:N,onPaginationChange:c=>{const y=typeof c=="function"?c({pageIndex:u,pageSize:we}).pageIndex:c.pageIndex;h(y)},enableSorting:!0});return e.jsxs("div",{className:"page-section bg-neutral-950",children:[e.jsx(nt,{title:"Compras y abastecimiento",description:"Controla ordenes, recepciones y presupuestos para evitar quiebres.",actions:e.jsx("button",{className:"btn",onClick:()=>p(!0),children:"+ Nueva orden"})}),e.jsx("div",{className:"mb-8",children:e.jsx(bt,{})}),e.jsxs("div",{className:"mb-8 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"üìä An√°lisis ABC de Proveedores"}),e.jsx(jt,{}),e.jsx(Nt,{}),e.jsx(vt,{})]}),e.jsxs("div",{className:"mb-8 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"üîÆ Pron√≥stico de Demanda"}),e.jsx(ft,{}),e.jsx(Ct,{}),e.jsx(yt,{})]}),e.jsx(St,{startDate:F,endDate:M,statusFilter:n}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"filter-bar",children:[e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",placeholder:"Buscar (doc, numero, proveedor)",value:j,onChange:c=>m(c.target.value)}),j&&e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>m(""),children:"Limpiar"}),e.jsx("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:n,onChange:c=>o(c.target.value),children:Lt.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>q(!$),children:$?"üîΩ Ocultar filtros":"üîº M√°s filtros"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>d(!0),children:"üìä Exportar Avanzado"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>x(!0),children:"Importar CSV"})]}),$&&e.jsxs("div",{className:"filter-bar",style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid #404040",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.5rem"},children:[e.jsxs("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:v,onChange:c=>A(c.target.value),children:[e.jsx("option",{value:"",children:"Todos los tipos de documento"}),e.jsx("option",{value:"Factura",children:"Factura"}),e.jsx("option",{value:"Boleta",children:"Boleta"}),e.jsx("option",{value:"Cotizaci√≥n",children:"Cotizaci√≥n"}),e.jsx("option",{value:"Orden de Compra",children:"Orden de Compra"}),e.jsx("option",{value:"Gu√≠a de Despacho",children:"Gu√≠a de Despacho"})]}),e.jsxs("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:D,onChange:c=>R(c.target.value),children:[e.jsx("option",{value:"",children:"Todos los proveedores"}),xe.data?.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"number",placeholder:"Monto m√≠nimo",value:I,onChange:c=>_(c.target.value)}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"number",placeholder:"Monto m√°ximo",value:P,onChange:c=>z(c.target.value)}),(v||D||I||P)&&e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>{A(""),R(""),_(""),z("")},children:"Limpiar filtros avanzados"})]})]}),e.jsx(wt,{startDate:F,endDate:M,onStartDateChange:G,onEndDateChange:Ne}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4",children:[e.jsx(At,{startDate:F,endDate:M}),e.jsx(Tt,{startDate:F,endDate:M})]}),e.jsx(Dt,{startDate:F,endDate:M}),e.jsx(Pt,{startDate:F,endDate:M}),e.jsx(It,{startDate:F,endDate:M,statusFilter:n}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:"1.5rem",marginBottom:"1.5rem"},children:[e.jsx(Ft,{startDate:F,endDate:M,statusFilter:n}),e.jsx(kt,{startDate:F,endDate:M,statusFilter:n})]}),e.jsx(Mt,{startDate:F,endDate:M,statusFilter:n}),e.jsx(Ot,{startDate:F,endDate:M,statusFilter:n}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 table-card",children:[e.jsx("h3",{className:"text-neutral-100",children:"Ordenes recientes"}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:V.getHeaderGroups().map(c=>e.jsx("tr",{children:c.headers.map(y=>e.jsx("th",{onClick:y.column.getCanSort()?y.column.getToggleSortingHandler():void 0,style:{cursor:y.column.getCanSort()?"pointer":"default",userSelect:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[$e(y.column.columnDef.header,y.getContext()),y.column.getCanSort()&&e.jsx("span",{style:{opacity:.5},children:{asc:"‚Üë",desc:"‚Üì"}[y.column.getIsSorted()]??"‚Üï"})]})},y.id))},c.id))}),e.jsx("tbody",{children:V.getRowModel().rows.map(c=>e.jsx("tr",{children:c.getVisibleCells().map(y=>e.jsx("td",{children:$e(y.column.columnDef.cell,y.getContext())},y.id))},c.id))})]})}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"btn",disabled:u===0,onClick:()=>h(c=>Math.max(0,c-1)),children:"Anterior"}),e.jsxs("span",{className:"muted text-neutral-400",children:["Pagina ",u+1," de ",U?.totalPages??1]}),e.jsx("button",{className:"btn",disabled:u+1>=(U?.totalPages??1),onClick:()=>h(c=>c+1),children:"Siguiente"})]})]}),e.jsx(ht,{open:g,onClose:()=>p(!1),onCreated:()=>r.invalidateQueries({queryKey:["purchases"]})}),e.jsx(gt,{open:a,onClose:()=>x(!1),onImported:()=>r.invalidateQueries({queryKey:["purchases"]})}),e.jsx($t,{open:t,onClose:()=>d(!1),startDate:F,endDate:M,statusFilter:n}),e.jsxs(Ee,{open:!!s,onClose:()=>i(null),title:"Detalle del Comprobante de Compra",children:[w.isLoading&&e.jsx("p",{children:"Cargando detalle..."}),w.error&&e.jsxs("p",{className:"error",children:["Error al cargar: ",w.error.message]}),w.data&&e.jsxs("div",{className:"document-detail",children:[e.jsxs("section",{className:"document-detail__header",children:[e.jsxs("div",{className:"document-detail__title-row",children:[e.jsx("h2",{className:"document-detail__title",children:w.data.docType||"Compra"}),e.jsxs("p",{className:"document-detail__number",children:["#",w.data.docNumber??w.data.id]})]}),e.jsxs("div",{className:"document-detail__meta-grid",children:[e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Fecha Emisi√≥n"}),e.jsx("span",{className:"document-detail__meta-value",children:w.data.issuedAt?new Date(w.data.issuedAt).toLocaleString("es-CL"):"‚Äî"})]}),w.data.receivedAt&&e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Fecha Recepci√≥n"}),e.jsx("span",{className:"document-detail__meta-value",children:new Date(w.data.receivedAt).toLocaleString("es-CL")})]}),e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Proveedor"}),e.jsx("span",{className:"document-detail__meta-value",children:w.data.supplier?.name??"‚Äî"})]}),e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"T√©rminos de pago"}),e.jsx("span",{className:"document-detail__meta-value",children:w.data.paymentTermDays>0?`${w.data.paymentTermDays} d√≠as`:"Sin t√©rminos de pago"})]}),e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Estado"}),e.jsx("span",{className:"document-detail__meta-value",children:w.data.status})]}),e.jsxs("div",{className:"document-detail__meta-item document-detail__meta-item--highlight",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Total"}),e.jsx("span",{className:"document-detail__meta-value document-detail__meta-value--highlight",children:te(w.data.total)})]})]})]}),e.jsx("div",{className:"document-detail__items table-wrapper compact",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"Descripci√≥n"}),e.jsx("th",{className:"mono",children:"Cantidad"}),e.jsx("th",{className:"mono",children:"Costo Unit."}),e.jsx("th",{className:"mono",children:"Info Adicional"}),e.jsx("th",{className:"mono",children:"Total"})]})}),e.jsx("tbody",{children:w.data.items.map((c,y)=>{const T=c.qty*c.unitCost,O=c.productName||c.serviceName||"Item";return e.jsxs("tr",{children:[e.jsx("td",{className:"mono",children:c.productSku??"‚Äî"}),e.jsx("td",{children:e.jsx("span",{className:"document-detail__description",title:O,children:O})}),e.jsx("td",{className:"mono",children:c.qty}),e.jsx("td",{className:"mono",children:te(c.unitCost)}),e.jsxs("td",{className:"mono",style:{fontSize:"0.85rem",color:"#666"},children:[c.expDate&&`Venc: ${new Date(c.expDate).toLocaleDateString("es-CL")}`,c.mfgDate&&` | Fab: ${new Date(c.mfgDate).toLocaleDateString("es-CL")}`,c.locationCode&&` | üìç ${c.locationCode}`]}),e.jsx("td",{className:"mono",children:te(T)})]},`${c.id}-${y}`)})})]})}),e.jsxs("section",{className:"document-detail__totals",children:[e.jsxs("div",{className:"document-detail__totals-row",children:[e.jsx("span",{className:"document-detail__totals-label",children:"Neto"}),e.jsx("span",{className:"document-detail__totals-value mono",children:te(w.data.net)})]}),e.jsxs("div",{className:"document-detail__totals-row",children:[e.jsx("span",{className:"document-detail__totals-label",children:"IVA (19%)"}),e.jsx("span",{className:"document-detail__totals-value mono",children:te(w.data.vat)})]}),e.jsxs("div",{className:"document-detail__totals-row document-detail__totals-row--total",children:[e.jsx("span",{className:"document-detail__totals-label",children:"Total"}),e.jsx("span",{className:"document-detail__totals-value mono",children:te(w.data.total)})]})]}),e.jsx("div",{className:"document-detail__actions",children:e.jsx("button",{className:"btn",onClick:()=>i(null),children:"Cerrar"})})]})]})]})}export{Ht as default};
