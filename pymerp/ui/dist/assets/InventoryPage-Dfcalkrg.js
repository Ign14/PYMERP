import{S as de,u as U,c as L,j as e,T as ce,U as me,m as le,V as ue,W as xe,X as he,Y as pe,Z as ge,G as ae,_ as be,k as q,q as je,$ as Ne,a0 as ve,a1 as ye,a2 as fe,a3 as Ce,a4 as V,a5 as Se,a6 as we,a7 as W,a8 as _,a9 as ke,aa as Pe,ab as Ae}from"./index-DBJ25f9Z.js";import{r as y,d as Fe}from"./react-D8kvZI4c.js";import{u as w}from"./useQuery-DOGxExcK.js";import{P as Le}from"./PageHeader-C82fAhp-.js";import{M as D}from"./Modal-BqzbBRVa.js";import{c as G}from"./currency-HwQAg_Xa.js";import{R as H,B as Y,C as X,X as Z,Y as J,T as ee,a as se,g as $,f as ie}from"./charts-BH7DIlZU.js";function Ie(){const{session:s}=de(),[a,p]=y.useState(null),[l,i]=y.useState(!1),[m,r]=y.useState(null),[n,o]=y.useState({code:"",name:"",description:"",type:"WAREHOUSE",parentLocationId:void 0,active:!0,isBlocked:!1,capacity:void 0,capacityUnit:"UNITS"}),c=U(),x=w({queryKey:["locations"],queryFn:()=>le()}),d=w({queryKey:["parent-locations",s?.companyId],queryFn:()=>ue(s?.companyId??""),enabled:!!s?.companyId}),b=w({queryKey:["location-stock-summary"],queryFn:xe}),t=L({mutationFn:u=>ce(u),onSuccess:()=>{c.invalidateQueries({queryKey:["locations"]}),c.invalidateQueries({queryKey:["location-stock-summary"]}),i(!1),C()}}),g=L({mutationFn:u=>me(u),onSuccess:()=>{c.invalidateQueries({queryKey:["locations"]}),c.invalidateQueries({queryKey:["location-stock-summary"]}),p(null)}}),C=()=>{o({code:"",name:"",description:"",type:"WAREHOUSE",parentLocationId:void 0,active:!0,isBlocked:!1,capacity:void 0,capacityUnit:"UNITS"}),r(null)},j=u=>{u?(r(u),o({code:u.code,name:u.name,description:u.description,type:u.type,parentLocationId:u.parentLocationId,active:u.active,isBlocked:u.isBlocked,capacity:u.capacity,capacityUnit:u.capacityUnit||"UNITS"})):C(),i(!0)},S=u=>{if(u.preventDefault(),!n.code||!n.name){alert("CÃ³digo y nombre son requeridos");return}t.mutate(n)},h=()=>{a&&window.confirm(`Â¿Eliminar ubicaciÃ³n ${a.name}?`)&&g.mutate(a.id)},k=x.data??[],N=b.data??[],v=k.reduce((u,P)=>(u[P.type]||(u[P.type]=[]),u[P.type].push(P),u),{}),A=a?N.find(u=>u.locationId===a.id):null;return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Ubicaciones"}),e.jsx("p",{className:"muted small",children:"Gestiona las ubicaciones fÃ­sicas del inventario"})]}),e.jsxs("div",{className:"inline-actions",children:[e.jsx("button",{className:"btn primary",type:"button",onClick:()=>j(),children:"+ Nueva UbicaciÃ³n"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>c.invalidateQueries({queryKey:["locations"]}),disabled:x.isFetching,children:x.isFetching?"Cargando...":"Refrescar"})]}),x.isLoading&&e.jsx("p",{children:"Cargando ubicaciones..."}),x.isError&&e.jsx("p",{className:"error",children:x.error.message}),!x.isLoading&&!x.isError&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"locations-grid",children:[e.jsx("div",{className:"locations-list",children:Object.entries(v).map(([u,P])=>e.jsxs("div",{className:"location-type-section",children:[e.jsx("h3",{className:"location-type-title",children:u}),e.jsx("div",{className:"location-items",children:P.map(f=>{const I=N.find(B=>B.locationId===f.id)?.products.length??0,T=a?.id===f.id;return e.jsxs("div",{className:`location-item${T?" selected":""}`,onClick:()=>p(f),style:{opacity:f.active?1:.6,border:f.isBlocked?"2px solid var(--warning)":void 0},children:[e.jsxs("div",{className:"location-item-header",children:[e.jsx("span",{className:"location-code mono",children:f.code}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem",alignItems:"center"},children:[!f.active&&e.jsx("span",{className:"location-badge",style:{background:"var(--error)",color:"white",fontSize:"0.75rem"},children:"Inactiva"}),f.isBlocked&&e.jsx("span",{className:"location-badge",style:{background:"var(--warning)",color:"white",fontSize:"0.75rem"},children:"ðŸ”’ Bloqueada"}),I>0&&e.jsxs("span",{className:"location-badge",children:[I," productos"]})]})]}),e.jsx("div",{className:"location-name",children:f.name}),f.parentLocationId&&e.jsx("div",{className:"location-parent muted small",children:"ðŸ“ UbicaciÃ³n padre configurada"}),f.capacity&&e.jsxs("div",{className:"location-parent muted small",children:["ðŸ“¦ Capacidad: ",f.capacity," ",f.capacityUnit||"unidades"]}),f.description&&e.jsx("div",{className:"location-description muted small",children:f.description})]},f.id)})})]},u))}),e.jsx("div",{className:"location-details",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"panel",children:[e.jsx("h3",{className:"panel-title",children:"Detalles de UbicaciÃ³n"}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"CÃ³digo:"}),e.jsx("span",{className:"mono",children:a.code})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Nombre:"}),e.jsx("span",{children:a.name})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Tipo:"}),e.jsx("span",{children:a.type})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Estado:"}),e.jsxs("span",{children:[a.active?e.jsx("span",{style:{color:"var(--success-color)"},children:"âœ“ Activa"}):e.jsx("span",{style:{color:"var(--error-color)"},children:"âœ— Inactiva"}),a.isBlocked&&e.jsx("span",{style:{color:"var(--warning)",marginLeft:"0.5rem"},children:"ðŸ”’ Bloqueada"})]})]}),a.capacity&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Capacidad:"}),e.jsxs("span",{className:"mono",children:[a.capacity," ",a.capacityUnit||"unidades"]})]}),a.parentLocationId&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"UbicaciÃ³n Padre:"}),e.jsx("span",{children:(()=>{const u=d.data?.find(P=>P.id===a.parentLocationId)||k.find(P=>P.id===a.parentLocationId);return u?e.jsxs("span",{className:"mono",style:{color:"var(--accent)"},children:["ðŸ“ ",u.code," - ",u.name]}):e.jsxs("span",{className:"muted",children:["ID: ",a.parentLocationId]})})()})]}),a.description&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"DescripciÃ³n:"}),e.jsx("span",{children:a.description})]}),e.jsxs("div",{className:"inline-actions",style:{marginTop:"1rem"},children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>j(a),children:"Editar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:h,disabled:g.isPending,children:g.isPending?"Eliminando...":"Eliminar"})]})]}),e.jsxs("div",{className:"panel",children:[e.jsx("h3",{className:"panel-title",children:"Productos en esta UbicaciÃ³n"}),b.isLoading&&e.jsx("p",{className:"muted",children:"Cargando stock..."}),A&&A.products.length>0?e.jsx("div",{className:"table-wrapper compact",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Lotes"})]})}),e.jsx("tbody",{children:A.products.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono small",children:u.productSku}),e.jsx("td",{children:u.productName}),e.jsx("td",{className:"mono",children:u.totalQuantity.toFixed(2)}),e.jsx("td",{className:"mono",children:u.lotCount})]},u.productId))})]})}):e.jsx("p",{className:"muted small",children:"No hay productos en esta ubicaciÃ³n"})]})]}):e.jsx("div",{className:"empty-state",children:e.jsx("p",{className:"muted",children:"Selecciona una ubicaciÃ³n para ver detalles"})})})]})}),l&&e.jsx("div",{className:"modal-overlay",onClick:()=>i(!1),children:e.jsxs("div",{className:"modal",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:m?"Editar UbicaciÃ³n":"Nueva UbicaciÃ³n"}),e.jsx("button",{className:"btn-close",onClick:()=>i(!1),children:"Ã—"})]}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"CÃ³digo *"}),e.jsx("input",{className:"input",type:"text",required:!0,value:n.code,onChange:u=>o({...n,code:u.target.value}),placeholder:"Ej: ALM-01"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre *"}),e.jsx("input",{className:"input",type:"text",required:!0,value:n.name,onChange:u=>o({...n,name:u.target.value}),placeholder:"Ej: AlmacÃ©n Principal"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tipo"}),e.jsxs("select",{className:"input",value:n.type,onChange:u=>o({...n,type:u.target.value}),children:[e.jsx("option",{value:"WAREHOUSE",children:"WAREHOUSE"}),e.jsx("option",{value:"SHELF",children:"SHELF"}),e.jsx("option",{value:"BIN",children:"BIN"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"UbicaciÃ³n Padre (opcional)"}),e.jsxs("select",{className:"input",value:n.parentLocationId??"",onChange:u=>o({...n,parentLocationId:u.target.value||void 0}),children:[e.jsx("option",{value:"",children:"-- Sin ubicaciÃ³n padre --"}),d.data&&d.data.length>0&&e.jsx("optgroup",{label:"Ubicaciones Padre de la Empresa",children:d.data.map(u=>e.jsxs("option",{value:u.id,children:[u.code," - ",u.name]},u.id))}),k.length>0&&e.jsx("optgroup",{label:"Otras Ubicaciones",children:k.map(u=>e.jsxs("option",{value:u.id,children:[u.code," - ",u.name," (",u.type,")"]},u.id))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"DescripciÃ³n (opcional)"}),e.jsx("textarea",{className:"input",rows:3,value:n.description??"",onChange:u=>o({...n,description:u.target.value}),placeholder:"DescripciÃ³n de la ubicaciÃ³n"})]}),e.jsxs("div",{className:"form-group",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsx("label",{style:{gridColumn:"1 / -1",marginBottom:"-0.5rem"},children:"Estado"}),e.jsx("div",{children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:n.active??!0,onChange:u=>o({...n,active:u.target.checked})}),e.jsx("span",{children:"Activa"})]})}),e.jsx("div",{children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:n.isBlocked??!1,onChange:u=>o({...n,isBlocked:u.target.checked})}),e.jsx("span",{children:"Bloqueada"})]})})]}),e.jsxs("div",{className:"form-group",style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Capacidad mÃ¡xima (opcional)"}),e.jsx("input",{className:"input",type:"number",min:"0",step:"0.001",value:n.capacity||"",onChange:u=>o({...n,capacity:u.target.value?Number(u.target.value):void 0}),placeholder:"Ej: 1000"})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Unidad"}),e.jsxs("select",{className:"input",value:n.capacityUnit||"UNITS",onChange:u=>o({...n,capacityUnit:u.target.value}),children:[e.jsx("option",{value:"UNITS",children:"Unidades"}),e.jsx("option",{value:"PALLETS",children:"Pallets"}),e.jsx("option",{value:"CUBIC_METERS",children:"mÂ³"}),e.jsx("option",{value:"SQUARE_METERS",children:"mÂ²"}),e.jsx("option",{value:"KILOGRAMS",children:"Kg"})]})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>i(!1),disabled:t.isPending,children:"Cancelar"}),e.jsx("button",{className:"btn primary",type:"submit",disabled:t.isPending,children:t.isPending?"Guardando...":m?"Actualizar":"Crear"})]}),t.isError&&e.jsx("p",{className:"error",children:t.error?.message??"Error al guardar"})]})]})})]})}function Ee(){const[s,a]=y.useState(null),[p,l]=y.useState(!1),[i,m]=y.useState(null),[r,n]=y.useState("active"),[o,c]=y.useState({code:"",name:"",description:"",active:!0}),x=U(),d=w({queryKey:["services",{status:r}],queryFn:()=>r==="all"?ae():ae(r==="active")}),b=L({mutationFn:v=>he(v),onSuccess:v=>{x.invalidateQueries({queryKey:["services"]}),l(!1),a(v),C()}}),t=L({mutationFn:({id:v,payload:A})=>pe(v,A),onSuccess:()=>{x.invalidateQueries({queryKey:["services"]}),l(!1),C()}}),g=L({mutationFn:v=>ge(v),onSuccess:()=>{x.invalidateQueries({queryKey:["services"]}),a(null)}}),C=()=>{c({code:"",name:"",description:"",active:!0}),m(null)},j=v=>{v?(m(v),c({code:v.code,name:v.name,description:v.description,active:v.active})):C(),l(!0)},S=v=>{if(v.preventDefault(),!o.code||!o.name){alert("CÃ³digo y nombre son requeridos");return}i?t.mutate({id:i.id,payload:o}):b.mutate(o)},h=()=>{s&&window.confirm(`Â¿Eliminar servicio ${s.name}?`)&&g.mutate(s.id)},k=d.data??[],N=v=>v?new Date(v).toLocaleDateString("es-CL",{year:"numeric",month:"short",day:"numeric"}):"Nunca";return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Servicios"}),e.jsx("p",{className:"muted small",children:"Gestiona servicios que no requieren inventario"})]})}),e.jsxs("div",{className:"inline-actions",children:[e.jsxs("select",{className:"input",value:r,onChange:v=>n(v.target.value),children:[e.jsx("option",{value:"active",children:"Activos"}),e.jsx("option",{value:"inactive",children:"Inactivos"}),e.jsx("option",{value:"all",children:"Todos"})]}),e.jsx("button",{className:"btn primary",type:"button",onClick:()=>j(),children:"+ Nuevo Servicio"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>x.invalidateQueries({queryKey:["services"]}),disabled:d.isFetching,children:d.isFetching?"Cargando...":"Refrescar"})]}),d.isLoading&&e.jsx("p",{children:"Cargando servicios..."}),d.isError&&e.jsx("p",{className:"error",children:d.error.message}),!d.isLoading&&!d.isError&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"CÃ³digo"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Ãšltima Compra"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:k.map(v=>{const A=s?.id===v.id;return e.jsxs("tr",{className:A?"selected":"",onClick:()=>a(v),children:[e.jsx("td",{className:"mono",children:v.code}),e.jsx("td",{children:v.name}),e.jsx("td",{className:"mono small",children:N(v.lastPurchaseDate)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${v.active?"badge-success":"badge-muted"}`,children:v.active?"Activo":"Inactivo"})}),e.jsx("td",{children:e.jsx("button",{className:"btn ghost small",type:"button",onClick:u=>{u.stopPropagation(),j(v)},children:"Editar"})})]},v.id)})})]})}),k.length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{className:"muted",children:"No hay servicios registrados"})}),s&&e.jsxs("div",{className:"panel",children:[e.jsx("h3",{className:"panel-title",children:"Detalles del Servicio"}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"CÃ³digo:"}),e.jsx("span",{className:"mono",children:s.code})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Nombre:"}),e.jsx("span",{children:s.name})]}),s.description&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"DescripciÃ³n:"}),e.jsx("span",{children:s.description})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Ãšltima compra:"}),e.jsx("span",{children:N(s.lastPurchaseDate)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Estado:"}),e.jsx("span",{children:s.active?"Activo":"Inactivo"})]}),e.jsxs("div",{className:"inline-actions",style:{marginTop:"1rem"},children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>j(s),children:"Editar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:h,disabled:g.isPending,children:g.isPending?"Eliminando...":"Eliminar"})]})]})]}),p&&e.jsx("div",{className:"modal-overlay",onClick:()=>l(!1),children:e.jsxs("div",{className:"modal",onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:i?"Editar Servicio":"Nuevo Servicio"}),e.jsx("button",{className:"btn-close",onClick:()=>l(!1),children:"Ã—"})]}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"CÃ³digo *"}),e.jsx("input",{className:"input",type:"text",required:!0,value:o.code,onChange:v=>c({...o,code:v.target.value}),placeholder:"Ej: SRV-001"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre *"}),e.jsx("input",{className:"input",type:"text",required:!0,value:o.name,onChange:v=>c({...o,name:v.target.value}),placeholder:"Ej: ConsultorÃ­a de TI"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"DescripciÃ³n (opcional)"}),e.jsx("textarea",{className:"input",rows:3,value:o.description??"",onChange:v=>c({...o,description:v.target.value}),placeholder:"DescripciÃ³n del servicio"})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.active??!0,onChange:v=>c({...o,active:v.target.checked})}),"Activo"]})}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>l(!1),disabled:b.isPending||t.isPending,children:"Cancelar"}),e.jsx("button",{className:"btn primary",type:"submit",disabled:b.isPending||t.isPending,children:b.isPending||t.isPending?"Guardando...":i?"Actualizar":"Crear"})]}),(b.isError||t.isError)&&e.jsx("p",{className:"error",children:(b.error||t.error)?.message??"Error al guardar"})]})]})})]})}const Q={productId:"",direction:"increase",quantity:"0",unitCost:"0",reason:"",expDate:""};function qe({open:s,onClose:a,onApplied:p}){const[l,i]=y.useState(Q);y.useEffect(()=>{s||i(Q)},[s]);const m=w({queryKey:["products",{dialog:"inventory-adjustment"}],queryFn:()=>q({size:200,status:"all"}),enabled:s}),r=y.useMemo(()=>m.data?.content??[],[m.data]),n=L({mutationFn:()=>{if(!l.productId)throw new Error("Selecciona un producto");const c=Number(l.quantity);if(!Number.isFinite(c)||c<=0)throw new Error("La cantidad debe ser mayor a cero");const x=l.direction,d=Number(l.unitCost||0);if(x==="increase"&&(Number.isNaN(d)||d<0))throw new Error("El costo unitario debe ser positivo");const b={productId:l.productId,quantity:c,direction:x,reason:l.reason.trim()||"Ajuste manual",unitCost:x==="increase"?d:void 0,expDate:l.expDate||void 0};return be(b)},onSuccess:()=>{p?.(),i(Q),a()}}),o=c=>{c.preventDefault(),!n.isPending&&n.mutate()};return e.jsx(D,{open:s,title:"Ajuste de stock",onClose:()=>{n.isPending||a()},children:e.jsxs("form",{className:"form-grid",onSubmit:o,children:[e.jsxs("label",{children:[e.jsx("span",{children:"Producto *"}),e.jsxs("select",{className:"input",value:l.productId,onChange:c=>i(x=>({...x,productId:c.target.value})),disabled:n.isPending,required:!0,children:[e.jsx("option",{value:"",children:"Selecciona un producto"}),r.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Tipo de ajuste"}),e.jsxs("select",{className:"input",value:l.direction,onChange:c=>i(x=>({...x,direction:c.target.value})),disabled:n.isPending,children:[e.jsx("option",{value:"increase",children:"Incremento"}),e.jsx("option",{value:"decrease",children:"Disminucion"})]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Cantidad *"}),e.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",value:l.quantity,onChange:c=>i(x=>({...x,quantity:c.target.value})),disabled:n.isPending,required:!0})]}),l.direction==="increase"&&e.jsxs("label",{children:[e.jsx("span",{children:"Costo unitario"}),e.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",value:l.unitCost,onChange:c=>i(x=>({...x,unitCost:c.target.value})),disabled:n.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Fecha de vencimiento"}),e.jsx("input",{className:"input",type:"date",value:l.expDate,onChange:c=>i(x=>({...x,expDate:c.target.value})),disabled:n.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Motivo"}),e.jsx("textarea",{className:"input",rows:3,value:l.reason,onChange:c=>i(x=>({...x,reason:c.target.value})),placeholder:"Regularizacion, inventario, merma, etc.",disabled:n.isPending})]}),n.isError&&e.jsx("p",{className:"error",children:n.error?.message??"No se pudo registrar el ajuste"}),e.jsxs("div",{className:"buttons",children:[e.jsx("button",{className:"btn",type:"submit",disabled:n.isPending,children:n.isPending?"Guardando...":"Registrar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:a,disabled:n.isPending,children:"Cancelar"})]})]})})}const De="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20160%20160'%20role='img'%20aria-label='Producto%20sin%20imagen'%3e%3cdefs%3e%3clinearGradient%20id='bg'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%231f2937'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23111827'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='160'%20height='160'%20fill='url(%23bg)'%20rx='24'%20ry='24'%20/%3e%3cpath%20d='M48%2052c0-8.837%207.163-16%2016-16h32c8.837%200%2016%207.163%2016%2016v56c0%208.837-7.163%2016-16%2016H64c-8.837%200-16-7.163-16-16V52zm16-4a12%2012%200%200%200-12%2012v4.382l11.172-11.172a4%204%200%200%201%205.656%200L92%2094.343l10.828-10.828a4%204%200%200%201%205.656%200L112%2086V60a12%2012%200%200%200-12-12H64zm0%2096c-13.255%200-24-10.745-24-24V60c0-13.255%2010.745-24%2024-24h32c13.255%200%2024%2010.745%2024%2024v60c0%2013.255-10.745%2024-24%2024H64z'%20fill='%2360a5fa'%20fill-opacity='0.35'%20/%3e%3ccircle%20cx='64'%20cy='64'%20r='12'%20fill='%23ffffff'%20fill-opacity='0.08'%20/%3e%3c/svg%3e",Te=12;function Be({open:s,onClose:a,onSelectProduct:p}){const[l,i]=y.useState(""),[m,r]=y.useState(0),[n,o]=y.useState("active"),c=w({queryKey:["products",{q:l,page:m,status:n}],queryFn:()=>q({q:l||void 0,page:m,size:Te,status:n}),placeholderData:je,enabled:s}),x=c.data?.content??[],d=c.data?.totalPages??1,b=t=>{p(t)};return e.jsx(D,{open:s,onClose:a,title:"CatÃ¡logo de productos",className:"modal-wide",children:e.jsxs("div",{style:{width:"100%",maxWidth:"1000px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"var(--bg-secondary)",borderRadius:"12px",border:"1px solid var(--border-color)"},children:[e.jsx("input",{className:"input",type:"text",placeholder:"ðŸ” Buscar por nombre, SKU o cÃ³digo...",value:l,onChange:t=>{i(t.target.value),r(0)},"data-autofocus":!0,style:{fontSize:"0.95rem"}}),e.jsxs("select",{className:"input",value:n,onChange:t=>{o(t.target.value),r(0)},style:{minWidth:"140px"},children:[e.jsx("option",{value:"active",children:"âœ“ Activos"}),e.jsx("option",{value:"inactive",children:"âœ— Inactivos"}),e.jsx("option",{value:"all",children:"ðŸ“‹ Todos"})]})]}),c.isLoading&&e.jsx("p",{className:"muted",style:{textAlign:"center",padding:"2rem"},children:"Cargando productos..."}),c.isError&&e.jsx("p",{className:"error",style:{textAlign:"center",padding:"2rem"},children:c.error?.message??"No se pudieron cargar los productos"}),!c.isLoading&&x.length===0&&e.jsx("p",{className:"muted",style:{textAlign:"center",padding:"2rem"},children:"No se encontraron productos"}),!c.isLoading&&x.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:"1.25rem",marginBottom:"1.5rem"},children:x.map(t=>{const g=typeof t.imageUrl=="string"&&t.imageUrl.trim().length>0?t.imageUrl:De,C=t.currentPrice&&Number(t.currentPrice)>0?`$${Number(t.currentPrice).toLocaleString()}`:"Sin precio";return e.jsxs("button",{type:"button",onClick:()=>b(t),className:"product-catalog-card",children:[e.jsxs("div",{className:"product-catalog-card-image-wrapper",children:[e.jsx("img",{src:g,alt:t.name,className:"product-catalog-card-image"}),!t.active&&e.jsx("span",{className:"product-catalog-card-badge-inactive",children:"Inactivo"})]}),e.jsxs("div",{className:"product-catalog-card-content",children:[e.jsx("h4",{className:"product-catalog-card-title",title:t.name,children:t.name}),e.jsx("p",{className:"product-catalog-card-sku",children:t.sku}),e.jsxs("div",{className:"product-catalog-card-footer",children:[e.jsx("span",{className:"product-catalog-card-label",children:"Precio"}),e.jsx("span",{className:"product-catalog-card-price",children:C})]}),t.category&&e.jsx("span",{className:"product-catalog-card-category",title:t.category,children:t.category})]})]},t.id)})}),d>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"0.5rem",paddingTop:"1rem",borderTop:"1px solid var(--border-color)"},children:[e.jsx("button",{className:"btn ghost small",onClick:()=>r(t=>Math.max(0,t-1)),disabled:m===0,children:"â€¹ Anterior"}),e.jsxs("span",{className:"muted small",children:["PÃ¡gina ",m+1," de ",d]}),e.jsx("button",{className:"btn ghost small",onClick:()=>r(t=>Math.min(d-1,t+1)),disabled:m>=d-1,children:"Siguiente â€º"})]})]})]})})}const R={targetLocationId:"",qty:"",note:""};function Me({open:s,lot:a,productName:p,onClose:l,onTransferred:i}){const[m,r]=y.useState(R),[n,o]=y.useState(null),c=a?.quantity??0,x=y.useMemo(()=>a?a.locationCode&&a.locationName?`${a.locationCode} Â· ${a.locationName}`:a.locationCode?a.locationCode:a.locationName?a.locationName:"Sin ubicaciÃ³n asignada":"â€”",[a]);y.useEffect(()=>{if(!s){r(R),o(null);return}r(j=>({...R,qty:c>0?String(Math.min(c,1)):""})),o(null)},[s,c]);const d=w({queryKey:["locations"],queryFn:()=>le(),enabled:s,staleTime:300*1e3}),b=y.useMemo(()=>!d.data||!a?.locationId?d.data??[]:d.data.filter(j=>j.id!==a.locationId),[d.data,a?.locationId]),t=L({mutationFn:async()=>{if(!a)throw new Error("No hay lote seleccionado");const j=Number(m.qty);if(!Number.isFinite(j)||j<=0)throw new Error("La cantidad debe ser mayor a 0");if(j>c)throw new Error(`La cantidad no puede superar ${c}`);if(!m.targetLocationId)throw new Error("Selecciona una ubicaciÃ³n destino");const S={targetLocationId:m.targetLocationId,qty:j,note:m.note.trim()||void 0};await Ne(a.lotId,S)},onSuccess:()=>{r(R),i?.(),l()},onError:j=>{const S=Oe(j);o(S)}}),g=j=>{j.preventDefault(),!t.isPending&&(o(null),t.mutate())},C=!a||!m.targetLocationId||!m.qty||Number(m.qty)<=0||Number(m.qty)>c||b.length===0||t.isPending;return e.jsx(D,{open:s,onClose:l,title:"Transferir stock",className:"modal-card",children:e.jsxs("form",{onSubmit:g,style:{width:"100%",maxWidth:"480px"},children:[e.jsxs("section",{className:"transfer-summary",children:[e.jsx("p",{className:"muted small",children:"Producto"}),e.jsx("p",{style:{marginBottom:"0.75rem",fontWeight:600},children:p}),e.jsxs("div",{className:"summary-row",children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted small",children:"UbicaciÃ³n actual"}),e.jsx("p",{children:x})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted small",children:"Stock disponible"}),e.jsx("p",{className:"mono",children:c})]})]})]}),b.length===0&&!d.isLoading&&e.jsx("p",{className:"panel-error",style:{marginBottom:"1rem"},children:"No hay ubicaciones destino disponibles para transferir."}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("label",{className:"form-field",children:[e.jsx("span",{className:"label",children:"UbicaciÃ³n destino"}),e.jsxs("select",{className:"input",value:m.targetLocationId,onChange:j=>r(S=>({...S,targetLocationId:j.target.value})),disabled:d.isLoading||t.isPending||b.length===0,"data-autofocus":!0,children:[e.jsx("option",{value:"",children:"Selecciona una ubicaciÃ³nâ€¦"}),b.map(j=>e.jsxs("option",{value:j.id,children:[j.code," Â· ",j.name]},j.id))]}),d.isLoading&&e.jsx("span",{className:"muted small",children:"Cargando ubicacionesâ€¦"})]}),e.jsxs("label",{className:"form-field",children:[e.jsx("span",{className:"label",children:"Cantidad a transferir"}),e.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",value:m.qty,onChange:j=>r(S=>({...S,qty:j.target.value})),disabled:t.isPending}),e.jsxs("span",{className:"muted very-small",children:["MÃ¡ximo permitido: ",c]})]}),e.jsxs("label",{className:"form-field",children:[e.jsx("span",{className:"label",children:"Comentario (opcional)"}),e.jsx("textarea",{className:"input",rows:3,value:m.note,onChange:j=>r(S=>({...S,note:j.target.value})),placeholder:"Ej. mover a bodega principal",disabled:t.isPending})]})]}),n&&e.jsx("p",{className:"panel-error",style:{marginTop:"1rem"},children:n}),e.jsxs("footer",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"flex-end",gap:"0.75rem"},children:[e.jsx("button",{type:"button",className:"btn ghost",onClick:l,disabled:t.isPending,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn primary",disabled:C,children:t.isPending?"Transfiriendoâ€¦":"Transferir"})]})]})})}function Oe(s){if(ve.isAxiosError(s)){const a=s.response?.data;if(a){if(typeof a=="string")return a;if(typeof a=="object"){const p=a.message??a.detail??a.error;if(p&&typeof p=="string")return p}}return s.response?.statusText??"No se pudo completar la transferencia"}return s instanceof Error&&s.message?s.message:"No se pudo completar la transferencia"}function Re({open:s,product:a,pendingValue:p,submitting:l=!1,error:i,onClose:m,onSubmit:r}){const[n,o]=y.useState("0"),[c,x]=y.useState(null),d=y.useMemo(()=>{if(typeof p=="number")return p;const j=Number(a?.criticalStock??0);return Number.isFinite(j)&&j>=0?j:0},[p,a?.criticalStock]);y.useEffect(()=>{if(!s||!a){o("0"),x(null);return}o(String(d)),x(null)},[s,a?.id,d]);const b=j=>{j.preventDefault();const S=Number(n);if(!Number.isFinite(S)||S<0){x("Ingresa un stock vÃ¡lido (mayor o igual a 0)");return}x(null),r(S)},t=()=>{l||m()},g=a?`Stock crÃ­tico - ${a.name}`:"Stock crÃ­tico",C=!!c||!!i;return e.jsx(D,{open:s,title:g,onClose:t,children:e.jsxs("form",{className:"form-grid",onSubmit:b,children:[e.jsxs("label",{children:[e.jsx("span",{children:"Stock crÃ­tico"}),e.jsx("input",{className:`input${C?" input-error":""}`,type:"number",min:"0",step:"1",value:n,onChange:j=>o(j.target.value),disabled:l,"data-autofocus":!0,inputMode:"numeric"})]}),e.jsxs("div",{className:"buttons",children:[e.jsx("button",{className:"btn",type:"submit",disabled:l,children:l?"Guardando...":"Guardar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:t,disabled:l,children:"Cancelar"})]}),c&&e.jsx("p",{className:"error",children:c}),!c&&i&&e.jsx("p",{className:"error",children:i})]})})}function $e({open:s,product:a,onClose:p}){const[l,i]=y.useState("details"),[m,r]=y.useState(null),[n,o]=y.useState(!1),[c,x]=y.useState({price:0}),d=U(),b=w({queryKey:["product-prices",a?.id],queryFn:()=>{if(!a)throw new Error("Producto no seleccionado");return fe(a.id,{size:10})},enabled:!!a&&s}),t=w({queryKey:["product",a?.id,"stock"],queryFn:()=>{if(!a)throw new Error("Producto no seleccionado");return Ce(a.id)},enabled:!!a&&s}),g=b.data?.content??[],C=L({mutationFn:async()=>{if(!a)throw new Error("Producto no seleccionado");if(!c.price||c.price<=0)throw new Error("Ingresa un precio vÃ¡lido");return ye(a.id,c)},onSuccess:()=>{d.invalidateQueries({queryKey:["products"],exact:!1}),d.invalidateQueries({queryKey:["product-prices",a?.id]}),x({price:0}),i("prices")}}),j=N=>{N.preventDefault(),!C.isPending&&C.mutate()},S=N=>{if(typeof N=="number")return Number.isFinite(N)&&N>0?`$${N.toFixed(2)}`:"Sin precio";if(typeof N=="string"&&N.trim().length>0){const v=Number(N);return Number.isFinite(v)&&v>0?`$${v.toFixed(2)}`:"Sin precio"}return"Sin precio"},h=y.useMemo(()=>a?S(a.currentPrice):"",[a]),k=y.useMemo(()=>{if(!a?.criticalStock)return 0;const N=Number(a.criticalStock);return Number.isFinite(N)?N:0},[a]);return a?e.jsxs(e.Fragment,{children:[e.jsx(D,{open:s,onClose:p,title:a.name,className:"modal-wide",children:e.jsxs("div",{style:{width:"100%",maxWidth:"1000px"},children:[e.jsxs("div",{className:"tabs-container",children:[e.jsx("button",{className:`tab-button ${l==="details"?"active":""}`,onClick:()=>i("details"),type:"button",children:"ðŸ“‹ Detalles"}),e.jsx("button",{className:`tab-button ${l==="prices"?"active":""}`,onClick:()=>i("prices"),type:"button",children:"ðŸ’° Precios"}),e.jsx("button",{className:`tab-button ${l==="inventory"?"active":""}`,onClick:()=>i("inventory"),type:"button",children:"ðŸ“¦ Inventario"})]}),l==="details"&&e.jsx("div",{className:"tab-content",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",padding:"1.5rem",background:"var(--bg-secondary)",borderRadius:"12px",border:"1px solid var(--border-color)"},children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted small",children:"SKU"}),e.jsx("p",{style:{fontWeight:600,fontSize:"1.05rem"},children:a.sku})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted small",children:"Precio actual"}),e.jsx("p",{style:{fontWeight:600,fontSize:"1.05rem",color:"var(--accent)"},children:h})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted small",children:"CategorÃ­a"}),e.jsx("p",{style:{fontWeight:600,fontSize:"1.05rem"},children:a.category||"â€”"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted small",children:"Estado"}),e.jsx("p",{style:{fontWeight:600,fontSize:"1.05rem"},children:a.active?e.jsx("span",{style:{color:"var(--success-color)"},children:"âœ“ Activo"}):e.jsx("span",{style:{color:"var(--error-color)"},children:"âœ— Inactivo"})})]})]})}),l==="prices"&&e.jsxs("div",{className:"tab-content",children:[e.jsxs("form",{onSubmit:j,style:{padding:"1.5rem",background:"var(--bg-secondary)",borderRadius:"12px",border:"1px solid var(--border-color)",marginBottom:"1.5rem"},children:[e.jsx("h4",{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:600},children:"Actualizar precio"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"1rem"},children:[e.jsxs("label",{children:[e.jsx("span",{className:"muted small",children:"Nuevo precio"}),e.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",value:c.price||"",onChange:N=>x({price:Number(N.target.value)}),placeholder:"Ingresa el nuevo precio",disabled:C.isPending,required:!0})]}),e.jsx("button",{className:"btn primary",type:"submit",disabled:C.isPending,style:{alignSelf:"end"},children:C.isPending?"Guardando...":"Actualizar precio"})]}),C.isError&&e.jsx("p",{className:"error",style:{marginTop:"0.75rem"},children:C.error?.message??"No se pudo actualizar el precio"})]}),e.jsx("h4",{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:600},children:"HistÃ³rico de precios"}),b.isLoading&&e.jsx("p",{className:"muted",children:"Cargando precios..."}),b.isError&&e.jsx("p",{className:"error",children:b.error?.message??"No se pudieron cargar los precios"}),!b.isLoading&&g.length===0&&e.jsx("p",{className:"muted",children:"No hay histÃ³rico de precios"}),!b.isLoading&&g.length>0&&e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table compact",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Desde"})]})}),e.jsx("tbody",{children:g.map((N,v)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"mono",style:{fontWeight:600},children:["$",Number(N.price).toLocaleString()]}),e.jsx("td",{className:"mono small",children:new Date(N.validFrom).toLocaleString("es-CL",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})]},v))})]})})]}),l==="inventory"&&e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h4",{style:{fontSize:"1.1rem",fontWeight:600,margin:0},children:"Inventario"}),e.jsx("button",{className:"btn ghost small",type:"button",onClick:()=>o(!0),children:"Definir stock crÃ­tico"})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("p",{className:"muted",children:["Stock total:"," ",t.isLoading?"Cargando...":t.data?t.data.total:"Sin datos"]}),e.jsxs("p",{className:"muted",children:["Stock crÃ­tico configurado: ",k]})]}),t.isError&&e.jsx("p",{className:"error",children:t.error?.message??"No se pudo obtener el stock"}),t.isLoading&&e.jsx("p",{className:"muted",children:"Cargando lotes..."}),t.data&&t.data.lots.length>0&&e.jsx("div",{className:"table-wrapper compact",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Lote"}),e.jsx("th",{children:"Batch"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Costo Unit."}),e.jsx("th",{children:"Factura Origen"}),e.jsx("th",{children:"UbicaciÃ³n"}),e.jsx("th",{children:"Mfg."}),e.jsx("th",{children:"Vence"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:t.data.lots.map(N=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono small",children:N.lotId.substring(0,8)}),e.jsx("td",{className:"mono small",children:N.batchName||"â€”"}),e.jsx("td",{className:"mono",children:N.quantity}),e.jsx("td",{className:"mono small",children:N.costUnit?`$${N.costUnit.toLocaleString()}`:"â€”"}),e.jsx("td",{className:"mono small",children:N.purchaseDocNumber?e.jsxs("span",{style:{background:"var(--accent-soft)",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:["ðŸ“„ ",N.purchaseDocNumber]}):e.jsx("span",{style:{color:"var(--muted)"},children:"Sin factura"})}),e.jsx("td",{children:N.locationCode?e.jsx("span",{title:N.locationName||"",children:N.locationCode}):"â€”"}),e.jsx("td",{className:"mono small",children:N.manufactureDate?new Date(N.manufactureDate).toLocaleDateString("es-CL"):"â€”"}),e.jsx("td",{className:"mono small",children:N.expiryDate?new Date(N.expiryDate).toLocaleDateString("es-CL"):"â€”"}),e.jsx("td",{children:e.jsx("button",{className:"btn small primary",onClick:()=>r({product:a,lot:N}),type:"button",children:"Transferir"})})]},N.lotId))})]})}),t.data&&t.data.lots.length===0&&e.jsx("p",{className:"muted",style:{textAlign:"center",padding:"2rem"},children:"No hay lotes disponibles"})]})]})}),e.jsx(Me,{open:!!m,lot:m?.lot??null,productName:m?.product.name??"",onClose:()=>r(null),onTransferred:()=>{m?.product.id&&d.invalidateQueries({queryKey:["product",m.product.id,"stock"]}),d.invalidateQueries({queryKey:["inventoryMovements"],exact:!1})}}),e.jsx(Re,{open:n,product:a,onClose:()=>o(!1),onSubmit:async N=>{console.log("Update critical stock to:",N),o(!1)}})]}):null}async function Ue(s){const a=new URLSearchParams;s.productId&&a.append("productId",s.productId),s.type&&a.append("type",s.type),s.from&&a.append("from",s.from),s.to&&a.append("to",s.to),a.append("page",String(s.page??0)),a.append("size",String(s.size));const p=await fetch(`/api/v1/inventory/movements?${a}`);if(!p.ok)throw new Error("Error al cargar movimientos");return p.json()}const re=[{value:"",label:"Todos los tipos"},{value:"MANUAL_IN",label:"Entrada manual"},{value:"MANUAL_OUT",label:"Salida manual"},{value:"SALE_OUT",label:"Venta"},{value:"SALE_CANCEL",label:"CancelaciÃ³n venta"},{value:"PURCHASE_IN",label:"Compra"}];function Ke(){const[s,a]=y.useState(0),[p,l]=y.useState(""),[i,m]=y.useState(""),[r,n]=y.useState(""),o=w({queryKey:["inventory-movements",s,p,i,r],queryFn:()=>Ue({type:p||void 0,from:i?new Date(i).toISOString():void 0,to:r?new Date(r+"T23:59:59").toISOString():void 0,page:s,size:20})}),c=d=>re.find(b=>b.value===d)?.label??d,x=d=>{switch(d){case"MANUAL_IN":case"PURCHASE_IN":return"status active";case"MANUAL_OUT":case"SALE_OUT":return"status cancelled";case"SALE_CANCEL":return"status warning";default:return"status"}};return e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Historial de Movimientos (AuditorÃ­a)"}),e.jsx("p",{className:"muted",style:{marginBottom:"1rem"},children:"Registro completo de todos los movimientos de inventario con trazabilidad"}),e.jsxs("div",{className:"filter-bar",style:{marginBottom:"1rem"},children:[e.jsx("select",{className:"input",value:p,onChange:d=>{l(d.target.value),a(0)},children:re.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))}),e.jsx("input",{type:"date",className:"input",value:i,onChange:d=>{m(d.target.value),a(0)},placeholder:"Desde"}),e.jsx("input",{type:"date",className:"input",value:r,onChange:d=>{n(d.target.value),a(0)},placeholder:"Hasta"}),(p||i||r)&&e.jsx("button",{className:"btn ghost",onClick:()=>{l(""),m(""),n(""),a(0)},children:"Limpiar filtros"})]}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Stock Anterior"}),e.jsx("th",{children:"Stock Nuevo"}),e.jsx("th",{children:"Usuario"}),e.jsx("th",{children:"IP"}),e.jsx("th",{children:"Nota"})]})}),e.jsxs("tbody",{children:[o.isLoading&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"muted",children:"Cargando movimientos..."})}),o.isError&&e.jsx("tr",{children:e.jsxs("td",{colSpan:9,className:"error",children:["Error: ",o.error.message]})}),!o.isLoading&&!o.isError&&o.data?.content.map(d=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono small",children:new Date(d.createdAt).toLocaleString("es-CL")}),e.jsx("td",{children:e.jsx("span",{className:x(d.type),children:c(d.type)})}),e.jsx("td",{children:d.productName}),e.jsxs("td",{className:"mono",children:[d.type.includes("OUT")?"-":"+",Number(d.qty).toFixed(2)]}),e.jsx("td",{className:"mono",children:d.previousQty!=null?Number(d.previousQty).toFixed(2):"-"}),e.jsx("td",{className:"mono",children:d.newQty!=null?Number(d.newQty).toFixed(2):"-"}),e.jsx("td",{className:"small",children:d.createdBy??"Sistema"}),e.jsx("td",{className:"mono small",children:d.userIp??"-"}),e.jsx("td",{className:"small",children:d.note??"-"})]},d.id)),!o.isLoading&&!o.isError&&o.data?.content.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"muted",children:"No hay movimientos"})})]})]})}),o.data&&o.data.totalPages>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"btn",disabled:s===0,onClick:()=>a(d=>Math.max(0,d-1)),children:"Anterior"}),e.jsxs("span",{className:"muted",children:["PÃ¡gina ",s+1," de ",o.data.totalPages]}),e.jsx("button",{className:"btn",disabled:s+1>=o.data.totalPages,onClick:()=>a(d=>d+1),children:"Siguiente"})]}),o.data&&e.jsx("div",{style:{marginTop:"1rem",padding:"0.75rem",background:"#f5f5f5",borderRadius:"4px"},children:e.jsxs("p",{className:"muted small",children:[e.jsx("strong",{children:"Total de registros:"})," ",o.data.totalElements," movimientos"]})})]})}function ze(){y.useMemo(()=>G(),[]);const s=w({queryKey:["products-rotation"],queryFn:()=>q({size:200,status:"all"})}),a=s.data?.content??[],p=y.useMemo(()=>{const l=a.map(t=>{const g=Number(t.stock??0),j=Number(t.currentPrice??0)*.7,S=g*j,h=Math.random()*20;return{id:t.id,name:t.name??"Sin nombre",stock:g,value:S,rotation:h,category:t.category??"General"}}),i=l.reduce((t,g)=>t+g.value,0),m=[...l].sort((t,g)=>g.value-t.value);let r=0;const n=m.map(t=>{r+=t.value;const g=i>0?r/i*100:0;return{...t,class:g<=80?"A":g<=95?"B":"C"}}),o=n.filter(t=>t.class==="A"),c=n.filter(t=>t.class==="B"),x=n.filter(t=>t.class==="C"),d=[...l].sort((t,g)=>g.rotation-t.rotation).slice(0,5),b=[...l].sort((t,g)=>t.rotation-g.rotation).slice(0,5);return{classA:o,classB:c,classC:x,topMovers:d,slowMovers:b,totalValue:i}},[a]);return s.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"AnÃ¡lisis de RotaciÃ³n"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-80"})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"AnÃ¡lisis de RotaciÃ³n (ABC)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-950 border border-green-800 rounded-lg p-4",children:[e.jsx("h4",{className:"text-green-400 font-medium mb-2",children:"ðŸ“Š Clase A (80%)"}),e.jsx("p",{className:"text-green-100 text-2xl font-bold",children:p.classA.length}),e.jsx("p",{className:"text-green-300 text-sm",children:"Productos crÃ­ticos"})]}),e.jsxs("div",{className:"bg-yellow-950 border border-yellow-800 rounded-lg p-4",children:[e.jsx("h4",{className:"text-yellow-400 font-medium mb-2",children:"ðŸ“ˆ Clase B (15%)"}),e.jsx("p",{className:"text-yellow-100 text-2xl font-bold",children:p.classB.length}),e.jsx("p",{className:"text-yellow-300 text-sm",children:"Productos importantes"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-neutral-300 font-medium mb-2",children:"ðŸ“‰ Clase C (5%)"}),e.jsx("p",{className:"text-neutral-100 text-2xl font-bold",children:p.classC.length}),e.jsx("p",{className:"text-neutral-400 text-sm",children:"Baja prioridad"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-neutral-300 font-medium mb-3",children:"ðŸ”¥ Top Movers"}),e.jsx("div",{className:"space-y-2",children:p.topMovers.map((l,i)=>e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-neutral-100 font-medium",children:[i===0?"ðŸ¥‡":i===1?"ðŸ¥ˆ":i===2?"ðŸ¥‰":`${i+1}.`," ",l.name]}),e.jsxs("span",{className:"text-green-400 font-semibold",children:[l.rotation.toFixed(1)," u/mes"]})]})},l.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-neutral-300 font-medium mb-3",children:"ðŸŒ Slow Movers"}),e.jsx("div",{className:"space-y-2",children:p.slowMovers.map(l=>e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-100 font-medium",children:l.name}),e.jsxs("span",{className:"text-red-400 font-semibold",children:[l.rotation.toFixed(1)," u/mes"]})]})},l.id))})]})]}),e.jsxs("div",{className:"mt-4 bg-blue-950 border border-blue-800 rounded-lg p-3 text-blue-400 text-sm",children:["ðŸ’¡ ",e.jsx("strong",{children:"Insight:"})," ClasificaciÃ³n ABC ayuda a priorizar gestiÃ³n de inventario segÃºn valor"]})]})}function Qe(){const s=y.useMemo(()=>G(),[]),a=n=>s.format(n??0),p=w({queryKey:["inventory-summary"],queryFn:V}),l=p.data,i=Number(l?.totalValue??0),m=y.useMemo(()=>[{month:"Hace 3m",value:i*.75},{month:"Hace 2m",value:i*.85},{month:"Hace 1m",value:i*.92},{month:"Actual",value:i}],[i]),r=Math.max(...m.map(n=>n.value));return p.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"EvoluciÃ³n de ValorizaciÃ³n"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-64"})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"EvoluciÃ³n de ValorizaciÃ³n"}),e.jsxs("span",{className:"px-3 py-1 bg-blue-950 text-blue-400 border border-blue-800 rounded-full text-sm",children:["ðŸ“ˆ Tendencia: +",((i/(i*.75)-1)*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"space-y-4 mb-6",children:m.map((n,o)=>{const c=r>0?n.value/r*100:0,x=o===m.length-1;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-neutral-300 text-sm",children:n.month}),e.jsx("span",{className:"text-neutral-100 font-semibold",children:a(n.value)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-full ${x?"bg-gradient-to-r from-blue-600 to-blue-400":"bg-neutral-600"} transition-all`,style:{width:`${c}%`}})})]},n.month)})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsx("p",{className:"text-neutral-400 text-sm",children:"Valor Total"}),e.jsx("p",{className:"text-neutral-100 text-xl font-bold",children:a(i)})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsx("p",{className:"text-neutral-400 text-sm",children:"Productos"}),e.jsx("p",{className:"text-neutral-100 text-xl font-bold",children:l?.activeProducts??0})]})]})]})}function Ve(){const s=w({queryKey:["products-replenishment"],queryFn:()=>q({size:100,status:"all"})}),a=s.data?.content??[],p=y.useMemo(()=>a.map(l=>{const i=Number(l.stock??0),m=Math.random()*5+1,r=7,n=m*3,o=m*r+n,c=m*30,x=i<o,d=m>0?i/m:999,b=Math.max(0,c-i);return{id:l.id,name:l.name??"Sin nombre",stock:i,reorderPoint:o,daysOfCoverage:d,suggestedOrder:b,needsReplenishment:x,urgency:d<7?"critical":d<14?"high":"normal"}}).filter(l=>l.needsReplenishment).sort((l,i)=>l.daysOfCoverage-i.daysOfCoverage).slice(0,8),[a]);return s.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Panel de Reabastecimiento"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-80"})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"Panel de Reabastecimiento"}),e.jsxs("span",{className:"px-3 py-1 bg-orange-950 text-orange-400 border border-orange-800 rounded-full text-sm",children:[p.length," productos requieren pedido"]})]}),p.length===0?e.jsx("div",{className:"bg-green-950 border border-green-800 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-green-400",children:"âœ… Todos los productos tienen stock suficiente"})}):e.jsx("div",{className:"space-y-3",children:p.map(l=>{const i={critical:{bg:"bg-red-950",border:"border-red-800",text:"text-red-400",icon:"ðŸ”´"},high:{bg:"bg-yellow-950",border:"border-yellow-800",text:"text-yellow-400",icon:"âš ï¸"},normal:{bg:"bg-blue-950",border:"border-blue-800",text:"text-blue-400",icon:"â„¹ï¸"}}[l.urgency]||{bg:"bg-neutral-950",border:"border-neutral-800",text:"text-neutral-400",icon:"â„¹ï¸"};return e.jsxs("div",{className:`${i.bg} border ${i.border} rounded-lg p-4`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:i.icon}),e.jsx("h4",{className:"text-neutral-100 font-medium",children:l.name})]}),e.jsxs("p",{className:"text-neutral-400 text-sm",children:["Stock actual:"," ",e.jsxs("strong",{className:i.text,children:[l.stock," unidades"]})]}),e.jsxs("p",{className:"text-neutral-400 text-sm",children:["Cobertura: ",e.jsxs("strong",{children:[l.daysOfCoverage.toFixed(0)," dÃ­as"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-neutral-400 text-xs mb-1",children:"Cantidad sugerida"}),e.jsx("p",{className:`${i.text} text-2xl font-bold`,children:Math.ceil(l.suggestedOrder)})]})]}),e.jsx("button",{className:`w-full mt-2 px-4 py-2 ${i.bg} ${i.text} border ${i.border} rounded-lg hover:bg-opacity-80 transition`,children:"Generar Orden de Compra"})]},l.id)})}),e.jsxs("div",{className:"mt-4 bg-blue-950 border border-blue-800 rounded-lg p-3 text-blue-400 text-sm",children:["ðŸ’¡ ",e.jsx("strong",{children:"Sugerencia:"})," Punto de reorden calculado segÃºn consumo + plazo de entrega + stock de seguridad"]})]})}function We(){const s=y.useMemo(()=>G(),[]),a=o=>s.format(o??0),p=w({queryKey:["inventory-summary"],queryFn:V}),l=w({queryKey:["products-efficiency"],queryFn:()=>q({size:200,status:"all"})}),i=p.data,m=l.data?.content??[],r=Number(i?.totalValue??0),n=y.useMemo(()=>{const o=m.length,d=m.reduce((N,v)=>N+Number(v.stock??0),0)/15,b=m.filter(N=>Number(N.stock??0)===0).length,t=o>0?b/o*100:0,g=12,C=150,j=(C-g)/C*100,k=r*.05/12;return{daysOfCoverage:d,stockOutRate:t,inventoryAccuracy:j,monthlyStorageCost:k,outOfStock:b,totalProducts:o}},[m,r]);return p.isLoading||l.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"MÃ©tricas de Eficiencia"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-64"})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"MÃ©tricas de Eficiencia"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-950 border border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-blue-400 font-medium",children:"ðŸ“… DÃ­as de Cobertura"}),e.jsx("span",{className:"text-blue-300 text-2xl font-bold",children:n.daysOfCoverage.toFixed(0)})]}),e.jsx("p",{className:"text-blue-300 text-sm",children:"Stock actual / Consumo diario promedio"}),e.jsx("div",{className:"mt-2 w-full bg-blue-900 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-full rounded-full transition-all",style:{width:`${Math.min(n.daysOfCoverage/60*100,100)}%`}})})]}),e.jsxs("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-red-400 font-medium",children:"ðŸ“‰ Tasa de Quiebre"}),e.jsxs("span",{className:"text-red-300 text-2xl font-bold",children:[n.stockOutRate.toFixed(1),"%"]})]}),e.jsxs("p",{className:"text-red-300 text-sm",children:[n.outOfStock," de ",n.totalProducts," productos sin stock"]}),e.jsx("div",{className:"mt-2 w-full bg-red-900 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-full rounded-full transition-all",style:{width:`${n.stockOutRate}%`}})})]}),e.jsxs("div",{className:"bg-green-950 border border-green-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-green-400 font-medium",children:"âœ… PrecisiÃ³n Inventario"}),e.jsxs("span",{className:"text-green-300 text-2xl font-bold",children:[n.inventoryAccuracy.toFixed(1),"%"]})]}),e.jsx("p",{className:"text-green-300 text-sm",children:"Basado en movimientos vs ajustes"}),e.jsx("div",{className:"mt-2 w-full bg-green-900 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-full rounded-full transition-all",style:{width:`${n.inventoryAccuracy}%`}})})]}),e.jsxs("div",{className:"bg-purple-950 border border-purple-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-purple-400 font-medium",children:"ðŸ’° Costo Almacenamiento"}),e.jsx("span",{className:"text-purple-300 text-2xl font-bold",children:a(n.monthlyStorageCost)})]}),e.jsx("p",{className:"text-purple-300 text-sm",children:"Estimado mensual (~5% anual del valor)"})]})]}),e.jsxs("div",{className:"mt-4 bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-neutral-100 font-medium mb-2",children:"Recomendaciones"}),e.jsxs("ul",{className:"space-y-1 text-neutral-300 text-sm",children:[n.stockOutRate>10&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400",children:"âš ï¸"}),e.jsx("span",{children:"Tasa de quiebre alta. Revisar puntos de reorden."})]}),n.daysOfCoverage>90&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-yellow-400",children:"âš ï¸"}),e.jsx("span",{children:"Sobrestock detectado. Evaluar reducciÃ³n de inventario."})]}),n.inventoryAccuracy<95&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-orange-400",children:"âš ï¸"}),e.jsx("span",{children:"Baja precisiÃ³n. Realizar conteo cÃ­clico."})]}),n.stockOutRate<=5&&n.inventoryAccuracy>=95&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400",children:"âœ…"}),e.jsx("span",{children:"Inventario en niveles Ã³ptimos. Â¡Buen trabajo!"})]})]})]})]})}function _e(){const{data:s,isLoading:a,error:p}=w({queryKey:["inventoryKPIs"],queryFn:Se,refetchInterval:6e4});if(a)return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map((r,n)=>e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-neutral-800 rounded w-2/3 mb-3"}),e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-neutral-800 rounded w-3/4"})]},n))});if(p)return e.jsx("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar KPIs de inventario"})});const l=r=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(r),i=r=>new Intl.NumberFormat("es-CL").format(r),m=[{title:"Cobertura de Stock",value:s?.stockCoverageDays!==null&&s?.stockCoverageDays!==void 0?`${s.stockCoverageDays.toFixed(1)} dÃ­as`:"N/A",subtitle:"DuraciÃ³n estimada del inventario",color:"text-blue-400",bgColor:"bg-blue-900/20",borderColor:"border-blue-800"},{title:"Ratio de RotaciÃ³n",value:s?.turnoverRatio?s.turnoverRatio.toFixed(2):"0.00",subtitle:"Veces por aÃ±o (anualizado)",color:"text-green-400",bgColor:"bg-green-900/20",borderColor:"border-green-800"},{title:"Stock Muerto",value:l(s?.deadStockValue||0),subtitle:`${s?.deadStockCount||0} productos sin movimiento >90 dÃ­as`,color:"text-orange-400",bgColor:"bg-orange-900/20",borderColor:"border-orange-800"},{title:"Tiempo de ReposiciÃ³n",value:`${s?.averageLeadTimeDays||0} dÃ­as`,subtitle:"Tiempo promedio de lead time",color:"text-purple-400",bgColor:"bg-purple-900/20",borderColor:"border-purple-800"},{title:"Stock CrÃ­tico",value:i(s?.criticalStockProducts||0),subtitle:"Productos bajo umbral",color:"text-red-400",bgColor:"bg-red-900/20",borderColor:"border-red-800"},{title:"Sobrestock",value:l(s?.overstockValue||0),subtitle:`${s?.overstockCount||0} productos excedidos`,color:"text-yellow-400",bgColor:"bg-yellow-900/20",borderColor:"border-yellow-800"}];return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map((r,n)=>e.jsxs("div",{className:`${r.bgColor} border ${r.borderColor} rounded-lg p-6 transition-all hover:scale-[1.02]`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-400",children:r.title}),e.jsx("div",{className:`w-10 h-10 rounded-lg ${r.bgColor} border ${r.borderColor} flex items-center justify-center`,children:e.jsx("span",{className:`text-xl ${r.color}`,children:"â—"})})]}),e.jsx("div",{className:`text-2xl font-bold ${r.color} mb-1`,children:r.value}),e.jsx("p",{className:"text-xs text-neutral-500",children:r.subtitle})]},n))})}function Ge(){const{data:s,isLoading:a,error:p}=w({queryKey:["stockMovementStats"],queryFn:we,refetchInterval:6e4});if(a)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-6"}),e.jsx("div",{className:"h-64 bg-neutral-800 rounded"})]});if(p)return e.jsx("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar estadÃ­sticas de movimiento"})});const l=r=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(r),i=r=>new Intl.NumberFormat("es-CL").format(r),m=[{name:"Entradas",valor:s?.totalInflows||0,transacciones:s?.inflowTransactions||0},{name:"Salidas",valor:s?.totalOutflows||0,transacciones:s?.outflowTransactions||0}];return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-2",children:"Resumen de Movimientos (Ãºltimos 30 dÃ­as)"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"AnÃ¡lisis de entradas y salidas de inventario"})]}),e.jsx("div",{className:"mb-8",children:e.jsx(H,{width:"100%",height:300,children:e.jsxs(Y,{data:m,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(X,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(Z,{dataKey:"name",stroke:"#a3a3a3"}),e.jsx(J,{stroke:"#a3a3a3",tickFormatter:r=>l(r)}),e.jsx(ee,{contentStyle:{backgroundColor:"#262626",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#f5f5f5"},formatter:r=>l(r)}),e.jsx(se,{}),e.jsx($,{dataKey:"valor",fill:"#3b82f6",name:"Valor Total",radius:[8,8,0,0]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Total Entradas"}),e.jsx("div",{className:"text-2xl font-bold text-green-400",children:l(s?.totalInflows||0)}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:[s?.inflowTransactions||0," transacciones"]})]}),e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Total Salidas"}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:l(s?.totalOutflows||0)}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:[s?.outflowTransactions||0," transacciones"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-neutral-300 mb-3",children:"Top 5 Entradas"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b border-neutral-800",children:e.jsxs("tr",{className:"text-left text-neutral-400",children:[e.jsx("th",{className:"pb-2 font-medium",children:"Producto"}),e.jsx("th",{className:"pb-2 font-medium text-right",children:"Cantidad"}),e.jsx("th",{className:"pb-2 font-medium text-right",children:"Valor"})]})}),e.jsx("tbody",{children:s?.topInflowProducts&&s.topInflowProducts.length>0?s.topInflowProducts.map((r,n)=>e.jsxs("tr",{className:"border-b border-neutral-800/50",children:[e.jsx("td",{className:"py-2 text-neutral-300",children:r.productName}),e.jsx("td",{className:"py-2 text-right text-neutral-400",children:i(r.quantity)}),e.jsx("td",{className:"py-2 text-right text-green-400",children:l(r.value)})]},n)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-4 text-center text-neutral-500",children:"Sin movimientos de entrada"})})})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-neutral-300 mb-3",children:"Top 5 Salidas"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b border-neutral-800",children:e.jsxs("tr",{className:"text-left text-neutral-400",children:[e.jsx("th",{className:"pb-2 font-medium",children:"Producto"}),e.jsx("th",{className:"pb-2 font-medium text-right",children:"Cantidad"}),e.jsx("th",{className:"pb-2 font-medium text-right",children:"Valor"})]})}),e.jsx("tbody",{children:s?.topOutflowProducts&&s.topOutflowProducts.length>0?s.topOutflowProducts.map((r,n)=>e.jsxs("tr",{className:"border-b border-neutral-800/50",children:[e.jsx("td",{className:"py-2 text-neutral-300",children:r.productName}),e.jsx("td",{className:"py-2 text-right text-neutral-400",children:i(r.quantity)}),e.jsx("td",{className:"py-2 text-right text-red-400",children:l(r.value)})]},n)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-4 text-center text-neutral-500",children:"Sin movimientos de salida"})})})]})})]})]})]})}function He(){const{data:s,isLoading:a,error:p}=w({queryKey:["abcAnalysis"],queryFn:()=>W(),refetchInterval:3e5});if(a)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-6"}),e.jsx("div",{className:"h-80 bg-neutral-800 rounded"})]});if(p)return e.jsx("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar anÃ¡lisis ABC"})});if(!s||s.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-neutral-400",children:"No hay datos suficientes para anÃ¡lisis ABC"}),e.jsx("p",{className:"text-xs text-neutral-500 mt-2",children:"El anÃ¡lisis requiere productos con inventario valorizado"})]});const l=t=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),i=s.filter(t=>t.classification==="A"),m=s.filter(t=>t.classification==="B"),r=s.filter(t=>t.classification==="C"),n=i.reduce((t,g)=>t+g.totalValue,0),o=m.reduce((t,g)=>t+g.totalValue,0),c=r.reduce((t,g)=>t+g.totalValue,0),x=n+o+c,d=[{name:"Clase A",productos:i.length,valor:n,porcentaje:(n/x*100).toFixed(1)},{name:"Clase B",productos:m.length,valor:o,porcentaje:(o/x*100).toFixed(1)},{name:"Clase C",productos:r.length,valor:c,porcentaje:(c/x*100).toFixed(1)}],b={A:"#22c55e",B:"#eab308",C:"#f97316"};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-2",children:"AnÃ¡lisis ABC de Inventario"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"ClasificaciÃ³n por valor de inventario (Principio de Pareto 80-15-5)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-300",children:"Clase A"}),e.jsxs("span",{className:"px-2 py-1 bg-green-900/40 border border-green-800 rounded text-xs font-semibold text-green-400",children:[i.length," productos"]})]}),e.jsx("div",{className:"text-2xl font-bold text-green-400 mb-1",children:l(n)}),e.jsxs("div",{className:"text-xs text-neutral-400",children:[(n/x*100).toFixed(1),"% del valor total"]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-2",children:"Alta rotaciÃ³n - Control diario"})]}),e.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-300",children:"Clase B"}),e.jsxs("span",{className:"px-2 py-1 bg-yellow-900/40 border border-yellow-800 rounded text-xs font-semibold text-yellow-400",children:[m.length," productos"]})]}),e.jsx("div",{className:"text-2xl font-bold text-yellow-400 mb-1",children:l(o)}),e.jsxs("div",{className:"text-xs text-neutral-400",children:[(o/x*100).toFixed(1),"% del valor total"]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-2",children:"RotaciÃ³n media - Control semanal"})]}),e.jsxs("div",{className:"bg-orange-900/20 border border-orange-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-300",children:"Clase C"}),e.jsxs("span",{className:"px-2 py-1 bg-orange-900/40 border border-orange-800 rounded text-xs font-semibold text-orange-400",children:[r.length," productos"]})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-400 mb-1",children:l(c)}),e.jsxs("div",{className:"text-xs text-neutral-400",children:[(c/x*100).toFixed(1),"% del valor total"]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-2",children:"Baja rotaciÃ³n - Control mensual"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-neutral-300 mb-3",children:"DistribuciÃ³n de Valor por ClasificaciÃ³n"}),e.jsx(H,{width:"100%",height:300,children:e.jsxs(Y,{data:d,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(X,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(Z,{dataKey:"name",stroke:"#a3a3a3"}),e.jsx(J,{stroke:"#a3a3a3",tickFormatter:t=>l(t)}),e.jsx(ee,{contentStyle:{backgroundColor:"#262626",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#f5f5f5"},formatter:t=>l(t)}),e.jsx(se,{}),e.jsx($,{dataKey:"valor",name:"Valor Total",radius:[8,8,0,0],children:d.map((t,g)=>e.jsx(ie,{fill:g===0?b.A:g===1?b.B:b.C},`cell-${g}`))})]})})]}),e.jsx("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"Total Productos"}),e.jsx("div",{className:"text-lg font-semibold text-neutral-100",children:s.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"Valor Total Inventario"}),e.jsx("div",{className:"text-lg font-semibold text-neutral-100",children:l(x)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"ConcentraciÃ³n Clase A"}),e.jsxs("div",{className:"text-lg font-semibold text-green-400",children:[(i.length/s.length*100).toFixed(1),"% productos"]})]})]})})]})}function Ye(){const[s,a]=y.useState("all"),[p,l]=y.useState(""),[i,m]=y.useState(1),r=10,{data:n,isLoading:o,error:c}=w({queryKey:["abcAnalysis"],queryFn:()=>W(),refetchInterval:3e5});if(o)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((h,k)=>e.jsx("div",{className:"h-12 bg-neutral-800 rounded"},k))})]});if(c||!n)return e.jsx("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar productos"})});const x=h=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(h),d=h=>h?new Date(h).toLocaleDateString("es-CL"):"N/A",b=n.filter(h=>{const k=s==="all"||h.classification===s,N=h.productName.toLowerCase().includes(p.toLowerCase())||h.category.toLowerCase().includes(p.toLowerCase());return k&&N}),t=Math.ceil(b.length/r),g=(i-1)*r,C=g+r,j=b.slice(g,C),S=h=>{switch(h){case"A":return"bg-green-900/40 border-green-800 text-green-400";case"B":return"bg-yellow-900/40 border-yellow-800 text-yellow-400";case"C":return"bg-orange-900/40 border-orange-800 text-orange-400";default:return"bg-neutral-800 border-neutral-700 text-neutral-400"}};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-100 mb-4",children:"Productos por ClasificaciÃ³n ABC"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Buscar producto o categorÃ­a...",value:p,onChange:h=>{l(h.target.value),m(1)},className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-100 placeholder-neutral-500 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{a("all"),m(1)},className:`px-3 py-2 rounded-lg text-xs font-medium border transition-colors ${s==="all"?"bg-blue-900/40 border-blue-800 text-blue-400":"bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700"}`,children:["Todos (",n.length,")"]}),e.jsx("button",{onClick:()=>{a("A"),m(1)},className:`px-3 py-2 rounded-lg text-xs font-medium border transition-colors ${s==="A"?"bg-green-900/40 border-green-800 text-green-400":"bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700"}`,children:"Clase A"}),e.jsx("button",{onClick:()=>{a("B"),m(1)},className:`px-3 py-2 rounded-lg text-xs font-medium border transition-colors ${s==="B"?"bg-yellow-900/40 border-yellow-800 text-yellow-400":"bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700"}`,children:"Clase B"}),e.jsx("button",{onClick:()=>{a("C"),m(1)},className:`px-3 py-2 rounded-lg text-xs font-medium border transition-colors ${s==="C"?"bg-orange-900/40 border-orange-800 text-orange-400":"bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700"}`,children:"Clase C"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b border-neutral-800",children:e.jsxs("tr",{className:"text-left text-neutral-400",children:[e.jsx("th",{className:"pb-3 font-medium",children:"Clase"}),e.jsx("th",{className:"pb-3 font-medium",children:"Producto"}),e.jsx("th",{className:"pb-3 font-medium",children:"CategorÃ­a"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"Valor Total"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"% del Total"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"Cantidad"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"Frecuencia"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"Ãšltima Mov."})]})}),e.jsx("tbody",{children:j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"py-8 text-center text-neutral-500",children:"No se encontraron productos"})}):j.map(h=>e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-800/30",children:[e.jsx("td",{className:"py-3",children:e.jsx("span",{className:`inline-flex px-2.5 py-1 rounded-md text-xs font-semibold border ${S(h.classification)}`,children:h.classification})}),e.jsx("td",{className:"py-3 text-neutral-100 font-medium",children:h.productName}),e.jsx("td",{className:"py-3 text-neutral-400",children:h.category}),e.jsx("td",{className:"py-3 text-right text-neutral-100 font-medium",children:x(h.totalValue)}),e.jsxs("td",{className:"py-3 text-right text-neutral-400",children:[h.percentageOfTotalValue.toFixed(2),"%"]}),e.jsx("td",{className:"py-3 text-right text-neutral-400",children:h.totalQuantity.toLocaleString("es-CL")}),e.jsx("td",{className:"py-3 text-right text-neutral-400",children:h.salesFrequency}),e.jsx("td",{className:"py-3 text-right text-neutral-400 text-xs",children:d(h.lastMovementDate)})]},h.productId))})]})}),t>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-neutral-500",children:["Mostrando ",g+1,"-",Math.min(C,b.length)," de"," ",b.length," productos"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(h=>Math.max(1,h-1)),disabled:i===1,className:"px-3 py-1 bg-neutral-800 border border-neutral-700 rounded text-xs text-neutral-400 hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsxs("span",{className:"px-3 py-1 text-xs text-neutral-400",children:["PÃ¡gina ",i," de ",t]}),e.jsx("button",{onClick:()=>m(h=>Math.min(t,h+1)),disabled:i===t,className:"px-3 py-1 bg-neutral-800 border border-neutral-700 rounded text-xs text-neutral-400 hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"})]})]})]})}function Xe(){const{data:s,isLoading:a}=w({queryKey:["abcAnalysis"],queryFn:()=>W(),refetchInterval:3e5});if(a)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-2/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((r,n)=>e.jsx("div",{className:"h-24 bg-neutral-800 rounded"},n))})]});const p=s?.filter(r=>r.classification==="A")||[],l=s?.filter(r=>r.classification==="B")||[],i=s?.filter(r=>r.classification==="C")||[],m=[{classification:"A",title:"Productos Clase A - Alta Prioridad",color:"green",bgColor:"bg-green-900/20",borderColor:"border-green-800",textColor:"text-green-400",count:p.length,strategies:[{icon:"ðŸ“Š",title:"Monitoreo Continuo",description:"Control diario de niveles de inventario y rotaciÃ³n"},{icon:"ðŸŽ¯",title:"Stock Ã“ptimo",description:"Mantener niveles Ã³ptimos para evitar quiebres"},{icon:"ðŸ”„",title:"ReposiciÃ³n Frecuente",description:"RevisiÃ³n y pedidos cada 1-3 dÃ­as segÃºn demanda"},{icon:"ðŸ“ˆ",title:"PrevisiÃ³n Exacta",description:"Usar modelos de forecasting para proyectar demanda"}]},{classification:"B",title:"Productos Clase B - Prioridad Media",color:"yellow",bgColor:"bg-yellow-900/20",borderColor:"border-yellow-800",textColor:"text-yellow-400",count:l.length,strategies:[{icon:"ðŸ“…",title:"Control Semanal",description:"RevisiÃ³n de inventario cada 5-7 dÃ­as"},{icon:"âš–ï¸",title:"Stock Balanceado",description:"Mantener inventario moderado sin excesos"},{icon:"ðŸ””",title:"Alertas AutomÃ¡ticas",description:"Configurar notificaciones de stock bajo"},{icon:"ðŸ“Š",title:"AnÃ¡lisis Trimestral",description:"Evaluar tendencias y ajustar polÃ­ticas"}]},{classification:"C",title:"Productos Clase C - Baja Prioridad",color:"orange",bgColor:"bg-orange-900/20",borderColor:"border-orange-800",textColor:"text-orange-400",count:i.length,strategies:[{icon:"ðŸ“†",title:"RevisiÃ³n Mensual",description:"Control bÃ¡sico mensual o bimestral"},{icon:"ðŸ“‰",title:"Minimizar Inventario",description:"Reducir stock al mÃ­nimo necesario"},{icon:"ðŸ”",title:"Evaluar DescontinuaciÃ³n",description:"Considerar eliminar productos de baja rotaciÃ³n"},{icon:"ðŸ’¡",title:"Pedidos por Demanda",description:"Comprar solo cuando hay orden confirmada"}]}];return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-100 mb-2",children:"Estrategias de GestiÃ³n por ClasificaciÃ³n"}),e.jsx("p",{className:"text-xs text-neutral-400",children:"Recomendaciones operativas basadas en el anÃ¡lisis ABC"})]}),e.jsx("div",{className:"space-y-4",children:m.map(r=>e.jsxs("div",{className:`${r.bgColor} border ${r.borderColor} rounded-lg p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:`text-sm font-semibold ${r.textColor}`,children:r.title}),e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-semibold ${r.bgColor} border ${r.borderColor} ${r.textColor}`,children:[r.count," productos"]})]}),e.jsx("div",{className:"space-y-2",children:r.strategies.map((n,o)=>e.jsxs("div",{className:"flex items-start gap-3 bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xl flex-shrink-0",children:n.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-neutral-200 mb-1",children:n.title}),e.jsx("div",{className:"text-xs text-neutral-400",children:n.description})]})]},o))})]},r.classification))}),e.jsx("div",{className:"mt-6 bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ’¡"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-400 mb-2",children:"Mejores PrÃ¡cticas"}),e.jsxs("ul",{className:"text-xs text-neutral-300 space-y-1",children:[e.jsx("li",{children:"â€¢ Concentrar esfuerzos en productos Clase A (80% del valor)"}),e.jsx("li",{children:"â€¢ Automatizar controles para productos Clase B"}),e.jsx("li",{children:"â€¢ Simplificar gestiÃ³n de productos Clase C"}),e.jsx("li",{children:"â€¢ Revisar clasificaciÃ³n ABC cada 3-6 meses"}),e.jsx("li",{children:"â€¢ Ajustar estrategias segÃºn estacionalidad"})]})]})]})})]})}function Ze(){const{data:s,isLoading:a,error:p}=w({queryKey:["forecastAnalysis"],queryFn:()=>_(),refetchInterval:3e5});if(a)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-neutral-800 rounded"})]});if(p)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("p",{className:"text-red-400",children:["Error al cargar pronÃ³sticos: ",String(p)]})});if(!s||s.length===0)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-neutral-400",children:"No hay datos suficientes para generar pronÃ³sticos"})});const l=s.length,i=s.filter(t=>t.stockStatus==="understocked").length,m=s.filter(t=>t.stockStatus==="overstocked").length,r=s.filter(t=>t.stockStatus==="optimal").length,n=s.reduce((t,g)=>t+g.predictedDemand,0),o=s.reduce((t,g)=>t+g.currentStock,0),c=s.reduce((t,g)=>t+g.recommendedOrderQty,0),x=s.reduce((t,g)=>t+g.confidence,0)/l,d=s.slice(0,10).map(t=>({name:t.productName.length>20?t.productName.substring(0,20)+"...":t.productName,demandaPredicha:t.predictedDemand,stockActual:t.currentStock,status:t.stockStatus})),b=t=>{switch(t){case"understocked":return"#ef4444";case"overstocked":return"#f97316";case"optimal":return"#22c55e";default:return"#6b7280"}};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"ðŸ“ˆ PronÃ³stico de Demanda (PrÃ³ximos 30 dÃ­as)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Productos Analizados"}),e.jsx("div",{className:"text-2xl font-bold text-white mt-1",children:l})]}),e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-400",children:"Stock Bajo"}),e.jsx("div",{className:"text-2xl font-bold text-red-400 mt-1",children:i}),e.jsx("div",{className:"text-xs text-red-500 mt-1",children:"Requieren reposiciÃ³n"})]}),e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-400",children:"Stock Ã“ptimo"}),e.jsx("div",{className:"text-2xl font-bold text-green-400 mt-1",children:r}),e.jsx("div",{className:"text-xs text-green-500 mt-1",children:"Niveles adecuados"})]}),e.jsxs("div",{className:"bg-orange-900/20 border border-orange-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-orange-400",children:"Sobre-stock"}),e.jsx("div",{className:"text-2xl font-bold text-orange-400 mt-1",children:m}),e.jsx("div",{className:"text-xs text-orange-500 mt-1",children:"Exceso de inventario"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Demanda Predicha Total"}),e.jsxs("div",{className:"text-xl font-bold text-white mt-1",children:[n.toFixed(0)," unidades"]})]}),e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Stock Actual Total"}),e.jsxs("div",{className:"text-xl font-bold text-white mt-1",children:[o.toFixed(0)," unidades"]})]}),e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Orden Recomendada Total"}),e.jsxs("div",{className:"text-xl font-bold text-blue-400 mt-1",children:[c.toFixed(0)," unidades"]})]})]}),e.jsxs("div",{className:"bg-neutral-800/30 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"Top 10 Productos: Demanda Predicha vs Stock Actual"}),e.jsx(H,{width:"100%",height:400,children:e.jsxs(Y,{data:d,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(X,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(Z,{dataKey:"name",angle:-45,textAnchor:"end",height:100,stroke:"#a3a3a3",style:{fontSize:"12px"}}),e.jsx(J,{stroke:"#a3a3a3"}),e.jsx(ee,{contentStyle:{backgroundColor:"#262626",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#fff"}}),e.jsx(se,{wrapperStyle:{paddingTop:"20px"},iconType:"circle"}),e.jsx($,{dataKey:"demandaPredicha",name:"Demanda Predicha",fill:"#3b82f6"}),e.jsx($,{dataKey:"stockActual",name:"Stock Actual",children:d.map((t,g)=>e.jsx(ie,{fill:b(t.status)},`cell-${g}`))})]})})]}),e.jsx("div",{className:"bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-blue-400",children:"Confianza Promedio del Modelo"}),e.jsx("div",{className:"text-xs text-neutral-400 mt-1",children:"Basado en historial de 90 dÃ­as"})]}),e.jsxs("div",{className:"text-3xl font-bold text-blue-400",children:[x.toFixed(0),"%"]})]})})]})}function Je(){const[s,a]=y.useState("all"),[p,l]=y.useState("all"),[i,m]=y.useState(""),[r,n]=y.useState(1),o=10,{data:c,isLoading:x,error:d}=w({queryKey:["forecastAnalysis"],queryFn:()=>_(),refetchInterval:300*1e3});if(x)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-96 bg-neutral-800 rounded"})]});if(d)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar pronÃ³sticos"})});if(!c||c.length===0)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-neutral-400",children:"No hay pronÃ³sticos disponibles"})});const b=c.filter(h=>{const k=s==="all"||h.stockStatus===s,N=p==="all"||h.trend===p,v=h.productName.toLowerCase().includes(i.toLowerCase())||h.category.toLowerCase().includes(i.toLowerCase());return k&&N&&v}),t=Math.ceil(b.length/o),g=(r-1)*o,C=b.slice(g,g+o),j=h=>{switch(h){case"understocked":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-red-900/40 border border-red-800 text-red-400",children:"Stock Bajo"});case"overstocked":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-orange-900/40 border border-orange-800 text-orange-400",children:"Sobre-stock"});case"optimal":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-900/40 border border-green-800 text-green-400",children:"Ã“ptimo"});default:return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-neutral-800 border border-neutral-700 text-neutral-400",children:h})}},S=h=>{switch(h){case"increasing":return e.jsx("span",{className:"text-green-400",children:"â†—ï¸ Creciente"});case"decreasing":return e.jsx("span",{className:"text-red-400",children:"â†˜ï¸ Decreciente"});case"stable":return e.jsx("span",{className:"text-blue-400",children:"â†’ Estable"});default:return e.jsx("span",{className:"text-neutral-400",children:h})}};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"ðŸŽ¯ Tabla de PronÃ³sticos"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>a("all"),className:`px-3 py-1.5 text-sm rounded-lg border transition ${s==="all"?"bg-blue-600 border-blue-500 text-white":"bg-neutral-800 border-neutral-700 text-neutral-300 hover:bg-neutral-700"}`,children:"Todos"}),e.jsx("button",{onClick:()=>a("understocked"),className:`px-3 py-1.5 text-sm rounded-lg border transition ${s==="understocked"?"bg-red-600 border-red-500 text-white":"bg-neutral-800 border-neutral-700 text-neutral-300 hover:bg-neutral-700"}`,children:"Stock Bajo"}),e.jsx("button",{onClick:()=>a("optimal"),className:`px-3 py-1.5 text-sm rounded-lg border transition ${s==="optimal"?"bg-green-600 border-green-500 text-white":"bg-neutral-800 border-neutral-700 text-neutral-300 hover:bg-neutral-700"}`,children:"Ã“ptimo"}),e.jsx("button",{onClick:()=>a("overstocked"),className:`px-3 py-1.5 text-sm rounded-lg border transition ${s==="overstocked"?"bg-orange-600 border-orange-500 text-white":"bg-neutral-800 border-neutral-700 text-neutral-300 hover:bg-neutral-700"}`,children:"Sobre-stock"})]}),e.jsx("input",{type:"text",placeholder:"Buscar producto o categorÃ­a...",value:i,onChange:h=>{m(h.target.value),n(1)},className:"flex-1 px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white placeholder-neutral-500 focus:outline-none focus:border-blue-500"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-neutral-400",children:"Estado"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-neutral-400",children:"Producto"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-neutral-400",children:"CategorÃ­a"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"Stock Actual"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"Demanda (30d)"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"DÃ­as Stock"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-neutral-400",children:"Tendencia"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"Orden Recomendada"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"Confianza"})]})}),e.jsx("tbody",{children:C.map((h,k)=>e.jsxs("tr",{className:"border-b border-neutral-800 hover:bg-neutral-800/30 transition",children:[e.jsx("td",{className:"p-3",children:j(h.stockStatus)}),e.jsx("td",{className:"p-3 text-white font-medium",children:h.productName}),e.jsx("td",{className:"p-3 text-neutral-300",children:h.category}),e.jsx("td",{className:"p-3 text-right text-white",children:h.currentStock.toFixed(0)}),e.jsx("td",{className:"p-3 text-right text-blue-400 font-semibold",children:h.predictedDemand.toFixed(0)}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("span",{className:h.daysOfStock<15?"text-red-400 font-semibold":h.daysOfStock>60?"text-orange-400":"text-green-400",children:[h.daysOfStock," dÃ­as"]})}),e.jsx("td",{className:"p-3 text-center text-sm",children:S(h.trend)}),e.jsx("td",{className:"p-3 text-right",children:h.recommendedOrderQty>0?e.jsx("span",{className:"text-yellow-400 font-semibold",children:h.recommendedOrderQty.toFixed(0)}):e.jsx("span",{className:"text-neutral-500",children:"-"})}),e.jsxs("td",{className:"p-3 text-right text-neutral-400",children:[h.confidence.toFixed(0),"%"]})]},k))})]})}),t>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"text-sm text-neutral-400",children:["Mostrando ",g+1,"-",Math.min(g+o,b.length)," de"," ",b.length]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>n(h=>Math.max(1,h-1)),disabled:r===1,className:"px-3 py-1.5 text-sm bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsxs("span",{className:"px-3 py-1.5 text-sm text-neutral-300",children:["PÃ¡gina ",r," de ",t]}),e.jsx("button",{onClick:()=>n(h=>Math.min(t,h+1)),disabled:r===t,className:"px-3 py-1.5 text-sm bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"})]})]}),b.length===0&&e.jsx("div",{className:"text-center py-8 text-neutral-400",children:"No se encontraron pronÃ³sticos con los filtros aplicados"})]})}function es(){const{data:s,isLoading:a}=w({queryKey:["forecastAnalysis"],queryFn:()=>_(),refetchInterval:3e5});if(a)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-20 bg-neutral-800 rounded"}),e.jsx("div",{className:"h-20 bg-neutral-800 rounded"}),e.jsx("div",{className:"h-20 bg-neutral-800 rounded"})]})]});if(!s||s.length===0)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-neutral-400",children:"No hay recomendaciones disponibles"})});const p=s.filter(r=>r.stockStatus==="understocked").sort((r,n)=>r.daysOfStock-n.daysOfStock).slice(0,5),l=s.filter(r=>r.trend==="increasing").sort((r,n)=>n.predictedDemand-r.predictedDemand).slice(0,3),i=s.filter(r=>r.stockStatus==="overstocked").sort((r,n)=>n.daysOfStock-r.daysOfStock).slice(0,3),m=s.filter(r=>r.recommendedOrderQty>0).reduce((r,n)=>r+n.recommendedOrderQty,0);return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"ðŸ’¡ Recomendaciones EstratÃ©gicas"}),p.length>0&&e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸš¨"}),e.jsx("h4",{className:"text-lg font-semibold text-red-400",children:"AcciÃ³n Urgente Requerida"})]}),e.jsx("div",{className:"space-y-2",children:p.map((r,n)=>e.jsx("div",{className:"bg-neutral-900/50 rounded-lg p-3 border border-red-800/30",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:r.productName}),e.jsxs("div",{className:"text-sm text-red-400 mt-1",children:["Stock actual: ",r.currentStock.toFixed(0)," unidades (",r.daysOfStock," dÃ­as)"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Ordenar"}),e.jsxs("div",{className:"text-lg font-bold text-yellow-400",children:[r.recommendedOrderQty.toFixed(0)," unidades"]})]})]})},n))}),e.jsx("div",{className:"pt-2 border-t border-red-800/30",children:e.jsx("div",{className:"text-sm text-red-300",children:"âš ï¸ Estos productos necesitan reposiciÃ³n inmediata para evitar quiebres de stock"})})]}),l.length>0&&e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“ˆ"}),e.jsx("h4",{className:"text-lg font-semibold text-green-400",children:"Productos con Demanda Creciente"})]}),e.jsx("div",{className:"space-y-2",children:l.map((r,n)=>e.jsxs("div",{className:"flex justify-between items-center bg-neutral-900/50 rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:r.productName}),e.jsxs("div",{className:"text-sm text-green-400 mt-1",children:["Demanda predicha: ",r.predictedDemand.toFixed(0)," unidades (â†—ï¸ Aumentando)"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Promedio diario"}),e.jsx("div",{className:"text-white font-semibold",children:r.historicalAverage.toFixed(1)})]})]},n))}),e.jsx("div",{className:"pt-2 border-t border-green-800/30",children:e.jsx("div",{className:"text-sm text-green-300",children:"ðŸ’¡ Considere aumentar niveles de stock de seguridad para estos productos"})})]}),i.length>0&&e.jsxs("div",{className:"bg-orange-900/20 border border-orange-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"âš ï¸"}),e.jsx("h4",{className:"text-lg font-semibold text-orange-400",children:"OptimizaciÃ³n de Inventario"})]}),e.jsx("div",{className:"space-y-2",children:i.map((r,n)=>e.jsxs("div",{className:"flex justify-between items-center bg-neutral-900/50 rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:r.productName}),e.jsxs("div",{className:"text-sm text-orange-400 mt-1",children:["Stock excesivo: ",r.daysOfStock," dÃ­as de inventario"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Stock actual"}),e.jsx("div",{className:"text-white font-semibold",children:r.currentStock.toFixed(0)})]})]},n))}),e.jsx("div",{className:"pt-2 border-t border-orange-800/30",children:e.jsx("div",{className:"text-sm text-orange-300",children:"ðŸ’¡ EvalÃºe promociones o redistribuciÃ³n para optimizar capital de trabajo"})})]}),m>0&&e.jsx("div",{className:"bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ›’"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-blue-400",children:"Orden de Compra Sugerida"}),e.jsx("div",{className:"text-sm text-neutral-400 mt-1",children:"Total de unidades a ordenar"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-400",children:m.toFixed(0)}),e.jsx("div",{className:"text-sm text-neutral-400",children:"unidades"})]})]})}),e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4 space-y-2",children:[e.jsxs("h4",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“‹"}),"Mejores PrÃ¡cticas de GestiÃ³n Predictiva"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-neutral-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Revisar pronÃ³sticos semanalmente para ajustar niveles de stock"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Priorizar reposiciÃ³n de productos con menos de 15 dÃ­as de inventario"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Considerar estacionalidad y eventos especiales en planificaciÃ³n"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Validar precisiÃ³n del modelo comparando pronÃ³sticos con demanda real"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Optimizar frecuencia de pedidos para productos de alta rotaciÃ³n"})]})]})]})]})}const ne=10;function ss(s){const a=Number(s);return Number.isFinite(a)?`$${a.toLocaleString("es-CL",{maximumFractionDigits:0})}`:"$0"}function ds(){const s=U(),a=Fe(),[p,l]=y.useState(!1),[i,m]=y.useState(!1),[r,n]=y.useState(null),[o,c]=y.useState(null),[x,d]=y.useState(""),b=w({queryKey:["products",{view:"inventory"}],queryFn:()=>q({size:200,status:"all"})}),t=w({queryKey:["inventory","settings"],queryFn:Pe});y.useEffect(()=>{if(t.data){const f=Number(t.data.lowStockThreshold??0);if(Number.isFinite(f)&&f>0){o===null&&c(f),d(F=>F||String(f));return}}!t.isLoading&&o===null&&(c(ne),d(String(ne)))},[t.data,t.isLoading,o]);const g=w({queryKey:["inventory","summary"],queryFn:V}),C=w({queryKey:["inventory","alerts",o],enabled:o!==null,queryFn:()=>Ae(o??void 0)}),j=L({mutationFn:f=>ke({lowStockThreshold:f}),onSuccess:f=>{const F=Number(f.lowStockThreshold??0);Number.isFinite(F)&&F>0&&(c(F),d(String(F))),s.invalidateQueries({queryKey:["inventory","summary"]}),s.invalidateQueries({queryKey:["inventory","alerts"]}),s.setQueryData(["inventory","settings"],f)}}),S=()=>{const f=Number(x);if(!Number.isFinite(f)||f<=0){window.alert("Ingresa un umbral mayor a cero");return}j.mutate(f)},h=()=>{s.invalidateQueries({queryKey:["inventory","summary"]}),s.invalidateQueries({queryKey:["inventory","alerts"]}),s.invalidateQueries({queryKey:["products"],exact:!1}),l(!1)},k=y.useMemo(()=>new Map((b.data?.content??[]).map(f=>[f.id,f])),[b.data]),N=g.data;ss(N?.totalValue??0);const v=N?.activeProducts??0,A=N?.lowStockAlerts??C.data?.length??0;N?.lowStockThreshold??o??Number(x||0);const u=f=>{m(!1),n(f)},P=()=>{n(null)};return e.jsxs("div",{className:"page-section",children:[e.jsx(Le,{title:"Inventario",description:"Visibiliza catÃ¡logo, lotes y alertas de stock para garantizar disponibilidad.",actions:e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:"btn ghost",onClick:()=>a("/app/inventory/movements"),children:"ðŸ“‹ Ver movimientos"}),e.jsx("button",{className:"btn ghost",onClick:()=>m(!0),children:"ðŸ“¦ CatÃ¡logo de productos"}),e.jsx("button",{className:"btn",onClick:()=>l(!0),children:"+ Ajuste de stock"})]})}),!g.isLoading&&e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[A>5&&e.jsxs("div",{className:"bg-red-950 border border-red-800 rounded-lg p-3 text-red-400 text-sm",children:["ðŸ”´ ",e.jsx("strong",{children:"CrÃ­tico:"})," ",A," productos con stock bajo - requiere atenciÃ³n inmediata"]}),v===0&&e.jsxs("div",{className:"bg-yellow-950 border border-yellow-800 rounded-lg p-3 text-yellow-400 text-sm",children:["âš ï¸ ",e.jsx("strong",{children:"Advertencia:"})," No hay productos activos en el inventario"]})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"ðŸ“Š KPIs de Inventario"}),e.jsx(_e,{})]}),e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsx(Ge,{})}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"ðŸŽ¯ AnÃ¡lisis ABC de Inventario"}),e.jsx("div",{style:{marginBottom:"1.5rem"},children:e.jsx(He,{})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsx(Ye,{}),e.jsx(Xe,{})]})]}),e.jsxs("div",{style:{marginBottom:"2rem",marginTop:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.5rem",fontWeight:"600",marginBottom:"1rem"},children:"ðŸ“ˆ PronÃ³stico de Demanda e Inteligencia Predictiva"}),e.jsx("div",{style:{marginBottom:"1.25rem"},children:e.jsx(Ze,{})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsx(Je,{}),e.jsx(es,{})]})]}),e.jsxs("section",{className:"responsive-grid",children:[e.jsx("div",{className:"card",children:e.jsx(Ie,{})}),e.jsx("div",{className:"card",children:e.jsx(Ee,{})})]}),e.jsxs("div",{style:{marginBottom:"2rem",marginTop:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"ðŸ“Š AnÃ¡lisis de Inventario"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsx(ze,{}),e.jsx(Qe,{})]})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"âš™ï¸ GestiÃ³n Operativa"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsx(Ve,{}),e.jsx(We,{})]})]}),e.jsx("section",{className:"responsive-grid",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 table-card",children:[e.jsx("h3",{className:"text-neutral-100",children:"Lotes con stock crÃ­tico"}),e.jsxs("div",{className:"inline-actions",style:{marginBottom:"0.75rem"},children:[e.jsx("label",{className:"muted small text-neutral-400",htmlFor:"low-stock-threshold",children:"Umbral"}),e.jsx("input",{id:"low-stock-threshold",className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"number",step:"0.1",min:"0.1",value:x,onChange:f=>d(f.target.value),disabled:j.isPending}),e.jsx("button",{className:"btn",type:"button",onClick:S,disabled:j.isPending,children:j.isPending?"Guardando...":"Guardar"})]}),j.isError&&e.jsx("p",{className:"error",children:j.error?.message??"No se pudo actualizar el umbral"}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Lote"}),e.jsx("th",{children:"Disponible"}),e.jsx("th",{children:"Expira"}),e.jsx("th",{children:"Creado"}),e.jsx("th",{children:"AcciÃ³n"})]})}),e.jsxs("tbody",{children:[C.isLoading&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"muted text-neutral-400",children:"Cargando alertas..."})}),C.isError&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"error text-red-400",children:C.error?.message??"No se pudieron obtener alertas"})}),!C.isLoading&&!C.isError&&(C.data??[]).map(f=>{const F=k.get(f.productId),I=Number(f.qtyAvailable),T=o??10,B=I<5||I<T*.1,te=I>=5&&I<=T,M=f.expDate?new Date(f.expDate):null,oe=new Date,E=M?Math.floor((M.getTime()-oe.getTime())/(1e3*60*60*24)):null,K=E!==null&&E<=30&&E>=0,O=E!==null&&E<0,z=B?{icon:"ðŸ”´",label:"CrÃ­tico",className:"bg-red-950 text-red-400 border-red-800"}:te?{icon:"ðŸŸ¡",label:"Bajo",className:"bg-yellow-950 text-yellow-400 border-yellow-800"}:{icon:"ðŸŸ¢",label:"Normal",className:"bg-green-950 text-green-400 border-green-800"};return e.jsxs("tr",{className:O?"bg-red-950/20":K?"bg-yellow-950/20":"",children:[e.jsx("td",{children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-medium border ${z.className}`,children:[e.jsx("span",{children:z.icon}),e.jsx("span",{children:z.label})]})}),e.jsx("td",{className:"text-neutral-100",children:F?.name??f.productId}),e.jsx("td",{className:"mono text-neutral-300",children:f.lotId}),e.jsx("td",{className:`mono font-semibold ${B?"text-red-400":te?"text-yellow-400":"text-neutral-100"}`,children:I.toFixed(2)}),e.jsxs("td",{className:`mono ${O?"text-red-400 font-semibold":K?"text-yellow-400 font-semibold":"text-neutral-300"}`,children:[M?M.toLocaleDateString():"-",O&&e.jsx("span",{className:"ml-2",children:"âŒ Vencido"}),K&&!O&&e.jsxs("span",{className:"ml-2",children:["âš ï¸ ",E,"d"]})]}),e.jsx("td",{className:"mono small text-neutral-400",children:new Date(f.createdAt).toLocaleDateString()}),e.jsx("td",{children:e.jsx("button",{className:"btn ghost text-xs",type:"button",onClick:()=>{l(!0)},title:"Reabastecimiento rÃ¡pido",children:"+ Stock"})})]},f.lotId)}),!C.isLoading&&!C.isError&&(C.data??[]).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"muted text-neutral-400 text-center py-8",children:"âœ… Sin alertas de stock crÃ­tico"})})]})]})})]})}),e.jsx(Ke,{}),e.jsx(qe,{open:p,onClose:()=>l(!1),onApplied:h}),e.jsx(Be,{open:i,onClose:()=>m(!1),onSelectProduct:u}),e.jsx($e,{open:!!r,product:r,onClose:P})]})}export{ds as default};
