import{b as xt,j as e,u as rt,c as me,d as ht,i as pt,n as gt,e as bt,f as jt,h as ft,k as Nt,m as vt,o as yt,p as Ct,q as nt,r as wt,s as lt,t as St,v as Me,w as $e,x as Qe,y as Pt,z as Dt,A as kt,B as Tt,C as Le,D as Rt}from"./index-DBJ25f9Z.js";import{r as d}from"./react-D8kvZI4c.js";import{u as K}from"./useQuery-DOGxExcK.js";import{P as Ft}from"./PageHeader-C82fAhp-.js";import{M as qe}from"./Modal-BqzbBRVa.js";import{u as Et,m as _t,c as Lt}from"./customersUtils-CCyDH5By.js";import{u as ot}from"./useDebouncedValue-DnjRONvw.js";import{p as At}from"./problemDetail-BUp5Xn9a.js";import{u as It,f as He,g as Mt}from"./table-DbsuG4jc.js";import{f as Oe,c as ct}from"./currency-HwQAg_Xa.js";import{R as je,A as $t,C as ve,X as ye,Y as Ce,T as fe,c as qt,d as dt,P as Ot,e as Bt,f as it,a as Be,B as Ke,g as ze,L as ut,b as _e}from"./charts-BH7DIlZU.js";function Kt(t){return K({queryKey:["frequent-products",t],queryFn:()=>{if(!t)throw new Error("customerId is required");return xt(t)},enabled:!!t,staleTime:300*1e3,gcTime:600*1e3})}const zt=new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0});function Ut(t){try{return new Date(t).toLocaleDateString()}catch{return t}}function Vt({customerId:t,visible:o,onPick:n}){const[c,r]=d.useState(""),{data:a,isLoading:l,isFetching:m,isError:N,refetch:u}=Kt(t);d.useEffect(()=>{r("")},[t]);const f=d.useMemo(()=>{if(!a)return[];const h=c.trim().toLowerCase();return h?a.filter(v=>{const T=v.name?.toLowerCase()??"",S=v.sku?.toLowerCase()??"";return T.includes(h)||S.includes(h)}):a},[a,c]);if(!o||!t)return null;const g=(a?.length??0)>0,p=l||m&&!(a&&a.length);return e.jsxs("section",{className:"card frequent-products-panel","aria-label":"Productos frecuentes del cliente","aria-live":"polite",children:[e.jsxs("header",{className:"card-header frequent-products-header",children:[e.jsxs("div",{className:"frequent-products-heading",children:[e.jsx("h2",{className:"card-title",children:"Productos frecuentes"}),e.jsx("p",{className:"muted",children:"Basado en compras anteriores del cliente."})]}),g?e.jsxs("div",{className:"frequent-products-search",children:[e.jsx("label",{className:"sr-only",htmlFor:"frequent-products-search",children:"Buscar producto frecuente"}),e.jsx("input",{id:"frequent-products-search",type:"search",className:"input",placeholder:"Buscar por nombre o SKU",value:c,onChange:h=>r(h.target.value),autoComplete:"off"})]}):null]}),e.jsxs("div",{className:"frequent-products-content","aria-busy":p,children:[p?e.jsxs("div",{className:"frequent-products-loading",role:"status","aria-live":"polite",children:[e.jsx("div",{className:"skeleton skeleton-text","aria-hidden":"true"}),e.jsx("div",{className:"skeleton skeleton-text","aria-hidden":"true"}),e.jsx("div",{className:"skeleton skeleton-text","aria-hidden":"true"})]}):null,!p&&N?e.jsxs("div",{className:"frequent-products-error",role:"alert",children:[e.jsx("p",{children:"No pudimos cargar los productos frecuentes."}),e.jsx("button",{type:"button",className:"btn",onClick:()=>u(),children:"Reintentar"})]}):null,!p&&!N&&(a?.length??0)===0?e.jsx("p",{className:"muted",role:"status",children:"Este cliente no tiene compras previas."}):null,!p&&!N&&f.length>0?e.jsx("ul",{className:"frequent-products-list",children:f.map(h=>{const v=Ut(h.lastPurchasedAt),T=h.avgQty!==void 0&&h.avgQty!==null?Number(h.avgQty).toFixed(1):null,S=h.lastUnitPrice!==void 0&&h.lastUnitPrice!==null?zt.format(h.lastUnitPrice):null,W=()=>n(h,{lastQty:h.lastQty});return e.jsx("li",{children:e.jsxs("div",{role:"button",tabIndex:0,className:"frequent-product-row",onClick:W,onKeyDown:Y=>{(Y.key==="Enter"||Y.key===" ")&&(Y.preventDefault(),W())},"aria-label":`Agregar ${h.name}`,children:[e.jsxs("div",{className:"frequent-product-main",children:[e.jsx("span",{className:"frequent-product-name",children:h.name}),e.jsxs("span",{className:"frequent-product-sku",children:["SKU: ",h.sku||"â€”"]})]}),e.jsxs("dl",{className:"frequent-product-meta",children:[e.jsxs("div",{children:[e.jsx("dt",{children:"Ãšltima compra"}),e.jsx("dd",{children:v})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Veces compradas"}),e.jsx("dd",{children:h.totalPurchases})]}),h.lastQty!==void 0?e.jsxs("div",{children:[e.jsx("dt",{children:"Ãšltima cantidad"}),e.jsx("dd",{children:h.lastQty})]}):null,T?e.jsxs("div",{children:[e.jsx("dt",{children:"Cantidad promedio"}),e.jsx("dd",{children:T})]}):null,S?e.jsxs("div",{children:[e.jsx("dt",{children:"Ãšltimo precio"}),e.jsx("dd",{children:S})]}):null]})]})},h.productId)})}):null,!p&&!N&&f.length===0&&(a?.length??0)>0?e.jsxs("p",{className:"muted",role:"status",children:['No encontramos coincidencias para "',c,'".']}):null]})]})}const Ue=[{value:"Factura",label:"Factura"},{value:"Boleta",label:"Boleta"},{value:"CotizaciÃ³n",label:"CotizaciÃ³n"},{value:"Comprobante",label:"Comprobante"}],Ve=[{value:"Efectivo",label:"Efectivo"},{value:"Tarjetas",label:"Tarjetas"},{value:"Transferencia",label:"Transferencia"},{value:"Otros",label:"Otros"}],Qt=20,Ht="name,asc",Gt=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,Pe={name:"",document:"",email:"",phone:"",address:"",commune:""};function Ae(t){const o=t.trim();return o.length>0?o:void 0}function Wt(t){const o={},n=t.name.trim();n.length<3?o.name="El nombre debe tener al menos 3 caracteres":n.length>120&&(o.name="El nombre no puede superar 120 caracteres");const c=t.document.trim();let r;c.length>0&&(pt(c)?r=gt(c):o.document="Ingresa un RUT vÃ¡lido");const a=t.email.trim();a&&!Gt.test(a)&&(o.email="Ingresa un email vÃ¡lido");const l=t.phone.trim();return Object.keys(o).length>0?{errors:o}:{payload:{name:n,document:r??Ae(t.document),email:a?a.toLowerCase():void 0,phone:l?l.replace(/\s+/g," ").trim():void 0,address:Ae(t.address),commune:Ae(t.commune)},errors:o}}function Yt(t,o,n){const c=d.useRef(t.length);d.useEffect(()=>{if(!o){c.current=t.length;return}if(t.length===0){n(-1),c.current=0;return}t.length!==c.current&&(n(0),c.current=t.length)},[t,o,n])}function Xt({value:t,onSelect:o,onClear:n,disabled:c,label:r="Cliente",required:a=!1,error:l=null,onErrorDismiss:m,debounceMs:N=400}){const[u,f]=d.useState(""),[g,p]=d.useState(!1),[h,v]=d.useState(-1),[T,S]=d.useState({tone:null,message:null}),[W,Y]=d.useState(!1),[X,O]=d.useState({...Pe}),[A,J]=d.useState({}),[te,ie]=d.useState(null),ue=d.useRef(null),re=d.useRef(null),z=d.useRef(null),xe=d.useRef(null),H=ot(u,N),ne=rt(),I=d.useId(),E=d.useId(),D=d.useRef(null),le=d.useRef(null);d.useEffect(()=>{const x=t?.id??null;x!==xe.current&&(xe.current=x,f(t?t.name??"":""))},[t]);const R=Et({queryKey:["customers","picker",H],queryFn:async({pageParam:x=0})=>{const j=H.trim();return await bt({page:x,size:Qt,sort:Ht,q:j.length>0?j:void 0})},getNextPageParam:x=>Lt(x),initialPageParam:0}),M=d.useMemo(()=>_t(R.data?.pages??[]),[R.data]);Yt(M,g,v);const w=R.hasNextPage??!1,V=R.isFetchingNextPage,oe=R.isPending&&M.length===0,ce=d.useCallback(x=>{typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(x):setTimeout(x,0)},[]);d.useEffect(()=>{if(!g||typeof window>"u"||typeof window.IntersectionObserver>"u")return;const x=D.current;if(!x)return;const j=new IntersectionObserver(_=>{const[s]=_;s?.isIntersecting&&w&&!V&&R.fetchNextPage()});return j.observe(x),le.current=j,()=>j.disconnect()},[g,w,V,R]);const Z=()=>{z.current&&(window.clearTimeout(z.current),z.current=null)},Q=d.useCallback(()=>{p(!1),v(-1)},[]),F=d.useCallback(x=>{o(x),Q(),S({tone:null,message:null}),m?.(),ce(()=>re.current?.blur())},[Q,o,m,ce]),we=()=>{c||(Z(),p(!0))},de=()=>{Z(),z.current=window.setTimeout(()=>{Q()},120)},se=x=>{const{value:j}=x.currentTarget;f(j),S({tone:null,message:null}),g||p(!0)},he=x=>{if(!g&&(x.key==="ArrowDown"||x.key==="ArrowUp"||x.key==="Enter")&&p(!0),x.key==="ArrowDown"){if(x.preventDefault(),M.length===0)return;v(j=>j+1>=M.length?j:j+1);return}if(x.key==="ArrowUp"){if(x.preventDefault(),M.length===0)return;v(j=>j<=0?0:j-1);return}if(x.key==="Enter"){g&&h>=0&&M[h]&&(x.preventDefault(),F(M[h]));return}if(x.key==="Escape"){if(x.preventDefault(),g){Q();return}u.length>0&&(f(""),n?.())}},Se=x=>{x.preventDefault(),Z()},Ne=()=>{Y(!0),O({...Pe,name:u.trim()}),J({}),ie(null),Q(),ce(()=>{re.current?.blur()})},ae=()=>{B.isPending||(Y(!1),O({...Pe}),J({}),ie(null),re.current?.focus())},B=me({mutationFn:x=>ht(x),onSuccess:x=>{ne.invalidateQueries({queryKey:["customers"],exact:!1}),S({tone:"success",message:"Cliente creado"}),Y(!1),O({...Pe}),J({}),ie(null),F(x),ce(()=>re.current?.focus())},onError:x=>{const j=At(x),_={};for(const[s,b]of Object.entries(j.fieldErrors))b&&s in Pe&&(_[s]=b);J(_),ie(j.message??"No se pudo crear el cliente")}}),ge=x=>{x.preventDefault(),ie(null);const{payload:j,errors:_}=Wt(X);if(!j||Object.keys(_).length>0){J(_);return}B.mutate(j)},G=x=>{const j=[];return x.document&&j.push(x.document),x.email&&j.push(x.email),!x.email&&x.phone&&j.push(x.phone),j.join(" â€¢ ")};return e.jsxs("div",{className:"customer-select",ref:ue,children:[e.jsxs("label",{className:"customer-select__label",htmlFor:`${I}-input`,children:[r,a?e.jsx("span",{className:"customer-select__required","aria-hidden":"true",children:"*"}):null]}),e.jsxs("div",{className:"customer-select__field",children:[e.jsxs("div",{className:`customer-select__combobox${g?" is-open":""}${c?" is-disabled":""}${l?" has-error":""}`,children:[e.jsx("input",{id:`${I}-input`,ref:re,type:"text",className:"customer-select__input",role:"combobox","aria-autocomplete":"list","aria-expanded":g,"aria-controls":I,"aria-activedescendant":h>=0&&M[h]?`${I}-option-${h}`:void 0,"aria-describedby":l?`${I}-error`:void 0,placeholder:"Buscar por nombre, RUT o emailâ€¦",value:u,onFocus:we,onBlur:de,onInput:se,onKeyDown:he,disabled:c,autoComplete:"off","aria-required":a?"true":void 0}),t?e.jsx("button",{type:"button",className:"customer-select__clear",onClick:()=>{n?.(),f(""),S({tone:null,message:null}),re.current?.focus()},"aria-label":"Limpiar cliente seleccionado",disabled:c,children:"Ã—"}):null,e.jsx("button",{type:"button",className:"customer-select__create-btn",onClick:Ne,disabled:c,children:"+ Nuevo cliente"})]}),g?e.jsxs("div",{className:"customer-select__dropdown",role:"listbox",id:I,children:[oe?e.jsx("div",{className:"customer-select__empty",children:"Buscando clientesâ€¦"}):M.length===0?e.jsxs("div",{className:"customer-select__empty",role:"status","aria-live":"polite",children:[e.jsx("p",{children:"Sin resultados. Â¿Crear cliente?"}),e.jsx("button",{type:"button",className:"btn ghost",onClick:Ne,children:"Crear cliente"})]}):e.jsx("ul",{className:"customer-select__options",children:M.map((x,j)=>{const _=G(x),s=j===h;return e.jsx("li",{children:e.jsxs("button",{type:"button",role:"option",id:`${I}-option-${j}`,className:`customer-select__option${s?" is-active":""}`,"aria-selected":s,onMouseDown:Se,onClick:()=>F(x),children:[e.jsx("span",{className:"customer-select__option-name",children:x.name}),_?e.jsx("span",{className:"customer-select__option-meta",children:_}):null]})},x.id)})}),R.isError?e.jsx("div",{className:"customer-select__empty customer-select__empty--error",role:"alert",children:R.error.message||"No se pudieron cargar los clientes"}):null,w?e.jsx("div",{className:"customer-select__load-more",ref:D,children:e.jsx("button",{type:"button",className:"btn ghost",onClick:()=>void R.fetchNextPage(),disabled:V,children:V?"Cargando mÃ¡sâ€¦":"Cargar mÃ¡s"})}):null]}):null,l?e.jsx("p",{id:`${I}-error`,className:"customer-select__feedback customer-select__feedback--error",role:"alert",children:l}):null,T.tone&&T.message?e.jsx("p",{className:`customer-select__feedback customer-select__feedback--${T.tone}`,role:"status","aria-live":"polite",children:T.message}):null]}),W?e.jsxs("div",{className:"customer-create-overlay",role:"dialog","aria-modal":"true","aria-labelledby":E,children:[e.jsx("div",{className:"customer-create-overlay__backdrop",onClick:ae,role:"presentation"}),e.jsxs("section",{className:"customer-create-sheet",children:[e.jsxs("header",{className:"customer-create-sheet__header",children:[e.jsx("h3",{id:E,children:"Nuevo cliente"}),e.jsx("button",{type:"button",className:"icon-btn",onClick:ae,"aria-label":"Cerrar",disabled:B.isPending,children:"Ã—"})]}),e.jsxs("form",{className:"customer-create-sheet__form",onSubmit:ge,noValidate:!0,children:[e.jsxs("label",{children:[e.jsx("span",{children:"Nombre *"}),e.jsx("input",{type:"text",className:`input${A.name?" input-error":""}`,value:X.name,onChange:x=>{O(j=>({...j,name:x.target.value})),J(j=>({...j,name:void 0}))},required:!0,minLength:3,maxLength:120,autoFocus:!0,disabled:B.isPending}),A.name?e.jsx("span",{className:"error",role:"alert",children:A.name}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"RUT"}),e.jsx("input",{type:"text",className:`input${A.document?" input-error":""}`,value:X.document,onChange:x=>{O(j=>({...j,document:x.target.value})),J(j=>({...j,document:void 0}))},placeholder:"76.123.456-0",disabled:B.isPending}),A.document?e.jsx("span",{className:"error",role:"alert",children:A.document}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"Email"}),e.jsx("input",{type:"email",className:`input${A.email?" input-error":""}`,value:X.email,onChange:x=>{O(j=>({...j,email:x.target.value})),J(j=>({...j,email:void 0}))},placeholder:"contacto@cliente.cl",disabled:B.isPending}),A.email?e.jsx("span",{className:"error",role:"alert",children:A.email}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"TelÃ©fono"}),e.jsx("input",{type:"tel",className:"input",value:X.phone,onChange:x=>{O(j=>({...j,phone:x.target.value}))},placeholder:"+56 9 1234 5678",disabled:B.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"DirecciÃ³n"}),e.jsx("input",{type:"text",className:"input",value:X.address,onChange:x=>{O(j=>({...j,address:x.target.value}))},placeholder:"Av. Principal 1234",disabled:B.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Comuna"}),e.jsx("input",{type:"text",className:"input",value:X.commune,onChange:x=>{O(j=>({...j,commune:x.target.value}))},placeholder:"Providencia",disabled:B.isPending})]}),te?e.jsx("div",{className:"customer-create-sheet__alert",role:"alert",children:te}):null,e.jsxs("div",{className:"customer-create-sheet__actions",children:[e.jsx("button",{type:"button",className:"btn ghost",onClick:ae,disabled:B.isPending,children:"Cancelar"}),e.jsx("button",{className:"btn",type:"submit",disabled:B.isPending,children:B.isPending?"Guardandoâ€¦":"Guardar"})]})]})]})]}):null]})}const Ge=Ue[0].value,We=Ve[2].value,Ye=["barcode","sku","qr"],Jt=100,Zt=[{value:"auto",label:"DetecciÃ³n automÃ¡tica"},{value:"barcode",label:"CÃ³digo de barras"},{value:"sku",label:"SKU"},{value:"qr",label:"QR"}];function es({open:t,onClose:o,onCreated:n}){const[c,r]=d.useState(null),[a,l]=d.useState(null),[m,N]=d.useState(Ge),[u,f]=d.useState(We),[g,p]=d.useState(null),[h,v]=d.useState([]),[T,S]=d.useState(""),[W,Y]=d.useState(1),[X,O]=d.useState(0),[A,J]=d.useState("amount"),[te,ie]=d.useState(0),[ue,re]=d.useState(!0),[z,xe]=d.useState({}),[H,ne]=d.useState(!1),I=d.useRef(null),E=d.useRef(""),D=d.useRef(null),[le,R]=d.useState(""),[M,w]=d.useState(""),[V,oe]=d.useState("auto"),[ce,Z]=d.useState(!1),[Q,F]=d.useState({status:"idle"}),we=K({queryKey:["products",{dialog:"sales"}],queryFn:()=>Nt({size:200}),enabled:t,staleTime:3e4});K({queryKey:["locations",{dialog:"sales"}],queryFn:()=>vt(),enabled:t});const de=me({mutationFn:i=>ft(i),onSuccess:i=>{n(i),C(),o()}}),se=we.data?.content??[],he=c?.id??"";d.useEffect(()=>{se.length&&xe(i=>{let y=!1;const P={...i};for(const k of se)P[k.id]||(P[k.id]=k,y=!0);return y?P:i})},[se]),d.useEffect(()=>{c?.id||ne(!1)},[c]);const Se=d.useCallback(i=>{r(i),l(null)},[]),Ne=d.useCallback(()=>{r(null),l(null),ne(!1)},[]),ae=d.useCallback((i,y=1,P)=>{if(!i||y<=0||Number.isNaN(y))return;const k=P!==void 0&&!Number.isNaN(P)?P:Number(i.currentPrice??0)||0;xe(q=>q[i.id]?q:{...q,[i.id]:i}),v(q=>{const $=q.findIndex(L=>L.productId===i.id);if($!==-1){const L=q[$],ke=[...q];return ke[$]={...L,qty:L.qty+y,unitPrice:P!==void 0?P:L.unitPrice||k},ke}return[...q,{productId:i.id,qty:y,unitPrice:k}]})},[]),B=d.useCallback(async(i,y={})=>{const P=i.trim();if(!P)return y.showEmptyError&&F({status:"error",message:"Ingresa un cÃ³digo vÃ¡lido."}),null;Z(!0),F({status:"loading",message:"Buscando producto..."});const k=y.hint?[y.hint,...Ye.filter($=>$!==y.hint)]:Ye,q=new Set;try{for(const $ of k){if(q.has($))continue;q.add($);const L=await jt({query:P,type:$});if(L)return ae(L,1),F({status:"success",message:`Producto "${L.name}" agregado a la venta.`}),L}return F({status:"error",message:"Producto no encontrado para el cÃ³digo ingresado."}),null}catch($){const L=$ instanceof Error?$.message:"No se pudo buscar el producto.";return F({status:"error",message:L}),null}finally{Z(!1)}},[ae]),ge=d.useCallback(()=>{D.current&&(window.clearTimeout(D.current),D.current=null);const i=E.current.trim();if(!i){R(""),E.current="";return}let y=i;R(""),E.current="",B(y,{showEmptyError:!1})},[B]),G=i=>{const y=i.target.value;R(y),E.current=y,D.current&&window.clearTimeout(D.current),y&&(D.current=window.setTimeout(ge,Jt))},x=i=>{i.key==="Enter"&&(i.preventDefault(),ge())},j=async()=>{if(ce)return;await B(M,{hint:V==="auto"?void 0:V,showEmptyError:!0})&&(w(""),oe("auto"))},_=d.useMemo(()=>{const i=h.reduce(($,L)=>$+L.qty*L.unitPrice-(L.discount??0),0);let y=0;A==="percentage"?y=i*(te/100):y=te;const P=i-y,k=ue?P*.19:0,q=P+k;return{subtotal:i,discountAmount:y,net:P,vat:k,total:q}},[h,ue,A,te]),s=()=>{if(!T){F({status:"error",message:"Selecciona un producto para agregarlo."});return}const i=se.find(y=>y.id===T);if(!i){F({status:"error",message:"Producto seleccionado no disponible."});return}if(W<=0||Number.isNaN(W)){F({status:"error",message:"La cantidad debe ser mayor a cero."});return}if(X<=0||Number.isNaN(X)){F({status:"error",message:"El precio unitario debe ser mayor a cero."});return}ae(i,W,X),F({status:"success",message:`Se agregÃ³ ${W}Ã— "${i.name}" al carrito.`}),S(""),Y(1),O(0)},b=i=>{v(y=>y.filter((P,k)=>k!==i))},C=()=>{r(null),l(null),N(Ge),f(We),p(null),v([]),S(""),Y(1),O(0),w(""),oe("auto"),F({status:"idle"}),Z(!1),R(""),E.current="",D.current&&(window.clearTimeout(D.current),D.current=null),ne(!1)},U=i=>{if(i.preventDefault(),!c?.id){l("Selecciona un cliente");return}if(h.length===0)return;const y={customerId:c.id,docType:m,paymentMethod:u,paymentTermDays:g??void 0,discount:te>0?A==="percentage"?_.discountAmount:te:void 0,vatRate:ue?19:void 0,items:h};de.mutate(y)};d.useEffect(()=>{if(!t){F({status:"idle"}),Z(!1),R(""),E.current="",D.current&&(window.clearTimeout(D.current),D.current=null),ne(!1);return}requestAnimationFrame(()=>{I.current&&(I.current.focus(),I.current.select())})},[t]),d.useEffect(()=>()=>{D.current&&(window.clearTimeout(D.current),D.current=null)},[]);const be=d.useCallback((i,y)=>{const P=z[i.productId]??se.find(mt=>mt.id===i.productId);if(!P){F({status:"error",message:"El producto ya no estÃ¡ disponible en el catÃ¡logo."});return}const k=y?.lastQty,q=i.avgQty?Math.round(i.avgQty):1,$=k!==void 0&&k>0?k:q,L=$>0?$:1,ke=P.currentPrice!==void 0&&P.currentPrice!==null?void 0:i.lastUnitPrice;ae(P,L,ke),F({status:"success",message:`Se agregÃ³ ${L}Ã— "${P.name}" desde frecuentes.`})},[ae,z,se]);return e.jsx(qe,{open:t,onClose:o,title:"Registrar venta",initialFocusRef:I,className:"modal--wide sales-create-modal",children:e.jsxs("form",{className:"form-grid",onSubmit:U,children:[e.jsx(Xt,{value:c,onSelect:Se,onClear:Ne,label:"Cliente",required:!0,error:a,onErrorDismiss:()=>l(null),disabled:de.isPending}),e.jsxs("label",{children:[e.jsx("span",{children:"Documento"}),e.jsx("select",{className:"input",value:m,onChange:i=>N(i.target.value),children:Ue.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))})]}),e.jsxs("label",{children:[e.jsx("span",{children:"MÃ©todo de pago"}),e.jsx("select",{className:"input",value:u,onChange:i=>f(i.target.value),children:Ve.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))})]}),e.jsxs("label",{children:[e.jsx("span",{children:"TÃ©rminos de pago (opcional)"}),e.jsxs("select",{className:"input",value:g??"",onChange:i=>p(i.target.value?Number(i.target.value):null),children:[e.jsx("option",{value:"",children:"Sin tÃ©rminos de pago"}),e.jsx("option",{value:"7",children:"7 dÃ­as"}),e.jsx("option",{value:"15",children:"15 dÃ­as"}),e.jsx("option",{value:"30",children:"30 dÃ­as"}),e.jsx("option",{value:"60",children:"60 dÃ­as"})]})]}),e.jsx("div",{className:"line"}),e.jsx("div",{className:"section-title",children:"Descuentos e Impuestos"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:[e.jsxs("label",{children:[e.jsx("span",{children:"Tipo de descuento"}),e.jsxs("select",{className:"input",value:A,onChange:i=>J(i.target.value),children:[e.jsx("option",{value:"amount",children:"Monto fijo ($)"}),e.jsx("option",{value:"percentage",children:"Porcentaje (%)"})]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Valor descuento"}),e.jsx("input",{className:"input",type:"number",min:0,step:A==="percentage"?1:.01,value:te,onChange:i=>ie(Number(i.target.value)),placeholder:A==="percentage"?"0-100":"0.00"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",checked:ue,onChange:i=>re(i.target.checked)}),e.jsx("span",{children:"Aplicar IVA 19%"})]})]}),e.jsx("div",{className:"line"}),e.jsxs("div",{className:"lookup-section",children:[e.jsxs("div",{className:"scan-input-wrapper",children:[e.jsxs("label",{children:[e.jsx("span",{children:"EscÃ¡ner USB"}),e.jsx("input",{ref:I,className:"input scan-input",type:"text",inputMode:"text",autoComplete:"off",value:le,onChange:G,onKeyDown:x,placeholder:"Enfoca y escanea el cÃ³digo","aria-describedby":"scan-hint"})]}),e.jsx("p",{id:"scan-hint",className:"scan-hint",children:"MantÃ©n el foco en este campo y escanea cÃ³digo de barras, SKU o QR. El producto se agrega automÃ¡ticamente cuando se detecta la lectura."})]}),e.jsx("div",{className:"manual-entry",children:e.jsxs("label",{children:[e.jsx("span",{children:"Agregar por cÃ³digo"}),e.jsxs("div",{className:"manual-entry__inputs",children:[e.jsx("input",{className:"input",type:"text",value:M,onChange:i=>w(i.target.value),onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),j())},placeholder:"Ingresa cÃ³digo, SKU o QR"}),e.jsx("select",{className:"input manual-entry__type",value:V,onChange:i=>oe(i.target.value),"aria-label":"Tipo de cÃ³digo",children:Zt.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))}),e.jsx("button",{type:"button",className:"btn",onClick:()=>void j(),disabled:ce||M.trim()==="",children:ce?"Buscando...":"Agregar"})]})]})})]}),Q.status!=="idle"&&e.jsx("div",{className:`status-message lookup-feedback ${Q.status==="success"?"success":Q.status==="error"?"error":"loading"}`,role:"status","aria-live":"polite",children:Q.message??""}),e.jsxs("section",{className:"frequent-products-wrapper",children:[e.jsxs("label",{className:"frequent-products-toggle",children:[e.jsx("input",{type:"checkbox",checked:H,onChange:i=>ne(i.target.checked),disabled:!he}),e.jsx("span",{children:"Productos frecuentes del cliente"})]}),e.jsx(Vt,{customerId:he||void 0,visible:H&&!!he,onPick:be})]}),e.jsx("div",{className:"line"}),e.jsxs("div",{className:"item-builder",children:[e.jsxs("select",{className:"input",value:T,onChange:i=>{const y=i.target.value;S(y);const P=se.find(k=>k.id===y);P?.currentPrice!==void 0&&P.currentPrice!==null?O(Number(P.currentPrice)):O(0)},children:[e.jsx("option",{value:"",children:"Selecciona producto"}),se.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),e.jsx("input",{className:"input",type:"number",min:1,value:W,onChange:i=>Y(Number(i.target.value))}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:0,value:X,onChange:i=>O(Number(i.target.value))}),e.jsx("button",{type:"button",className:"btn",onClick:s,children:"Agregar"})]}),h.length>0&&e.jsx("div",{className:"table-wrapper compact",children:e.jsxs("table",{className:"table nowrap",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:h.map((i,y)=>{const k=(z[i.productId]??se.find(L=>L.id===i.productId))?.name??i.productId,q=`${i.qty}`,$=`$${i.unitPrice.toFixed(2)}`;return e.jsxs("tr",{children:[e.jsx("td",{title:k,children:e.jsx("span",{className:"cell-text",children:k})}),e.jsx("td",{className:"mono",title:q,children:e.jsx("span",{className:"cell-text",children:i.qty})}),e.jsx("td",{className:"mono",title:$,children:e.jsx("span",{className:"cell-text",children:$})}),e.jsx("td",{className:"actions-cell",children:e.jsx("button",{type:"button",className:"btn ghost",onClick:()=>b(y),children:"Quitar"})})]},`${i.productId}-${y}`)})})]})}),e.jsxs("div",{className:"total-section",style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"1rem",background:"#f9f9f9",borderRadius:"4px"},children:[e.jsx("span",{className:"muted",children:"Subtotal:"}),e.jsxs("strong",{children:["$",_.subtotal.toFixed(2)]}),te>0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"muted",children:["Descuento (",A==="percentage"?`${te}%`:"$","):"]}),e.jsxs("strong",{children:["-$",_.discountAmount.toFixed(2)]})]}),e.jsx("span",{className:"muted",children:"Neto:"}),e.jsxs("strong",{children:["$",_.net.toFixed(2)]}),ue&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"muted",children:"IVA (19%):"}),e.jsxs("strong",{children:["$",_.vat.toFixed(2)]})]}),e.jsx("span",{style:{fontSize:"1.1rem",fontWeight:"bold"},children:"Total:"}),e.jsxs("strong",{style:{fontSize:"1.1rem"},children:["$",_.total.toFixed(2)]})]}),de.isError&&e.jsx("p",{className:"error",children:de.error.message}),e.jsxs("div",{className:"buttons",children:[e.jsx("button",{className:"btn",type:"submit",disabled:de.isPending,children:de.isPending?"Guardando...":"Registrar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:C,children:"Limpiar"})]})]})})}function ts({value:t,rangeLabel:o,formatter:n=Oe}){return e.jsxs("article",{className:"card stat","aria-label":`Promedio diario de ventas para ${o}`,children:[e.jsx("h3",{children:"Promedio diario"}),e.jsx("p",{className:"stat-value","data-testid":"sales-daily-average",children:n(t)}),e.jsxs("span",{className:"stat-trend",children:["Rango seleccionado: ",o]})]})}function ss({value:t,rangeLabel:o,formatter:n=Oe}){return e.jsxs("article",{className:"card stat","aria-label":`Ventas acumuladas para ${o}`,children:[e.jsx("h3",{children:"Ventas acumuladas"}),e.jsx("p",{className:"stat-value","data-testid":"sales-total-14d",children:n(t)}),e.jsxs("span",{className:"stat-trend",children:["Rango seleccionado: ",o]}),e.jsx("span",{className:"muted small",children:"Incluye solo Boleta y Factura"})]})}function as({startDate:t,endDate:o,onStartDateChange:n,onEndDateChange:c}){const r=d.useMemo(()=>ct(),[]),a=h=>r.format(h??0),l=d.useMemo(()=>{const h=new Date(t),v=new Date(o),T=Math.abs(v.getTime()-h.getTime());return Math.ceil(T/(1e3*60*60*24))+1},[t,o]),{data:m,isLoading:N,error:u}=K({queryKey:["sales-window-metrics",l],queryFn:()=>yt(`${l}d`)}),f=d.useMemo(()=>m?.dailyAverage??0,[m]),g=d.useMemo(()=>m?.totalWithTax??0,[m]);d.useMemo(()=>m?.documentCount??0,[m]);const p=`Ãšltimos ${l} dÃ­as`;return N?e.jsx("section",{"aria-labelledby":"sales-dashboard-overview-heading",className:"mb-6",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("header",{className:"mb-4",children:e.jsx("h2",{id:"sales-dashboard-overview-heading",className:"text-xl font-semibold text-neutral-100",children:"ðŸ“Š Resumen de ventas"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"})]})]})}):u?e.jsx("section",{"aria-labelledby":"sales-dashboard-overview-heading",className:"mb-6",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("header",{className:"mb-4",children:e.jsx("h2",{id:"sales-dashboard-overview-heading",className:"text-xl font-semibold text-neutral-100",children:"ðŸ“Š Resumen de ventas"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar mÃ©tricas de ventas"})}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar mÃ©tricas de ventas"})})]})]})}):e.jsx("section",{"aria-labelledby":"sales-dashboard-overview-heading",className:"mb-6",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("header",{className:"mb-4",children:e.jsx("h2",{id:"sales-dashboard-overview-heading",className:"text-xl font-semibold text-neutral-100",children:"ðŸ“Š Resumen de ventas"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ts,{value:f,rangeLabel:p,formatter:a}),e.jsx(ss,{value:g,rangeLabel:p,formatter:a})]})]})})}const rs={position:"absolute",width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:0};function ns({points:t,formatter:o=Oe,averageLine:n}){const c=t.map(a=>({date:a.date,total:a.total??0})),r=c.some(a=>a.total>0);return e.jsxs("div",{className:"chart-container","data-testid":"sales-trend-chart","data-point-count":c.length,children:[e.jsx("div",{style:{height:260},role:"img","aria-label":"Tendencia de ventas diarias",children:e.jsx(je,{width:"100%",height:"100%",children:e.jsxs($t,{data:c,margin:{top:10,right:24,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"salesTrendGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#22d3ee",stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:"#22d3ee",stopOpacity:0})]})}),e.jsx(ve,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(ye,{dataKey:"date",stroke:"#a3a3a3",tick:{fontSize:12,fill:"#a3a3a3"}}),e.jsx(Ce,{stroke:"#a3a3a3",tick:{fill:"#a3a3a3"},tickFormatter:a=>o(Number(a)),width:96}),e.jsx(fe,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:(a,l)=>{const m=l==="total"?"Venta del dÃ­a":"Promedio perÃ­odo";return[o(a),m]},labelFormatter:a=>`Fecha: ${a}`}),e.jsx(qt,{type:"monotone",dataKey:"total",stroke:"#22d3ee",strokeWidth:2,fill:"url(#salesTrendGradient)",dot:{r:4,strokeWidth:2,fill:"#0891b2",stroke:"#22d3ee"},activeDot:{r:6,fill:"#06b6d4",stroke:"#22d3ee",strokeWidth:2}}),n!==void 0&&n>0&&e.jsx(dt,{y:n,stroke:"#fb923c",strokeWidth:2,strokeDasharray:"5 5",label:{value:`Promedio: ${o(n)}`,position:"right",style:{fill:"#fb923c",fontSize:12,fontWeight:600}}})]})})}),!r&&e.jsx("p",{className:"text-neutral-400",role:"status",children:"Sin ventas registradas en el perÃ­odo seleccionado."}),e.jsx("ul",{style:rs,"data-testid":"sales-trend-points",children:c.map(a=>e.jsx("li",{"data-testid":"sales-trend-point",children:`${a.date}: ${a.total}`},a.date))})]})}function ls({startDate:t,endDate:o,onStartDateChange:n,onEndDateChange:c}){const r=new Date().toISOString().split("T")[0],a=d.useMemo(()=>ct(),[]),l=p=>a.format(p??0),m=K({queryKey:["sales","daily-range",t,o],queryFn:()=>Ct(t,o),enabled:!!t&&!!o&&t<=o}),N=m.data??[],u=d.useMemo(()=>N.length===0?0:N.reduce((h,v)=>h+v.total,0)/N.length,[N]),f=p=>{p&&(n(p),p>o&&c(p))},g=p=>{p&&(c(p),p<t&&n(p))};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"flex flex-wrap gap-4 justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ“ˆ Tendencia de ventas"}),e.jsxs("p",{className:"text-sm text-neutral-400",children:["Promedio diario: ",l(u)," | Total perÃ­odo:"," ",l(N.reduce((p,h)=>p+h.total,0))]})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Desde"}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"date",value:t,max:o,onChange:p=>f(p.target.value)})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Hasta"}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"date",value:o,min:t,max:r,onChange:p=>g(p.target.value)})]})]})]}),e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:m.isLoading?e.jsx("p",{className:"text-neutral-400",role:"status",children:"Cargando datos de ventas..."}):m.isError?e.jsxs("p",{className:"text-red-400",role:"status",children:["Error al cargar los datos de ventas. ",m.error?.message]}):N.length>0?e.jsx(ns,{points:N,formatter:l,averageLine:u}):e.jsxs("p",{className:"text-neutral-400",role:"status",children:["No hay ventas registradas en el rango seleccionado (",t," - ",o,")."]})})]})}function os({page:t=0,size:o=10,sort:n="date,DESC",enabled:c=!0}={}){return K({queryKey:["sale-documents",t,o,n],queryFn:()=>wt({page:t,size:o,sort:n}),enabled:c,placeholderData:nt})}const cs=new Intl.DateTimeFormat("es-CL",{dateStyle:"medium"}),ds=new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0});function is(t){if(!t)return"â€”";const o=Date.parse(t);return Number.isNaN(o)?t:cs.format(new Date(o))}function us(t){return t==null||Number.isNaN(t)?"â€”":ds.format(t)}function Xe(t){const o=[t.documentNumber];return(!o[0]||!o[0]?.trim())&&(o[0]=t.docNumber),(!o[0]||!o[0]?.trim())&&t.series&&t.folio!==void 0&&t.folio!==null&&(o[0]=`${t.series}-${t.folio}`),o[0]?.trim()||t.id}const ms=10;function xs({isOpen:t,onClose:o,pageSize:n=ms}){const[c,r]=d.useState(0),a=d.useRef(null);d.useEffect(()=>{t&&r(0)},[t]);const l=os({page:c,size:n,enabled:t}),m=l.data?.content??[],N=l.data?.totalPages??1,u=!l.isLoading&&!l.isError&&m.length===0,f=d.useMemo(()=>l.isFetching&&!l.isLoading?"Actualizando documentos...":null,[l.isFetching,l.isLoading]),g=()=>{l.refetch()},p=()=>{r(v=>Math.max(0,v-1))},h=()=>{r(v=>v+1)};return e.jsxs(qe,{open:t,onClose:o,title:"Documentos de venta",initialFocusRef:a,className:"modal--wide",children:[e.jsxs("div",{className:"sale-documents-modal","aria-live":"polite",children:[l.isLoading&&e.jsx("p",{role:"status",children:"Cargando documentos..."}),l.isError&&e.jsxs("div",{className:"sale-documents-modal__error",role:"alert",children:[e.jsx("p",{children:l.error?.message??"No se pudieron obtener los documentos de venta."}),e.jsx("button",{className:"btn",type:"button",onClick:g,children:"Reintentar"})]}),f&&e.jsx("p",{className:"muted",role:"status",children:f}),u&&e.jsx("p",{className:"muted",children:"No hay documentos de ventas registrados."}),!l.isLoading&&!l.isError&&m.length>0&&e.jsx("div",{className:"sale-documents-modal__table",children:e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table sale-documents-modal__grid",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"Fecha"}),e.jsx("th",{scope:"col",children:"NÃºmero de documento"}),e.jsx("th",{scope:"col",children:"Cliente"}),e.jsx("th",{scope:"col",children:"Total"}),e.jsx("th",{scope:"col",className:"sale-documents-modal__status-column",children:"Estado"})]})}),e.jsx("tbody",{children:m.map(v=>e.jsxs("tr",{children:[e.jsx("td",{children:is(v.date)}),e.jsx("td",{children:e.jsx("span",{className:"sale-documents-modal__cell",title:Xe(v),children:Xe(v)})}),e.jsx("td",{children:e.jsx("span",{className:"sale-documents-modal__cell",title:v.customerName,children:v.customerName||"â€”"})}),e.jsx("td",{className:"mono",children:us(v.total)}),e.jsx("td",{className:"sale-documents-modal__status-column",children:v.status?e.jsx("span",{className:`status ${v.status.toLowerCase()}`,"aria-label":v.status,children:v.status}):"â€”"})]},v.id))})]})})}),!l.isError&&m.length>0&&e.jsxs("div",{className:"sale-documents-modal__pagination",children:[e.jsx("button",{className:"btn",type:"button",onClick:p,disabled:c===0||l.isFetching,children:"Anterior"}),e.jsxs("span",{className:"muted",children:["PÃ¡gina ",c+1," de ",N]}),e.jsx("button",{className:"btn",type:"button",onClick:h,disabled:c+1>=N||l.isFetching,children:"Siguiente"})]})]}),e.jsx("footer",{className:"sale-documents-modal__footer",children:e.jsx("button",{ref:a,className:"btn ghost",type:"button",onClick:o,children:"Cerrar"})})]})}function hs(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function ps(){return[{productId:"P001",productName:"Laptop Dell Inspiron 15",sku:"DELL-INS-15",totalRevenue:85e5,totalQuantity:12,salesCount:12},{productId:"P002",productName:'Monitor Samsung 27"',sku:"SAM-MON-27",totalRevenue:62e5,totalQuantity:28,salesCount:28},{productId:"P003",productName:"Teclado MecÃ¡nico Logitech",sku:"LOG-KB-MEC",totalRevenue:48e5,totalQuantity:65,salesCount:65},{productId:"P004",productName:"Mouse InalÃ¡mbrico HP",sku:"HP-MOUSE-WL",totalRevenue:35e5,totalQuantity:120,salesCount:85},{productId:"P005",productName:"Webcam HD Logitech C920",sku:"LOG-CAM-920",totalRevenue:29e5,totalQuantity:42,salesCount:42},{productId:"P006",productName:"Auriculares Sony WH-1000XM4",sku:"SONY-AUR-XM4",totalRevenue:26e5,totalQuantity:18,salesCount:18},{productId:"P007",productName:"SSD Kingston 1TB",sku:"KING-SSD-1TB",totalRevenue:21e5,totalQuantity:38,salesCount:38},{productId:"P008",productName:"Impresora HP LaserJet Pro",sku:"HP-PRINT-LJ",totalRevenue:18e5,totalQuantity:8,salesCount:8},{productId:"P009",productName:"Router WiFi 6 TP-Link",sku:"TP-ROUTER-W6",totalRevenue:15e5,totalQuantity:24,salesCount:24},{productId:"P010",productName:"Cable HDMI 2.1 Premium",sku:"HDMI-21-PREM",totalRevenue:95e4,totalQuantity:95,salesCount:75}]}function gs({startDate:t,endDate:o}){const n=d.useMemo(()=>ps(),[]),c=n.length>0?n[0].totalRevenue:1;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ† Top 10 Productos mÃ¡s vendidos"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"Ranking por ingresos totales generados"})]}),e.jsx("div",{className:"space-y-3",children:n.map((r,a)=>{const l=r.totalRevenue/c*100;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4 hover:border-neutral-600 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-full bg-neutral-700 text-neutral-300 text-xs font-bold",children:a+1}),e.jsx("h3",{className:"text-neutral-100 font-medium",children:r.productName})]}),e.jsxs("p",{className:"text-xs text-neutral-400",children:["SKU: ",r.sku]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-neutral-100",children:hs(r.totalRevenue)}),e.jsxs("p",{className:"text-xs text-neutral-400",children:[r.totalQuantity.toLocaleString()," unidades"]})]})]}),e.jsx("div",{className:"relative w-full h-2 bg-neutral-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full transition-all",style:{width:`${l}%`}})}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-xs text-neutral-400",children:[r.salesCount," venta",r.salesCount>1?"s":""]}),e.jsxs("span",{className:"text-xs text-neutral-300",children:[l.toFixed(1),"%"]})]})]},r.productId)})})]})}const Te=["#22d3ee","#3b82f6","#8b5cf6","#ec4899","#f59e0b","#10b981"];function Je(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function bs(){return[{method:"Efectivo",total:125e5,count:145},{method:"Tarjeta de crÃ©dito",total:189e5,count:98},{method:"Tarjeta de dÃ©bito",total:152e5,count:112},{method:"Transferencia",total:83e5,count:42},{method:"Cheque",total:35e5,count:18},{method:"Otro",total:12e5,count:9}]}function js({startDate:t,endDate:o}){const n=d.useMemo(()=>bs(),[]),c=n.reduce((a,l)=>a+l.total,0),r=n.map(a=>({name:a.method,value:a.total,count:a.count}));return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ’³ AnÃ¡lisis de MÃ©todos de Pago"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"DistribuciÃ³n de ventas por forma de pago"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:e.jsx("div",{style:{height:280},role:"img","aria-label":"DistribuciÃ³n de mÃ©todos de pago",children:e.jsx(je,{width:"100%",height:"100%",children:e.jsxs(Ot,{children:[e.jsx(Bt,{data:r,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:2,dataKey:"value",label:({percent:a})=>`${(a*100).toFixed(1)}%`,labelLine:{stroke:"#a3a3a3",strokeWidth:1},children:r.map((a,l)=>e.jsx(it,{fill:Te[l%Te.length]},`cell-${l}`))}),e.jsx(fe,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:(a,l,m)=>[Je(a),`${m.payload.count} transacciones`]}),e.jsx(Be,{iconType:"circle",wrapperStyle:{color:"#a3a3a3",fontSize:"12px"}})]})})})}),e.jsx("div",{className:"space-y-3",children:n.map((a,l)=>{const m=a.total/c*100;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Te[l%Te.length]}}),e.jsx("h3",{className:"text-neutral-100 font-medium",children:a.method})]}),e.jsx("span",{className:"text-lg font-bold text-neutral-100",children:Je(a.total)})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"text-neutral-400",children:[a.count," transacciones"]}),e.jsxs("span",{className:"text-neutral-300",children:[m.toFixed(1),"%"]})]})]},a.method)})})]})]})}function fs(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function Ns(){return[{type:"Factura ElectrÃ³nica",count:185,total:425e5},{type:"Boleta ElectrÃ³nica",count:312,total:189e5},{type:"Nota de CrÃ©dito",count:28,total:32e5},{type:"Nota de DÃ©bito",count:15,total:15e5},{type:"GuÃ­a de Despacho",count:94,total:0}]}function vs({startDate:t,endDate:o}){const n=d.useMemo(()=>Ns(),[]),c=n.map(r=>({name:r.type,cantidad:r.count,monto:r.total/1e6}));return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ“‹ AnÃ¡lisis de Tipos de Documento"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"Desglose por tipo de documento tributario"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:e.jsx("div",{style:{height:300},role:"img","aria-label":"Cantidad de documentos por tipo",children:e.jsx(je,{width:"100%",height:"100%",children:e.jsxs(Ke,{data:c,layout:"vertical",margin:{top:10,right:10,left:120,bottom:10},children:[e.jsx(ve,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(ye,{type:"number",stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:12}}),e.jsx(Ce,{dataKey:"name",type:"category",stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:12},width:110}),e.jsx(fe,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:(r,a)=>a==="cantidad"?[r,"Cantidad"]:a==="monto"?[`${r.toFixed(1)}M`,"Monto (millones)"]:[r,a]}),e.jsx(ze,{dataKey:"cantidad",fill:"#22d3ee",radius:[0,4,4,0]})]})})})}),e.jsx("div",{className:"space-y-3",children:n.map(r=>e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-neutral-100 font-medium mb-2",children:r.type}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Cantidad"}),e.jsx("span",{className:"text-sm font-semibold text-neutral-100",children:r.count.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Monto total"}),e.jsx("span",{className:"text-sm font-semibold text-neutral-100",children:r.total>0?fs(r.total):"N/A"})]})]})]},r.type))})]})]})}function ys(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function Cs(){return{cancellationRate:4.2,avgTicket:125500,peakHour:"14:00 - 15:00",weeklyTrend:"up",totalSales:634,totalCancelled:27}}function ws({startDate:t,endDate:o}){const n=d.useMemo(()=>Cs(),[]);return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ“Š MÃ©tricas de Rendimiento"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"Indicadores clave de desempeÃ±o comercial"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸš«"}),e.jsx("h3",{className:"text-sm font-medium text-neutral-400",children:"Tasa de CancelaciÃ³n"})]}),e.jsxs("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:[n.cancellationRate.toFixed(1),"%"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-neutral-400",children:[n.totalCancelled," de ",n.totalSales," ventas"]}),n.cancellationRate<5?e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-green-950 text-green-400 border border-green-800",children:"ðŸŸ¢ Bajo"}):n.cancellationRate<10?e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-yellow-950 text-yellow-400 border border-yellow-800",children:"ðŸŸ¡ Medio"}):e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-red-950 text-red-400 border border-red-800",children:"ðŸ”´ Alto"})]})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŽ«"}),e.jsx("h3",{className:"text-sm font-medium text-neutral-400",children:"Ticket Promedio"})]}),e.jsx("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:ys(n.avgTicket)}),e.jsx("p",{className:"text-xs text-neutral-400",children:"Por transacciÃ³n emitida"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"â°"}),e.jsx("h3",{className:"text-sm font-medium text-neutral-400",children:"Horario Pico"})]}),e.jsx("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:n.peakHour.split(" - ")[0]}),e.jsx("p",{className:"text-xs text-neutral-400",children:"Mayor volumen de ventas"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“ˆ"}),e.jsx("h3",{className:"text-sm font-medium text-neutral-400",children:"Tendencia Semanal"})]}),e.jsx("div",{className:"flex items-center gap-2 mb-1",children:n.weeklyTrend==="up"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-3xl font-bold text-green-400",children:"â†—"}),e.jsx("span",{className:"text-lg font-semibold text-neutral-100",children:"Crecimiento"})]}):n.weeklyTrend==="down"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-3xl font-bold text-red-400",children:"â†˜"}),e.jsx("span",{className:"text-lg font-semibold text-neutral-100",children:"Descenso"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-3xl font-bold text-neutral-400",children:"â†’"}),e.jsx("span",{className:"text-lg font-semibold text-neutral-100",children:"Estable"})]})}),e.jsx("p",{className:"text-xs text-neutral-400",children:"Comparado con semana anterior"})]})]}),e.jsxs("div",{className:"mt-6 bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-100",children:"Progreso del perÃ­odo"}),e.jsxs("span",{className:"text-sm text-neutral-400",children:[n.totalSales," ventas totales"]})]}),e.jsx("div",{className:"relative w-full h-3 bg-neutral-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-green-500 to-cyan-500 rounded-full",style:{width:`${(n.totalSales-n.totalCancelled)/n.totalSales*100}%`}})}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-xs text-green-400",children:[n.totalSales-n.totalCancelled," emitidas (",((1-n.cancellationRate/100)*100).toFixed(1),"%)"]}),e.jsxs("span",{className:"text-xs text-red-400",children:[n.totalCancelled," canceladas (",n.cancellationRate.toFixed(1),"%)"]})]})]})]})}function Ze(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function Ss(t){return new Date(t).toLocaleDateString("es-CL",{day:"numeric",month:"short"})}function Ps(){return[{customerId:"C001",customerName:"Empresa TechSolutions SpA",totalRevenue:158e5,purchaseCount:42,avgTicket:376190,lastPurchaseDate:"2024-01-25"},{customerId:"C002",customerName:"Comercial Del Norte Ltda",totalRevenue:124e5,purchaseCount:38,avgTicket:326316,lastPurchaseDate:"2024-01-24"},{customerId:"C003",customerName:"Servicios Integrales SA",totalRevenue:98e5,purchaseCount:28,avgTicket:35e4,lastPurchaseDate:"2024-01-23"},{customerId:"C004",customerName:"Distribuidora Central",totalRevenue:85e5,purchaseCount:52,avgTicket:163462,lastPurchaseDate:"2024-01-25"},{customerId:"C005",customerName:"Constructora Horizonte",totalRevenue:72e5,purchaseCount:15,avgTicket:48e4,lastPurchaseDate:"2024-01-22"},{customerId:"C006",customerName:"Retail Express SpA",totalRevenue:69e5,purchaseCount:64,avgTicket:107813,lastPurchaseDate:"2024-01-25"},{customerId:"C007",customerName:"Alimentos Frescos SA",totalRevenue:58e5,purchaseCount:31,avgTicket:187097,lastPurchaseDate:"2024-01-21"},{customerId:"C008",customerName:"Transporte RÃ¡pido Ltda",totalRevenue:45e5,purchaseCount:22,avgTicket:204545,lastPurchaseDate:"2024-01-20"},{customerId:"C009",customerName:"Farmacia Salud Total",totalRevenue:38e5,purchaseCount:48,avgTicket:79167,lastPurchaseDate:"2024-01-25"},{customerId:"C010",customerName:"MueblerÃ­a El Roble",totalRevenue:32e5,purchaseCount:9,avgTicket:355556,lastPurchaseDate:"2024-01-19"}]}function Ds({startDate:t,endDate:o}){const n=d.useMemo(()=>Ps(),[]),c=n.length>0?n[0].totalRevenue:1;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ‘¥ Top 10 Clientes"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"Clientes con mayor volumen de compras"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-700",children:[e.jsx("th",{className:"text-left py-3 px-2 text-xs font-semibold text-neutral-400 uppercase",children:"#"}),e.jsx("th",{className:"text-left py-3 px-2 text-xs font-semibold text-neutral-400 uppercase",children:"Cliente"}),e.jsx("th",{className:"text-right py-3 px-2 text-xs font-semibold text-neutral-400 uppercase",children:"Ingresos"}),e.jsx("th",{className:"text-center py-3 px-2 text-xs font-semibold text-neutral-400 uppercase",children:"Compras"}),e.jsx("th",{className:"text-right py-3 px-2 text-xs font-semibold text-neutral-400 uppercase",children:"Ticket Prom."}),e.jsx("th",{className:"text-center py-3 px-2 text-xs font-semibold text-neutral-400 uppercase",children:"Ãšltima Compra"})]})}),e.jsx("tbody",{children:n.map((r,a)=>{const l=r.totalRevenue/c*100,m=new Date(r.lastPurchaseDate)>new Date(Date.now()-4320*60*1e3);return e.jsxs("tr",{className:"border-b border-neutral-800 hover:bg-neutral-800 transition-colors",children:[e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-neutral-700 text-neutral-300 text-xs font-bold",children:a+1}),a<3&&e.jsx("span",{className:"text-lg",children:a===0?"ðŸ¥‡":a===1?"ðŸ¥ˆ":"ðŸ¥‰"})]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-100 font-medium",children:r.customerName}),e.jsx("div",{className:"relative w-full h-1.5 bg-neutral-700 rounded-full overflow-hidden mt-1",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full",style:{width:`${l}%`}})})]})}),e.jsx("td",{className:"py-4 px-2 text-right",children:e.jsx("p",{className:"text-neutral-100 font-bold",children:Ze(r.totalRevenue)})}),e.jsx("td",{className:"py-4 px-2 text-center",children:e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-neutral-800 text-neutral-300 border border-neutral-700",children:r.purchaseCount})}),e.jsx("td",{className:"py-4 px-2 text-right",children:e.jsx("p",{className:"text-neutral-300",children:Ze(r.avgTicket)})}),e.jsx("td",{className:"py-4 px-2 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${m?"bg-green-950 text-green-400 border border-green-800":"bg-neutral-800 text-neutral-400 border border-neutral-700"}`,children:[m&&"ðŸŸ¢ ",Ss(r.lastPurchaseDate)]})})]},r.customerId)})})]})})]})}function Re(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function ks(){return[{hour:"09:00",sales:85e4,count:8},{hour:"10:00",sales:12e5,count:12},{hour:"11:00",sales:185e4,count:18},{hour:"12:00",sales:24e5,count:22},{hour:"13:00",sales:15e5,count:14},{hour:"14:00",sales:32e5,count:28},{hour:"15:00",sales:29e5,count:26},{hour:"16:00",sales:21e5,count:19},{hour:"17:00",sales:17e5,count:16},{hour:"18:00",sales:12e5,count:11},{hour:"19:00",sales:9e5,count:8}]}function Ts({date:t}){const o=d.useMemo(()=>ks(),[]),n=o.reduce((l,m)=>l+m.sales,0),c=o.reduce((l,m)=>l+m.count,0),r=o.reduce((l,m)=>m.sales>l.sales?m:l,o[0]),a=o.map(l=>({hora:l.hour,ventas:l.sales/1e6,cantidad:l.count}));return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"â° Timeline Diario de Ventas"}),e.jsxs("p",{className:"text-sm text-neutral-400",children:["PatrÃ³n de ventas por hora | Total: ",Re(n)," (",c," ventas)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Hora Pico"}),e.jsx("p",{className:"text-2xl font-bold text-neutral-100",children:r.hour}),e.jsxs("p",{className:"text-xs text-neutral-400 mt-1",children:[Re(r.sales)," en ",r.count," ventas"]})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Promedio por Hora"}),e.jsx("p",{className:"text-2xl font-bold text-neutral-100",children:Re(n/o.length)}),e.jsxs("p",{className:"text-xs text-neutral-400 mt-1",children:[(c/o.length).toFixed(1)," ventas/hora"]})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Ticket Promedio"}),e.jsx("p",{className:"text-2xl font-bold text-neutral-100",children:Re(n/c)}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:"Por transacciÃ³n"})]})]}),e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:e.jsx("div",{style:{height:320},role:"img","aria-label":"Ventas por hora del dÃ­a",children:e.jsx(je,{width:"100%",height:"100%",children:e.jsxs(Ke,{data:a,margin:{top:10,right:10,left:10,bottom:10},children:[e.jsx(ve,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(ye,{dataKey:"hora",stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:12}}),e.jsx(Ce,{stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:12}}),e.jsx(fe,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:(l,m)=>m==="ventas"?[`${l.toFixed(2)}M`,"Ventas (millones)"]:m==="cantidad"?[l,"Cantidad"]:[l,m]}),e.jsx(ze,{dataKey:"ventas",fill:"#22d3ee",radius:[4,4,0,0]})]})})})}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium bg-green-950 text-green-400 border border-green-800",children:"ðŸŸ¢ Horario pico: 14:00-15:00"}),e.jsx("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium bg-yellow-950 text-yellow-400 border border-yellow-800",children:"ðŸŸ¡ Horario medio: 11:00-12:00, 16:00-17:00"}),e.jsx("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium bg-neutral-800 text-neutral-400 border border-neutral-700",children:"âšª Horario bajo: 09:00-10:00, 19:00"})]})]})}function et(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function Rs(t){const o=[],n=[{date:pe(-7),actual:28e5},{date:pe(-6),actual:32e5},{date:pe(-5),actual:29e5},{date:pe(-4),actual:35e5},{date:pe(-3),actual:31e5},{date:pe(-2),actual:38e5},{date:pe(-1),actual:34e5}],c=n.reduce((a,l)=>a+l.actual,0)/n.length,r=(n[n.length-1].actual-n[0].actual)/n.length;n.forEach(a=>{o.push({date:a.date,actual:a.actual,predicted:a.actual,confidence:"high"})});for(let a=0;a<t;a++){const l=c+r*(n.length+a)+(Math.random()*2e5-1e5),m=a<3?"high":a<7?"medium":"low";o.push({date:pe(a),predicted:Math.max(0,l),confidence:m})}return o}function pe(t){const o=new Date;return o.setDate(o.getDate()+t),o.toLocaleDateString("es-CL",{day:"2-digit",month:"short"})}function Fs({days:t=7}){const o=d.useMemo(()=>Rs(t),[t]),n=o.filter(u=>u.actual!==void 0),c=o.filter(u=>u.actual===void 0),r=c.reduce((u,f)=>u+f.predicted,0),a=r/c.length,l=n.reduce((u,f)=>u+(f.actual||0),0)/n.length,m=(a-l)/l*100,N=o.map(u=>({fecha:u.date,real:u.actual?u.actual/1e6:null,proyeccion:u.predicted/1e6}));return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ”® PronÃ³stico de Ventas"}),e.jsxs("p",{className:"text-sm text-neutral-400",children:["ProyecciÃ³n prÃ³ximos ",t," dÃ­as basada en tendencia histÃ³rica"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Ventas Proyectadas"}),e.jsx("p",{className:"text-2xl font-bold text-neutral-100",children:et(r)}),e.jsxs("p",{className:"text-xs text-neutral-400 mt-1",children:["PrÃ³ximos ",t," dÃ­as"]})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Promedio Diario"}),e.jsx("p",{className:"text-2xl font-bold text-neutral-100",children:et(a)}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:"Estimado futuro"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Crecimiento Esperado"}),e.jsxs("p",{className:`text-2xl font-bold ${m>=0?"text-green-400":"text-red-400"}`,children:[m>=0?"+":"",m.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:"vs promedio histÃ³rico"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Confianza"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[c.filter(u=>u.confidence==="high").length>0&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-green-950 text-green-400 border border-green-800",children:"ðŸŸ¢ Alta"}),c.filter(u=>u.confidence==="medium").length>0&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-yellow-950 text-yellow-400 border border-yellow-800",children:"ðŸŸ¡ Media"}),c.filter(u=>u.confidence==="low").length>0&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-red-950 text-red-400 border border-red-800",children:"ðŸ”´ Baja"})]})]})]}),e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:e.jsx("div",{style:{height:320},role:"img","aria-label":"GrÃ¡fico de pronÃ³stico de ventas",children:e.jsx(je,{width:"100%",height:"100%",children:e.jsxs(ut,{data:N,margin:{top:10,right:10,left:10,bottom:10},children:[e.jsx(ve,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(ye,{dataKey:"fecha",stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:11}}),e.jsx(Ce,{stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:12}}),e.jsx(fe,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:(u,f)=>f==="real"?[`${u.toFixed(2)}M`,"Ventas reales"]:f==="proyeccion"?[`${u.toFixed(2)}M`,"ProyecciÃ³n"]:[u,f]}),e.jsx(dt,{x:n[n.length-1]?.date,stroke:"#fb923c",strokeDasharray:"5 5",strokeWidth:2}),e.jsx(_e,{type:"monotone",dataKey:"real",stroke:"#22d3ee",strokeWidth:3,dot:{r:5,fill:"#0891b2",stroke:"#22d3ee",strokeWidth:2},connectNulls:!1}),e.jsx(_e,{type:"monotone",dataKey:"proyeccion",stroke:"#a78bfa",strokeWidth:2,strokeDasharray:"5 5",dot:{r:4,fill:"#7c3aed",stroke:"#a78bfa",strokeWidth:2}})]})})})}),e.jsx("div",{className:"mt-4 bg-blue-950 border border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-lg",children:"â„¹ï¸"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-blue-400 mb-1",children:"Acerca del pronÃ³stico"}),e.jsxs("ul",{className:"text-xs text-blue-300 space-y-1",children:[e.jsx("li",{children:"â€¢ Basado en promedio mÃ³vil de Ãºltimos 7 dÃ­as y tendencia detectada"}),e.jsx("li",{children:"â€¢ La confianza disminuye con dÃ­as mÃ¡s lejanos (alta: 1-3 dÃ­as, media: 4-7 dÃ­as, baja: 8+ dÃ­as)"}),e.jsx("li",{children:"â€¢ Factores externos (promociones, temporadas, eventos) pueden afectar la precisiÃ³n"})]})]})]})})]})}function Es({isOpen:t,onClose:o,filters:n,totalRecords:c}){const[r,a]=d.useState("csv"),[l,m]=d.useState("filtered"),[N,u]=d.useState(!0),f=me({mutationFn:async()=>{const h=l==="all"?{}:{status:n.status||void 0,docType:n.docType||void 0,paymentMethod:n.paymentMethod||void 0,search:n.search||void 0};if(r==="csv"){const v=await lt(h);g(v,`ventas-${new Date().toISOString().split("T")[0]}.csv`)}else{const v={metadata:N?{exportDate:new Date().toISOString(),filters:n,totalRecords:c,scope:l}:void 0,summary:{totalRecords:c,appliedFilters:Object.keys(n).filter(S=>n[S])},data:[]},T=new Blob([JSON.stringify(v,null,2)],{type:"application/json"});g(T,`ventas-${new Date().toISOString().split("T")[0]}.json`)}},onSuccess:()=>{o()}});function g(h,v){const T=URL.createObjectURL(h),S=document.createElement("a");S.href=T,S.download=v,S.rel="noopener",document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(T)}if(!t)return null;const p=Object.entries(n).filter(([h,v])=>v&&v!=="").map(([h,v])=>({key:h,value:v}));return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-2xl p-6 max-w-lg w-full mx-4",children:[e.jsxs("header",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-neutral-100 mb-2",children:"ðŸ“¥ Exportar Ventas"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"Configura las opciones de exportaciÃ³n para tus documentos de ventas"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-100 mb-3",children:"Formato de archivo"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>a("csv"),className:`p-4 rounded-lg border-2 transition-all ${r==="csv"?"border-cyan-500 bg-cyan-950 text-cyan-400":"border-neutral-700 bg-neutral-800 text-neutral-400 hover:border-neutral-600"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ“Š"}),e.jsx("div",{className:"font-semibold",children:"CSV"}),e.jsx("div",{className:"text-xs mt-1",children:"Excel compatible"})]}),e.jsxs("button",{type:"button",onClick:()=>a("json"),className:`p-4 rounded-lg border-2 transition-all ${r==="json"?"border-purple-500 bg-purple-950 text-purple-400":"border-neutral-700 bg-neutral-800 text-neutral-400 hover:border-neutral-600"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ”§"}),e.jsx("div",{className:"font-semibold",children:"JSON"}),e.jsx("div",{className:"text-xs mt-1",children:"Desarrollo/API"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-100 mb-3",children:"Datos a exportar"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{type:"button",onClick:()=>m("filtered"),className:`w-full p-3 rounded-lg border text-left transition-all ${l==="filtered"?"border-cyan-500 bg-cyan-950 text-cyan-100":"border-neutral-700 bg-neutral-800 text-neutral-300 hover:border-neutral-600"}`,children:[e.jsxs("div",{className:"font-medium",children:["Resultados filtrados (",c,")"]}),e.jsx("div",{className:"text-xs mt-1 opacity-75",children:"Exportar solo los registros con filtros aplicados"})]}),e.jsxs("button",{type:"button",onClick:()=>m("all"),className:`w-full p-3 rounded-lg border text-left transition-all ${l==="all"?"border-cyan-500 bg-cyan-950 text-cyan-100":"border-neutral-700 bg-neutral-800 text-neutral-300 hover:border-neutral-600"}`,children:[e.jsx("div",{className:"font-medium",children:"Todas las ventas"}),e.jsx("div",{className:"text-xs mt-1 opacity-75",children:"Exportar todos los registros sin filtros"})]})]})]}),r==="json"&&e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg bg-neutral-800 border border-neutral-700 cursor-pointer hover:border-neutral-600 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:h=>u(h.target.checked),className:"w-4 h-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-100",children:"Incluir metadatos"}),e.jsx("div",{className:"text-xs text-neutral-400 mt-0.5",children:"Fecha, filtros aplicados, estadÃ­sticas"})]})]})}),p.length>0&&l==="filtered"&&e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-100 mb-2",children:"Filtros aplicados:"}),e.jsx("div",{className:"space-y-1",children:p.map(({key:h,value:v})=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-neutral-700 text-neutral-300 font-medium",children:h}),e.jsx("span",{className:"text-neutral-400",children:"="}),e.jsx("span",{className:"text-neutral-100",children:v})]},h))})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-6 border-t border-neutral-800",children:[e.jsx("button",{type:"button",onClick:o,disabled:f.isPending,className:"flex-1 px-4 py-2.5 rounded-lg bg-neutral-800 border border-neutral-700 text-neutral-100 hover:bg-neutral-700 transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:()=>f.mutate(),disabled:f.isPending,className:"flex-1 px-4 py-2.5 rounded-lg bg-cyan-600 text-white font-medium hover:bg-cyan-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:f.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"â³"}),"Exportando..."]}):e.jsxs(e.Fragment,{children:["ðŸ“¥ Exportar ",r.toUpperCase()]})})]})]})})}function _s(){const{data:t,isLoading:o,error:n}=K({queryKey:["salesKPIs"],queryFn:()=>St(),refetchInterval:3e5});if(o)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 animate-pulse",children:[1,2,3,4,5,6,7,8].map(m=>e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 h-32"},m))});if(n)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar KPIs de ventas"})});if(!t)return null;const c=m=>`$${m.toLocaleString("es-CL",{maximumFractionDigits:0})}`,r=m=>`${m.toFixed(1)}%`,a=m=>m>0?"text-green-400":m<0?"text-red-400":"text-neutral-400",l=m=>m>0?"â†—ï¸":m<0?"â†˜ï¸":"â†’";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"ðŸ“Š KPIs Avanzados de Ventas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-900/30 to-blue-800/20 border border-blue-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-blue-400 mb-1",children:"Ingresos Totales"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:c(t.totalRevenue)}),e.jsxs("div",{className:"text-xs text-blue-300 mt-2",children:[t.totalOrders," Ã³rdenes emitidas"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-900/30 to-green-800/20 border border-green-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-green-400 mb-1",children:"Utilidad Bruta"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:c(t.grossProfit)}),e.jsxs("div",{className:"text-xs text-green-300 mt-2",children:["Margen: ",r(t.profitMargin)]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-900/30 to-purple-800/20 border border-purple-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-purple-400 mb-1",children:"Ticket Promedio"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:c(t.averageTicket)}),e.jsx("div",{className:"text-xs text-purple-300 mt-2",children:"Por orden emitida"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-900/30 to-orange-800/20 border border-orange-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-orange-400 mb-1",children:"Crecimiento"}),e.jsxs("div",{className:`text-3xl font-bold ${a(t.salesGrowth)}`,children:[l(t.salesGrowth)," ",r(Math.abs(t.salesGrowth))]}),e.jsx("div",{className:"text-xs text-orange-300 mt-2",children:"vs perÃ­odo anterior"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Clientes Ãšnicos"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:t.uniqueCustomers}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:["RetenciÃ³n: ",r(t.customerRetentionRate)]})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Tasa de ConversiÃ³n"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:r(t.conversionRate)}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Emitidas vs total"})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Top Producto"}),e.jsx("div",{className:"text-lg font-semibold text-white truncate",title:t.topProductName,children:t.topProductName}),e.jsx("div",{className:"text-sm text-green-400 mt-1",children:c(t.topProductRevenue)})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Top Cliente"}),e.jsx("div",{className:"text-lg font-semibold text-white truncate",title:t.topCustomerName,children:t.topCustomerName}),e.jsx("div",{className:"text-sm text-blue-400 mt-1",children:c(t.topCustomerRevenue)})]})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Desglose de Ingresos"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-400",children:"Ingresos Totales"}),e.jsx("span",{className:"text-white font-semibold",children:c(t.totalRevenue)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-500 h-3 rounded-full",style:{width:"100%"}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-400",children:"Costo Estimado"}),e.jsx("span",{className:"text-red-400 font-semibold",children:c(t.totalCost)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-red-500 h-3 rounded-full",style:{width:`${t.totalCost/t.totalRevenue*100}%`}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-400",children:"Utilidad Bruta"}),e.jsx("span",{className:"text-green-400 font-bold text-lg",children:c(t.grossProfit)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-green-500 h-3 rounded-full",style:{width:`${t.profitMargin}%`}})})]})]}),e.jsx("div",{className:"bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-blue-400",children:["ðŸ“… PerÃ­odo de anÃ¡lisis: ",new Date(t.periodStart).toLocaleDateString("es-CL")," -"," ",new Date(t.periodEnd).toLocaleDateString("es-CL")]}),e.jsx("span",{className:"text-xs text-blue-300",children:"Actualizado automÃ¡ticamente cada 5 minutos"})]})})]})}function Ls(){const{data:t=[],isLoading:o}=K({queryKey:["salesABCAnalysis"],queryFn:()=>Me(),refetchInterval:3e5});if(o)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-neutral-800 rounded"})]})});const n=t.filter(g=>g.classification==="A"),c=t.filter(g=>g.classification==="B"),r=t.filter(g=>g.classification==="C"),a=t.reduce((g,p)=>g+p.totalRevenue,0),l=n.reduce((g,p)=>g+p.totalRevenue,0),m=c.reduce((g,p)=>g+p.totalRevenue,0),N=r.reduce((g,p)=>g+p.totalRevenue,0),u=[{class:"Clase A",count:n.length,revenue:l,percentage:a>0?l/a*100:0},{class:"Clase B",count:c.length,revenue:m,percentage:a>0?m/a*100:0},{class:"Clase C",count:r.length,revenue:N,percentage:a>0?N/a*100:0}],f={"Clase A":"#ef4444","Clase B":"#f59e0b","Clase C":"#10b981"};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"DistribuciÃ³n ABC de Productos"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-red-950 border border-red-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-red-200",children:"Clase A - Productos Estrella"}),e.jsxs("span",{className:"text-xs bg-red-900 text-red-200 px-2 py-1 rounded",children:[n.length," productos"]})]}),e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:["$",l.toLocaleString("es-CL")]}),e.jsxs("div",{className:"text-sm text-red-300",children:[a>0?(l/a*100).toFixed(1):0,"% de ingresos"]})]}),e.jsxs("div",{className:"bg-amber-950 border border-amber-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-amber-200",children:"Clase B - Productos Importantes"}),e.jsxs("span",{className:"text-xs bg-amber-900 text-amber-200 px-2 py-1 rounded",children:[c.length," productos"]})]}),e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:["$",m.toLocaleString("es-CL")]}),e.jsxs("div",{className:"text-sm text-amber-300",children:[a>0?(m/a*100).toFixed(1):0,"% de ingresos"]})]}),e.jsxs("div",{className:"bg-emerald-950 border border-emerald-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-emerald-200",children:"Clase C - Productos Ocasionales"}),e.jsxs("span",{className:"text-xs bg-emerald-900 text-emerald-200 px-2 py-1 rounded",children:[r.length," productos"]})]}),e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:["$",N.toLocaleString("es-CL")]}),e.jsxs("div",{className:"text-sm text-emerald-300",children:[a>0?(N/a*100).toFixed(1):0,"% de ingresos"]})]})]}),e.jsx(je,{width:"100%",height:300,children:e.jsxs(Ke,{data:u,children:[e.jsx(ve,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(ye,{dataKey:"class",stroke:"#9ca3af"}),e.jsx(Ce,{stroke:"#9ca3af"}),e.jsx(fe,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"0.375rem",color:"#fff"},formatter:(g,p)=>p==="revenue"?[`$${g.toLocaleString("es-CL")}`,"Ingresos"]:p==="percentage"?[`${g.toFixed(1)}%`,"% del Total"]:[g,p]}),e.jsx(Be,{}),e.jsx(ze,{dataKey:"revenue",name:"Ingresos",radius:[4,4,0,0],children:u.map((g,p)=>e.jsx(it,{fill:f[g.class]},`cell-${p}`))})]})}),e.jsxs("div",{className:"mt-6 bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"ðŸ“Š Principio de Pareto (80-15-5)"}),e.jsxs("p",{className:"text-xs text-neutral-300 leading-relaxed",children:["El anÃ¡lisis ABC clasifica productos segÃºn su contribuciÃ³n a los ingresos."," ",e.jsx("strong",{className:"text-white",children:"Clase A"})," (â‰¤80% acumulado) representa los productos estrella que generan la mayor parte de los ingresos."," ",e.jsx("strong",{className:"text-white",children:"Clase B"})," (80-95% acumulado) son productos importantes con potencial de crecimiento. ",e.jsx("strong",{className:"text-white",children:"Clase C"})," ","(>95%) son productos ocasionales que aportan poco, candidatos para evaluaciÃ³n o descontinuaciÃ³n."]})]})]})}function As(){const{data:t=[],isLoading:o}=K({queryKey:["salesABCAnalysis"],queryFn:()=>Me(),refetchInterval:3e5}),n=d.useMemo(()=>[...t].sort((r,a)=>a.totalRevenue-r.totalRevenue),[t]);if(o)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((r,a)=>e.jsx("div",{className:"h-12 bg-neutral-800 rounded"},a))})]})});const c={A:{bg:"bg-red-950",border:"border-red-900",text:"text-red-200"},B:{bg:"bg-amber-950",border:"border-amber-900",text:"text-amber-200"},C:{bg:"bg-emerald-950",border:"border-emerald-900",text:"text-emerald-200"}};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"ClasificaciÃ³n Detallada de Productos"}),e.jsxs("span",{className:"text-sm text-neutral-400",children:[n.length," productos"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-3 px-2 text-neutral-400 font-medium",children:"Clase"}),e.jsx("th",{className:"text-left py-3 px-2 text-neutral-400 font-medium",children:"Producto"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"Ingresos"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"Ventas"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"% Total"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"% Acum."}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"Precio Prom."}),e.jsx("th",{className:"text-left py-3 px-2 text-neutral-400 font-medium",children:"AcciÃ³n Recomendada"})]})}),e.jsx("tbody",{children:n.map((r,a)=>{const l=c[r.classification]||c.C,m=a<10;return e.jsxs("tr",{className:`border-b border-neutral-800 hover:bg-neutral-800/50 transition-colors ${m?"bg-neutral-800/30":""}`,children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold ${l.bg} ${l.border} ${l.text}`,children:r.classification})}),e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-white font-medium",children:r.productName}),e.jsxs("span",{className:"text-xs text-neutral-400",children:["ID: ",r.productId]})]})}),e.jsxs("td",{className:"py-3 px-2 text-right text-white font-medium",children:["$",r.totalRevenue.toLocaleString("es-CL")]}),e.jsx("td",{className:"py-3 px-2 text-right text-neutral-300",children:r.salesCount}),e.jsxs("td",{className:"py-3 px-2 text-right text-neutral-300",children:[r.percentageOfTotal.toFixed(2),"%"]}),e.jsxs("td",{className:"py-3 px-2 text-right text-neutral-300",children:[r.cumulativePercentage.toFixed(2),"%"]}),e.jsxs("td",{className:"py-3 px-2 text-right text-neutral-300",children:["$",r.averagePrice.toLocaleString("es-CL")]}),e.jsx("td",{className:"py-3 px-2 text-neutral-400 text-xs max-w-xs truncate",children:r.recommendedAction})]},r.productId)})})]})}),n.length===0&&e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"No hay datos de clasificaciÃ³n ABC disponibles"}),n.length>0&&e.jsxs("div",{className:"mt-4 text-xs text-neutral-500 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-neutral-800/30 rounded"}),e.jsx("span",{children:"Top 10 productos destacados"})]})]})}function Is(){const{data:t=[],isLoading:o}=K({queryKey:["salesABCAnalysis"],queryFn:()=>Me(),refetchInterval:3e5});if(o)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3"}),e.jsx("div",{className:"h-32 bg-neutral-800 rounded"}),e.jsx("div",{className:"h-32 bg-neutral-800 rounded"})]})});const n=t.filter(g=>g.classification==="A"),c=t.filter(g=>g.classification==="B"),r=t.filter(g=>g.classification==="C"),a=t.reduce((g,p)=>g+p.totalRevenue,0),l=n.reduce((g,p)=>g+p.totalRevenue,0),m=c.reduce((g,p)=>g+p.totalRevenue,0),N=r.reduce((g,p)=>g+p.totalRevenue,0),u=a>0?l/a*100:0,f=r.length;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"Recomendaciones EstratÃ©gicas por Clase"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-red-950 border border-red-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"â­"}),e.jsxs("h4",{className:"text-base font-semibold text-red-100",children:["Clase A - Productos Estrella (",n.length," productos)"]})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-red-200",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Stock prioritario:"})," Mantener niveles de inventario elevados para evitar quiebres de stock"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"PromociÃ³n activa:"})," Destacar en campaÃ±as de marketing, vitrinas y canales digitales"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"AnÃ¡lisis de precio:"})," Optimizar mÃ¡rgenes sin sacrificar volumen de ventas"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"RelaciÃ³n con proveedores:"})," Negociar condiciones preferenciales y continuidad de suministro"]})]})]})]}),e.jsxs("div",{className:"bg-amber-950 border border-amber-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“ˆ"}),e.jsxs("h4",{className:"text-base font-semibold text-amber-100",children:["Clase B - Productos Importantes (",c.length," productos)"]})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-amber-200",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Potencial de crecimiento:"})," Evaluar estrategias para promover a Clase A mediante promociones dirigidas"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"RevisiÃ³n de pricing:"})," Ajustar precios para mejorar competitividad sin afectar mÃ¡rgenes"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"OptimizaciÃ³n de inventario:"})," Mantener stock equilibrado basado en demanda histÃ³rica"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Cross-selling:"})," Bundling con productos Clase A para aumentar ticket promedio"]})]})]})]}),e.jsxs("div",{className:"bg-emerald-950 border border-emerald-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ”"}),e.jsxs("h4",{className:"text-base font-semibold text-emerald-100",children:["Clase C - Productos Ocasionales (",r.length," productos)"]})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-emerald-200",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"EvaluaciÃ³n de continuidad:"})," Considerar descontinuar productos con baja rotaciÃ³n y bajo margen"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"ReducciÃ³n de stock:"})," Minimizar inventario para liberar capital de trabajo"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Promociones liquidaciÃ³n:"})," Lanzar ofertas especiales para rotar inventario estancado"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Reemplazo estratÃ©gico:"})," Identificar alternativas con mejor potencial de ventas"]})]})]})]})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"ðŸ’¡ AnÃ¡lisis Global"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"ConcentraciÃ³n en Clase A"}),e.jsxs("span",{className:"text-sm font-semibold text-white",children:[u.toFixed(1),"%"]})]}),u>85&&e.jsx("p",{className:"text-xs text-red-300",children:"âš ï¸ Alta concentraciÃ³n de ingresos en pocos productos. Considerar diversificar portafolio."}),u>=70&&u<=85&&e.jsx("p",{className:"text-xs text-amber-300",children:"â„¹ï¸ ConcentraciÃ³n balanceada. Monitorear continuidad de productos Clase A."}),u<70&&e.jsx("p",{className:"text-xs text-emerald-300",children:"âœ“ Portafolio diversificado. Evaluar oportunidades de consolidaciÃ³n."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Productos con bajo impacto (Clase C)"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:f})]}),f>20&&e.jsxs("p",{className:"text-xs text-emerald-300",children:["ðŸ’¡ Oportunidad: Revisar ",f," productos para optimizar recursos y simplificar catÃ¡logo."]}),f>=10&&f<=20&&e.jsx("p",{className:"text-xs text-neutral-300",children:"â„¹ï¸ Portafolio manejable. Evaluar periÃ³dicamente productos de baja rotaciÃ³n."}),f<10&&e.jsx("p",{className:"text-xs text-neutral-300",children:"âœ“ CatÃ¡logo optimizado con pocos productos de baja rotaciÃ³n."})]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"Total Productos"}),e.jsx("div",{className:"text-xl font-bold text-white",children:t.length})]}),e.jsxs("div",{className:"bg-red-950 border border-red-900 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-red-300 mb-1",children:"Clase A"}),e.jsxs("div",{className:"text-xl font-bold text-white",children:[n.length," (",a>0?(l/a*100).toFixed(0):0,"%)"]})]}),e.jsxs("div",{className:"bg-amber-950 border border-amber-900 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-amber-300 mb-1",children:"Clase B"}),e.jsxs("div",{className:"text-xl font-bold text-white",children:[c.length," (",a>0?(m/a*100).toFixed(0):0,"%)"]})]}),e.jsxs("div",{className:"bg-emerald-950 border border-emerald-900 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-emerald-300 mb-1",children:"Clase C"}),e.jsxs("div",{className:"text-xl font-bold text-white",children:[r.length," (",a>0?(N/a*100).toFixed(0):0,"%)"]})]})]})]})}function Ms(){const{data:t=[],isLoading:o}=K({queryKey:["salesProductForecast"],queryFn:()=>$e(),refetchInterval:3e5});if(o)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-neutral-800 rounded"})]})});const n=t.slice(0,5),c=n.map(l=>({name:l.productName,historical:l.historicalAverage,forecasted:l.forecastedDemand})),r=l=>l==="increasing"?"ðŸ“ˆ":l==="decreasing"?"ðŸ“‰":"âž¡ï¸",a=l=>l==="increasing"?"text-red-400":l==="decreasing"?"text-green-400":"text-neutral-400";return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"PronÃ³stico de Demanda - Top 5 Productos"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:n.map((l,m)=>{const N=l.historicalAverage>0?(l.forecastedDemand-l.historicalAverage)/l.historicalAverage*100:0;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs text-neutral-400",children:["#",m+1]}),e.jsx("span",{className:`text-lg ${a(l.trend)}`,children:r(l.trend)})]}),e.jsx("div",{className:"text-sm font-medium text-white mb-1 truncate",children:l.productName}),e.jsxs("div",{className:"text-xs text-neutral-400 mb-1",children:["PronÃ³stico:"," ",e.jsxs("span",{className:"text-white font-semibold",children:[l.forecastedDemand.toFixed(0)," u/mes"]})]}),e.jsxs("div",{className:"text-xs text-neutral-400",children:["HistÃ³rico: ",l.historicalAverage.toFixed(0)," u/mes"]}),e.jsxs("div",{className:`text-xs font-semibold mt-1 ${N>0?"text-red-400":N<0?"text-green-400":"text-neutral-400"}`,children:[N>0?"+":"",N.toFixed(1),"%"]}),e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("span",{className:"text-neutral-500",children:"Confianza: "}),e.jsxs("span",{className:`font-semibold ${l.confidence>=70?"text-green-400":l.confidence>=50?"text-amber-400":"text-red-400"}`,children:[l.confidence.toFixed(0),"%"]})]})]},l.productId)})}),e.jsx(je,{width:"100%",height:300,children:e.jsxs(ut,{data:c,children:[e.jsx(ve,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(ye,{dataKey:"name",stroke:"#9ca3af",angle:-15,textAnchor:"end",height:80}),e.jsx(Ce,{stroke:"#9ca3af"}),e.jsx(fe,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"0.375rem",color:"#fff"},formatter:l=>[l.toFixed(2)+" u/mes",""]}),e.jsx(Be,{}),e.jsx(_e,{type:"monotone",dataKey:"historical",name:"Demanda HistÃ³rica",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4}}),e.jsx(_e,{type:"monotone",dataKey:"forecasted",name:"Demanda Pronosticada",stroke:"#f59e0b",strokeWidth:2,strokeDasharray:"5 5",dot:{fill:"#f59e0b",r:4}})]})}),t.length===0&&e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"No hay datos de pronÃ³stico disponibles"})]})}function $s(){const{data:t=[],isLoading:o}=K({queryKey:["salesProductForecast"],queryFn:()=>$e(),refetchInterval:3e5});if(o)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((r,a)=>e.jsx("div",{className:"h-12 bg-neutral-800 rounded"},a))})]})});const n=r=>r==="increasing"?e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold bg-red-950 border-red-900 text-red-200",children:"â†— Creciente"}):r==="decreasing"?e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold bg-green-950 border-green-900 text-green-200",children:"â†˜ Decreciente"}):e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold bg-neutral-800 border-neutral-700 text-neutral-300",children:"â†’ Estable"}),c=r=>r>=70?e.jsxs("span",{className:"text-green-400 font-semibold",children:[r.toFixed(0),"%"]}):r>=50?e.jsxs("span",{className:"text-amber-400 font-semibold",children:[r.toFixed(0),"%"]}):e.jsxs("span",{className:"text-red-400 font-semibold",children:[r.toFixed(0),"%"]});return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"PronÃ³stico Detallado de Productos"}),e.jsxs("span",{className:"text-sm text-neutral-400",children:[t.length," productos"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-3 px-2 text-neutral-400 font-medium",children:"Producto"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"HistÃ³rico"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"PronÃ³stico"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"VariaciÃ³n"}),e.jsx("th",{className:"text-center py-3 px-2 text-neutral-400 font-medium",children:"Tendencia"}),e.jsx("th",{className:"text-center py-3 px-2 text-neutral-400 font-medium",children:"Confianza"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"Stock Rec."}),e.jsx("th",{className:"text-left py-3 px-2 text-neutral-400 font-medium",children:"PrÃ³xima Venta"})]})}),e.jsx("tbody",{children:t.map((r,a)=>{const l=r.historicalAverage>0?(r.forecastedDemand-r.historicalAverage)/r.historicalAverage*100:0,m=a<10;return e.jsxs("tr",{className:`border-b border-neutral-800 hover:bg-neutral-800/50 transition-colors ${m?"bg-neutral-800/30":""}`,children:[e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-white font-medium",children:r.productName}),e.jsxs("span",{className:"text-xs text-neutral-400",children:["ID: ",r.productId]})]})}),e.jsxs("td",{className:"py-3 px-2 text-right text-neutral-300",children:[r.historicalAverage.toFixed(1)," u/mes"]}),e.jsxs("td",{className:"py-3 px-2 text-right text-white font-medium",children:[r.forecastedDemand.toFixed(1)," u/mes"]}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("span",{className:`font-semibold ${l>10?"text-red-400":l<-10?"text-green-400":"text-neutral-400"}`,children:[l>0?"+":"",l.toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-2 text-center",children:n(r.trend)}),e.jsx("td",{className:"py-3 px-2 text-center",children:c(r.confidence)}),e.jsxs("td",{className:"py-3 px-2 text-right text-neutral-300",children:[r.recommendedStock.toFixed(0)," u"]}),e.jsx("td",{className:"py-3 px-2 text-neutral-400 text-xs",children:r.nextSaleDate?new Date(r.nextSaleDate).toLocaleDateString("es-CL"):"N/A"})]},r.productId)})})]})}),t.length===0&&e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"No hay datos de pronÃ³stico disponibles"}),t.length>0&&e.jsxs("div",{className:"mt-4 text-xs text-neutral-500 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-neutral-800/30 rounded"}),e.jsx("span",{children:"Top 10 productos destacados"})]})]})}function qs(){const{data:t=[],isLoading:o}=K({queryKey:["salesProductForecast"],queryFn:()=>$e(),refetchInterval:3e5});if(o)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3"}),e.jsx("div",{className:"h-32 bg-neutral-800 rounded"}),e.jsx("div",{className:"h-32 bg-neutral-800 rounded"})]})});const n=t.filter(u=>u.trend==="increasing"),c=t.filter(u=>u.trend==="decreasing"),r=t.filter(u=>u.confidence<60),a=t.filter(u=>{const f=t.reduce((g,p)=>g+p.forecastedDemand,0)/t.length;return u.forecastedDemand>f*2}),l=t.reduce((u,f)=>u+f.historicalAverage,0),m=t.reduce((u,f)=>u+f.forecastedDemand,0),N=l>0?(m-l)/l*100:0;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"Insights y Alertas de PronÃ³stico"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[n.length>0&&e.jsxs("div",{className:"bg-red-950 border border-red-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“ˆ"}),e.jsxs("h4",{className:"text-base font-semibold text-red-100",children:["Demanda Creciente (",n.length," productos)"]})]}),e.jsx("p",{className:"text-sm text-red-200 mb-3",children:"Los siguientes productos muestran tendencia de aumento en la demanda. Considere incrementar stock para evitar quiebres."}),e.jsx("div",{className:"space-y-2",children:n.slice(0,5).map(u=>{const f=u.historicalAverage>0?(u.forecastedDemand-u.historicalAverage)/u.historicalAverage*100:0;return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-red-100",children:u.productName}),e.jsxs("span",{className:"text-red-300 font-semibold",children:["+",f.toFixed(1),"%"]})]},u.productId)})}),e.jsxs("div",{className:"mt-3 text-xs text-red-300 bg-red-900/30 rounded p-2",children:["ðŸ’¡ ",e.jsx("strong",{children:"AcciÃ³n:"})," Revisar contratos con proveedores y ajustar Ã³rdenes de compra anticipadamente."]})]}),r.length>0&&e.jsxs("div",{className:"bg-amber-950 border border-amber-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"âš ï¸"}),e.jsxs("h4",{className:"text-base font-semibold text-amber-100",children:["Baja Confianza en PronÃ³stico (",r.length," productos)"]})]}),e.jsx("p",{className:"text-sm text-amber-200 mb-3",children:"Estos productos tienen datos histÃ³ricos limitados, lo que reduce la precisiÃ³n del pronÃ³stico."}),e.jsx("div",{className:"space-y-2",children:r.slice(0,5).map(u=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-amber-100",children:u.productName}),e.jsxs("span",{className:"text-amber-300 font-semibold",children:["Confianza: ",u.confidence.toFixed(0),"%"]})]},u.productId))}),e.jsxs("div",{className:"mt-3 text-xs text-amber-300 bg-amber-900/30 rounded p-2",children:["ðŸ’¡ ",e.jsx("strong",{children:"AcciÃ³n:"})," Recopilar mÃ¡s datos histÃ³ricos. Utilizar mÃ©todos de validaciÃ³n cruzada con ventas similares."]})]}),c.length>0&&e.jsxs("div",{className:"bg-green-950 border border-green-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“‰"}),e.jsxs("h4",{className:"text-base font-semibold text-green-100",children:["Demanda Decreciente (",c.length," productos)"]})]}),e.jsx("p",{className:"text-sm text-green-200 mb-3",children:"Productos con disminuciÃ³n en demanda pronosticada. Evaluar causas y ajustar inventario."}),e.jsx("div",{className:"space-y-2",children:c.slice(0,5).map(u=>{const f=u.historicalAverage>0?(u.forecastedDemand-u.historicalAverage)/u.historicalAverage*100:0;return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-green-100",children:u.productName}),e.jsxs("span",{className:"text-green-300 font-semibold",children:[f.toFixed(1),"%"]})]},u.productId)})}),e.jsxs("div",{className:"mt-3 text-xs text-green-300 bg-green-900/30 rounded p-2",children:["ðŸ’¡ ",e.jsx("strong",{children:"AcciÃ³n:"})," Reducir pedidos futuros. Considerar promociones para liquidar excedentes."]})]}),a.length>0&&e.jsxs("div",{className:"bg-purple-950 border border-purple-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ”¥"}),e.jsxs("h4",{className:"text-base font-semibold text-purple-100",children:["Alto Volumen Pronosticado (",a.length," productos)"]})]}),e.jsx("p",{className:"text-sm text-purple-200 mb-3",children:"Productos con demanda significativamente superior al promedio. Requieren atenciÃ³n prioritaria."}),e.jsx("div",{className:"space-y-2",children:a.slice(0,5).map(u=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-purple-100",children:u.productName}),e.jsxs("span",{className:"text-purple-300 font-semibold",children:[u.forecastedDemand.toFixed(0)," u/mes"]})]},u.productId))}),e.jsxs("div",{className:"mt-3 text-xs text-purple-300 bg-purple-900/30 rounded p-2",children:["ðŸ’¡ ",e.jsx("strong",{children:"AcciÃ³n:"})," Asegurar disponibilidad con proveedores. Evaluar descuentos por volumen."]})]})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"ðŸ“Š Resumen Global del PronÃ³stico"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Demanda HistÃ³rica Total"}),e.jsxs("span",{className:"text-sm font-semibold text-white",children:[l.toFixed(0)," u/mes"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Demanda Pronosticada Total"}),e.jsxs("span",{className:"text-sm font-semibold text-white",children:[m.toFixed(0)," u/mes"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"VariaciÃ³n Global"}),e.jsxs("span",{className:`text-sm font-semibold ${N>5?"text-red-400":N<-5?"text-green-400":"text-neutral-300"}`,children:[N>0?"+":"",N.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[N>10&&e.jsxs("p",{className:"text-xs text-red-300",children:["âš ï¸ Se espera un ",e.jsx("strong",{children:"aumento significativo"})," en la demanda global. Preparar recursos y capacidad operativa."]}),N>=-10&&N<=10&&e.jsxs("p",{className:"text-xs text-neutral-300",children:["â„¹ï¸ Demanda global ",e.jsx("strong",{children:"estable"}),". Mantener niveles actuales de inventario y operaciÃ³n."]}),N<-10&&e.jsxs("p",{className:"text-xs text-green-300",children:["â„¹ï¸ Se espera una ",e.jsx("strong",{children:"disminuciÃ³n"})," en la demanda global. Ajustar inventario y evaluar estrategias de marketing."]})]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"Productos Analizados"}),e.jsx("div",{className:"text-xl font-bold text-white",children:t.length})]}),e.jsxs("div",{className:"bg-red-950 border border-red-900 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-red-300 mb-1",children:"Demanda Creciente"}),e.jsx("div",{className:"text-xl font-bold text-white",children:n.length})]}),e.jsxs("div",{className:"bg-green-950 border border-green-900 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-green-300 mb-1",children:"Demanda Decreciente"}),e.jsx("div",{className:"text-xl font-bold text-white",children:c.length})]}),e.jsxs("div",{className:"bg-amber-950 border border-amber-900 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-amber-300 mb-1",children:"Baja Confianza"}),e.jsx("div",{className:"text-xl font-bold text-white",children:r.length})]})]})]})}const Fe=10,Os=[{value:"",label:"Todos"},{value:"emitida",label:"Emitida"},{value:"cancelled",label:"Cancelada"}],Bs=[{value:"",label:"Todos los documentos"},...Ue.map(t=>({value:t.value,label:t.label}))],Ks=[{value:"",label:"Todos los pagos"},...Ve.map(t=>({value:t.value,label:t.label}))];function De(t,o){return t?t.toLowerCase().includes(o):!1}function ee(t){return t==null||Number.isNaN(t)?"-":`$${Math.round(t).toLocaleString("es-CL")}`}function Ee(t){return t==null||Number.isNaN(t)?"-":t.toLocaleString("es-CL")}function zs(t,o){const n=[];return t&&t>0&&n.push(`- ${ee(t)}`),o&&o>0&&n.push(`+ ${ee(o)}`),n.length>0?n.join(" / "):"â€”"}function Ie(t){return t.documentNumber&&t.documentNumber.trim()?t.documentNumber.trim():t.docNumber&&t.docNumber.trim()?t.docNumber.trim():t.series&&(t.folio??"")!==""?`${t.series}-${t.folio}`:t.id}function tt(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]+/g,"_").replace(/^_+|_+$/g,"")}function Us(t){if(!t)return".pdf";const o=t.toLowerCase();return o.includes("pdf")?".pdf":o.includes("html")?".html":o.includes("json")?".json":o.includes("xml")?".xml":".bin"}function st(t,o){if(o?.filename)return o.filename;const n=tt(t.type||"documento"),c=tt(t.number??t.id),r=Us(o?.mimeType);return`${n||"documento"}-${c||t.id}${r}`}function Vs(t){return`${t.type} ${t.number??t.id}`}function at(t,o){const n=URL.createObjectURL(t.blob),c=document.createElement("a");c.href=n,c.download=o,c.rel="noopener",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(n)}async function Qs(t,o){const n=URL.createObjectURL(t.blob),c=window.open("","_blank","noopener,noreferrer");if(!c)throw URL.revokeObjectURL(n),new Error("No se pudo abrir la ventana de impresiÃ³n. Revisa el bloqueador de ventanas emergentes.");const r=()=>{URL.revokeObjectURL(n)};if(c.addEventListener("beforeunload",r,{once:!0}),t.mimeType.toLowerCase().includes("pdf")){c.document.body.style.margin="0",c.document.body.style.height="100vh";const a=c.document.createElement("iframe");a.src=n,a.title=o,a.style.border="0",a.style.width="100%",a.style.height="100%",c.document.body.appendChild(a),a.onload=()=>{c.document.title=o,c.focus(),c.print()}}else{const a=await t.blob.text();c.document.open(),c.document.write(a),c.document.title=o,c.document.close(),c.focus(),c.print()}setTimeout(r,6e4)}function ra(){const t=rt(),[o,n]=d.useState(0),[c,r]=d.useState(!1),[a,l]=d.useState("emitida"),[m,N]=d.useState(""),[u,f]=d.useState(""),[g,p]=d.useState(""),[h,v]=d.useState(null),[T,S]=d.useState(null),[W,Y]=d.useState(!1),[X,O]=d.useState(!1),A=d.useRef(null),J=d.useRef(null),te=d.useRef(null),ie=14,ue=new Date().toISOString().split("T")[0],re=new Date(Date.now()-(ie-1)*24*60*60*1e3).toISOString().split("T")[0],[z,xe]=d.useState(re),[H,ne]=d.useState(ue),I=ot(g,300);d.useEffect(()=>{n(0)},[a,m,u,I]),d.useEffect(()=>{W||requestAnimationFrame(()=>{A.current?.focus()})},[W]);const E=K({queryKey:["sales",o,a,m,u,I],queryFn:()=>Tt({page:o,size:Fe,status:a||void 0,docType:m||void 0,paymentMethod:u||void 0,search:I||void 0}),placeholderData:nt}),D=K({queryKey:["sales","metrics","summary","today"],queryFn:()=>Le("today")}),le=K({queryKey:["sales","metrics","summary","week"],queryFn:()=>Le("week")}),R=K({queryKey:["sales","metrics","summary","month"],queryFn:()=>Le("month")}),M=K({queryKey:["sale-detail",h?.id],queryFn:()=>{if(!h)throw new Error("Documento no seleccionado");return Rt(h.id)},enabled:!!h}),w=M.data??null,V=d.useMemo(()=>{if(!w)return{subtotal:0,discount:0,tax:0,total:0};const s=w.items.reduce((be,i)=>be+(i.discount??0),0),b=w.net,C=w.vat??0,U=w.total??b+C;return{subtotal:b,discount:s,tax:C,total:U}},[w]);d.useEffect(()=>{if(!h||!w)return;const s=J.current;s&&requestAnimationFrame(()=>s.focus())},[h,w]);const oe=me({mutationFn:s=>Pt(s),onSuccess:()=>t.invalidateQueries({queryKey:["sales"]})}),ce=me({mutationFn:({id:s,payload:b})=>kt(s,b),onSuccess:()=>t.invalidateQueries({queryKey:["sales"]})}),Z=me({mutationFn:async s=>{const b=await Dt(s.id);await Qs(b,Vs(s))},onMutate:()=>{S(null)},onError:s=>{S(s instanceof Error?s.message:"No se pudo preparar la impresiÃ³n. Intenta nuevamente.")}}),Q=me({mutationFn:async s=>{const b=await Qe(s.id),C=st(s,b);at(b,C)},onMutate:()=>{S(null)},onError:s=>{S(s instanceof Error?s.message:"No se pudo descargar el documento. Intenta nuevamente.")}}),F=me({mutationFn:async s=>{const b={id:s.id,type:s.docType??"Documento",number:Ie(s),issuedAt:s.issuedAt,total:s.total,status:s.status},C=await Qe(b.id),U=st(b,C);at(C,U)}});me({mutationFn:async()=>{const s=await lt({status:a||void 0,docType:m||void 0,paymentMethod:u||void 0,search:I||void 0}),b=URL.createObjectURL(s),C=document.createElement("a");C.href=b,C.download=`ventas-${new Date().toISOString().split("T")[0]}.csv`,C.rel="noopener",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(b)}});const we=s=>{if(s.status?.toLowerCase()==="cancelled"){window.alert("La venta ya fue cancelada.");return}window.confirm(`Cancelar venta ${s.docType??"Factura"}?`)&&oe.mutate(s.id)},de=s=>{const b=window.prompt("Documento",s.docType??"");if(b===null)return;const C=window.prompt("Metodo de pago",s.paymentMethod??"");if(C===null)return;const U={docType:b.trim()||s.docType,paymentMethod:C.trim()||s.paymentMethod};ce.mutate({id:s.id,payload:U})},se=s=>{const b={id:s.id,direction:"sales",type:s.docType??"Documento",number:Ie(s),issuedAt:s.issuedAt,total:s.total,status:s.status};v(b),S(null)},he=()=>{v(null),S(null),Z.reset(),Q.reset()},Se=()=>{Y(!0)},Ne=()=>{Y(!1)},ae=s=>{n(0);const b=g.trim().toLowerCase(),C=!a||s.status.toLowerCase()===a.toLowerCase(),U=!m||s.docType===m,be=!u||s.paymentMethod===u,i=!b||De(s.docType,b)||De(s.paymentMethod,b)||De(s.customerName,b)||De(s.customerId,b)||De(s.id,b);C&&U&&be&&i&&t.setQueriesData({queryKey:["sales"]},y=>{if(!y||y.number!==0)return y;const P={id:s.id,customerId:s.customerId??void 0,customerName:s.customerName??void 0,docType:s.docType,docNumber:s.docNumber??s.documentNumber??s.id,paymentMethod:s.paymentMethod,status:s.status,net:s.net,vat:s.vat,total:s.total,issuedAt:s.issuedAt},k=y.content??[],q=[P,...k].slice(0,y.size??Fe);return{...y,content:q,totalElements:(y.totalElements??0)+1}}),t.invalidateQueries({queryKey:["sales"]})},B=d.useMemo(()=>[{header:"Documento",accessorKey:"docType",cell:s=>s.getValue()??"Factura"},{header:"NÃºmero de documento",accessorFn:s=>Ie(s),cell:s=>{const b=s.getValue()??"-";return e.jsx("span",{className:"mono",children:b})}},{header:"Cliente",accessorFn:s=>s.customerName??s.customerId??"-",cell:s=>s.getValue()??"-"},{header:"Pago",accessorKey:"paymentMethod",cell:s=>s.getValue()??"-"},{header:"Estado",accessorKey:"status",cell:s=>{const b=s.getValue()??"",C=b.toLowerCase();let U="";return C==="emitida"?U="ðŸŸ¢ Emitida":C==="cancelled"?U="ðŸ”´ Cancelada":U=b,e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${C==="emitida"?"bg-green-950 text-green-400 border border-green-800":C==="cancelled"?"bg-red-950 text-red-400 border border-red-800":"bg-neutral-800 text-neutral-400 border border-neutral-700"}`,children:U})}},{header:"Neto",accessorKey:"net",cell:s=>e.jsxs("span",{className:"text-neutral-100",children:["$",(s.getValue()??0).toLocaleString()]})},{header:"IVA",accessorKey:"vat",cell:s=>e.jsxs("span",{className:"text-neutral-100",children:["$",(s.getValue()??0).toLocaleString()]})},{header:"Total",accessorKey:"total",cell:s=>e.jsxs("span",{className:"font-semibold text-neutral-100",children:["$",(s.getValue()??0).toLocaleString()]})},{header:"Emitida",accessorKey:"issuedAt",cell:s=>e.jsx("span",{className:"text-neutral-400 text-sm",children:new Date(s.getValue()).toLocaleString()})},{id:"actions",header:"Acciones",cell:({row:s})=>e.jsxs("div",{className:"table-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>se(s.original),children:"Comprobante"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>F.mutate(s.original),disabled:F.isPending,children:F.isPending?"Descargando...":"Descargar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>de(s.original),children:"Editar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>we(s.original),disabled:oe.isPending,children:oe.isPending?"Cancelando...":"Cancelar"})]})}],[oe.isPending,F.isPending]),ge=It({data:E.data?.content??[],columns:B,getCoreRowModel:Mt(),manualPagination:!0,pageCount:E.data?.totalPages??-1,state:{pagination:{pageIndex:o,pageSize:Fe}},onPaginationChange:s=>{const b=typeof s=="function"?s({pageIndex:o,pageSize:Fe}).pageIndex:s.pageIndex;n(b)}}),G=D.data,x=le.data,j=R.data,_=d.useMemo(()=>{const s=[];if(G&&x){const b=x.total/7;G.total>0&&G.total<b*.5&&s.push({id:"low-sales-today",type:"warning",message:`âš ï¸ Las ventas de hoy estÃ¡n un 50% por debajo del promedio semanal (${ee(b)})`})}if(E.data?.content){const b=new Date().toISOString().split("T")[0],C=E.data.content.filter(U=>{const be=new Date(U.issuedAt).toISOString().split("T")[0];return U.status?.toLowerCase()==="cancelled"&&be===b});C.length>0&&s.push({id:"cancelled-today",type:"warning",message:`âš ï¸ ${C.length} documento${C.length>1?"s":""} cancelado${C.length>1?"s":""} hoy`})}return G&&G.total===0&&G.count===0&&s.push({id:"no-sales-today",type:"info",message:"â„¹ï¸ Sin ventas registradas hoy"}),s},[G,x,E.data]);return e.jsxs("div",{className:"page-section bg-neutral-950",children:[e.jsx(Ft,{title:"Ventas",description:"Gestiona documentos, monitorea cobranzas y analiza el desempeno.",actions:e.jsx("button",{className:"btn",onClick:()=>r(!0),children:"+ Registrar venta"})}),e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsx(_s,{})}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"AnÃ¡lisis ABC de Productos"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(Ls,{}),e.jsx(As,{}),e.jsx(Is,{})]})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"PronÃ³stico de Demanda"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(Ms,{}),e.jsx($s,{}),e.jsx(qs,{})]})]}),e.jsx(as,{startDate:z,endDate:H,onStartDateChange:xe,onEndDateChange:ne}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 text-sm font-medium mb-2",children:"ðŸ’° Ventas del dÃ­a"}),e.jsx("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:D.isLoading?"...":D.isError?"â€”":ee(G?.total)}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-neutral-400",children:D.isError?"Sin datos disponibles.":`${Ee(G?.count)} docs`}),!D.isLoading&&!D.isError&&G&&x&&x.total>0?(()=>{const s=x.total/7,b=(G.total-s)/s*100,C=b>0;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${C?"bg-green-950 text-green-400 border border-green-800":"bg-red-950 text-red-400 border border-red-800"}`,children:[C?"ðŸŸ¢":"ðŸ”´"," ",b>0?"+":"",b.toFixed(1),"%"]})})():null]})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 text-sm font-medium mb-2",children:"ðŸ“ˆ Ventas de la semana"}),e.jsx("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:le.isLoading?"...":le.isError?"â€”":ee(x?.total)}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-neutral-400",children:le.isError?"Sin datos disponibles.":`${Ee(x?.count)} docs`}),!le.isLoading&&!le.isError&&x&&j&&j.total>0?(()=>{const s=j.total/4,b=(x.total-s)/s*100,C=b>0;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${C?"bg-green-950 text-green-400 border border-green-800":"bg-red-950 text-red-400 border border-red-800"}`,children:[C?"ðŸŸ¢":"ðŸ”´"," ",b>0?"+":"",b.toFixed(1),"%"]})})():null]})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 text-sm font-medium mb-2",children:"ðŸ“Š Ventas del mes"}),e.jsx("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:R.isLoading?"...":R.isError?"â€”":ee(j?.total)}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-neutral-400",children:R.isError?"Sin datos disponibles.":`${Ee(j?.count)} docs`}),!R.isLoading&&!R.isError&&j&&x?(()=>{const s=x.count>0?j.count/x.count:0,b=s>=4?"tendencia alta":s>=2?"tendencia media":"tendencia baja";return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-neutral-800 text-neutral-400 border border-neutral-700",children:["ðŸ“Š ",b]})})():null]})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 text-sm font-medium mb-2",children:"ðŸ“„ Total documentos"}),e.jsx("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:E.isLoading?"...":E.isError?"â€”":(E.data?.totalElements??0).toLocaleString("es-CL")}),e.jsx("button",{type:"button",className:"text-sm text-blue-400 hover:text-blue-300 transition-colors",onClick:Se,ref:A,children:"Ver documentos â†’"})]})]}),_.length>0&&e.jsx("section",{className:"mb-6 space-y-3",children:_.map(s=>e.jsxs("div",{className:`flex items-start gap-3 p-4 rounded-xl border ${s.type==="warning"?"bg-yellow-950 border-yellow-800 text-yellow-400":"bg-blue-950 border-blue-800 text-blue-400"}`,children:[e.jsx("span",{className:"text-lg",children:s.type==="warning"?"âš ï¸":"â„¹ï¸"}),e.jsx("p",{className:"text-sm font-medium flex-1",children:s.message})]},s.id))}),e.jsx(ls,{startDate:z,endDate:H,onStartDateChange:xe,onEndDateChange:ne}),e.jsx(gs,{startDate:z,endDate:H}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(js,{startDate:z,endDate:H}),e.jsx(vs,{startDate:z,endDate:H})]}),e.jsx(ws,{startDate:z,endDate:H}),e.jsx(Ds,{startDate:z,endDate:H}),e.jsx(Ts,{date:H}),e.jsx(Fs,{days:7}),e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-3 items-center mb-4",children:[e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100 flex-1 min-w-[200px]",placeholder:"Buscar (cliente, doc, pago)",value:g,onChange:s=>p(s.target.value)}),g&&e.jsx("button",{className:"btn ghost text-neutral-400 hover:text-neutral-100",type:"button",onClick:()=>p(""),children:"Limpiar"}),e.jsx("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:a,onChange:s=>l(s.target.value),children:Os.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:m,onChange:s=>N(s.target.value),children:Bs.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:u,onChange:s=>f(s.target.value),children:Ks.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("button",{className:"btn bg-cyan-600 hover:bg-cyan-700 text-white font-medium",type:"button",onClick:()=>O(!0),children:"ðŸ“¥ Exportar"})]})}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Documentos recientes"}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:ge.getHeaderGroups().map(s=>e.jsx("tr",{children:s.headers.map(b=>e.jsx("th",{children:b.isPlaceholder?null:He(b.column.columnDef.header,b.getContext())},b.id))},s.id))}),e.jsx("tbody",{children:ge.getRowModel().rows.map(s=>e.jsx("tr",{children:s.getVisibleCells().map(b=>e.jsx("td",{children:He(b.column.columnDef.cell,b.getContext())},b.id))},s.id))})]})}),e.jsxs("div",{className:"flex gap-2 mt-4 justify-between items-center border-t border-neutral-700 pt-4",children:[e.jsx("button",{className:"btn bg-neutral-800 border-neutral-700 text-neutral-100 hover:bg-neutral-700",disabled:o===0,onClick:()=>n(s=>Math.max(0,s-1)),children:"â† Anterior"}),e.jsxs("span",{className:"text-neutral-400",children:["PÃ¡gina ",o+1," de ",E.data?.totalPages??1]}),e.jsx("button",{className:"btn bg-neutral-800 border-neutral-700 text-neutral-100 hover:bg-neutral-700",disabled:o+1>=(E.data?.totalPages??1),onClick:()=>n(s=>s+1),children:"Siguiente â†’"})]})]}),e.jsx(xs,{isOpen:W,onClose:Ne}),e.jsx(es,{open:c,onClose:()=>r(!1),onCreated:ae}),e.jsxs(qe,{open:!!h,onClose:he,title:"Detalle del comprobante",initialFocusRef:J,className:"modal--wide",children:[M.isLoading&&e.jsx("p",{children:"Cargando comprobante..."}),M.isError&&e.jsx("p",{className:"error",children:M.error?.message??"No se pudo cargar el comprobante."}),T&&!M.isLoading&&e.jsx("p",{className:"error",children:T}),w&&e.jsxs("div",{className:"document-detail","aria-live":"polite",children:[e.jsxs("section",{className:"document-detail__header",children:[e.jsxs("div",{className:"document-detail__headline",children:[e.jsx("p",{className:"document-detail__type",children:w.docType??h?.type??"Documento"}),e.jsxs("p",{className:"document-detail__number",children:["#",h?.number??w.id]})]}),e.jsxs("div",{className:"document-detail__meta-grid",children:[e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Fecha"}),e.jsx("span",{className:"document-detail__meta-value",children:h?.issuedAt?new Date(h.issuedAt).toLocaleString():"â€”"})]}),e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:w.customer?"Cliente":w.supplier?"Proveedor":"Contraparte"}),e.jsx("span",{className:"document-detail__meta-value",children:w.customer?.name??w.supplier?.name??"â€”"})]}),e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Pago"}),e.jsx("span",{className:"document-detail__meta-value",children:w.paymentMethod??"â€”"})]}),e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"TÃ©rminos de pago"}),e.jsx("span",{className:"document-detail__meta-value",children:w.paymentTermDays?`${w.paymentTermDays} dÃ­as`:"Sin tÃ©rminos de pago"})]}),e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Estado"}),e.jsx("span",{className:"document-detail__meta-value",children:w.status})]}),e.jsxs("div",{className:"document-detail__meta-item document-detail__meta-item--highlight",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Total"}),e.jsx("span",{className:"document-detail__meta-value document-detail__meta-value--highlight",children:ee(V.total)})]})]})]}),e.jsx("div",{className:"document-detail__items table-wrapper compact",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"DescripciÃ³n"}),e.jsx("th",{className:"mono",children:"Cantidad"}),e.jsx("th",{className:"mono",children:"Precio unitario"}),e.jsx("th",{className:"mono",children:"Descuentos/Impuestos"}),e.jsx("th",{className:"mono",children:"Total Ã­tem"})]})}),e.jsx("tbody",{children:w.items.map((s,b)=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono",children:s.productId??"â€”"}),e.jsx("td",{children:e.jsx("span",{className:"document-detail__description",title:s.productName,children:s.productName})}),e.jsx("td",{className:"mono",children:Ee(s.qty)}),e.jsx("td",{className:"mono",children:ee(s.unitPrice)}),e.jsx("td",{className:"mono",children:zs(s.discount,s.tax)}),e.jsx("td",{className:"mono",children:ee(s.lineTotal)})]},`${s.productId??"item"}-${b}`))})]})}),e.jsxs("div",{className:"document-detail__totals",children:[e.jsxs("div",{className:"document-detail__totals-item",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("strong",{children:ee(V.subtotal)})]}),e.jsxs("div",{className:"document-detail__totals-item",children:[e.jsx("span",{children:"Descuentos"}),e.jsx("strong",{children:V.discount>0?`- ${ee(V.discount)}`:ee(V.discount)})]}),e.jsxs("div",{className:"document-detail__totals-item",children:[e.jsx("span",{children:"Impuestos"}),e.jsx("strong",{children:ee(V.tax)})]}),e.jsxs("div",{className:"document-detail__totals-item document-detail__totals-item--accent",children:[e.jsx("span",{children:"Total"}),e.jsx("strong",{children:ee(V.total)})]})]}),e.jsxs("div",{className:"document-detail__actions",children:[e.jsx("button",{ref:J,className:"btn",type:"button",onClick:()=>h&&w&&Z.mutate(h),disabled:!h||!w||Z.isPending||Q.isPending,children:Z.isPending?"Preparando...":"Imprimir"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>h&&w&&Q.mutate(h),disabled:!h||!w||Q.isPending||Z.isPending,children:Q.isPending?"Descargando...":"Descargar"}),e.jsx("button",{ref:te,className:"btn ghost",type:"button",onClick:he,children:"Cerrar"})]})]})]}),e.jsx(Es,{isOpen:X,onClose:()=>O(!1),filters:{status:a,docType:m,paymentMethod:u,search:I,startDate:z,endDate:H},totalRecords:E.data?.totalElements??0})]})}export{ra as default};
