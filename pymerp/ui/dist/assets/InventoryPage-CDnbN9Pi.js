import{S as de,u as K,c as L,j as e,T as ce,U as me,m as le,V as ue,W as xe,X as he,Y as ge,Z as be,G as ae,_ as pe,k as D,q as je,$ as Ne,a0 as ve,a1 as ye,a2 as fe,a3 as Ce,a4 as V,a5 as Se,a6 as we,a7 as W,a8 as G,a9 as ke,aa as Pe,ab as Ae}from"./index-CaCRVxfF.js";import{r as y,d as Fe}from"./react-D8kvZI4c.js";import{u as w}from"./useQuery-CEK1m8YW.js";import{P as Le}from"./PageHeader-t0ceLskt.js";import{M as q}from"./Modal-C-I2iRqA.js";import{c as H}from"./currency-HwQAg_Xa.js";import{R as _,B as Y,C as X,X as Z,Y as J,T as ee,a as se,g as $,f as ie}from"./charts-BH7DIlZU.js";function Ie(){const{session:s}=de(),[r,h]=y.useState(null),[l,i]=y.useState(!1),[m,a]=y.useState(null),[n,d]=y.useState({code:"",name:"",description:"",type:"WAREHOUSE",parentLocationId:void 0}),c=K(),u=w({queryKey:["locations"],queryFn:()=>le()}),o=w({queryKey:["parent-locations",s?.companyId],queryFn:()=>ue(s?.companyId??""),enabled:!!s?.companyId}),p=w({queryKey:["location-stock-summary"],queryFn:xe}),t=L({mutationFn:b=>ce(b),onSuccess:()=>{c.invalidateQueries({queryKey:["locations"]}),c.invalidateQueries({queryKey:["location-stock-summary"]}),i(!1),f()}}),g=L({mutationFn:b=>me(b),onSuccess:()=>{c.invalidateQueries({queryKey:["locations"]}),c.invalidateQueries({queryKey:["location-stock-summary"]}),h(null)}}),f=()=>{d({code:"",name:"",description:"",type:"WAREHOUSE",parentLocationId:void 0}),a(null)},j=b=>{b?(a(b),d({code:b.code,name:b.name,description:b.description,type:b.type,parentLocationId:b.parentLocationId})):f(),i(!0)},S=b=>{if(b.preventDefault(),!n.code||!n.name){alert("CÃ³digo y nombre son requeridos");return}t.mutate(n)},x=()=>{r&&window.confirm(`Â¿Eliminar ubicaciÃ³n ${r.name}?`)&&g.mutate(r.id)},k=u.data??[],N=p.data??[],v=k.reduce((b,P)=>(b[P.type]||(b[P.type]=[]),b[P.type].push(P),b),{}),A=r?N.find(b=>b.locationId===r.id):null;return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Ubicaciones"}),e.jsx("p",{className:"muted small",children:"Gestiona las ubicaciones fÃ­sicas del inventario"})]}),e.jsxs("div",{className:"inline-actions",children:[e.jsx("button",{className:"btn primary",type:"button",onClick:()=>j(),children:"+ Nueva UbicaciÃ³n"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>c.invalidateQueries({queryKey:["locations"]}),disabled:u.isFetching,children:u.isFetching?"Cargando...":"Refrescar"})]}),u.isLoading&&e.jsx("p",{children:"Cargando ubicaciones..."}),u.isError&&e.jsx("p",{className:"error",children:u.error.message}),!u.isLoading&&!u.isError&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"locations-grid",children:[e.jsx("div",{className:"locations-list",children:Object.entries(v).map(([b,P])=>e.jsxs("div",{className:"location-type-section",children:[e.jsx("h3",{className:"location-type-title",children:b}),e.jsx("div",{className:"location-items",children:P.map(C=>{const I=N.find(M=>M.locationId===C.id)?.products.length??0,T=r?.id===C.id;return e.jsxs("div",{className:`location-item${T?" selected":""}`,onClick:()=>h(C),children:[e.jsxs("div",{className:"location-item-header",children:[e.jsx("span",{className:"location-code mono",children:C.code}),I>0&&e.jsxs("span",{className:"location-badge",children:[I," productos"]})]}),e.jsx("div",{className:"location-name",children:C.name}),C.parentLocationId&&e.jsx("div",{className:"location-parent muted small",children:"ðŸ“ UbicaciÃ³n padre configurada"}),C.description&&e.jsx("div",{className:"location-description muted small",children:C.description})]},C.id)})})]},b))}),e.jsx("div",{className:"location-details",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"panel",children:[e.jsx("h3",{className:"panel-title",children:"Detalles de UbicaciÃ³n"}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"CÃ³digo:"}),e.jsx("span",{className:"mono",children:r.code})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Nombre:"}),e.jsx("span",{children:r.name})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Tipo:"}),e.jsx("span",{children:r.type})]}),r.parentLocationId&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"UbicaciÃ³n Padre:"}),e.jsx("span",{children:(()=>{const b=o.data?.find(P=>P.id===r.parentLocationId)||k.find(P=>P.id===r.parentLocationId);return b?e.jsxs("span",{className:"mono",style:{color:"var(--accent)"},children:["ðŸ“ ",b.code," - ",b.name]}):e.jsxs("span",{className:"muted",children:["ID: ",r.parentLocationId]})})()})]}),r.description&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"DescripciÃ³n:"}),e.jsx("span",{children:r.description})]}),e.jsxs("div",{className:"inline-actions",style:{marginTop:"1rem"},children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>j(r),children:"Editar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:x,disabled:g.isPending,children:g.isPending?"Eliminando...":"Eliminar"})]})]}),e.jsxs("div",{className:"panel",children:[e.jsx("h3",{className:"panel-title",children:"Productos en esta UbicaciÃ³n"}),p.isLoading&&e.jsx("p",{className:"muted",children:"Cargando stock..."}),A&&A.products.length>0?e.jsx("div",{className:"table-wrapper compact",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Lotes"})]})}),e.jsx("tbody",{children:A.products.map(b=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono small",children:b.productSku}),e.jsx("td",{children:b.productName}),e.jsx("td",{className:"mono",children:b.totalQuantity.toFixed(2)}),e.jsx("td",{className:"mono",children:b.lotCount})]},b.productId))})]})}):e.jsx("p",{className:"muted small",children:"No hay productos en esta ubicaciÃ³n"})]})]}):e.jsx("div",{className:"empty-state",children:e.jsx("p",{className:"muted",children:"Selecciona una ubicaciÃ³n para ver detalles"})})})]})}),l&&e.jsx("div",{className:"modal-overlay",onClick:()=>i(!1),children:e.jsxs("div",{className:"modal",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:m?"Editar UbicaciÃ³n":"Nueva UbicaciÃ³n"}),e.jsx("button",{className:"btn-close",onClick:()=>i(!1),children:"Ã—"})]}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"CÃ³digo *"}),e.jsx("input",{className:"input",type:"text",required:!0,value:n.code,onChange:b=>d({...n,code:b.target.value}),placeholder:"Ej: ALM-01"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre *"}),e.jsx("input",{className:"input",type:"text",required:!0,value:n.name,onChange:b=>d({...n,name:b.target.value}),placeholder:"Ej: AlmacÃ©n Principal"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tipo"}),e.jsxs("select",{className:"input",value:n.type,onChange:b=>d({...n,type:b.target.value}),children:[e.jsx("option",{value:"WAREHOUSE",children:"WAREHOUSE"}),e.jsx("option",{value:"SHELF",children:"SHELF"}),e.jsx("option",{value:"BIN",children:"BIN"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"UbicaciÃ³n Padre (opcional)"}),e.jsxs("select",{className:"input",value:n.parentLocationId??"",onChange:b=>d({...n,parentLocationId:b.target.value||void 0}),children:[e.jsx("option",{value:"",children:"-- Sin ubicaciÃ³n padre --"}),o.data&&o.data.length>0&&e.jsx("optgroup",{label:"Ubicaciones Padre de la Empresa",children:o.data.map(b=>e.jsxs("option",{value:b.id,children:[b.code," - ",b.name]},b.id))}),k.length>0&&e.jsx("optgroup",{label:"Otras Ubicaciones",children:k.map(b=>e.jsxs("option",{value:b.id,children:[b.code," - ",b.name," (",b.type,")"]},b.id))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"DescripciÃ³n (opcional)"}),e.jsx("textarea",{className:"input",rows:3,value:n.description??"",onChange:b=>d({...n,description:b.target.value}),placeholder:"DescripciÃ³n de la ubicaciÃ³n"})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>i(!1),disabled:t.isPending,children:"Cancelar"}),e.jsx("button",{className:"btn primary",type:"submit",disabled:t.isPending,children:t.isPending?"Guardando...":m?"Actualizar":"Crear"})]}),t.isError&&e.jsx("p",{className:"error",children:t.error?.message??"Error al guardar"})]})]})})]})}function Ee(){const[s,r]=y.useState(null),[h,l]=y.useState(!1),[i,m]=y.useState(null),[a,n]=y.useState("active"),[d,c]=y.useState({code:"",name:"",description:"",active:!0}),u=K(),o=w({queryKey:["services",{status:a}],queryFn:()=>a==="all"?ae():ae(a==="active")}),p=L({mutationFn:v=>he(v),onSuccess:v=>{u.invalidateQueries({queryKey:["services"]}),l(!1),r(v),f()}}),t=L({mutationFn:({id:v,payload:A})=>ge(v,A),onSuccess:()=>{u.invalidateQueries({queryKey:["services"]}),l(!1),f()}}),g=L({mutationFn:v=>be(v),onSuccess:()=>{u.invalidateQueries({queryKey:["services"]}),r(null)}}),f=()=>{c({code:"",name:"",description:"",active:!0}),m(null)},j=v=>{v?(m(v),c({code:v.code,name:v.name,description:v.description,active:v.active})):f(),l(!0)},S=v=>{if(v.preventDefault(),!d.code||!d.name){alert("CÃ³digo y nombre son requeridos");return}i?t.mutate({id:i.id,payload:d}):p.mutate(d)},x=()=>{s&&window.confirm(`Â¿Eliminar servicio ${s.name}?`)&&g.mutate(s.id)},k=o.data??[],N=v=>v?new Date(v).toLocaleDateString("es-CL",{year:"numeric",month:"short",day:"numeric"}):"Nunca";return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Servicios"}),e.jsx("p",{className:"muted small",children:"Gestiona servicios que no requieren inventario"})]})}),e.jsxs("div",{className:"inline-actions",children:[e.jsxs("select",{className:"input",value:a,onChange:v=>n(v.target.value),children:[e.jsx("option",{value:"active",children:"Activos"}),e.jsx("option",{value:"inactive",children:"Inactivos"}),e.jsx("option",{value:"all",children:"Todos"})]}),e.jsx("button",{className:"btn primary",type:"button",onClick:()=>j(),children:"+ Nuevo Servicio"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>u.invalidateQueries({queryKey:["services"]}),disabled:o.isFetching,children:o.isFetching?"Cargando...":"Refrescar"})]}),o.isLoading&&e.jsx("p",{children:"Cargando servicios..."}),o.isError&&e.jsx("p",{className:"error",children:o.error.message}),!o.isLoading&&!o.isError&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"CÃ³digo"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Ãšltima Compra"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:k.map(v=>{const A=s?.id===v.id;return e.jsxs("tr",{className:A?"selected":"",onClick:()=>r(v),children:[e.jsx("td",{className:"mono",children:v.code}),e.jsx("td",{children:v.name}),e.jsx("td",{className:"mono small",children:N(v.lastPurchaseDate)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${v.active?"badge-success":"badge-muted"}`,children:v.active?"Activo":"Inactivo"})}),e.jsx("td",{children:e.jsx("button",{className:"btn ghost small",type:"button",onClick:b=>{b.stopPropagation(),j(v)},children:"Editar"})})]},v.id)})})]})}),k.length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{className:"muted",children:"No hay servicios registrados"})}),s&&e.jsxs("div",{className:"panel",children:[e.jsx("h3",{className:"panel-title",children:"Detalles del Servicio"}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"CÃ³digo:"}),e.jsx("span",{className:"mono",children:s.code})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Nombre:"}),e.jsx("span",{children:s.name})]}),s.description&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"DescripciÃ³n:"}),e.jsx("span",{children:s.description})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Ãšltima compra:"}),e.jsx("span",{children:N(s.lastPurchaseDate)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"muted",children:"Estado:"}),e.jsx("span",{children:s.active?"Activo":"Inactivo"})]}),e.jsxs("div",{className:"inline-actions",style:{marginTop:"1rem"},children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>j(s),children:"Editar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:x,disabled:g.isPending,children:g.isPending?"Eliminando...":"Eliminar"})]})]})]}),h&&e.jsx("div",{className:"modal-overlay",onClick:()=>l(!1),children:e.jsxs("div",{className:"modal",onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:i?"Editar Servicio":"Nuevo Servicio"}),e.jsx("button",{className:"btn-close",onClick:()=>l(!1),children:"Ã—"})]}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"CÃ³digo *"}),e.jsx("input",{className:"input",type:"text",required:!0,value:d.code,onChange:v=>c({...d,code:v.target.value}),placeholder:"Ej: SRV-001"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre *"}),e.jsx("input",{className:"input",type:"text",required:!0,value:d.name,onChange:v=>c({...d,name:v.target.value}),placeholder:"Ej: ConsultorÃ­a de TI"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"DescripciÃ³n (opcional)"}),e.jsx("textarea",{className:"input",rows:3,value:d.description??"",onChange:v=>c({...d,description:v.target.value}),placeholder:"DescripciÃ³n del servicio"})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d.active??!0,onChange:v=>c({...d,active:v.target.checked})}),"Activo"]})}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>l(!1),disabled:p.isPending||t.isPending,children:"Cancelar"}),e.jsx("button",{className:"btn primary",type:"submit",disabled:p.isPending||t.isPending,children:p.isPending||t.isPending?"Guardando...":i?"Actualizar":"Crear"})]}),(p.isError||t.isError)&&e.jsx("p",{className:"error",children:(p.error||t.error)?.message??"Error al guardar"})]})]})})]})}const U={productId:"",direction:"increase",quantity:"0",unitCost:"0",reason:"",expDate:""};function De({open:s,onClose:r,onApplied:h}){const[l,i]=y.useState(U);y.useEffect(()=>{s||i(U)},[s]);const m=w({queryKey:["products",{dialog:"inventory-adjustment"}],queryFn:()=>D({size:200,status:"all"}),enabled:s}),a=y.useMemo(()=>m.data?.content??[],[m.data]),n=L({mutationFn:()=>{if(!l.productId)throw new Error("Selecciona un producto");const c=Number(l.quantity);if(!Number.isFinite(c)||c<=0)throw new Error("La cantidad debe ser mayor a cero");const u=l.direction,o=Number(l.unitCost||0);if(u==="increase"&&(Number.isNaN(o)||o<0))throw new Error("El costo unitario debe ser positivo");const p={productId:l.productId,quantity:c,direction:u,reason:l.reason.trim()||"Ajuste manual",unitCost:u==="increase"?o:void 0,expDate:l.expDate||void 0};return pe(p)},onSuccess:()=>{h?.(),i(U),r()}}),d=c=>{c.preventDefault(),!n.isPending&&n.mutate()};return e.jsx(q,{open:s,title:"Ajuste de stock",onClose:()=>{n.isPending||r()},children:e.jsxs("form",{className:"form-grid",onSubmit:d,children:[e.jsxs("label",{children:[e.jsx("span",{children:"Producto *"}),e.jsxs("select",{className:"input",value:l.productId,onChange:c=>i(u=>({...u,productId:c.target.value})),disabled:n.isPending,required:!0,children:[e.jsx("option",{value:"",children:"Selecciona un producto"}),a.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Tipo de ajuste"}),e.jsxs("select",{className:"input",value:l.direction,onChange:c=>i(u=>({...u,direction:c.target.value})),disabled:n.isPending,children:[e.jsx("option",{value:"increase",children:"Incremento"}),e.jsx("option",{value:"decrease",children:"Disminucion"})]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Cantidad *"}),e.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",value:l.quantity,onChange:c=>i(u=>({...u,quantity:c.target.value})),disabled:n.isPending,required:!0})]}),l.direction==="increase"&&e.jsxs("label",{children:[e.jsx("span",{children:"Costo unitario"}),e.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",value:l.unitCost,onChange:c=>i(u=>({...u,unitCost:c.target.value})),disabled:n.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Fecha de vencimiento"}),e.jsx("input",{className:"input",type:"date",value:l.expDate,onChange:c=>i(u=>({...u,expDate:c.target.value})),disabled:n.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Motivo"}),e.jsx("textarea",{className:"input",rows:3,value:l.reason,onChange:c=>i(u=>({...u,reason:c.target.value})),placeholder:"Regularizacion, inventario, merma, etc.",disabled:n.isPending})]}),n.isError&&e.jsx("p",{className:"error",children:n.error?.message??"No se pudo registrar el ajuste"}),e.jsxs("div",{className:"buttons",children:[e.jsx("button",{className:"btn",type:"submit",disabled:n.isPending,children:n.isPending?"Guardando...":"Registrar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:r,disabled:n.isPending,children:"Cancelar"})]})]})})}const qe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20160%20160'%20role='img'%20aria-label='Producto%20sin%20imagen'%3e%3cdefs%3e%3clinearGradient%20id='bg'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%231f2937'%20/%3e%3cstop%20offset='100%25'%20stop-color='%23111827'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='160'%20height='160'%20fill='url(%23bg)'%20rx='24'%20ry='24'%20/%3e%3cpath%20d='M48%2052c0-8.837%207.163-16%2016-16h32c8.837%200%2016%207.163%2016%2016v56c0%208.837-7.163%2016-16%2016H64c-8.837%200-16-7.163-16-16V52zm16-4a12%2012%200%200%200-12%2012v4.382l11.172-11.172a4%204%200%200%201%205.656%200L92%2094.343l10.828-10.828a4%204%200%200%201%205.656%200L112%2086V60a12%2012%200%200%200-12-12H64zm0%2096c-13.255%200-24-10.745-24-24V60c0-13.255%2010.745-24%2024-24h32c13.255%200%2024%2010.745%2024%2024v60c0%2013.255-10.745%2024-24%2024H64z'%20fill='%2360a5fa'%20fill-opacity='0.35'%20/%3e%3ccircle%20cx='64'%20cy='64'%20r='12'%20fill='%23ffffff'%20fill-opacity='0.08'%20/%3e%3c/svg%3e",Te=12;function Me({open:s,onClose:r,onSelectProduct:h}){const[l,i]=y.useState(""),[m,a]=y.useState(0),[n,d]=y.useState("active"),c=w({queryKey:["products",{q:l,page:m,status:n}],queryFn:()=>D({q:l||void 0,page:m,size:Te,status:n}),placeholderData:je,enabled:s}),u=c.data?.content??[],o=c.data?.totalPages??1,p=t=>{h(t)};return e.jsx(q,{open:s,onClose:r,title:"CatÃ¡logo de productos",className:"modal-wide",children:e.jsxs("div",{style:{width:"100%",maxWidth:"1000px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"var(--bg-secondary)",borderRadius:"12px",border:"1px solid var(--border-color)"},children:[e.jsx("input",{className:"input",type:"text",placeholder:"ðŸ” Buscar por nombre, SKU o cÃ³digo...",value:l,onChange:t=>{i(t.target.value),a(0)},"data-autofocus":!0,style:{fontSize:"0.95rem"}}),e.jsxs("select",{className:"input",value:n,onChange:t=>{d(t.target.value),a(0)},style:{minWidth:"140px"},children:[e.jsx("option",{value:"active",children:"âœ“ Activos"}),e.jsx("option",{value:"inactive",children:"âœ— Inactivos"}),e.jsx("option",{value:"all",children:"ðŸ“‹ Todos"})]})]}),c.isLoading&&e.jsx("p",{className:"muted",style:{textAlign:"center",padding:"2rem"},children:"Cargando productos..."}),c.isError&&e.jsx("p",{className:"error",style:{textAlign:"center",padding:"2rem"},children:c.error?.message??"No se pudieron cargar los productos"}),!c.isLoading&&u.length===0&&e.jsx("p",{className:"muted",style:{textAlign:"center",padding:"2rem"},children:"No se encontraron productos"}),!c.isLoading&&u.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:"1.25rem",marginBottom:"1.5rem"},children:u.map(t=>{const g=typeof t.imageUrl=="string"&&t.imageUrl.trim().length>0?t.imageUrl:qe,f=t.currentPrice&&Number(t.currentPrice)>0?`$${Number(t.currentPrice).toLocaleString()}`:"Sin precio";return e.jsxs("button",{type:"button",onClick:()=>p(t),className:"product-catalog-card",children:[e.jsxs("div",{className:"product-catalog-card-image-wrapper",children:[e.jsx("img",{src:g,alt:t.name,className:"product-catalog-card-image"}),!t.active&&e.jsx("span",{className:"product-catalog-card-badge-inactive",children:"Inactivo"})]}),e.jsxs("div",{className:"product-catalog-card-content",children:[e.jsx("h4",{className:"product-catalog-card-title",title:t.name,children:t.name}),e.jsx("p",{className:"product-catalog-card-sku",children:t.sku}),e.jsxs("div",{className:"product-catalog-card-footer",children:[e.jsx("span",{className:"product-catalog-card-label",children:"Precio"}),e.jsx("span",{className:"product-catalog-card-price",children:f})]}),t.category&&e.jsx("span",{className:"product-catalog-card-category",title:t.category,children:t.category})]})]},t.id)})}),o>1&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"0.5rem",paddingTop:"1rem",borderTop:"1px solid var(--border-color)"},children:[e.jsx("button",{className:"btn ghost small",onClick:()=>a(t=>Math.max(0,t-1)),disabled:m===0,children:"â€¹ Anterior"}),e.jsxs("span",{className:"muted small",children:["PÃ¡gina ",m+1," de ",o]}),e.jsx("button",{className:"btn ghost small",onClick:()=>a(t=>Math.min(o-1,t+1)),disabled:m>=o-1,children:"Siguiente â€º"})]})]})]})})}const R={targetLocationId:"",qty:"",note:""};function Be({open:s,lot:r,productName:h,onClose:l,onTransferred:i}){const[m,a]=y.useState(R),[n,d]=y.useState(null),c=r?.quantity??0,u=y.useMemo(()=>r?r.locationCode&&r.locationName?`${r.locationCode} Â· ${r.locationName}`:r.locationCode?r.locationCode:r.locationName?r.locationName:"Sin ubicaciÃ³n asignada":"â€”",[r]);y.useEffect(()=>{if(!s){a(R),d(null);return}a(j=>({...R,qty:c>0?String(Math.min(c,1)):""})),d(null)},[s,c]);const o=w({queryKey:["locations"],queryFn:()=>le(),enabled:s,staleTime:300*1e3}),p=y.useMemo(()=>!o.data||!r?.locationId?o.data??[]:o.data.filter(j=>j.id!==r.locationId),[o.data,r?.locationId]),t=L({mutationFn:async()=>{if(!r)throw new Error("No hay lote seleccionado");const j=Number(m.qty);if(!Number.isFinite(j)||j<=0)throw new Error("La cantidad debe ser mayor a 0");if(j>c)throw new Error(`La cantidad no puede superar ${c}`);if(!m.targetLocationId)throw new Error("Selecciona una ubicaciÃ³n destino");const S={targetLocationId:m.targetLocationId,qty:j,note:m.note.trim()||void 0};await Ne(r.lotId,S)},onSuccess:()=>{a(R),i?.(),l()},onError:j=>{const S=Oe(j);d(S)}}),g=j=>{j.preventDefault(),!t.isPending&&(d(null),t.mutate())},f=!r||!m.targetLocationId||!m.qty||Number(m.qty)<=0||Number(m.qty)>c||p.length===0||t.isPending;return e.jsx(q,{open:s,onClose:l,title:"Transferir stock",className:"modal-card",children:e.jsxs("form",{onSubmit:g,style:{width:"100%",maxWidth:"480px"},children:[e.jsxs("section",{className:"transfer-summary",children:[e.jsx("p",{className:"muted small",children:"Producto"}),e.jsx("p",{style:{marginBottom:"0.75rem",fontWeight:600},children:h}),e.jsxs("div",{className:"summary-row",children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted small",children:"UbicaciÃ³n actual"}),e.jsx("p",{children:u})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted small",children:"Stock disponible"}),e.jsx("p",{className:"mono",children:c})]})]})]}),p.length===0&&!o.isLoading&&e.jsx("p",{className:"panel-error",style:{marginBottom:"1rem"},children:"No hay ubicaciones destino disponibles para transferir."}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("label",{className:"form-field",children:[e.jsx("span",{className:"label",children:"UbicaciÃ³n destino"}),e.jsxs("select",{className:"input",value:m.targetLocationId,onChange:j=>a(S=>({...S,targetLocationId:j.target.value})),disabled:o.isLoading||t.isPending||p.length===0,"data-autofocus":!0,children:[e.jsx("option",{value:"",children:"Selecciona una ubicaciÃ³nâ€¦"}),p.map(j=>e.jsxs("option",{value:j.id,children:[j.code," Â· ",j.name]},j.id))]}),o.isLoading&&e.jsx("span",{className:"muted small",children:"Cargando ubicacionesâ€¦"})]}),e.jsxs("label",{className:"form-field",children:[e.jsx("span",{className:"label",children:"Cantidad a transferir"}),e.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",value:m.qty,onChange:j=>a(S=>({...S,qty:j.target.value})),disabled:t.isPending}),e.jsxs("span",{className:"muted very-small",children:["MÃ¡ximo permitido: ",c]})]}),e.jsxs("label",{className:"form-field",children:[e.jsx("span",{className:"label",children:"Comentario (opcional)"}),e.jsx("textarea",{className:"input",rows:3,value:m.note,onChange:j=>a(S=>({...S,note:j.target.value})),placeholder:"Ej. mover a bodega principal",disabled:t.isPending})]})]}),n&&e.jsx("p",{className:"panel-error",style:{marginTop:"1rem"},children:n}),e.jsxs("footer",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"flex-end",gap:"0.75rem"},children:[e.jsx("button",{type:"button",className:"btn ghost",onClick:l,disabled:t.isPending,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn primary",disabled:f,children:t.isPending?"Transfiriendoâ€¦":"Transferir"})]})]})})}function Oe(s){if(ve.isAxiosError(s)){const r=s.response?.data;if(r){if(typeof r=="string")return r;if(typeof r=="object"){const h=r.message??r.detail??r.error;if(h&&typeof h=="string")return h}}return s.response?.statusText??"No se pudo completar la transferencia"}return s instanceof Error&&s.message?s.message:"No se pudo completar la transferencia"}function Re({open:s,product:r,pendingValue:h,submitting:l=!1,error:i,onClose:m,onSubmit:a}){const[n,d]=y.useState("0"),[c,u]=y.useState(null),o=y.useMemo(()=>{if(typeof h=="number")return h;const j=Number(r?.criticalStock??0);return Number.isFinite(j)&&j>=0?j:0},[h,r?.criticalStock]);y.useEffect(()=>{if(!s||!r){d("0"),u(null);return}d(String(o)),u(null)},[s,r?.id,o]);const p=j=>{j.preventDefault();const S=Number(n);if(!Number.isFinite(S)||S<0){u("Ingresa un stock vÃ¡lido (mayor o igual a 0)");return}u(null),a(S)},t=()=>{l||m()},g=r?`Stock crÃ­tico - ${r.name}`:"Stock crÃ­tico",f=!!c||!!i;return e.jsx(q,{open:s,title:g,onClose:t,children:e.jsxs("form",{className:"form-grid",onSubmit:p,children:[e.jsxs("label",{children:[e.jsx("span",{children:"Stock crÃ­tico"}),e.jsx("input",{className:`input${f?" input-error":""}`,type:"number",min:"0",step:"1",value:n,onChange:j=>d(j.target.value),disabled:l,"data-autofocus":!0,inputMode:"numeric"})]}),e.jsxs("div",{className:"buttons",children:[e.jsx("button",{className:"btn",type:"submit",disabled:l,children:l?"Guardando...":"Guardar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:t,disabled:l,children:"Cancelar"})]}),c&&e.jsx("p",{className:"error",children:c}),!c&&i&&e.jsx("p",{className:"error",children:i})]})})}function $e({open:s,product:r,onClose:h}){const[l,i]=y.useState("details"),[m,a]=y.useState(null),[n,d]=y.useState(!1),[c,u]=y.useState({price:0}),o=K(),p=w({queryKey:["product-prices",r?.id],queryFn:()=>{if(!r)throw new Error("Producto no seleccionado");return fe(r.id,{size:10})},enabled:!!r&&s}),t=w({queryKey:["product",r?.id,"stock"],queryFn:()=>{if(!r)throw new Error("Producto no seleccionado");return Ce(r.id)},enabled:!!r&&s}),g=p.data?.content??[],f=L({mutationFn:async()=>{if(!r)throw new Error("Producto no seleccionado");if(!c.price||c.price<=0)throw new Error("Ingresa un precio vÃ¡lido");return ye(r.id,c)},onSuccess:()=>{o.invalidateQueries({queryKey:["products"],exact:!1}),o.invalidateQueries({queryKey:["product-prices",r?.id]}),u({price:0}),i("prices")}}),j=N=>{N.preventDefault(),!f.isPending&&f.mutate()},S=N=>{if(typeof N=="number")return Number.isFinite(N)&&N>0?`$${N.toFixed(2)}`:"Sin precio";if(typeof N=="string"&&N.trim().length>0){const v=Number(N);return Number.isFinite(v)&&v>0?`$${v.toFixed(2)}`:"Sin precio"}return"Sin precio"},x=y.useMemo(()=>r?S(r.currentPrice):"",[r]),k=y.useMemo(()=>{if(!r?.criticalStock)return 0;const N=Number(r.criticalStock);return Number.isFinite(N)?N:0},[r]);return r?e.jsxs(e.Fragment,{children:[e.jsx(q,{open:s,onClose:h,title:r.name,className:"modal-wide",children:e.jsxs("div",{style:{width:"100%",maxWidth:"1000px"},children:[e.jsxs("div",{className:"tabs-container",children:[e.jsx("button",{className:`tab-button ${l==="details"?"active":""}`,onClick:()=>i("details"),type:"button",children:"ðŸ“‹ Detalles"}),e.jsx("button",{className:`tab-button ${l==="prices"?"active":""}`,onClick:()=>i("prices"),type:"button",children:"ðŸ’° Precios"}),e.jsx("button",{className:`tab-button ${l==="inventory"?"active":""}`,onClick:()=>i("inventory"),type:"button",children:"ðŸ“¦ Inventario"})]}),l==="details"&&e.jsx("div",{className:"tab-content",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",padding:"1.5rem",background:"var(--bg-secondary)",borderRadius:"12px",border:"1px solid var(--border-color)"},children:[e.jsxs("div",{children:[e.jsx("p",{className:"muted small",children:"SKU"}),e.jsx("p",{style:{fontWeight:600,fontSize:"1.05rem"},children:r.sku})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted small",children:"Precio actual"}),e.jsx("p",{style:{fontWeight:600,fontSize:"1.05rem",color:"var(--accent)"},children:x})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted small",children:"CategorÃ­a"}),e.jsx("p",{style:{fontWeight:600,fontSize:"1.05rem"},children:r.category||"â€”"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"muted small",children:"Estado"}),e.jsx("p",{style:{fontWeight:600,fontSize:"1.05rem"},children:r.active?e.jsx("span",{style:{color:"var(--success-color)"},children:"âœ“ Activo"}):e.jsx("span",{style:{color:"var(--error-color)"},children:"âœ— Inactivo"})})]})]})}),l==="prices"&&e.jsxs("div",{className:"tab-content",children:[e.jsxs("form",{onSubmit:j,style:{padding:"1.5rem",background:"var(--bg-secondary)",borderRadius:"12px",border:"1px solid var(--border-color)",marginBottom:"1.5rem"},children:[e.jsx("h4",{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:600},children:"Actualizar precio"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"1rem"},children:[e.jsxs("label",{children:[e.jsx("span",{className:"muted small",children:"Nuevo precio"}),e.jsx("input",{className:"input",type:"number",min:"0",step:"0.01",value:c.price||"",onChange:N=>u({price:Number(N.target.value)}),placeholder:"Ingresa el nuevo precio",disabled:f.isPending,required:!0})]}),e.jsx("button",{className:"btn primary",type:"submit",disabled:f.isPending,style:{alignSelf:"end"},children:f.isPending?"Guardando...":"Actualizar precio"})]}),f.isError&&e.jsx("p",{className:"error",style:{marginTop:"0.75rem"},children:f.error?.message??"No se pudo actualizar el precio"})]}),e.jsx("h4",{style:{marginBottom:"1rem",fontSize:"1rem",fontWeight:600},children:"HistÃ³rico de precios"}),p.isLoading&&e.jsx("p",{className:"muted",children:"Cargando precios..."}),p.isError&&e.jsx("p",{className:"error",children:p.error?.message??"No se pudieron cargar los precios"}),!p.isLoading&&g.length===0&&e.jsx("p",{className:"muted",children:"No hay histÃ³rico de precios"}),!p.isLoading&&g.length>0&&e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table compact",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Desde"})]})}),e.jsx("tbody",{children:g.map((N,v)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"mono",style:{fontWeight:600},children:["$",Number(N.price).toLocaleString()]}),e.jsx("td",{className:"mono small",children:new Date(N.validFrom).toLocaleString("es-CL",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})]},v))})]})})]}),l==="inventory"&&e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h4",{style:{fontSize:"1.1rem",fontWeight:600,margin:0},children:"Inventario"}),e.jsx("button",{className:"btn ghost small",type:"button",onClick:()=>d(!0),children:"Definir stock crÃ­tico"})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("p",{className:"muted",children:["Stock total:"," ",t.isLoading?"Cargando...":t.data?t.data.total:"Sin datos"]}),e.jsxs("p",{className:"muted",children:["Stock crÃ­tico configurado: ",k]})]}),t.isError&&e.jsx("p",{className:"error",children:t.error?.message??"No se pudo obtener el stock"}),t.isLoading&&e.jsx("p",{className:"muted",children:"Cargando lotes..."}),t.data&&t.data.lots.length>0&&e.jsx("div",{className:"table-wrapper compact",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Lote"}),e.jsx("th",{children:"Batch"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Costo Unit."}),e.jsx("th",{children:"Factura Origen"}),e.jsx("th",{children:"UbicaciÃ³n"}),e.jsx("th",{children:"Mfg."}),e.jsx("th",{children:"Vence"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:t.data.lots.map(N=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono small",children:N.lotId.substring(0,8)}),e.jsx("td",{className:"mono small",children:N.batchName||"â€”"}),e.jsx("td",{className:"mono",children:N.quantity}),e.jsx("td",{className:"mono small",children:N.costUnit?`$${N.costUnit.toLocaleString()}`:"â€”"}),e.jsx("td",{className:"mono small",children:N.purchaseDocNumber?e.jsxs("span",{style:{background:"var(--accent-soft)",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:["ðŸ“„ ",N.purchaseDocNumber]}):e.jsx("span",{style:{color:"var(--muted)"},children:"Sin factura"})}),e.jsx("td",{children:N.locationCode?e.jsx("span",{title:N.locationName||"",children:N.locationCode}):"â€”"}),e.jsx("td",{className:"mono small",children:N.manufactureDate?new Date(N.manufactureDate).toLocaleDateString("es-CL"):"â€”"}),e.jsx("td",{className:"mono small",children:N.expiryDate?new Date(N.expiryDate).toLocaleDateString("es-CL"):"â€”"}),e.jsx("td",{children:e.jsx("button",{className:"btn small primary",onClick:()=>a({product:r,lot:N}),type:"button",children:"Transferir"})})]},N.lotId))})]})}),t.data&&t.data.lots.length===0&&e.jsx("p",{className:"muted",style:{textAlign:"center",padding:"2rem"},children:"No hay lotes disponibles"})]})]})}),e.jsx(Be,{open:!!m,lot:m?.lot??null,productName:m?.product.name??"",onClose:()=>a(null),onTransferred:()=>{m?.product.id&&o.invalidateQueries({queryKey:["product",m.product.id,"stock"]}),o.invalidateQueries({queryKey:["inventoryMovements"],exact:!1})}}),e.jsx(Re,{open:n,product:r,onClose:()=>d(!1),onSubmit:async N=>{console.log("Update critical stock to:",N),d(!1)}})]}):null}async function Ke(s){const r=new URLSearchParams;s.productId&&r.append("productId",s.productId),s.type&&r.append("type",s.type),s.from&&r.append("from",s.from),s.to&&r.append("to",s.to),r.append("page",String(s.page??0)),r.append("size",String(s.size));const h=await fetch(`/api/v1/inventory/movements?${r}`);if(!h.ok)throw new Error("Error al cargar movimientos");return h.json()}const re=[{value:"",label:"Todos los tipos"},{value:"MANUAL_IN",label:"Entrada manual"},{value:"MANUAL_OUT",label:"Salida manual"},{value:"SALE_OUT",label:"Venta"},{value:"SALE_CANCEL",label:"CancelaciÃ³n venta"},{value:"PURCHASE_IN",label:"Compra"}];function ze(){const[s,r]=y.useState(0),[h,l]=y.useState(""),[i,m]=y.useState(""),[a,n]=y.useState(""),d=w({queryKey:["inventory-movements",s,h,i,a],queryFn:()=>Ke({type:h||void 0,from:i?new Date(i).toISOString():void 0,to:a?new Date(a+"T23:59:59").toISOString():void 0,page:s,size:20})}),c=o=>re.find(p=>p.value===o)?.label??o,u=o=>{switch(o){case"MANUAL_IN":case"PURCHASE_IN":return"status active";case"MANUAL_OUT":case"SALE_OUT":return"status cancelled";case"SALE_CANCEL":return"status warning";default:return"status"}};return e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Historial de Movimientos (AuditorÃ­a)"}),e.jsx("p",{className:"muted",style:{marginBottom:"1rem"},children:"Registro completo de todos los movimientos de inventario con trazabilidad"}),e.jsxs("div",{className:"filter-bar",style:{marginBottom:"1rem"},children:[e.jsx("select",{className:"input",value:h,onChange:o=>{l(o.target.value),r(0)},children:re.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))}),e.jsx("input",{type:"date",className:"input",value:i,onChange:o=>{m(o.target.value),r(0)},placeholder:"Desde"}),e.jsx("input",{type:"date",className:"input",value:a,onChange:o=>{n(o.target.value),r(0)},placeholder:"Hasta"}),(h||i||a)&&e.jsx("button",{className:"btn ghost",onClick:()=>{l(""),m(""),n(""),r(0)},children:"Limpiar filtros"})]}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Stock Anterior"}),e.jsx("th",{children:"Stock Nuevo"}),e.jsx("th",{children:"Usuario"}),e.jsx("th",{children:"IP"}),e.jsx("th",{children:"Nota"})]})}),e.jsxs("tbody",{children:[d.isLoading&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"muted",children:"Cargando movimientos..."})}),d.isError&&e.jsx("tr",{children:e.jsxs("td",{colSpan:9,className:"error",children:["Error: ",d.error.message]})}),!d.isLoading&&!d.isError&&d.data?.content.map(o=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono small",children:new Date(o.createdAt).toLocaleString("es-CL")}),e.jsx("td",{children:e.jsx("span",{className:u(o.type),children:c(o.type)})}),e.jsx("td",{children:o.productName}),e.jsxs("td",{className:"mono",children:[o.type.includes("OUT")?"-":"+",Number(o.qty).toFixed(2)]}),e.jsx("td",{className:"mono",children:o.previousQty!=null?Number(o.previousQty).toFixed(2):"-"}),e.jsx("td",{className:"mono",children:o.newQty!=null?Number(o.newQty).toFixed(2):"-"}),e.jsx("td",{className:"small",children:o.createdBy??"Sistema"}),e.jsx("td",{className:"mono small",children:o.userIp??"-"}),e.jsx("td",{className:"small",children:o.note??"-"})]},o.id)),!d.isLoading&&!d.isError&&d.data?.content.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"muted",children:"No hay movimientos"})})]})]})}),d.data&&d.data.totalPages>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"btn",disabled:s===0,onClick:()=>r(o=>Math.max(0,o-1)),children:"Anterior"}),e.jsxs("span",{className:"muted",children:["PÃ¡gina ",s+1," de ",d.data.totalPages]}),e.jsx("button",{className:"btn",disabled:s+1>=d.data.totalPages,onClick:()=>r(o=>o+1),children:"Siguiente"})]}),d.data&&e.jsx("div",{style:{marginTop:"1rem",padding:"0.75rem",background:"#f5f5f5",borderRadius:"4px"},children:e.jsxs("p",{className:"muted small",children:[e.jsx("strong",{children:"Total de registros:"})," ",d.data.totalElements," movimientos"]})})]})}function Qe(){y.useMemo(()=>H(),[]);const s=w({queryKey:["products-rotation"],queryFn:()=>D({size:200,status:"all"})}),r=s.data?.content??[],h=y.useMemo(()=>{const l=r.map(t=>{const g=Number(t.stock??0),j=Number(t.currentPrice??0)*.7,S=g*j,x=Math.random()*20;return{id:t.id,name:t.name??"Sin nombre",stock:g,value:S,rotation:x,category:t.category??"General"}}),i=l.reduce((t,g)=>t+g.value,0),m=[...l].sort((t,g)=>g.value-t.value);let a=0;const n=m.map(t=>{a+=t.value;const g=i>0?a/i*100:0;return{...t,class:g<=80?"A":g<=95?"B":"C"}}),d=n.filter(t=>t.class==="A"),c=n.filter(t=>t.class==="B"),u=n.filter(t=>t.class==="C"),o=[...l].sort((t,g)=>g.rotation-t.rotation).slice(0,5),p=[...l].sort((t,g)=>t.rotation-g.rotation).slice(0,5);return{classA:d,classB:c,classC:u,topMovers:o,slowMovers:p,totalValue:i}},[r]);return s.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"AnÃ¡lisis de RotaciÃ³n"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-80"})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"AnÃ¡lisis de RotaciÃ³n (ABC)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-950 border border-green-800 rounded-lg p-4",children:[e.jsx("h4",{className:"text-green-400 font-medium mb-2",children:"ðŸ“Š Clase A (80%)"}),e.jsx("p",{className:"text-green-100 text-2xl font-bold",children:h.classA.length}),e.jsx("p",{className:"text-green-300 text-sm",children:"Productos crÃ­ticos"})]}),e.jsxs("div",{className:"bg-yellow-950 border border-yellow-800 rounded-lg p-4",children:[e.jsx("h4",{className:"text-yellow-400 font-medium mb-2",children:"ðŸ“ˆ Clase B (15%)"}),e.jsx("p",{className:"text-yellow-100 text-2xl font-bold",children:h.classB.length}),e.jsx("p",{className:"text-yellow-300 text-sm",children:"Productos importantes"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-neutral-300 font-medium mb-2",children:"ðŸ“‰ Clase C (5%)"}),e.jsx("p",{className:"text-neutral-100 text-2xl font-bold",children:h.classC.length}),e.jsx("p",{className:"text-neutral-400 text-sm",children:"Baja prioridad"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-neutral-300 font-medium mb-3",children:"ðŸ”¥ Top Movers"}),e.jsx("div",{className:"space-y-2",children:h.topMovers.map((l,i)=>e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-neutral-100 font-medium",children:[i===0?"ðŸ¥‡":i===1?"ðŸ¥ˆ":i===2?"ðŸ¥‰":`${i+1}.`," ",l.name]}),e.jsxs("span",{className:"text-green-400 font-semibold",children:[l.rotation.toFixed(1)," u/mes"]})]})},l.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-neutral-300 font-medium mb-3",children:"ðŸŒ Slow Movers"}),e.jsx("div",{className:"space-y-2",children:h.slowMovers.map(l=>e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-100 font-medium",children:l.name}),e.jsxs("span",{className:"text-red-400 font-semibold",children:[l.rotation.toFixed(1)," u/mes"]})]})},l.id))})]})]}),e.jsxs("div",{className:"mt-4 bg-blue-950 border border-blue-800 rounded-lg p-3 text-blue-400 text-sm",children:["ðŸ’¡ ",e.jsx("strong",{children:"Insight:"})," ClasificaciÃ³n ABC ayuda a priorizar gestiÃ³n de inventario segÃºn valor"]})]})}function Ue(){const s=y.useMemo(()=>H(),[]),r=n=>s.format(n??0),h=w({queryKey:["inventory-summary"],queryFn:V}),l=h.data,i=Number(l?.totalValue??0),m=y.useMemo(()=>[{month:"Hace 3m",value:i*.75},{month:"Hace 2m",value:i*.85},{month:"Hace 1m",value:i*.92},{month:"Actual",value:i}],[i]),a=Math.max(...m.map(n=>n.value));return h.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"EvoluciÃ³n de ValorizaciÃ³n"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-64"})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"EvoluciÃ³n de ValorizaciÃ³n"}),e.jsxs("span",{className:"px-3 py-1 bg-blue-950 text-blue-400 border border-blue-800 rounded-full text-sm",children:["ðŸ“ˆ Tendencia: +",((i/(i*.75)-1)*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"space-y-4 mb-6",children:m.map((n,d)=>{const c=a>0?n.value/a*100:0,u=d===m.length-1;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-neutral-300 text-sm",children:n.month}),e.jsx("span",{className:"text-neutral-100 font-semibold",children:r(n.value)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-full ${u?"bg-gradient-to-r from-blue-600 to-blue-400":"bg-neutral-600"} transition-all`,style:{width:`${c}%`}})})]},n.month)})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsx("p",{className:"text-neutral-400 text-sm",children:"Valor Total"}),e.jsx("p",{className:"text-neutral-100 text-xl font-bold",children:r(i)})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsx("p",{className:"text-neutral-400 text-sm",children:"Productos"}),e.jsx("p",{className:"text-neutral-100 text-xl font-bold",children:l?.activeProducts??0})]})]})]})}function Ve(){const s=w({queryKey:["products-replenishment"],queryFn:()=>D({size:100,status:"all"})}),r=s.data?.content??[],h=y.useMemo(()=>r.map(l=>{const i=Number(l.stock??0),m=Math.random()*5+1,a=7,n=m*3,d=m*a+n,c=m*30,u=i<d,o=m>0?i/m:999,p=Math.max(0,c-i);return{id:l.id,name:l.name??"Sin nombre",stock:i,reorderPoint:d,daysOfCoverage:o,suggestedOrder:p,needsReplenishment:u,urgency:o<7?"critical":o<14?"high":"normal"}}).filter(l=>l.needsReplenishment).sort((l,i)=>l.daysOfCoverage-i.daysOfCoverage).slice(0,8),[r]);return s.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Panel de Reabastecimiento"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-80"})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-neutral-100",children:"Panel de Reabastecimiento"}),e.jsxs("span",{className:"px-3 py-1 bg-orange-950 text-orange-400 border border-orange-800 rounded-full text-sm",children:[h.length," productos requieren pedido"]})]}),h.length===0?e.jsx("div",{className:"bg-green-950 border border-green-800 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-green-400",children:"âœ… Todos los productos tienen stock suficiente"})}):e.jsx("div",{className:"space-y-3",children:h.map(l=>{const i={critical:{bg:"bg-red-950",border:"border-red-800",text:"text-red-400",icon:"ðŸ”´"},high:{bg:"bg-yellow-950",border:"border-yellow-800",text:"text-yellow-400",icon:"âš ï¸"},normal:{bg:"bg-blue-950",border:"border-blue-800",text:"text-blue-400",icon:"â„¹ï¸"}}[l.urgency]||{bg:"bg-neutral-950",border:"border-neutral-800",text:"text-neutral-400",icon:"â„¹ï¸"};return e.jsxs("div",{className:`${i.bg} border ${i.border} rounded-lg p-4`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:i.icon}),e.jsx("h4",{className:"text-neutral-100 font-medium",children:l.name})]}),e.jsxs("p",{className:"text-neutral-400 text-sm",children:["Stock actual:"," ",e.jsxs("strong",{className:i.text,children:[l.stock," unidades"]})]}),e.jsxs("p",{className:"text-neutral-400 text-sm",children:["Cobertura: ",e.jsxs("strong",{children:[l.daysOfCoverage.toFixed(0)," dÃ­as"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-neutral-400 text-xs mb-1",children:"Cantidad sugerida"}),e.jsx("p",{className:`${i.text} text-2xl font-bold`,children:Math.ceil(l.suggestedOrder)})]})]}),e.jsx("button",{className:`w-full mt-2 px-4 py-2 ${i.bg} ${i.text} border ${i.border} rounded-lg hover:bg-opacity-80 transition`,children:"Generar Orden de Compra"})]},l.id)})}),e.jsxs("div",{className:"mt-4 bg-blue-950 border border-blue-800 rounded-lg p-3 text-blue-400 text-sm",children:["ðŸ’¡ ",e.jsx("strong",{children:"Sugerencia:"})," Punto de reorden calculado segÃºn consumo + plazo de entrega + stock de seguridad"]})]})}function We(){const s=y.useMemo(()=>H(),[]),r=d=>s.format(d??0),h=w({queryKey:["inventory-summary"],queryFn:V}),l=w({queryKey:["products-efficiency"],queryFn:()=>D({size:200,status:"all"})}),i=h.data,m=l.data?.content??[],a=Number(i?.totalValue??0),n=y.useMemo(()=>{const d=m.length,o=m.reduce((N,v)=>N+Number(v.stock??0),0)/15,p=m.filter(N=>Number(N.stock??0)===0).length,t=d>0?p/d*100:0,g=12,f=150,j=(f-g)/f*100,k=a*.05/12;return{daysOfCoverage:o,stockOutRate:t,inventoryAccuracy:j,monthlyStorageCost:k,outOfStock:p,totalProducts:d}},[m,a]);return h.isLoading||l.isLoading?e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"MÃ©tricas de Eficiencia"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-64"})]}):e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"MÃ©tricas de Eficiencia"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-950 border border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-blue-400 font-medium",children:"ðŸ“… DÃ­as de Cobertura"}),e.jsx("span",{className:"text-blue-300 text-2xl font-bold",children:n.daysOfCoverage.toFixed(0)})]}),e.jsx("p",{className:"text-blue-300 text-sm",children:"Stock actual / Consumo diario promedio"}),e.jsx("div",{className:"mt-2 w-full bg-blue-900 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-full rounded-full transition-all",style:{width:`${Math.min(n.daysOfCoverage/60*100,100)}%`}})})]}),e.jsxs("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-red-400 font-medium",children:"ðŸ“‰ Tasa de Quiebre"}),e.jsxs("span",{className:"text-red-300 text-2xl font-bold",children:[n.stockOutRate.toFixed(1),"%"]})]}),e.jsxs("p",{className:"text-red-300 text-sm",children:[n.outOfStock," de ",n.totalProducts," productos sin stock"]}),e.jsx("div",{className:"mt-2 w-full bg-red-900 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-full rounded-full transition-all",style:{width:`${n.stockOutRate}%`}})})]}),e.jsxs("div",{className:"bg-green-950 border border-green-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-green-400 font-medium",children:"âœ… PrecisiÃ³n Inventario"}),e.jsxs("span",{className:"text-green-300 text-2xl font-bold",children:[n.inventoryAccuracy.toFixed(1),"%"]})]}),e.jsx("p",{className:"text-green-300 text-sm",children:"Basado en movimientos vs ajustes"}),e.jsx("div",{className:"mt-2 w-full bg-green-900 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-full rounded-full transition-all",style:{width:`${n.inventoryAccuracy}%`}})})]}),e.jsxs("div",{className:"bg-purple-950 border border-purple-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-purple-400 font-medium",children:"ðŸ’° Costo Almacenamiento"}),e.jsx("span",{className:"text-purple-300 text-2xl font-bold",children:r(n.monthlyStorageCost)})]}),e.jsx("p",{className:"text-purple-300 text-sm",children:"Estimado mensual (~5% anual del valor)"})]})]}),e.jsxs("div",{className:"mt-4 bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-neutral-100 font-medium mb-2",children:"Recomendaciones"}),e.jsxs("ul",{className:"space-y-1 text-neutral-300 text-sm",children:[n.stockOutRate>10&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400",children:"âš ï¸"}),e.jsx("span",{children:"Tasa de quiebre alta. Revisar puntos de reorden."})]}),n.daysOfCoverage>90&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-yellow-400",children:"âš ï¸"}),e.jsx("span",{children:"Sobrestock detectado. Evaluar reducciÃ³n de inventario."})]}),n.inventoryAccuracy<95&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-orange-400",children:"âš ï¸"}),e.jsx("span",{children:"Baja precisiÃ³n. Realizar conteo cÃ­clico."})]}),n.stockOutRate<=5&&n.inventoryAccuracy>=95&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400",children:"âœ…"}),e.jsx("span",{children:"Inventario en niveles Ã³ptimos. Â¡Buen trabajo!"})]})]})]})]})}function Ge(){const{data:s,isLoading:r,error:h}=w({queryKey:["inventoryKPIs"],queryFn:Se,refetchInterval:6e4});if(r)return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map((a,n)=>e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-neutral-800 rounded w-2/3 mb-3"}),e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-neutral-800 rounded w-3/4"})]},n))});if(h)return e.jsx("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar KPIs de inventario"})});const l=a=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(a),i=a=>new Intl.NumberFormat("es-CL").format(a),m=[{title:"Cobertura de Stock",value:s?.stockCoverageDays!==null&&s?.stockCoverageDays!==void 0?`${s.stockCoverageDays.toFixed(1)} dÃ­as`:"N/A",subtitle:"DuraciÃ³n estimada del inventario",color:"text-blue-400",bgColor:"bg-blue-900/20",borderColor:"border-blue-800"},{title:"Ratio de RotaciÃ³n",value:s?.turnoverRatio?s.turnoverRatio.toFixed(2):"0.00",subtitle:"Veces por aÃ±o (anualizado)",color:"text-green-400",bgColor:"bg-green-900/20",borderColor:"border-green-800"},{title:"Stock Muerto",value:l(s?.deadStockValue||0),subtitle:`${s?.deadStockCount||0} productos sin movimiento >90 dÃ­as`,color:"text-orange-400",bgColor:"bg-orange-900/20",borderColor:"border-orange-800"},{title:"Tiempo de ReposiciÃ³n",value:`${s?.averageLeadTimeDays||0} dÃ­as`,subtitle:"Tiempo promedio de lead time",color:"text-purple-400",bgColor:"bg-purple-900/20",borderColor:"border-purple-800"},{title:"Stock CrÃ­tico",value:i(s?.criticalStockProducts||0),subtitle:"Productos bajo umbral",color:"text-red-400",bgColor:"bg-red-900/20",borderColor:"border-red-800"},{title:"Sobrestock",value:l(s?.overstockValue||0),subtitle:`${s?.overstockCount||0} productos excedidos`,color:"text-yellow-400",bgColor:"bg-yellow-900/20",borderColor:"border-yellow-800"}];return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map((a,n)=>e.jsxs("div",{className:`${a.bgColor} border ${a.borderColor} rounded-lg p-6 transition-all hover:scale-[1.02]`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-400",children:a.title}),e.jsx("div",{className:`w-10 h-10 rounded-lg ${a.bgColor} border ${a.borderColor} flex items-center justify-center`,children:e.jsx("span",{className:`text-xl ${a.color}`,children:"â—"})})]}),e.jsx("div",{className:`text-2xl font-bold ${a.color} mb-1`,children:a.value}),e.jsx("p",{className:"text-xs text-neutral-500",children:a.subtitle})]},n))})}function He(){const{data:s,isLoading:r,error:h}=w({queryKey:["stockMovementStats"],queryFn:we,refetchInterval:6e4});if(r)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-6"}),e.jsx("div",{className:"h-64 bg-neutral-800 rounded"})]});if(h)return e.jsx("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar estadÃ­sticas de movimiento"})});const l=a=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(a),i=a=>new Intl.NumberFormat("es-CL").format(a),m=[{name:"Entradas",valor:s?.totalInflows||0,transacciones:s?.inflowTransactions||0},{name:"Salidas",valor:s?.totalOutflows||0,transacciones:s?.outflowTransactions||0}];return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-2",children:"Resumen de Movimientos (Ãºltimos 30 dÃ­as)"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"AnÃ¡lisis de entradas y salidas de inventario"})]}),e.jsx("div",{className:"mb-8",children:e.jsx(_,{width:"100%",height:300,children:e.jsxs(Y,{data:m,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(X,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(Z,{dataKey:"name",stroke:"#a3a3a3"}),e.jsx(J,{stroke:"#a3a3a3",tickFormatter:a=>l(a)}),e.jsx(ee,{contentStyle:{backgroundColor:"#262626",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#f5f5f5"},formatter:a=>l(a)}),e.jsx(se,{}),e.jsx($,{dataKey:"valor",fill:"#3b82f6",name:"Valor Total",radius:[8,8,0,0]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Total Entradas"}),e.jsx("div",{className:"text-2xl font-bold text-green-400",children:l(s?.totalInflows||0)}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:[s?.inflowTransactions||0," transacciones"]})]}),e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Total Salidas"}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:l(s?.totalOutflows||0)}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:[s?.outflowTransactions||0," transacciones"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-neutral-300 mb-3",children:"Top 5 Entradas"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b border-neutral-800",children:e.jsxs("tr",{className:"text-left text-neutral-400",children:[e.jsx("th",{className:"pb-2 font-medium",children:"Producto"}),e.jsx("th",{className:"pb-2 font-medium text-right",children:"Cantidad"}),e.jsx("th",{className:"pb-2 font-medium text-right",children:"Valor"})]})}),e.jsx("tbody",{children:s?.topInflowProducts&&s.topInflowProducts.length>0?s.topInflowProducts.map((a,n)=>e.jsxs("tr",{className:"border-b border-neutral-800/50",children:[e.jsx("td",{className:"py-2 text-neutral-300",children:a.productName}),e.jsx("td",{className:"py-2 text-right text-neutral-400",children:i(a.quantity)}),e.jsx("td",{className:"py-2 text-right text-green-400",children:l(a.value)})]},n)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-4 text-center text-neutral-500",children:"Sin movimientos de entrada"})})})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-neutral-300 mb-3",children:"Top 5 Salidas"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b border-neutral-800",children:e.jsxs("tr",{className:"text-left text-neutral-400",children:[e.jsx("th",{className:"pb-2 font-medium",children:"Producto"}),e.jsx("th",{className:"pb-2 font-medium text-right",children:"Cantidad"}),e.jsx("th",{className:"pb-2 font-medium text-right",children:"Valor"})]})}),e.jsx("tbody",{children:s?.topOutflowProducts&&s.topOutflowProducts.length>0?s.topOutflowProducts.map((a,n)=>e.jsxs("tr",{className:"border-b border-neutral-800/50",children:[e.jsx("td",{className:"py-2 text-neutral-300",children:a.productName}),e.jsx("td",{className:"py-2 text-right text-neutral-400",children:i(a.quantity)}),e.jsx("td",{className:"py-2 text-right text-red-400",children:l(a.value)})]},n)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-4 text-center text-neutral-500",children:"Sin movimientos de salida"})})})]})})]})]})]})}function _e(){const{data:s,isLoading:r,error:h}=w({queryKey:["abcAnalysis"],queryFn:()=>W(),refetchInterval:3e5});if(r)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-6"}),e.jsx("div",{className:"h-80 bg-neutral-800 rounded"})]});if(h)return e.jsx("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar anÃ¡lisis ABC"})});if(!s||s.length===0)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-neutral-400",children:"No hay datos suficientes para anÃ¡lisis ABC"}),e.jsx("p",{className:"text-xs text-neutral-500 mt-2",children:"El anÃ¡lisis requiere productos con inventario valorizado"})]});const l=t=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),i=s.filter(t=>t.classification==="A"),m=s.filter(t=>t.classification==="B"),a=s.filter(t=>t.classification==="C"),n=i.reduce((t,g)=>t+g.totalValue,0),d=m.reduce((t,g)=>t+g.totalValue,0),c=a.reduce((t,g)=>t+g.totalValue,0),u=n+d+c,o=[{name:"Clase A",productos:i.length,valor:n,porcentaje:(n/u*100).toFixed(1)},{name:"Clase B",productos:m.length,valor:d,porcentaje:(d/u*100).toFixed(1)},{name:"Clase C",productos:a.length,valor:c,porcentaje:(c/u*100).toFixed(1)}],p={A:"#22c55e",B:"#eab308",C:"#f97316"};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-2",children:"AnÃ¡lisis ABC de Inventario"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"ClasificaciÃ³n por valor de inventario (Principio de Pareto 80-15-5)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-300",children:"Clase A"}),e.jsxs("span",{className:"px-2 py-1 bg-green-900/40 border border-green-800 rounded text-xs font-semibold text-green-400",children:[i.length," productos"]})]}),e.jsx("div",{className:"text-2xl font-bold text-green-400 mb-1",children:l(n)}),e.jsxs("div",{className:"text-xs text-neutral-400",children:[(n/u*100).toFixed(1),"% del valor total"]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-2",children:"Alta rotaciÃ³n - Control diario"})]}),e.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-300",children:"Clase B"}),e.jsxs("span",{className:"px-2 py-1 bg-yellow-900/40 border border-yellow-800 rounded text-xs font-semibold text-yellow-400",children:[m.length," productos"]})]}),e.jsx("div",{className:"text-2xl font-bold text-yellow-400 mb-1",children:l(d)}),e.jsxs("div",{className:"text-xs text-neutral-400",children:[(d/u*100).toFixed(1),"% del valor total"]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-2",children:"RotaciÃ³n media - Control semanal"})]}),e.jsxs("div",{className:"bg-orange-900/20 border border-orange-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-300",children:"Clase C"}),e.jsxs("span",{className:"px-2 py-1 bg-orange-900/40 border border-orange-800 rounded text-xs font-semibold text-orange-400",children:[a.length," productos"]})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-400 mb-1",children:l(c)}),e.jsxs("div",{className:"text-xs text-neutral-400",children:[(c/u*100).toFixed(1),"% del valor total"]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-2",children:"Baja rotaciÃ³n - Control mensual"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-neutral-300 mb-3",children:"DistribuciÃ³n de Valor por ClasificaciÃ³n"}),e.jsx(_,{width:"100%",height:300,children:e.jsxs(Y,{data:o,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(X,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(Z,{dataKey:"name",stroke:"#a3a3a3"}),e.jsx(J,{stroke:"#a3a3a3",tickFormatter:t=>l(t)}),e.jsx(ee,{contentStyle:{backgroundColor:"#262626",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#f5f5f5"},formatter:t=>l(t)}),e.jsx(se,{}),e.jsx($,{dataKey:"valor",name:"Valor Total",radius:[8,8,0,0],children:o.map((t,g)=>e.jsx(ie,{fill:g===0?p.A:g===1?p.B:p.C},`cell-${g}`))})]})})]}),e.jsx("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"Total Productos"}),e.jsx("div",{className:"text-lg font-semibold text-neutral-100",children:s.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"Valor Total Inventario"}),e.jsx("div",{className:"text-lg font-semibold text-neutral-100",children:l(u)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"ConcentraciÃ³n Clase A"}),e.jsxs("div",{className:"text-lg font-semibold text-green-400",children:[(i.length/s.length*100).toFixed(1),"% productos"]})]})]})})]})}function Ye(){const[s,r]=y.useState("all"),[h,l]=y.useState(""),[i,m]=y.useState(1),a=10,{data:n,isLoading:d,error:c}=w({queryKey:["abcAnalysis"],queryFn:()=>W(),refetchInterval:3e5});if(d)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((x,k)=>e.jsx("div",{className:"h-12 bg-neutral-800 rounded"},k))})]});if(c||!n)return e.jsx("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar productos"})});const u=x=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(x),o=x=>x?new Date(x).toLocaleDateString("es-CL"):"N/A",p=n.filter(x=>{const k=s==="all"||x.classification===s,N=x.productName.toLowerCase().includes(h.toLowerCase())||x.category.toLowerCase().includes(h.toLowerCase());return k&&N}),t=Math.ceil(p.length/a),g=(i-1)*a,f=g+a,j=p.slice(g,f),S=x=>{switch(x){case"A":return"bg-green-900/40 border-green-800 text-green-400";case"B":return"bg-yellow-900/40 border-yellow-800 text-yellow-400";case"C":return"bg-orange-900/40 border-orange-800 text-orange-400";default:return"bg-neutral-800 border-neutral-700 text-neutral-400"}};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-100 mb-4",children:"Productos por ClasificaciÃ³n ABC"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Buscar producto o categorÃ­a...",value:h,onChange:x=>{l(x.target.value),m(1)},className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-100 placeholder-neutral-500 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{r("all"),m(1)},className:`px-3 py-2 rounded-lg text-xs font-medium border transition-colors ${s==="all"?"bg-blue-900/40 border-blue-800 text-blue-400":"bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700"}`,children:["Todos (",n.length,")"]}),e.jsx("button",{onClick:()=>{r("A"),m(1)},className:`px-3 py-2 rounded-lg text-xs font-medium border transition-colors ${s==="A"?"bg-green-900/40 border-green-800 text-green-400":"bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700"}`,children:"Clase A"}),e.jsx("button",{onClick:()=>{r("B"),m(1)},className:`px-3 py-2 rounded-lg text-xs font-medium border transition-colors ${s==="B"?"bg-yellow-900/40 border-yellow-800 text-yellow-400":"bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700"}`,children:"Clase B"}),e.jsx("button",{onClick:()=>{r("C"),m(1)},className:`px-3 py-2 rounded-lg text-xs font-medium border transition-colors ${s==="C"?"bg-orange-900/40 border-orange-800 text-orange-400":"bg-neutral-800 border-neutral-700 text-neutral-400 hover:bg-neutral-700"}`,children:"Clase C"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b border-neutral-800",children:e.jsxs("tr",{className:"text-left text-neutral-400",children:[e.jsx("th",{className:"pb-3 font-medium",children:"Clase"}),e.jsx("th",{className:"pb-3 font-medium",children:"Producto"}),e.jsx("th",{className:"pb-3 font-medium",children:"CategorÃ­a"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"Valor Total"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"% del Total"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"Cantidad"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"Frecuencia"}),e.jsx("th",{className:"pb-3 font-medium text-right",children:"Ãšltima Mov."})]})}),e.jsx("tbody",{children:j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"py-8 text-center text-neutral-500",children:"No se encontraron productos"})}):j.map(x=>e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-800/30",children:[e.jsx("td",{className:"py-3",children:e.jsx("span",{className:`inline-flex px-2.5 py-1 rounded-md text-xs font-semibold border ${S(x.classification)}`,children:x.classification})}),e.jsx("td",{className:"py-3 text-neutral-100 font-medium",children:x.productName}),e.jsx("td",{className:"py-3 text-neutral-400",children:x.category}),e.jsx("td",{className:"py-3 text-right text-neutral-100 font-medium",children:u(x.totalValue)}),e.jsxs("td",{className:"py-3 text-right text-neutral-400",children:[x.percentageOfTotalValue.toFixed(2),"%"]}),e.jsx("td",{className:"py-3 text-right text-neutral-400",children:x.totalQuantity.toLocaleString("es-CL")}),e.jsx("td",{className:"py-3 text-right text-neutral-400",children:x.salesFrequency}),e.jsx("td",{className:"py-3 text-right text-neutral-400 text-xs",children:o(x.lastMovementDate)})]},x.productId))})]})}),t>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-neutral-500",children:["Mostrando ",g+1,"-",Math.min(f,p.length)," de"," ",p.length," productos"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(x=>Math.max(1,x-1)),disabled:i===1,className:"px-3 py-1 bg-neutral-800 border border-neutral-700 rounded text-xs text-neutral-400 hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsxs("span",{className:"px-3 py-1 text-xs text-neutral-400",children:["PÃ¡gina ",i," de ",t]}),e.jsx("button",{onClick:()=>m(x=>Math.min(t,x+1)),disabled:i===t,className:"px-3 py-1 bg-neutral-800 border border-neutral-700 rounded text-xs text-neutral-400 hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"})]})]})]})}function Xe(){const{data:s,isLoading:r}=w({queryKey:["abcAnalysis"],queryFn:()=>W(),refetchInterval:3e5});if(r)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-2/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((a,n)=>e.jsx("div",{className:"h-24 bg-neutral-800 rounded"},n))})]});const h=s?.filter(a=>a.classification==="A")||[],l=s?.filter(a=>a.classification==="B")||[],i=s?.filter(a=>a.classification==="C")||[],m=[{classification:"A",title:"Productos Clase A - Alta Prioridad",color:"green",bgColor:"bg-green-900/20",borderColor:"border-green-800",textColor:"text-green-400",count:h.length,strategies:[{icon:"ðŸ“Š",title:"Monitoreo Continuo",description:"Control diario de niveles de inventario y rotaciÃ³n"},{icon:"ðŸŽ¯",title:"Stock Ã“ptimo",description:"Mantener niveles Ã³ptimos para evitar quiebres"},{icon:"ðŸ”„",title:"ReposiciÃ³n Frecuente",description:"RevisiÃ³n y pedidos cada 1-3 dÃ­as segÃºn demanda"},{icon:"ðŸ“ˆ",title:"PrevisiÃ³n Exacta",description:"Usar modelos de forecasting para proyectar demanda"}]},{classification:"B",title:"Productos Clase B - Prioridad Media",color:"yellow",bgColor:"bg-yellow-900/20",borderColor:"border-yellow-800",textColor:"text-yellow-400",count:l.length,strategies:[{icon:"ðŸ“…",title:"Control Semanal",description:"RevisiÃ³n de inventario cada 5-7 dÃ­as"},{icon:"âš–ï¸",title:"Stock Balanceado",description:"Mantener inventario moderado sin excesos"},{icon:"ðŸ””",title:"Alertas AutomÃ¡ticas",description:"Configurar notificaciones de stock bajo"},{icon:"ðŸ“Š",title:"AnÃ¡lisis Trimestral",description:"Evaluar tendencias y ajustar polÃ­ticas"}]},{classification:"C",title:"Productos Clase C - Baja Prioridad",color:"orange",bgColor:"bg-orange-900/20",borderColor:"border-orange-800",textColor:"text-orange-400",count:i.length,strategies:[{icon:"ðŸ“†",title:"RevisiÃ³n Mensual",description:"Control bÃ¡sico mensual o bimestral"},{icon:"ðŸ“‰",title:"Minimizar Inventario",description:"Reducir stock al mÃ­nimo necesario"},{icon:"ðŸ”",title:"Evaluar DescontinuaciÃ³n",description:"Considerar eliminar productos de baja rotaciÃ³n"},{icon:"ðŸ’¡",title:"Pedidos por Demanda",description:"Comprar solo cuando hay orden confirmada"}]}];return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-100 mb-2",children:"Estrategias de GestiÃ³n por ClasificaciÃ³n"}),e.jsx("p",{className:"text-xs text-neutral-400",children:"Recomendaciones operativas basadas en el anÃ¡lisis ABC"})]}),e.jsx("div",{className:"space-y-4",children:m.map(a=>e.jsxs("div",{className:`${a.bgColor} border ${a.borderColor} rounded-lg p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:`text-sm font-semibold ${a.textColor}`,children:a.title}),e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-semibold ${a.bgColor} border ${a.borderColor} ${a.textColor}`,children:[a.count," productos"]})]}),e.jsx("div",{className:"space-y-2",children:a.strategies.map((n,d)=>e.jsxs("div",{className:"flex items-start gap-3 bg-neutral-900/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xl flex-shrink-0",children:n.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-neutral-200 mb-1",children:n.title}),e.jsx("div",{className:"text-xs text-neutral-400",children:n.description})]})]},d))})]},a.classification))}),e.jsx("div",{className:"mt-6 bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ’¡"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-400 mb-2",children:"Mejores PrÃ¡cticas"}),e.jsxs("ul",{className:"text-xs text-neutral-300 space-y-1",children:[e.jsx("li",{children:"â€¢ Concentrar esfuerzos en productos Clase A (80% del valor)"}),e.jsx("li",{children:"â€¢ Automatizar controles para productos Clase B"}),e.jsx("li",{children:"â€¢ Simplificar gestiÃ³n de productos Clase C"}),e.jsx("li",{children:"â€¢ Revisar clasificaciÃ³n ABC cada 3-6 meses"}),e.jsx("li",{children:"â€¢ Ajustar estrategias segÃºn estacionalidad"})]})]})]})})]})}function Ze(){const{data:s,isLoading:r,error:h}=w({queryKey:["forecastAnalysis"],queryFn:()=>G(),refetchInterval:3e5});if(r)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-neutral-800 rounded"})]});if(h)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("p",{className:"text-red-400",children:["Error al cargar pronÃ³sticos: ",String(h)]})});if(!s||s.length===0)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-neutral-400",children:"No hay datos suficientes para generar pronÃ³sticos"})});const l=s.length,i=s.filter(t=>t.stockStatus==="understocked").length,m=s.filter(t=>t.stockStatus==="overstocked").length,a=s.filter(t=>t.stockStatus==="optimal").length,n=s.reduce((t,g)=>t+g.predictedDemand,0),d=s.reduce((t,g)=>t+g.currentStock,0),c=s.reduce((t,g)=>t+g.recommendedOrderQty,0),u=s.reduce((t,g)=>t+g.confidence,0)/l,o=s.slice(0,10).map(t=>({name:t.productName.length>20?t.productName.substring(0,20)+"...":t.productName,demandaPredicha:t.predictedDemand,stockActual:t.currentStock,status:t.stockStatus})),p=t=>{switch(t){case"understocked":return"#ef4444";case"overstocked":return"#f97316";case"optimal":return"#22c55e";default:return"#6b7280"}};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"ðŸ“ˆ PronÃ³stico de Demanda (PrÃ³ximos 30 dÃ­as)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Productos Analizados"}),e.jsx("div",{className:"text-2xl font-bold text-white mt-1",children:l})]}),e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-400",children:"Stock Bajo"}),e.jsx("div",{className:"text-2xl font-bold text-red-400 mt-1",children:i}),e.jsx("div",{className:"text-xs text-red-500 mt-1",children:"Requieren reposiciÃ³n"})]}),e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-400",children:"Stock Ã“ptimo"}),e.jsx("div",{className:"text-2xl font-bold text-green-400 mt-1",children:a}),e.jsx("div",{className:"text-xs text-green-500 mt-1",children:"Niveles adecuados"})]}),e.jsxs("div",{className:"bg-orange-900/20 border border-orange-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-orange-400",children:"Sobre-stock"}),e.jsx("div",{className:"text-2xl font-bold text-orange-400 mt-1",children:m}),e.jsx("div",{className:"text-xs text-orange-500 mt-1",children:"Exceso de inventario"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Demanda Predicha Total"}),e.jsxs("div",{className:"text-xl font-bold text-white mt-1",children:[n.toFixed(0)," unidades"]})]}),e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Stock Actual Total"}),e.jsxs("div",{className:"text-xl font-bold text-white mt-1",children:[d.toFixed(0)," unidades"]})]}),e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Orden Recomendada Total"}),e.jsxs("div",{className:"text-xl font-bold text-blue-400 mt-1",children:[c.toFixed(0)," unidades"]})]})]}),e.jsxs("div",{className:"bg-neutral-800/30 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"Top 10 Productos: Demanda Predicha vs Stock Actual"}),e.jsx(_,{width:"100%",height:400,children:e.jsxs(Y,{data:o,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(X,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(Z,{dataKey:"name",angle:-45,textAnchor:"end",height:100,stroke:"#a3a3a3",style:{fontSize:"12px"}}),e.jsx(J,{stroke:"#a3a3a3"}),e.jsx(ee,{contentStyle:{backgroundColor:"#262626",border:"1px solid #404040",borderRadius:"8px"},labelStyle:{color:"#fff"}}),e.jsx(se,{wrapperStyle:{paddingTop:"20px"},iconType:"circle"}),e.jsx($,{dataKey:"demandaPredicha",name:"Demanda Predicha",fill:"#3b82f6"}),e.jsx($,{dataKey:"stockActual",name:"Stock Actual",children:o.map((t,g)=>e.jsx(ie,{fill:p(t.status)},`cell-${g}`))})]})})]}),e.jsx("div",{className:"bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-blue-400",children:"Confianza Promedio del Modelo"}),e.jsx("div",{className:"text-xs text-neutral-400 mt-1",children:"Basado en historial de 90 dÃ­as"})]}),e.jsxs("div",{className:"text-3xl font-bold text-blue-400",children:[u.toFixed(0),"%"]})]})})]})}function Je(){const[s,r]=y.useState("all"),[h,l]=y.useState("all"),[i,m]=y.useState(""),[a,n]=y.useState(1),d=10,{data:c,isLoading:u,error:o}=w({queryKey:["forecastAnalysis"],queryFn:()=>G(),refetchInterval:300*1e3});if(u)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-96 bg-neutral-800 rounded"})]});if(o)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar pronÃ³sticos"})});if(!c||c.length===0)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-neutral-400",children:"No hay pronÃ³sticos disponibles"})});const p=c.filter(x=>{const k=s==="all"||x.stockStatus===s,N=h==="all"||x.trend===h,v=x.productName.toLowerCase().includes(i.toLowerCase())||x.category.toLowerCase().includes(i.toLowerCase());return k&&N&&v}),t=Math.ceil(p.length/d),g=(a-1)*d,f=p.slice(g,g+d),j=x=>{switch(x){case"understocked":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-red-900/40 border border-red-800 text-red-400",children:"Stock Bajo"});case"overstocked":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-orange-900/40 border border-orange-800 text-orange-400",children:"Sobre-stock"});case"optimal":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-900/40 border border-green-800 text-green-400",children:"Ã“ptimo"});default:return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-neutral-800 border border-neutral-700 text-neutral-400",children:x})}},S=x=>{switch(x){case"increasing":return e.jsx("span",{className:"text-green-400",children:"â†—ï¸ Creciente"});case"decreasing":return e.jsx("span",{className:"text-red-400",children:"â†˜ï¸ Decreciente"});case"stable":return e.jsx("span",{className:"text-blue-400",children:"â†’ Estable"});default:return e.jsx("span",{className:"text-neutral-400",children:x})}};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"ðŸŽ¯ Tabla de PronÃ³sticos"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r("all"),className:`px-3 py-1.5 text-sm rounded-lg border transition ${s==="all"?"bg-blue-600 border-blue-500 text-white":"bg-neutral-800 border-neutral-700 text-neutral-300 hover:bg-neutral-700"}`,children:"Todos"}),e.jsx("button",{onClick:()=>r("understocked"),className:`px-3 py-1.5 text-sm rounded-lg border transition ${s==="understocked"?"bg-red-600 border-red-500 text-white":"bg-neutral-800 border-neutral-700 text-neutral-300 hover:bg-neutral-700"}`,children:"Stock Bajo"}),e.jsx("button",{onClick:()=>r("optimal"),className:`px-3 py-1.5 text-sm rounded-lg border transition ${s==="optimal"?"bg-green-600 border-green-500 text-white":"bg-neutral-800 border-neutral-700 text-neutral-300 hover:bg-neutral-700"}`,children:"Ã“ptimo"}),e.jsx("button",{onClick:()=>r("overstocked"),className:`px-3 py-1.5 text-sm rounded-lg border transition ${s==="overstocked"?"bg-orange-600 border-orange-500 text-white":"bg-neutral-800 border-neutral-700 text-neutral-300 hover:bg-neutral-700"}`,children:"Sobre-stock"})]}),e.jsx("input",{type:"text",placeholder:"Buscar producto o categorÃ­a...",value:i,onChange:x=>{m(x.target.value),n(1)},className:"flex-1 px-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white placeholder-neutral-500 focus:outline-none focus:border-blue-500"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-neutral-400",children:"Estado"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-neutral-400",children:"Producto"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-neutral-400",children:"CategorÃ­a"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"Stock Actual"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"Demanda (30d)"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"DÃ­as Stock"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-neutral-400",children:"Tendencia"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"Orden Recomendada"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-neutral-400",children:"Confianza"})]})}),e.jsx("tbody",{children:f.map((x,k)=>e.jsxs("tr",{className:"border-b border-neutral-800 hover:bg-neutral-800/30 transition",children:[e.jsx("td",{className:"p-3",children:j(x.stockStatus)}),e.jsx("td",{className:"p-3 text-white font-medium",children:x.productName}),e.jsx("td",{className:"p-3 text-neutral-300",children:x.category}),e.jsx("td",{className:"p-3 text-right text-white",children:x.currentStock.toFixed(0)}),e.jsx("td",{className:"p-3 text-right text-blue-400 font-semibold",children:x.predictedDemand.toFixed(0)}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("span",{className:x.daysOfStock<15?"text-red-400 font-semibold":x.daysOfStock>60?"text-orange-400":"text-green-400",children:[x.daysOfStock," dÃ­as"]})}),e.jsx("td",{className:"p-3 text-center text-sm",children:S(x.trend)}),e.jsx("td",{className:"p-3 text-right",children:x.recommendedOrderQty>0?e.jsx("span",{className:"text-yellow-400 font-semibold",children:x.recommendedOrderQty.toFixed(0)}):e.jsx("span",{className:"text-neutral-500",children:"-"})}),e.jsxs("td",{className:"p-3 text-right text-neutral-400",children:[x.confidence.toFixed(0),"%"]})]},k))})]})}),t>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"text-sm text-neutral-400",children:["Mostrando ",g+1,"-",Math.min(g+d,p.length)," de"," ",p.length]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>n(x=>Math.max(1,x-1)),disabled:a===1,className:"px-3 py-1.5 text-sm bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsxs("span",{className:"px-3 py-1.5 text-sm text-neutral-300",children:["PÃ¡gina ",a," de ",t]}),e.jsx("button",{onClick:()=>n(x=>Math.min(t,x+1)),disabled:a===t,className:"px-3 py-1.5 text-sm bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-300 hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"})]})]}),p.length===0&&e.jsx("div",{className:"text-center py-8 text-neutral-400",children:"No se encontraron pronÃ³sticos con los filtros aplicados"})]})}function es(){const{data:s,isLoading:r}=w({queryKey:["forecastAnalysis"],queryFn:()=>G(),refetchInterval:3e5});if(r)return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-20 bg-neutral-800 rounded"}),e.jsx("div",{className:"h-20 bg-neutral-800 rounded"}),e.jsx("div",{className:"h-20 bg-neutral-800 rounded"})]})]});if(!s||s.length===0)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-neutral-400",children:"No hay recomendaciones disponibles"})});const h=s.filter(a=>a.stockStatus==="understocked").sort((a,n)=>a.daysOfStock-n.daysOfStock).slice(0,5),l=s.filter(a=>a.trend==="increasing").sort((a,n)=>n.predictedDemand-a.predictedDemand).slice(0,3),i=s.filter(a=>a.stockStatus==="overstocked").sort((a,n)=>n.daysOfStock-a.daysOfStock).slice(0,3),m=s.filter(a=>a.recommendedOrderQty>0).reduce((a,n)=>a+n.recommendedOrderQty,0);return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"ðŸ’¡ Recomendaciones EstratÃ©gicas"}),h.length>0&&e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸš¨"}),e.jsx("h4",{className:"text-lg font-semibold text-red-400",children:"AcciÃ³n Urgente Requerida"})]}),e.jsx("div",{className:"space-y-2",children:h.map((a,n)=>e.jsx("div",{className:"bg-neutral-900/50 rounded-lg p-3 border border-red-800/30",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:a.productName}),e.jsxs("div",{className:"text-sm text-red-400 mt-1",children:["Stock actual: ",a.currentStock.toFixed(0)," unidades (",a.daysOfStock," dÃ­as)"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Ordenar"}),e.jsxs("div",{className:"text-lg font-bold text-yellow-400",children:[a.recommendedOrderQty.toFixed(0)," unidades"]})]})]})},n))}),e.jsx("div",{className:"pt-2 border-t border-red-800/30",children:e.jsx("div",{className:"text-sm text-red-300",children:"âš ï¸ Estos productos necesitan reposiciÃ³n inmediata para evitar quiebres de stock"})})]}),l.length>0&&e.jsxs("div",{className:"bg-green-900/20 border border-green-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“ˆ"}),e.jsx("h4",{className:"text-lg font-semibold text-green-400",children:"Productos con Demanda Creciente"})]}),e.jsx("div",{className:"space-y-2",children:l.map((a,n)=>e.jsxs("div",{className:"flex justify-between items-center bg-neutral-900/50 rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:a.productName}),e.jsxs("div",{className:"text-sm text-green-400 mt-1",children:["Demanda predicha: ",a.predictedDemand.toFixed(0)," unidades (â†—ï¸ Aumentando)"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Promedio diario"}),e.jsx("div",{className:"text-white font-semibold",children:a.historicalAverage.toFixed(1)})]})]},n))}),e.jsx("div",{className:"pt-2 border-t border-green-800/30",children:e.jsx("div",{className:"text-sm text-green-300",children:"ðŸ’¡ Considere aumentar niveles de stock de seguridad para estos productos"})})]}),i.length>0&&e.jsxs("div",{className:"bg-orange-900/20 border border-orange-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"âš ï¸"}),e.jsx("h4",{className:"text-lg font-semibold text-orange-400",children:"OptimizaciÃ³n de Inventario"})]}),e.jsx("div",{className:"space-y-2",children:i.map((a,n)=>e.jsxs("div",{className:"flex justify-between items-center bg-neutral-900/50 rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:a.productName}),e.jsxs("div",{className:"text-sm text-orange-400 mt-1",children:["Stock excesivo: ",a.daysOfStock," dÃ­as de inventario"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-neutral-400",children:"Stock actual"}),e.jsx("div",{className:"text-white font-semibold",children:a.currentStock.toFixed(0)})]})]},n))}),e.jsx("div",{className:"pt-2 border-t border-orange-800/30",children:e.jsx("div",{className:"text-sm text-orange-300",children:"ðŸ’¡ EvalÃºe promociones o redistribuciÃ³n para optimizar capital de trabajo"})})]}),m>0&&e.jsx("div",{className:"bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ›’"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-blue-400",children:"Orden de Compra Sugerida"}),e.jsx("div",{className:"text-sm text-neutral-400 mt-1",children:"Total de unidades a ordenar"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-400",children:m.toFixed(0)}),e.jsx("div",{className:"text-sm text-neutral-400",children:"unidades"})]})]})}),e.jsxs("div",{className:"bg-neutral-800/50 border border-neutral-700 rounded-lg p-4 space-y-2",children:[e.jsxs("h4",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“‹"}),"Mejores PrÃ¡cticas de GestiÃ³n Predictiva"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-neutral-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Revisar pronÃ³sticos semanalmente para ajustar niveles de stock"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Priorizar reposiciÃ³n de productos con menos de 15 dÃ­as de inventario"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Considerar estacionalidad y eventos especiales en planificaciÃ³n"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Validar precisiÃ³n del modelo comparando pronÃ³sticos con demanda real"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Optimizar frecuencia de pedidos para productos de alta rotaciÃ³n"})]})]})]})]})}const ne=10;function ss(s){const r=Number(s);return Number.isFinite(r)?`$${r.toLocaleString("es-CL",{maximumFractionDigits:0})}`:"$0"}function ds(){const s=K(),r=Fe(),[h,l]=y.useState(!1),[i,m]=y.useState(!1),[a,n]=y.useState(null),[d,c]=y.useState(null),[u,o]=y.useState(""),p=w({queryKey:["products",{view:"inventory"}],queryFn:()=>D({size:200,status:"all"})}),t=w({queryKey:["inventory","settings"],queryFn:Pe});y.useEffect(()=>{if(t.data){const C=Number(t.data.lowStockThreshold??0);if(Number.isFinite(C)&&C>0){d===null&&c(C),o(F=>F||String(C));return}}!t.isLoading&&d===null&&(c(ne),o(String(ne)))},[t.data,t.isLoading,d]);const g=w({queryKey:["inventory","summary"],queryFn:V}),f=w({queryKey:["inventory","alerts",d],enabled:d!==null,queryFn:()=>Ae(d??void 0)}),j=L({mutationFn:C=>ke({lowStockThreshold:C}),onSuccess:C=>{const F=Number(C.lowStockThreshold??0);Number.isFinite(F)&&F>0&&(c(F),o(String(F))),s.invalidateQueries({queryKey:["inventory","summary"]}),s.invalidateQueries({queryKey:["inventory","alerts"]}),s.setQueryData(["inventory","settings"],C)}}),S=()=>{const C=Number(u);if(!Number.isFinite(C)||C<=0){window.alert("Ingresa un umbral mayor a cero");return}j.mutate(C)},x=()=>{s.invalidateQueries({queryKey:["inventory","summary"]}),s.invalidateQueries({queryKey:["inventory","alerts"]}),s.invalidateQueries({queryKey:["products"],exact:!1}),l(!1)},k=y.useMemo(()=>new Map((p.data?.content??[]).map(C=>[C.id,C])),[p.data]),N=g.data;ss(N?.totalValue??0);const v=N?.activeProducts??0,A=N?.lowStockAlerts??f.data?.length??0;N?.lowStockThreshold??d??Number(u||0);const b=C=>{m(!1),n(C)},P=()=>{n(null)};return e.jsxs("div",{className:"page-section",children:[e.jsx(Le,{title:"Inventario",description:"Visibiliza catÃ¡logo, lotes y alertas de stock para garantizar disponibilidad.",actions:e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:"btn ghost",onClick:()=>r("/app/inventory/movements"),children:"ðŸ“‹ Ver movimientos"}),e.jsx("button",{className:"btn ghost",onClick:()=>m(!0),children:"ðŸ“¦ CatÃ¡logo de productos"}),e.jsx("button",{className:"btn",onClick:()=>l(!0),children:"+ Ajuste de stock"})]})}),!g.isLoading&&e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[A>5&&e.jsxs("div",{className:"bg-red-950 border border-red-800 rounded-lg p-3 text-red-400 text-sm",children:["ðŸ”´ ",e.jsx("strong",{children:"CrÃ­tico:"})," ",A," productos con stock bajo - requiere atenciÃ³n inmediata"]}),v===0&&e.jsxs("div",{className:"bg-yellow-950 border border-yellow-800 rounded-lg p-3 text-yellow-400 text-sm",children:["âš ï¸ ",e.jsx("strong",{children:"Advertencia:"})," No hay productos activos en el inventario"]})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"ðŸ“Š KPIs de Inventario"}),e.jsx(Ge,{})]}),e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsx(He,{})}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"ðŸŽ¯ AnÃ¡lisis ABC de Inventario"}),e.jsx("div",{style:{marginBottom:"1.5rem"},children:e.jsx(_e,{})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsx(Ye,{}),e.jsx(Xe,{})]})]}),e.jsxs("div",{style:{marginBottom:"2rem",marginTop:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.5rem",fontWeight:"600",marginBottom:"1rem"},children:"ðŸ“ˆ PronÃ³stico de Demanda e Inteligencia Predictiva"}),e.jsx("div",{style:{marginBottom:"1.25rem"},children:e.jsx(Ze,{})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsx(Je,{}),e.jsx(es,{})]})]}),e.jsxs("section",{className:"responsive-grid",children:[e.jsx("div",{className:"card",children:e.jsx(Ie,{})}),e.jsx("div",{className:"card",children:e.jsx(Ee,{})})]}),e.jsxs("div",{style:{marginBottom:"2rem",marginTop:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"ðŸ“Š AnÃ¡lisis de Inventario"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsx(Qe,{}),e.jsx(Ue,{})]})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{className:"text-neutral-100",style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"âš™ï¸ GestiÃ³n Operativa"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-5",children:[e.jsx(Ve,{}),e.jsx(We,{})]})]}),e.jsx("section",{className:"responsive-grid",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 table-card",children:[e.jsx("h3",{className:"text-neutral-100",children:"Lotes con stock crÃ­tico"}),e.jsxs("div",{className:"inline-actions",style:{marginBottom:"0.75rem"},children:[e.jsx("label",{className:"muted small text-neutral-400",htmlFor:"low-stock-threshold",children:"Umbral"}),e.jsx("input",{id:"low-stock-threshold",className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"number",step:"0.1",min:"0.1",value:u,onChange:C=>o(C.target.value),disabled:j.isPending}),e.jsx("button",{className:"btn",type:"button",onClick:S,disabled:j.isPending,children:j.isPending?"Guardando...":"Guardar"})]}),j.isError&&e.jsx("p",{className:"error",children:j.error?.message??"No se pudo actualizar el umbral"}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Lote"}),e.jsx("th",{children:"Disponible"}),e.jsx("th",{children:"Expira"}),e.jsx("th",{children:"Creado"}),e.jsx("th",{children:"AcciÃ³n"})]})}),e.jsxs("tbody",{children:[f.isLoading&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"muted text-neutral-400",children:"Cargando alertas..."})}),f.isError&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"error text-red-400",children:f.error?.message??"No se pudieron obtener alertas"})}),!f.isLoading&&!f.isError&&(f.data??[]).map(C=>{const F=k.get(C.productId),I=Number(C.qtyAvailable),T=d??10,M=I<5||I<T*.1,te=I>=5&&I<=T,B=C.expDate?new Date(C.expDate):null,oe=new Date,E=B?Math.floor((B.getTime()-oe.getTime())/(1e3*60*60*24)):null,z=E!==null&&E<=30&&E>=0,O=E!==null&&E<0,Q=M?{icon:"ðŸ”´",label:"CrÃ­tico",className:"bg-red-950 text-red-400 border-red-800"}:te?{icon:"ðŸŸ¡",label:"Bajo",className:"bg-yellow-950 text-yellow-400 border-yellow-800"}:{icon:"ðŸŸ¢",label:"Normal",className:"bg-green-950 text-green-400 border-green-800"};return e.jsxs("tr",{className:O?"bg-red-950/20":z?"bg-yellow-950/20":"",children:[e.jsx("td",{children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-medium border ${Q.className}`,children:[e.jsx("span",{children:Q.icon}),e.jsx("span",{children:Q.label})]})}),e.jsx("td",{className:"text-neutral-100",children:F?.name??C.productId}),e.jsx("td",{className:"mono text-neutral-300",children:C.lotId}),e.jsx("td",{className:`mono font-semibold ${M?"text-red-400":te?"text-yellow-400":"text-neutral-100"}`,children:I.toFixed(2)}),e.jsxs("td",{className:`mono ${O?"text-red-400 font-semibold":z?"text-yellow-400 font-semibold":"text-neutral-300"}`,children:[B?B.toLocaleDateString():"-",O&&e.jsx("span",{className:"ml-2",children:"âŒ Vencido"}),z&&!O&&e.jsxs("span",{className:"ml-2",children:["âš ï¸ ",E,"d"]})]}),e.jsx("td",{className:"mono small text-neutral-400",children:new Date(C.createdAt).toLocaleDateString()}),e.jsx("td",{children:e.jsx("button",{className:"btn ghost text-xs",type:"button",onClick:()=>{l(!0)},title:"Reabastecimiento rÃ¡pido",children:"+ Stock"})})]},C.lotId)}),!f.isLoading&&!f.isError&&(f.data??[]).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"muted text-neutral-400 text-center py-8",children:"âœ… Sin alertas de stock crÃ­tico"})})]})]})})]})}),e.jsx(ze,{}),e.jsx(De,{open:h,onClose:()=>l(!1),onApplied:x}),e.jsx(Me,{open:i,onClose:()=>m(!1),onSelectProduct:b}),e.jsx($e,{open:!!a,product:a,onClose:P})]})}export{ds as default};
