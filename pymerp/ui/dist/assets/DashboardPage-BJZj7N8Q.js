import{j as e,f as y,l as N,u as f,c as v,a as g,b,d as C}from"./index-BpLAP759.js";import{r as x}from"./react-BYfE7jJl.js";import{u as m,a as k}from"./useMutation-CPedeap3.js";import{P as S}from"./PageHeader-ECmiVUlh.js";import{P as F}from"./ProductsCard-CySb5dUk.js";import{S as q}from"./SuppliersCard-CJRD9MtR.js";import{C as A}from"./CustomersCard-BqHaGf9V.js";import{R as P,A as D,C as R,X as K,Y as $,T as L,a as E}from"./charts-CrTcgEid.js";import"./Modal-Bq1-hS2x.js";function Q(){const{data:i,isLoading:a,isError:t,error:c,refetch:r,isFetching:o}=m({queryKey:["health"],queryFn:y,refetchOnWindowFocus:!1});return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Health"}),e.jsx("button",{className:"btn-link",onClick:()=>r(),disabled:o,children:o?"Refreshing...":"Refresh"})]}),a&&e.jsx("p",{children:"Loading..."}),t&&e.jsx("p",{className:"error",children:c?.message??"Health check failed"}),!a&&!t&&i&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Status:"," ",e.jsx("span",{className:i.status==="UP"?"ok":"error",children:i.status})]}),e.jsx("pre",{className:"json",children:JSON.stringify(i,null,2)})]})]})}function w({onSelect:i}){const{data:a,isLoading:t,isError:c,error:r,refetch:o,isFetching:n}=m({queryKey:["companies"],queryFn:N,refetchOnWindowFocus:!1});return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Companies"}),e.jsx("button",{className:"btn-link",onClick:()=>o(),disabled:n,children:n?"Refreshing...":"Refresh"})]}),e.jsxs("div",{className:"card-body",children:[t&&e.jsx("p",{children:"Loading..."}),c&&e.jsx("p",{className:"error",children:r?.message??"Could not load companies"}),!t&&!c&&a&&a.length===0&&e.jsx("p",{className:"muted",children:"No companies yet."}),!t&&!c&&a&&a.length>0&&e.jsx("ul",{className:"list",children:a.map(d=>e.jsxs("li",{onClick:()=>i?.(d),children:[e.jsx("strong",{children:d.name}),d.rut?e.jsxs("span",{className:"mono",children:[" rut ",d.rut]}):null,e.jsx("div",{className:"mono small",children:d.id})]},d.id))})]})]})}function M({onCreated:i}){const[a,t]=x.useState({name:"",rut:""}),[c,r]=x.useState(null),[o,n]=x.useState(null),d=f(),s=k({mutationFn:v,onSuccess:()=>{d.invalidateQueries({queryKey:["companies"],exact:!1}),t({name:"",rut:""}),r("Company created"),n(null),i?.()},onError:l=>{n(l.message??"Could not create company"),r(null)}}),u=l=>{l.preventDefault(),r(null),n(null);const h=a.name?.trim();if(!h){n("Name is required");return}s.mutate({name:h,rut:a.rut?.trim()||void 0})};return e.jsxs("div",{className:"card",children:[e.jsx("h2",{children:"New company"}),e.jsxs("form",{onSubmit:u,className:"form-grid",children:[e.jsxs("label",{children:[e.jsx("span",{children:"Name *"}),e.jsx("input",{value:a.name,onChange:l=>t(h=>({...h,name:l.target.value})),placeholder:"Dev Company",className:"input"})]}),e.jsxs("label",{children:[e.jsx("span",{children:"RUT"}),e.jsx("input",{value:a.rut??"",onChange:l=>t(h=>({...h,rut:l.target.value})),placeholder:"76.000.000-0",className:"input"})]}),e.jsxs("div",{className:"buttons",children:[e.jsx("button",{className:"btn",disabled:s.isPending,type:"submit",children:s.isPending?"Saving...":"Create"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>{t({name:"",rut:""}),r(null),n(null)},children:"Clear"})]}),o&&e.jsx("p",{className:"error",children:o}),c&&e.jsx("p",{className:"success",children:c})]})]})}function Y(){const i=m({queryKey:["companies"],queryFn:N}),a=m({queryKey:["sales","dashboard"],queryFn:()=>g(14)}),t=m({queryKey:["inventory","alerts",{dashboard:!0}],queryFn:()=>b(5)}),c=m({queryKey:["products",{dashboard:!0}],queryFn:()=>C({size:200})}),r=x.useMemo(()=>{const s=a.data??[],u=s.reduce((j,p)=>j+Number(p.total),0),l=s.reduce((j,p)=>j+p.count,0),h=s.length?u/s.length:0;return{total:u,docs:l,avg:h}},[a.data]),o=x.useMemo(()=>(a.data??[]).map(s=>({date:s.date,total:Number(s.total)})),[a.data]),n=t.data??[],d=[{title:"Empresas",value:i.data?.length??0,trend:"Multi-tenant"},{title:"Ventas 14d",value:`$${r.total.toLocaleString()}`,trend:`${r.docs} documentos`},{title:"Ticket diario",value:`$${r.avg.toFixed(0)}`,trend:"Promedio 14 d�as"},{title:"Alertas stock",value:n.length,trend:"Umbral configurado"}];return e.jsxs("div",{className:"dashboard",children:[e.jsx(S,{title:"Resumen ejecutivo",description:"Monitorea indicadores clave, salud del sistema y cat�logos recientes."}),e.jsx("section",{className:"kpi-grid",children:d.map(s=>e.jsxs("div",{className:"card stat",children:[e.jsx("h3",{children:s.title}),e.jsx("p",{className:"stat-value",children:s.value}),e.jsx("span",{className:"stat-trend",children:s.trend})]},s.title))}),e.jsxs("section",{className:"card",children:[e.jsx("h3",{children:"Tendencia de ventas (14 d�as)"}),e.jsx("div",{style:{height:260},children:e.jsx(P,{width:"100%",height:"100%",children:e.jsxs(D,{data:o,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"dashboardSales",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#60a5fa",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#60a5fa",stopOpacity:0})]})}),e.jsx(R,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx(K,{dataKey:"date",stroke:"#9aa0a6",tick:{fontSize:12}}),e.jsx($,{stroke:"#9aa0a6",tickFormatter:s=>`$${(s/1e3).toFixed(0)}k`}),e.jsx(L,{formatter:s=>`$${s.toLocaleString()}`}),e.jsx(E,{type:"monotone",dataKey:"total",stroke:"#60a5fa",fill:"url(#dashboardSales)"})]})})})]}),e.jsxs("section",{className:"responsive-grid",children:[e.jsx("div",{className:"card stretch",children:e.jsx(Q,{})}),e.jsx("div",{className:"card",children:e.jsx(w,{})}),e.jsx("div",{className:"card",children:e.jsx(M,{})})]}),e.jsxs("section",{className:"responsive-grid large",children:[e.jsx("div",{className:"card",children:e.jsx(F,{})}),e.jsx("div",{className:"card",children:e.jsx(q,{})}),e.jsx("div",{className:"card",children:e.jsx(A,{})})]}),e.jsxs("section",{className:"card table-card",children:[e.jsx("h3",{children:"Alertas de inventario"}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Lote"}),e.jsx("th",{children:"Disponible"}),e.jsx("th",{children:"Registrado"})]})}),e.jsxs("tbody",{children:[n.map(s=>{const u=c.data?.content.find(l=>l.id===s.productId);return e.jsxs("tr",{children:[e.jsx("td",{children:u?.name??s.productId}),e.jsx("td",{className:"mono",children:s.lotId}),e.jsx("td",{className:"mono",children:Number(s.qtyAvailable).toFixed(2)}),e.jsx("td",{className:"mono small",children:new Date(s.createdAt).toLocaleDateString()})]},s.lotId)}),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"muted",children:"Sin alertas activas"})})]})]})})]})]})}export{Y as default};
