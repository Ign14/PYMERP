import{j as r}from"./index-C0DCX_lx.js";import{d as b,i as h,r as n}from"./react-DFcFNn96.js";import{P as y}from"./PageHeader-ZA88au4Z.js";import{P as x}from"./PurchaseCreateForm-iUq2Fou4.js";import"./useQuery-ClGZjTlq.js";const i=t=>{if(!t)return null;const e=Number(t);return Number.isFinite(e)?e:null},f=t=>{if(t!=null)return Math.max(Math.ceil(t),1)};function Q(){const t=b(),[e]=h(),[o,l]=n.useState(""),s=n.useRef(null),a=n.useMemo(()=>{const m=f(i(e.get("suggestedQty"))),c=i(e.get("reorderPoint")),d=i(e.get("currentQty")),p=c!=null&&d!=null?Math.max(Math.ceil(c-d),1):void 0,g=e.get("suggestedSupplierId")??e.get("supplierId")??void 0;return{productId:e.get("productId")??void 0,supplierId:g,locationId:e.get("locationId")??void 0,suggestedQty:m??p}},[e.toString()]),u=()=>{l("Orden registrada correctamente. Redirigiendo al panel de abastecimiento..."),s.current&&window.clearTimeout(s.current),s.current=window.setTimeout(()=>{t("/app/inventory")},1400)};return n.useEffect(()=>()=>{s.current&&window.clearTimeout(s.current)},[]),r.jsxs("div",{className:"page-section",children:[r.jsx(y,{title:"Registrar orden de compra",description:"Completa los datos para generar una orden alineada con las necesidades del panel de abastecimiento.",actions:r.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[r.jsx("button",{className:"btn ghost",type:"button",onClick:()=>t("/app/inventory"),children:"Volver a abastecimiento"}),r.jsx("button",{className:"btn ghost",type:"button",onClick:()=>t("/app/purchases"),children:"Ver compras"})]})}),o&&r.jsxs("div",{className:"bg-green-950 border border-green-800 rounded-lg p-4 text-green-300 text-sm",style:{marginBottom:"1rem"},children:[o,r.jsx("div",{style:{marginTop:"0.25rem"},children:r.jsx("button",{className:"btn ghost",type:"button",onClick:()=>t("/app/inventory"),children:"Ir al panel de abastecimiento"})})]}),r.jsx("div",{className:"card",style:{padding:"1.25rem 1.5rem"},children:r.jsx(x,{initialProductId:a.productId,initialSupplierId:a.supplierId,initialLocationId:a.locationId,initialQty:a.suggestedQty,onSubmitted:u})})]})}export{Q as default};
