import{j as e,a9 as C,k as E}from"./index-C0DCX_lx.js";import{r as l}from"./react-DFcFNn96.js";import{u as y}from"./useQuery-ClGZjTlq.js";import{P}from"./PageHeader-ZA88au4Z.js";const v=[{value:"",label:"Todos los tipos"},{value:"PURCHASE_IN",label:"Entrada por compra"},{value:"SALE_OUT",label:"Salida por venta"},{value:"ADJUSTMENT",label:"Ajuste manual"},{value:"TRANSFER",label:"Transferencia"}];function R(){const[n,p]=l.useState(""),[d,m]=l.useState(""),[o,x]=l.useState(""),[c,j]=l.useState(""),[r,s]=l.useState(0),[i,g]=l.useState(""),t=y({queryKey:["inventoryMovements",{productId:n,type:d,dateFrom:o,dateTo:c,page:r}],queryFn:()=>C({productId:n||void 0,type:d||void 0,dateFrom:o||void 0,dateTo:c||void 0,page:r,size:20})}),h=y({queryKey:["products",{q:i}],queryFn:()=>E({q:i||void 0,page:0,size:100}),enabled:i.length>2}),u=t.data?.content||[],b=t.data?.totalPages||0,f=a=>new Date(a).toLocaleString("es-CL",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),T=a=>{const N=v.find(F=>F.value===a);return N?N.label:a},S=a=>{switch(a){case"PURCHASE_IN":return"#10b981";case"SALE_OUT":return"#ef4444";case"ADJUSTMENT":return"#f59e0b";case"TRANSFER":return"#3b82f6";default:return"#6b7280"}};return e.jsxs("div",{className:"page",children:[e.jsx(P,{title:"Movimientos de Inventario"}),e.jsxs("section",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{children:"Filtros"})}),e.jsxs("div",{className:"inline-actions",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"productFilter",className:"label",children:"Producto"}),e.jsx("input",{id:"productFilter",type:"text",className:"input",placeholder:"Buscar por nombre o SKU...",value:i,onChange:a=>g(a.target.value)}),h.data&&h.data.content.length>0&&e.jsxs("select",{className:"input",style:{marginTop:"0.5rem"},value:n,onChange:a=>{p(a.target.value),s(0)},children:[e.jsx("option",{value:"",children:"Seleccionar producto..."}),h.data.content.map(a=>e.jsxs("option",{value:a.id,children:[a.sku," - ",a.name]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"typeFilter",className:"label",children:"Tipo de movimiento"}),e.jsx("select",{id:"typeFilter",className:"input",value:d,onChange:a=>{m(a.target.value),s(0)},children:v.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dateFromFilter",className:"label",children:"Desde"}),e.jsx("input",{id:"dateFromFilter",type:"datetime-local",className:"input",value:o,onChange:a=>{x(a.target.value),s(0)}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dateToFilter",className:"label",children:"Hasta"}),e.jsx("input",{id:"dateToFilter",type:"datetime-local",className:"input",value:c,onChange:a=>{j(a.target.value),s(0)}})]})]}),e.jsx("div",{style:{marginTop:"1rem"},children:e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>{p(""),m(""),x(""),j(""),g(""),s(0)},children:"Limpiar filtros"})})]}),e.jsxs("section",{className:"card",children:[t.isLoading&&e.jsx("p",{className:"muted",children:"Cargando movimientos..."}),t.isError&&e.jsxs("p",{className:"panel-error",children:["Error: ",t.error?.message]}),!t.isLoading&&!t.isError&&u.length===0&&e.jsx("p",{className:"muted",children:"No se encontraron movimientos con los filtros aplicados."}),u.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"Lote/Batch"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Ubicación"}),e.jsx("th",{children:"Referencia"}),e.jsx("th",{children:"Usuario"})]})}),e.jsx("tbody",{children:u.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono small",children:f(a.createdAt)}),e.jsx("td",{children:e.jsx("span",{style:{color:S(a.type),fontWeight:"bold",fontSize:"0.875rem"},children:T(a.type)})}),e.jsx("td",{children:a.productName||"—"}),e.jsx("td",{className:"mono small",children:a.productSku||"—"}),e.jsx("td",{className:"mono small",children:a.lotId?e.jsxs(e.Fragment,{children:[a.lotId.substring(0,8),a.batchName&&e.jsxs("span",{style:{marginLeft:"0.5rem",color:"#6b7280"},children:["(",a.batchName,")"]})]}):"—"}),e.jsxs("td",{className:"mono",style:{color:a.type==="PURCHASE_IN"?"#10b981":"#ef4444",fontWeight:"bold"},children:[a.type==="PURCHASE_IN"?"+":"",a.qty]}),e.jsx("td",{children:a.locationCode?e.jsx("span",{title:a.locationName||"",children:a.locationCode}):"—"}),e.jsx("td",{className:"mono small",children:a.refType&&a.refId?`${a.refType}:${a.refId.substring(0,8)}`:a.note||"—"}),e.jsx("td",{className:"small",children:a.createdBy||"—"})]},a.id))})]})}),e.jsxs("div",{className:"pagination",style:{marginTop:"1rem"},children:[e.jsx("button",{className:"btn ghost",disabled:r===0,onClick:()=>s(a=>Math.max(0,a-1)),children:"← Anterior"}),e.jsxs("span",{className:"muted",children:["Página ",r+1," de ",b||1]}),e.jsx("button",{className:"btn ghost",disabled:r>=b-1,onClick:()=>s(a=>a+1),children:"Siguiente →"})]})]})]})]})}export{R as default};
