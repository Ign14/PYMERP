import{b as ut,j as e,u as st,c as ie,d as mt,i as xt,n as ht,l as pt,e as bt,f as gt,h as jt,k as ft,m as Nt,o as vt,p as at,q as yt,r as rt,s as Ct,t as Ae,v as Ie,w as Ue,x as wt,y as St,z as Pt,A as Dt,B as Ee,C as kt}from"./index-CTZ9O8lC.js";import{r as i}from"./react-D8kvZI4c.js";import{u as $}from"./useQuery-C9GbdDDb.js";import{P as Tt}from"./PageHeader-CwWqOxH0.js";import{M as Me}from"./Modal-BpLUd7V9.js";import{u as Rt,m as Ft,c as Et}from"./customersUtils-DBUQXphp.js";import{u as nt}from"./useDebouncedValue-DnjRONvw.js";import{p as _t}from"./problemDetail-Cdronk76.js";import{u as Lt,f as Ve,g as At}from"./table-DbsuG4jc.js";import{f as $e,c as lt}from"./currency-HwQAg_Xa.js";import{R as be,A as It,C as Ne,X as ve,Y as ye,T as ge,c as Mt,d as ot,P as $t,e as qt,f as ct,a as qe,B as Oe,g as Be,L as dt,b as Fe}from"./charts-BH7DIlZU.js";function Ot(t){return $({queryKey:["frequent-products",t],queryFn:()=>{if(!t)throw new Error("customerId is required");return ut(t)},enabled:!!t,staleTime:300*1e3,gcTime:600*1e3})}const Bt=new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0});function Kt(t){try{return new Date(t).toLocaleDateString()}catch{return t}}function zt({customerId:t,visible:o,onPick:n}){const[c,r]=i.useState(""),{data:a,isLoading:l,isFetching:m,isError:N,refetch:u}=Ot(t);i.useEffect(()=>{r("")},[t]);const f=i.useMemo(()=>{if(!a)return[];const h=c.trim().toLowerCase();return h?a.filter(v=>{const T=v.name?.toLowerCase()??"",P=v.sku?.toLowerCase()??"";return T.includes(h)||P.includes(h)}):a},[a,c]);if(!o||!t)return null;const p=(a?.length??0)>0,b=l||m&&!(a&&a.length);return e.jsxs("section",{className:"card frequent-products-panel","aria-label":"Productos frecuentes del cliente","aria-live":"polite",children:[e.jsxs("header",{className:"card-header frequent-products-header",children:[e.jsxs("div",{className:"frequent-products-heading",children:[e.jsx("h2",{className:"card-title",children:"Productos frecuentes"}),e.jsx("p",{className:"muted",children:"Basado en compras anteriores del cliente."})]}),p?e.jsxs("div",{className:"frequent-products-search",children:[e.jsx("label",{className:"sr-only",htmlFor:"frequent-products-search",children:"Buscar producto frecuente"}),e.jsx("input",{id:"frequent-products-search",type:"search",className:"input",placeholder:"Buscar por nombre o SKU",value:c,onChange:h=>r(h.target.value),autoComplete:"off"})]}):null]}),e.jsxs("div",{className:"frequent-products-content","aria-busy":b,children:[b?e.jsxs("div",{className:"frequent-products-loading",role:"status","aria-live":"polite",children:[e.jsx("div",{className:"skeleton skeleton-text","aria-hidden":"true"}),e.jsx("div",{className:"skeleton skeleton-text","aria-hidden":"true"}),e.jsx("div",{className:"skeleton skeleton-text","aria-hidden":"true"})]}):null,!b&&N?e.jsxs("div",{className:"frequent-products-error",role:"alert",children:[e.jsx("p",{children:"No pudimos cargar los productos frecuentes."}),e.jsx("button",{type:"button",className:"btn",onClick:()=>u(),children:"Reintentar"})]}):null,!b&&!N&&(a?.length??0)===0?e.jsx("p",{className:"muted",role:"status",children:"Este cliente no tiene compras previas."}):null,!b&&!N&&f.length>0?e.jsx("ul",{className:"frequent-products-list",children:f.map(h=>{const v=Kt(h.lastPurchasedAt),T=h.avgQty!==void 0&&h.avgQty!==null?Number(h.avgQty).toFixed(1):null,P=h.lastUnitPrice!==void 0&&h.lastUnitPrice!==null?Bt.format(h.lastUnitPrice):null,J=()=>n(h,{lastQty:h.lastQty});return e.jsx("li",{children:e.jsxs("div",{role:"button",tabIndex:0,className:"frequent-product-row",onClick:J,onKeyDown:O=>{(O.key==="Enter"||O.key===" ")&&(O.preventDefault(),J())},"aria-label":`Agregar ${h.name}`,children:[e.jsxs("div",{className:"frequent-product-main",children:[e.jsx("span",{className:"frequent-product-name",children:h.name}),e.jsxs("span",{className:"frequent-product-sku",children:["SKU: ",h.sku||"â€”"]})]}),e.jsxs("dl",{className:"frequent-product-meta",children:[e.jsxs("div",{children:[e.jsx("dt",{children:"Ãšltima compra"}),e.jsx("dd",{children:v})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Veces compradas"}),e.jsx("dd",{children:h.totalPurchases})]}),h.lastQty!==void 0?e.jsxs("div",{children:[e.jsx("dt",{children:"Ãšltima cantidad"}),e.jsx("dd",{children:h.lastQty})]}):null,T?e.jsxs("div",{children:[e.jsx("dt",{children:"Cantidad promedio"}),e.jsx("dd",{children:T})]}):null,P?e.jsxs("div",{children:[e.jsx("dt",{children:"Ãšltimo precio"}),e.jsx("dd",{children:P})]}):null]})]})},h.productId)})}):null,!b&&!N&&f.length===0&&(a?.length??0)>0?e.jsxs("p",{className:"muted",role:"status",children:['No encontramos coincidencias para "',c,'".']}):null]})]})}const Ke=[{value:"Factura",label:"Factura"},{value:"Boleta",label:"Boleta"},{value:"CotizaciÃ³n",label:"CotizaciÃ³n"},{value:"Comprobante",label:"Comprobante"}],ze=[{value:"Efectivo",label:"Efectivo"},{value:"Tarjetas",label:"Tarjetas"},{value:"Transferencia",label:"Transferencia"},{value:"Otros",label:"Otros"}],Ut=20,Vt="name,asc",Qt=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,we={name:"",document:"",email:"",phone:"",address:"",commune:""};function _e(t){const o=t.trim();return o.length>0?o:void 0}function Ht(t){const o={},n=t.name.trim();n.length<3?o.name="El nombre debe tener al menos 3 caracteres":n.length>120&&(o.name="El nombre no puede superar 120 caracteres");const c=t.document.trim();let r;c.length>0&&(xt(c)?r=ht(c):o.document="Ingresa un RUT vÃ¡lido");const a=t.email.trim();a&&!Qt.test(a)&&(o.email="Ingresa un email vÃ¡lido");const l=t.phone.trim();return Object.keys(o).length>0?{errors:o}:{payload:{name:n,document:r??_e(t.document),email:a?a.toLowerCase():void 0,phone:l?l.replace(/\s+/g," ").trim():void 0,address:_e(t.address),commune:_e(t.commune)},errors:o}}function Gt(t,o,n){const c=i.useRef(t.length);i.useEffect(()=>{if(!o){c.current=t.length;return}if(t.length===0){n(-1),c.current=0;return}t.length!==c.current&&(n(0),c.current=t.length)},[t,o,n])}function Wt({value:t,onSelect:o,onClear:n,disabled:c,label:r="Cliente",required:a=!1,error:l=null,onErrorDismiss:m,debounceMs:N=400}){const[u,f]=i.useState(""),[p,b]=i.useState(!1),[h,v]=i.useState(-1),[T,P]=i.useState({tone:null,message:null}),[J,O]=i.useState(!1),[q,W]=i.useState({...we}),[_,Y]=i.useState({}),[oe,ce]=i.useState(null),he=i.useRef(null),se=i.useRef(null),B=i.useRef(null),ae=i.useRef(null),M=nt(u,N),re=st(),D=i.useId(),K=i.useId(),H=i.useRef(null),te=i.useRef(null);i.useEffect(()=>{const x=t?.id??null;x!==ae.current&&(ae.current=x,f(t?t.name??"":""))},[t]);const L=Rt({queryKey:["customers","picker",M],queryFn:async({pageParam:x=0})=>{const j=M.trim();return await pt({page:x,size:Ut,sort:Vt,q:j.length>0?j:void 0})},getNextPageParam:x=>Et(x),initialPageParam:0}),A=i.useMemo(()=>Ft(L.data?.pages??[]),[L.data]);Gt(A,p,v);const k=L.hasNextPage??!1,z=L.isFetchingNextPage,ne=L.isPending&&A.length===0,le=i.useCallback(x=>{typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(x):setTimeout(x,0)},[]);i.useEffect(()=>{if(!p||typeof window>"u"||typeof window.IntersectionObserver>"u")return;const x=H.current;if(!x)return;const j=new IntersectionObserver(Q=>{const[s]=Q;s?.isIntersecting&&k&&!z&&L.fetchNextPage()});return j.observe(x),te.current=j,()=>j.disconnect()},[p,k,z,L]);const R=()=>{B.current&&(window.clearTimeout(B.current),B.current=null)},Z=i.useCallback(()=>{b(!1),v(-1)},[]),G=i.useCallback(x=>{o(x),Z(),P({tone:null,message:null}),m?.(),le(()=>se.current?.blur())},[Z,o,m,le]),ee=()=>{c||(R(),b(!0))},pe=()=>{R(),B.current=window.setTimeout(()=>{Z()},120)},Ce=x=>{const{value:j}=x.currentTarget;f(j),P({tone:null,message:null}),p||b(!0)},je=x=>{if(!p&&(x.key==="ArrowDown"||x.key==="ArrowUp"||x.key==="Enter")&&b(!0),x.key==="ArrowDown"){if(x.preventDefault(),A.length===0)return;v(j=>j+1>=A.length?j:j+1);return}if(x.key==="ArrowUp"){if(x.preventDefault(),A.length===0)return;v(j=>j<=0?0:j-1);return}if(x.key==="Enter"){p&&h>=0&&A[h]&&(x.preventDefault(),G(A[h]));return}if(x.key==="Escape"){if(x.preventDefault(),p){Z();return}u.length>0&&(f(""),n?.())}},de=x=>{x.preventDefault(),R()},ue=()=>{O(!0),W({...we,name:u.trim()}),Y({}),ce(null),Z(),le(()=>{se.current?.blur()})},me=()=>{U.isPending||(O(!1),W({...we}),Y({}),ce(null),se.current?.focus())},U=ie({mutationFn:x=>mt(x),onSuccess:x=>{re.invalidateQueries({queryKey:["customers"],exact:!1}),P({tone:"success",message:"Cliente creado"}),O(!1),W({...we}),Y({}),ce(null),G(x),le(()=>se.current?.focus())},onError:x=>{const j=_t(x),Q={};for(const[s,g]of Object.entries(j.fieldErrors))g&&s in we&&(Q[s]=g);Y(Q),ce(j.message??"No se pudo crear el cliente")}}),fe=x=>{x.preventDefault(),ce(null);const{payload:j,errors:Q}=Ht(q);if(!j||Object.keys(Q).length>0){Y(Q);return}U.mutate(j)},V=x=>{const j=[];return x.document&&j.push(x.document),x.email&&j.push(x.email),!x.email&&x.phone&&j.push(x.phone),j.join(" â€¢ ")};return e.jsxs("div",{className:"customer-select",ref:he,children:[e.jsxs("label",{className:"customer-select__label",htmlFor:`${D}-input`,children:[r,a?e.jsx("span",{className:"customer-select__required","aria-hidden":"true",children:"*"}):null]}),e.jsxs("div",{className:"customer-select__field",children:[e.jsxs("div",{className:`customer-select__combobox${p?" is-open":""}${c?" is-disabled":""}${l?" has-error":""}`,children:[e.jsx("input",{id:`${D}-input`,ref:se,type:"text",className:"customer-select__input",role:"combobox","aria-autocomplete":"list","aria-expanded":p,"aria-controls":D,"aria-activedescendant":h>=0&&A[h]?`${D}-option-${h}`:void 0,"aria-describedby":l?`${D}-error`:void 0,placeholder:"Buscar por nombre, RUT o emailâ€¦",value:u,onFocus:ee,onBlur:pe,onInput:Ce,onKeyDown:je,disabled:c,autoComplete:"off","aria-required":a?"true":void 0}),t?e.jsx("button",{type:"button",className:"customer-select__clear",onClick:()=>{n?.(),f(""),P({tone:null,message:null}),se.current?.focus()},"aria-label":"Limpiar cliente seleccionado",disabled:c,children:"Ã—"}):null,e.jsx("button",{type:"button",className:"customer-select__create-btn",onClick:ue,disabled:c,children:"+ Nuevo cliente"})]}),p?e.jsxs("div",{className:"customer-select__dropdown",role:"listbox",id:D,children:[ne?e.jsx("div",{className:"customer-select__empty",children:"Buscando clientesâ€¦"}):A.length===0?e.jsxs("div",{className:"customer-select__empty",role:"status","aria-live":"polite",children:[e.jsx("p",{children:"Sin resultados. Â¿Crear cliente?"}),e.jsx("button",{type:"button",className:"btn ghost",onClick:ue,children:"Crear cliente"})]}):e.jsx("ul",{className:"customer-select__options",children:A.map((x,j)=>{const Q=V(x),s=j===h;return e.jsx("li",{children:e.jsxs("button",{type:"button",role:"option",id:`${D}-option-${j}`,className:`customer-select__option${s?" is-active":""}`,"aria-selected":s,onMouseDown:de,onClick:()=>G(x),children:[e.jsx("span",{className:"customer-select__option-name",children:x.name}),Q?e.jsx("span",{className:"customer-select__option-meta",children:Q}):null]})},x.id)})}),L.isError?e.jsx("div",{className:"customer-select__empty customer-select__empty--error",role:"alert",children:L.error.message||"No se pudieron cargar los clientes"}):null,k?e.jsx("div",{className:"customer-select__load-more",ref:H,children:e.jsx("button",{type:"button",className:"btn ghost",onClick:()=>void L.fetchNextPage(),disabled:z,children:z?"Cargando mÃ¡sâ€¦":"Cargar mÃ¡s"})}):null]}):null,l?e.jsx("p",{id:`${D}-error`,className:"customer-select__feedback customer-select__feedback--error",role:"alert",children:l}):null,T.tone&&T.message?e.jsx("p",{className:`customer-select__feedback customer-select__feedback--${T.tone}`,role:"status","aria-live":"polite",children:T.message}):null]}),J?e.jsxs("div",{className:"customer-create-overlay",role:"dialog","aria-modal":"true","aria-labelledby":K,children:[e.jsx("div",{className:"customer-create-overlay__backdrop",onClick:me,role:"presentation"}),e.jsxs("section",{className:"customer-create-sheet",children:[e.jsxs("header",{className:"customer-create-sheet__header",children:[e.jsx("h3",{id:K,children:"Nuevo cliente"}),e.jsx("button",{type:"button",className:"icon-btn",onClick:me,"aria-label":"Cerrar",disabled:U.isPending,children:"Ã—"})]}),e.jsxs("form",{className:"customer-create-sheet__form",onSubmit:fe,noValidate:!0,children:[e.jsxs("label",{children:[e.jsx("span",{children:"Nombre *"}),e.jsx("input",{type:"text",className:`input${_.name?" input-error":""}`,value:q.name,onChange:x=>{W(j=>({...j,name:x.target.value})),Y(j=>({...j,name:void 0}))},required:!0,minLength:3,maxLength:120,autoFocus:!0,disabled:U.isPending}),_.name?e.jsx("span",{className:"error",role:"alert",children:_.name}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"RUT"}),e.jsx("input",{type:"text",className:`input${_.document?" input-error":""}`,value:q.document,onChange:x=>{W(j=>({...j,document:x.target.value})),Y(j=>({...j,document:void 0}))},placeholder:"76.123.456-0",disabled:U.isPending}),_.document?e.jsx("span",{className:"error",role:"alert",children:_.document}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"Email"}),e.jsx("input",{type:"email",className:`input${_.email?" input-error":""}`,value:q.email,onChange:x=>{W(j=>({...j,email:x.target.value})),Y(j=>({...j,email:void 0}))},placeholder:"contacto@cliente.cl",disabled:U.isPending}),_.email?e.jsx("span",{className:"error",role:"alert",children:_.email}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"TelÃ©fono"}),e.jsx("input",{type:"tel",className:"input",value:q.phone,onChange:x=>{W(j=>({...j,phone:x.target.value}))},placeholder:"+56 9 1234 5678",disabled:U.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"DirecciÃ³n"}),e.jsx("input",{type:"text",className:"input",value:q.address,onChange:x=>{W(j=>({...j,address:x.target.value}))},placeholder:"Av. Principal 1234",disabled:U.isPending})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Comuna"}),e.jsx("input",{type:"text",className:"input",value:q.commune,onChange:x=>{W(j=>({...j,commune:x.target.value}))},placeholder:"Providencia",disabled:U.isPending})]}),oe?e.jsx("div",{className:"customer-create-sheet__alert",role:"alert",children:oe}):null,e.jsxs("div",{className:"customer-create-sheet__actions",children:[e.jsx("button",{type:"button",className:"btn ghost",onClick:me,disabled:U.isPending,children:"Cancelar"}),e.jsx("button",{className:"btn",type:"submit",disabled:U.isPending,children:U.isPending?"Guardandoâ€¦":"Guardar"})]})]})]})]}):null]})}const Qe=Ke[0].value,He=ze[2].value,Ge=["barcode","sku","qr"],Yt=100,Xt=[{value:"auto",label:"DetecciÃ³n automÃ¡tica"},{value:"barcode",label:"CÃ³digo de barras"},{value:"sku",label:"SKU"},{value:"qr",label:"QR"}];function Jt({open:t,onClose:o,onCreated:n}){const[c,r]=i.useState(null),[a,l]=i.useState(null),[m,N]=i.useState(Qe),[u,f]=i.useState(He),[p,b]=i.useState([]),[h,v]=i.useState(""),[T,P]=i.useState(1),[J,O]=i.useState(0),[q,W]=i.useState("amount"),[_,Y]=i.useState(0),[oe,ce]=i.useState(!0),[he,se]=i.useState({}),[B,ae]=i.useState(!1),M=i.useRef(null),re=i.useRef(""),D=i.useRef(null),[K,H]=i.useState(""),[te,L]=i.useState(""),[A,k]=i.useState("auto"),[z,ne]=i.useState(!1),[le,R]=i.useState({status:"idle"}),Z=$({queryKey:["products",{dialog:"sales"}],queryFn:()=>jt({size:200}),enabled:t,staleTime:3e4});$({queryKey:["locations",{dialog:"sales"}],queryFn:()=>ft(),enabled:t});const G=ie({mutationFn:d=>gt(d),onSuccess:d=>{n(d),s(),o()}}),ee=Z.data?.content??[],pe=c?.id??"";i.useEffect(()=>{ee.length&&se(d=>{let y=!1;const w={...d};for(const S of ee)w[S.id]||(w[S.id]=S,y=!0);return y?w:d})},[ee]),i.useEffect(()=>{c?.id||ae(!1)},[c]);const Ce=i.useCallback(d=>{r(d),l(null)},[]),je=i.useCallback(()=>{r(null),l(null),ae(!1)},[]),de=i.useCallback((d,y=1,w)=>{if(!d||y<=0||Number.isNaN(y))return;const S=w!==void 0&&!Number.isNaN(w)?w:Number(d.currentPrice??0)||0;se(I=>I[d.id]?I:{...I,[d.id]:d}),b(I=>{const E=I.findIndex(F=>F.productId===d.id);if(E!==-1){const F=I[E],Pe=[...I];return Pe[E]={...F,qty:F.qty+y,unitPrice:w!==void 0?w:F.unitPrice||S},Pe}return[...I,{productId:d.id,qty:y,unitPrice:S}]})},[]),ue=i.useCallback(async(d,y={})=>{const w=d.trim();if(!w)return y.showEmptyError&&R({status:"error",message:"Ingresa un cÃ³digo vÃ¡lido."}),null;ne(!0),R({status:"loading",message:"Buscando producto..."});const S=y.hint?[y.hint,...Ge.filter(E=>E!==y.hint)]:Ge,I=new Set;try{for(const E of S){if(I.has(E))continue;I.add(E);const F=await bt({query:w,type:E});if(F)return de(F,1),R({status:"success",message:`Producto "${F.name}" agregado a la venta.`}),F}return R({status:"error",message:"Producto no encontrado para el cÃ³digo ingresado."}),null}catch(E){const F=E instanceof Error?E.message:"No se pudo buscar el producto.";return R({status:"error",message:F}),null}finally{ne(!1)}},[de]),me=i.useCallback(()=>{D.current&&(window.clearTimeout(D.current),D.current=null);const d=re.current.trim();if(!d){H(""),re.current="";return}let y=d;H(""),re.current="",ue(y,{showEmptyError:!1})},[ue]),U=d=>{const y=d.target.value;H(y),re.current=y,D.current&&window.clearTimeout(D.current),y&&(D.current=window.setTimeout(me,Yt))},fe=d=>{d.key==="Enter"&&(d.preventDefault(),me())},V=async()=>{if(z)return;await ue(te,{hint:A==="auto"?void 0:A,showEmptyError:!0})&&(L(""),k("auto"))},x=i.useMemo(()=>{const d=p.reduce((E,F)=>E+F.qty*F.unitPrice-(F.discount??0),0);let y=0;q==="percentage"?y=d*(_/100):y=_;const w=d-y,S=oe?w*.19:0,I=w+S;return{subtotal:d,discountAmount:y,net:w,vat:S,total:I}},[p,oe,q,_]),j=()=>{if(!h){R({status:"error",message:"Selecciona un producto para agregarlo."});return}const d=ee.find(y=>y.id===h);if(!d){R({status:"error",message:"Producto seleccionado no disponible."});return}if(T<=0||Number.isNaN(T)){R({status:"error",message:"La cantidad debe ser mayor a cero."});return}if(J<=0||Number.isNaN(J)){R({status:"error",message:"El precio unitario debe ser mayor a cero."});return}de(d,T,J),R({status:"success",message:`Se agregÃ³ ${T}Ã— "${d.name}" al carrito.`}),v(""),P(1),O(0)},Q=d=>{b(y=>y.filter((w,S)=>S!==d))},s=()=>{r(null),l(null),N(Qe),f(He),b([]),v(""),P(1),O(0),L(""),k("auto"),R({status:"idle"}),ne(!1),H(""),re.current="",D.current&&(window.clearTimeout(D.current),D.current=null),ae(!1)},g=d=>{if(d.preventDefault(),!c?.id){l("Selecciona un cliente");return}if(p.length===0)return;const y={customerId:c.id,docType:m,paymentMethod:u,discount:_>0?q==="percentage"?x.discountAmount:_:void 0,vatRate:oe?19:void 0,items:p};G.mutate(y)};i.useEffect(()=>{if(!t){R({status:"idle"}),ne(!1),H(""),re.current="",D.current&&(window.clearTimeout(D.current),D.current=null),ae(!1);return}requestAnimationFrame(()=>{M.current&&(M.current.focus(),M.current.select())})},[t]),i.useEffect(()=>()=>{D.current&&(window.clearTimeout(D.current),D.current=null)},[]);const C=i.useCallback((d,y)=>{const w=he[d.productId]??ee.find(it=>it.id===d.productId);if(!w){R({status:"error",message:"El producto ya no estÃ¡ disponible en el catÃ¡logo."});return}const S=y?.lastQty,I=d.avgQty?Math.round(d.avgQty):1,E=S!==void 0&&S>0?S:I,F=E>0?E:1,Pe=w.currentPrice!==void 0&&w.currentPrice!==null?void 0:d.lastUnitPrice;de(w,F,Pe),R({status:"success",message:`Se agregÃ³ ${F}Ã— "${w.name}" desde frecuentes.`})},[de,he,ee]);return e.jsx(Me,{open:t,onClose:o,title:"Registrar venta",initialFocusRef:M,className:"modal--wide sales-create-modal",children:e.jsxs("form",{className:"form-grid",onSubmit:g,children:[e.jsx(Wt,{value:c,onSelect:Ce,onClear:je,label:"Cliente",required:!0,error:a,onErrorDismiss:()=>l(null),disabled:G.isPending}),e.jsxs("label",{children:[e.jsx("span",{children:"Documento"}),e.jsx("select",{className:"input",value:m,onChange:d=>N(d.target.value),children:Ke.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsxs("label",{children:[e.jsx("span",{children:"MÃ©todo de pago"}),e.jsx("select",{className:"input",value:u,onChange:d=>f(d.target.value),children:ze.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsx("div",{className:"line"}),e.jsx("div",{className:"section-title",children:"Descuentos e Impuestos"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:[e.jsxs("label",{children:[e.jsx("span",{children:"Tipo de descuento"}),e.jsxs("select",{className:"input",value:q,onChange:d=>W(d.target.value),children:[e.jsx("option",{value:"amount",children:"Monto fijo ($)"}),e.jsx("option",{value:"percentage",children:"Porcentaje (%)"})]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Valor descuento"}),e.jsx("input",{className:"input",type:"number",min:0,step:q==="percentage"?1:.01,value:_,onChange:d=>Y(Number(d.target.value)),placeholder:q==="percentage"?"0-100":"0.00"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",checked:oe,onChange:d=>ce(d.target.checked)}),e.jsx("span",{children:"Aplicar IVA 19%"})]})]}),e.jsx("div",{className:"line"}),e.jsxs("div",{className:"lookup-section",children:[e.jsxs("div",{className:"scan-input-wrapper",children:[e.jsxs("label",{children:[e.jsx("span",{children:"EscÃ¡ner USB"}),e.jsx("input",{ref:M,className:"input scan-input",type:"text",inputMode:"text",autoComplete:"off",value:K,onChange:U,onKeyDown:fe,placeholder:"Enfoca y escanea el cÃ³digo","aria-describedby":"scan-hint"})]}),e.jsx("p",{id:"scan-hint",className:"scan-hint",children:"MantÃ©n el foco en este campo y escanea cÃ³digo de barras, SKU o QR. El producto se agrega automÃ¡ticamente cuando se detecta la lectura."})]}),e.jsx("div",{className:"manual-entry",children:e.jsxs("label",{children:[e.jsx("span",{children:"Agregar por cÃ³digo"}),e.jsxs("div",{className:"manual-entry__inputs",children:[e.jsx("input",{className:"input",type:"text",value:te,onChange:d=>L(d.target.value),onKeyDown:d=>{d.key==="Enter"&&(d.preventDefault(),V())},placeholder:"Ingresa cÃ³digo, SKU o QR"}),e.jsx("select",{className:"input manual-entry__type",value:A,onChange:d=>k(d.target.value),"aria-label":"Tipo de cÃ³digo",children:Xt.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))}),e.jsx("button",{type:"button",className:"btn",onClick:()=>void V(),disabled:z||te.trim()==="",children:z?"Buscando...":"Agregar"})]})]})})]}),le.status!=="idle"&&e.jsx("div",{className:`status-message lookup-feedback ${le.status==="success"?"success":le.status==="error"?"error":"loading"}`,role:"status","aria-live":"polite",children:le.message??""}),e.jsxs("section",{className:"frequent-products-wrapper",children:[e.jsxs("label",{className:"frequent-products-toggle",children:[e.jsx("input",{type:"checkbox",checked:B,onChange:d=>ae(d.target.checked),disabled:!pe}),e.jsx("span",{children:"Productos frecuentes del cliente"})]}),e.jsx(zt,{customerId:pe||void 0,visible:B&&!!pe,onPick:C})]}),e.jsx("div",{className:"line"}),e.jsxs("div",{className:"item-builder",children:[e.jsxs("select",{className:"input",value:h,onChange:d=>{const y=d.target.value;v(y);const w=ee.find(S=>S.id===y);w?.currentPrice!==void 0&&w.currentPrice!==null?O(Number(w.currentPrice)):O(0)},children:[e.jsx("option",{value:"",children:"Selecciona producto"}),ee.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]}),e.jsx("input",{className:"input",type:"number",min:1,value:T,onChange:d=>P(Number(d.target.value))}),e.jsx("input",{className:"input",type:"number",step:"0.01",min:0,value:J,onChange:d=>O(Number(d.target.value))}),e.jsx("button",{type:"button",className:"btn",onClick:j,children:"Agregar"})]}),p.length>0&&e.jsx("div",{className:"table-wrapper compact",children:e.jsxs("table",{className:"table nowrap",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:p.map((d,y)=>{const S=(he[d.productId]??ee.find(F=>F.id===d.productId))?.name??d.productId,I=`${d.qty}`,E=`$${d.unitPrice.toFixed(2)}`;return e.jsxs("tr",{children:[e.jsx("td",{title:S,children:e.jsx("span",{className:"cell-text",children:S})}),e.jsx("td",{className:"mono",title:I,children:e.jsx("span",{className:"cell-text",children:d.qty})}),e.jsx("td",{className:"mono",title:E,children:e.jsx("span",{className:"cell-text",children:E})}),e.jsx("td",{className:"actions-cell",children:e.jsx("button",{type:"button",className:"btn ghost",onClick:()=>Q(y),children:"Quitar"})})]},`${d.productId}-${y}`)})})]})}),e.jsxs("div",{className:"total-section",style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"1rem",background:"#f9f9f9",borderRadius:"4px"},children:[e.jsx("span",{className:"muted",children:"Subtotal:"}),e.jsxs("strong",{children:["$",x.subtotal.toFixed(2)]}),_>0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"muted",children:["Descuento (",q==="percentage"?`${_}%`:"$","):"]}),e.jsxs("strong",{children:["-$",x.discountAmount.toFixed(2)]})]}),e.jsx("span",{className:"muted",children:"Neto:"}),e.jsxs("strong",{children:["$",x.net.toFixed(2)]}),oe&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"muted",children:"IVA (19%):"}),e.jsxs("strong",{children:["$",x.vat.toFixed(2)]})]}),e.jsx("span",{style:{fontSize:"1.1rem",fontWeight:"bold"},children:"Total:"}),e.jsxs("strong",{style:{fontSize:"1.1rem"},children:["$",x.total.toFixed(2)]})]}),G.isError&&e.jsx("p",{className:"error",children:G.error.message}),e.jsxs("div",{className:"buttons",children:[e.jsx("button",{className:"btn",type:"submit",disabled:G.isPending,children:G.isPending?"Guardando...":"Registrar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:s,children:"Limpiar"})]})]})})}function Zt({value:t,rangeLabel:o,formatter:n=$e}){return e.jsxs("article",{className:"card stat","aria-label":`Promedio diario de ventas para ${o}`,children:[e.jsx("h3",{children:"Promedio diario"}),e.jsx("p",{className:"stat-value","data-testid":"sales-daily-average",children:n(t)}),e.jsxs("span",{className:"stat-trend",children:["Rango seleccionado: ",o]})]})}function es({value:t,rangeLabel:o,formatter:n=$e}){return e.jsxs("article",{className:"card stat","aria-label":`Ventas acumuladas para ${o}`,children:[e.jsx("h3",{children:"Ventas acumuladas"}),e.jsx("p",{className:"stat-value","data-testid":"sales-total-14d",children:n(t)}),e.jsxs("span",{className:"stat-trend",children:["Rango seleccionado: ",o]}),e.jsx("span",{className:"muted small",children:"Incluye solo Boleta y Factura"})]})}function ts({startDate:t,endDate:o,onStartDateChange:n,onEndDateChange:c}){const r=i.useMemo(()=>lt(),[]),a=h=>r.format(h??0),l=i.useMemo(()=>{const h=new Date(t),v=new Date(o),T=Math.abs(v.getTime()-h.getTime());return Math.ceil(T/(1e3*60*60*24))+1},[t,o]),{data:m,isLoading:N,error:u}=$({queryKey:["sales-window-metrics",l],queryFn:()=>Nt(`${l}d`)}),f=i.useMemo(()=>m?.dailyAverage??0,[m]),p=i.useMemo(()=>m?.totalWithTax??0,[m]);i.useMemo(()=>m?.documentCount??0,[m]);const b=`Ãšltimos ${l} dÃ­as`;return N?e.jsx("section",{"aria-labelledby":"sales-dashboard-overview-heading",className:"mb-6",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("header",{className:"mb-4",children:e.jsx("h2",{id:"sales-dashboard-overview-heading",className:"text-xl font-semibold text-neutral-100",children:"ðŸ“Š Resumen de ventas"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"}),e.jsx("div",{className:"animate-pulse bg-neutral-800 rounded-lg h-32"})]})]})}):u?e.jsx("section",{"aria-labelledby":"sales-dashboard-overview-heading",className:"mb-6",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("header",{className:"mb-4",children:e.jsx("h2",{id:"sales-dashboard-overview-heading",className:"text-xl font-semibold text-neutral-100",children:"ðŸ“Š Resumen de ventas"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar mÃ©tricas de ventas"})}),e.jsx("div",{className:"bg-red-950 border border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar mÃ©tricas de ventas"})})]})]})}):e.jsx("section",{"aria-labelledby":"sales-dashboard-overview-heading",className:"mb-6",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("header",{className:"mb-4",children:e.jsx("h2",{id:"sales-dashboard-overview-heading",className:"text-xl font-semibold text-neutral-100",children:"ðŸ“Š Resumen de ventas"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Zt,{value:f,rangeLabel:b,formatter:a}),e.jsx(es,{value:p,rangeLabel:b,formatter:a})]})]})})}const ss={position:"absolute",width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:0};function as({points:t,formatter:o=$e,averageLine:n}){const c=t.map(a=>({date:a.date,total:a.total??0})),r=c.some(a=>a.total>0);return e.jsxs("div",{className:"chart-container","data-testid":"sales-trend-chart","data-point-count":c.length,children:[e.jsx("div",{style:{height:260},role:"img","aria-label":"Tendencia de ventas diarias",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(It,{data:c,margin:{top:10,right:24,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"salesTrendGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#22d3ee",stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:"#22d3ee",stopOpacity:0})]})}),e.jsx(Ne,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(ve,{dataKey:"date",stroke:"#a3a3a3",tick:{fontSize:12,fill:"#a3a3a3"}}),e.jsx(ye,{stroke:"#a3a3a3",tick:{fill:"#a3a3a3"},tickFormatter:a=>o(Number(a)),width:96}),e.jsx(ge,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:(a,l)=>{const m=l==="total"?"Venta del dÃ­a":"Promedio perÃ­odo";return[o(a),m]},labelFormatter:a=>`Fecha: ${a}`}),e.jsx(Mt,{type:"monotone",dataKey:"total",stroke:"#22d3ee",strokeWidth:2,fill:"url(#salesTrendGradient)",dot:{r:4,strokeWidth:2,fill:"#0891b2",stroke:"#22d3ee"},activeDot:{r:6,fill:"#06b6d4",stroke:"#22d3ee",strokeWidth:2}}),n!==void 0&&n>0&&e.jsx(ot,{y:n,stroke:"#fb923c",strokeWidth:2,strokeDasharray:"5 5",label:{value:`Promedio: ${o(n)}`,position:"right",style:{fill:"#fb923c",fontSize:12,fontWeight:600}}})]})})}),!r&&e.jsx("p",{className:"text-neutral-400",role:"status",children:"Sin ventas registradas en el perÃ­odo seleccionado."}),e.jsx("ul",{style:ss,"data-testid":"sales-trend-points",children:c.map(a=>e.jsx("li",{"data-testid":"sales-trend-point",children:`${a.date}: ${a.total}`},a.date))})]})}function rs({startDate:t,endDate:o,onStartDateChange:n,onEndDateChange:c}){const r=new Date().toISOString().split("T")[0],a=i.useMemo(()=>lt(),[]),l=b=>a.format(b??0),m=$({queryKey:["sales","daily-range",t,o],queryFn:()=>vt(t,o),enabled:!!t&&!!o&&t<=o}),N=m.data??[],u=i.useMemo(()=>N.length===0?0:N.reduce((h,v)=>h+v.total,0)/N.length,[N]),f=b=>{b&&(n(b),b>o&&c(b))},p=b=>{b&&(c(b),b<t&&n(b))};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"flex flex-wrap gap-4 justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ“ˆ Tendencia de ventas"}),e.jsxs("p",{className:"text-sm text-neutral-400",children:["Promedio diario: ",l(u)," | Total perÃ­odo:"," ",l(N.reduce((b,h)=>b+h.total,0))]})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Desde"}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"date",value:t,max:o,onChange:b=>f(b.target.value)})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Hasta"}),e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",type:"date",value:o,min:t,max:r,onChange:b=>p(b.target.value)})]})]})]}),e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:m.isLoading?e.jsx("p",{className:"text-neutral-400",role:"status",children:"Cargando datos de ventas..."}):m.isError?e.jsxs("p",{className:"text-red-400",role:"status",children:["Error al cargar los datos de ventas. ",m.error?.message]}):N.length>0?e.jsx(as,{points:N,formatter:l,averageLine:u}):e.jsxs("p",{className:"text-neutral-400",role:"status",children:["No hay ventas registradas en el rango seleccionado (",t," - ",o,")."]})})]})}function ns({page:t=0,size:o=10,sort:n="date,DESC",enabled:c=!0}={}){return $({queryKey:["sale-documents",t,o,n],queryFn:()=>yt({page:t,size:o,sort:n}),enabled:c,placeholderData:at})}const ls=new Intl.DateTimeFormat("es-CL",{dateStyle:"medium"}),os=new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0});function cs(t){if(!t)return"â€”";const o=Date.parse(t);return Number.isNaN(o)?t:ls.format(new Date(o))}function ds(t){return t==null||Number.isNaN(t)?"â€”":os.format(t)}function We(t){const o=[t.documentNumber];return(!o[0]||!o[0]?.trim())&&(o[0]=t.docNumber),(!o[0]||!o[0]?.trim())&&t.series&&t.folio!==void 0&&t.folio!==null&&(o[0]=`${t.series}-${t.folio}`),o[0]?.trim()||t.id}const is=10;function us({isOpen:t,onClose:o,pageSize:n=is}){const[c,r]=i.useState(0),a=i.useRef(null);i.useEffect(()=>{t&&r(0)},[t]);const l=ns({page:c,size:n,enabled:t}),m=l.data?.content??[],N=l.data?.totalPages??1,u=!l.isLoading&&!l.isError&&m.length===0,f=i.useMemo(()=>l.isFetching&&!l.isLoading?"Actualizando documentos...":null,[l.isFetching,l.isLoading]),p=()=>{l.refetch()},b=()=>{r(v=>Math.max(0,v-1))},h=()=>{r(v=>v+1)};return e.jsxs(Me,{open:t,onClose:o,title:"Documentos de venta",initialFocusRef:a,className:"modal--wide",children:[e.jsxs("div",{className:"sale-documents-modal","aria-live":"polite",children:[l.isLoading&&e.jsx("p",{role:"status",children:"Cargando documentos..."}),l.isError&&e.jsxs("div",{className:"sale-documents-modal__error",role:"alert",children:[e.jsx("p",{children:l.error?.message??"No se pudieron obtener los documentos de venta."}),e.jsx("button",{className:"btn",type:"button",onClick:p,children:"Reintentar"})]}),f&&e.jsx("p",{className:"muted",role:"status",children:f}),u&&e.jsx("p",{className:"muted",children:"No hay documentos de ventas registrados."}),!l.isLoading&&!l.isError&&m.length>0&&e.jsx("div",{className:"sale-documents-modal__table",children:e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table sale-documents-modal__grid",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"Fecha"}),e.jsx("th",{scope:"col",children:"NÃºmero de documento"}),e.jsx("th",{scope:"col",children:"Cliente"}),e.jsx("th",{scope:"col",children:"Total"}),e.jsx("th",{scope:"col",className:"sale-documents-modal__status-column",children:"Estado"})]})}),e.jsx("tbody",{children:m.map(v=>e.jsxs("tr",{children:[e.jsx("td",{children:cs(v.date)}),e.jsx("td",{children:e.jsx("span",{className:"sale-documents-modal__cell",title:We(v),children:We(v)})}),e.jsx("td",{children:e.jsx("span",{className:"sale-documents-modal__cell",title:v.customerName,children:v.customerName||"â€”"})}),e.jsx("td",{className:"mono",children:ds(v.total)}),e.jsx("td",{className:"sale-documents-modal__status-column",children:v.status?e.jsx("span",{className:`status ${v.status.toLowerCase()}`,"aria-label":v.status,children:v.status}):"â€”"})]},v.id))})]})})}),!l.isError&&m.length>0&&e.jsxs("div",{className:"sale-documents-modal__pagination",children:[e.jsx("button",{className:"btn",type:"button",onClick:b,disabled:c===0||l.isFetching,children:"Anterior"}),e.jsxs("span",{className:"muted",children:["PÃ¡gina ",c+1," de ",N]}),e.jsx("button",{className:"btn",type:"button",onClick:h,disabled:c+1>=N||l.isFetching,children:"Siguiente"})]})]}),e.jsx("footer",{className:"sale-documents-modal__footer",children:e.jsx("button",{ref:a,className:"btn ghost",type:"button",onClick:o,children:"Cerrar"})})]})}function ms(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function xs(){return[{productId:"P001",productName:"Laptop Dell Inspiron 15",sku:"DELL-INS-15",totalRevenue:85e5,totalQuantity:12,salesCount:12},{productId:"P002",productName:'Monitor Samsung 27"',sku:"SAM-MON-27",totalRevenue:62e5,totalQuantity:28,salesCount:28},{productId:"P003",productName:"Teclado MecÃ¡nico Logitech",sku:"LOG-KB-MEC",totalRevenue:48e5,totalQuantity:65,salesCount:65},{productId:"P004",productName:"Mouse InalÃ¡mbrico HP",sku:"HP-MOUSE-WL",totalRevenue:35e5,totalQuantity:120,salesCount:85},{productId:"P005",productName:"Webcam HD Logitech C920",sku:"LOG-CAM-920",totalRevenue:29e5,totalQuantity:42,salesCount:42},{productId:"P006",productName:"Auriculares Sony WH-1000XM4",sku:"SONY-AUR-XM4",totalRevenue:26e5,totalQuantity:18,salesCount:18},{productId:"P007",productName:"SSD Kingston 1TB",sku:"KING-SSD-1TB",totalRevenue:21e5,totalQuantity:38,salesCount:38},{productId:"P008",productName:"Impresora HP LaserJet Pro",sku:"HP-PRINT-LJ",totalRevenue:18e5,totalQuantity:8,salesCount:8},{productId:"P009",productName:"Router WiFi 6 TP-Link",sku:"TP-ROUTER-W6",totalRevenue:15e5,totalQuantity:24,salesCount:24},{productId:"P010",productName:"Cable HDMI 2.1 Premium",sku:"HDMI-21-PREM",totalRevenue:95e4,totalQuantity:95,salesCount:75}]}function hs({startDate:t,endDate:o}){const n=i.useMemo(()=>xs(),[]),c=n.length>0?n[0].totalRevenue:1;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ† Top 10 Productos mÃ¡s vendidos"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"Ranking por ingresos totales generados"})]}),e.jsx("div",{className:"space-y-3",children:n.map((r,a)=>{const l=r.totalRevenue/c*100;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4 hover:border-neutral-600 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-full bg-neutral-700 text-neutral-300 text-xs font-bold",children:a+1}),e.jsx("h3",{className:"text-neutral-100 font-medium",children:r.productName})]}),e.jsxs("p",{className:"text-xs text-neutral-400",children:["SKU: ",r.sku]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-neutral-100",children:ms(r.totalRevenue)}),e.jsxs("p",{className:"text-xs text-neutral-400",children:[r.totalQuantity.toLocaleString()," unidades"]})]})]}),e.jsx("div",{className:"relative w-full h-2 bg-neutral-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full transition-all",style:{width:`${l}%`}})}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-xs text-neutral-400",children:[r.salesCount," venta",r.salesCount>1?"s":""]}),e.jsxs("span",{className:"text-xs text-neutral-300",children:[l.toFixed(1),"%"]})]})]},r.productId)})})]})}const De=["#22d3ee","#3b82f6","#8b5cf6","#ec4899","#f59e0b","#10b981"];function Ye(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function ps(){return[{method:"Efectivo",total:125e5,count:145},{method:"Tarjeta de crÃ©dito",total:189e5,count:98},{method:"Tarjeta de dÃ©bito",total:152e5,count:112},{method:"Transferencia",total:83e5,count:42},{method:"Cheque",total:35e5,count:18},{method:"Otro",total:12e5,count:9}]}function bs({startDate:t,endDate:o}){const n=i.useMemo(()=>ps(),[]),c=n.reduce((a,l)=>a+l.total,0),r=n.map(a=>({name:a.method,value:a.total,count:a.count}));return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ’³ AnÃ¡lisis de MÃ©todos de Pago"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"DistribuciÃ³n de ventas por forma de pago"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:e.jsx("div",{style:{height:280},role:"img","aria-label":"DistribuciÃ³n de mÃ©todos de pago",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs($t,{children:[e.jsx(qt,{data:r,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:2,dataKey:"value",label:({percent:a})=>`${(a*100).toFixed(1)}%`,labelLine:{stroke:"#a3a3a3",strokeWidth:1},children:r.map((a,l)=>e.jsx(ct,{fill:De[l%De.length]},`cell-${l}`))}),e.jsx(ge,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:(a,l,m)=>[Ye(a),`${m.payload.count} transacciones`]}),e.jsx(qe,{iconType:"circle",wrapperStyle:{color:"#a3a3a3",fontSize:"12px"}})]})})})}),e.jsx("div",{className:"space-y-3",children:n.map((a,l)=>{const m=a.total/c*100;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:De[l%De.length]}}),e.jsx("h3",{className:"text-neutral-100 font-medium",children:a.method})]}),e.jsx("span",{className:"text-lg font-bold text-neutral-100",children:Ye(a.total)})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"text-neutral-400",children:[a.count," transacciones"]}),e.jsxs("span",{className:"text-neutral-300",children:[m.toFixed(1),"%"]})]})]},a.method)})})]})]})}function gs(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function js(){return[{type:"Factura ElectrÃ³nica",count:185,total:425e5},{type:"Boleta ElectrÃ³nica",count:312,total:189e5},{type:"Nota de CrÃ©dito",count:28,total:32e5},{type:"Nota de DÃ©bito",count:15,total:15e5},{type:"GuÃ­a de Despacho",count:94,total:0}]}function fs({startDate:t,endDate:o}){const n=i.useMemo(()=>js(),[]),c=n.map(r=>({name:r.type,cantidad:r.count,monto:r.total/1e6}));return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ“‹ AnÃ¡lisis de Tipos de Documento"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"Desglose por tipo de documento tributario"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:e.jsx("div",{style:{height:300},role:"img","aria-label":"Cantidad de documentos por tipo",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(Oe,{data:c,layout:"vertical",margin:{top:10,right:10,left:120,bottom:10},children:[e.jsx(Ne,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(ve,{type:"number",stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:12}}),e.jsx(ye,{dataKey:"name",type:"category",stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:12},width:110}),e.jsx(ge,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:(r,a)=>a==="cantidad"?[r,"Cantidad"]:a==="monto"?[`${r.toFixed(1)}M`,"Monto (millones)"]:[r,a]}),e.jsx(Be,{dataKey:"cantidad",fill:"#22d3ee",radius:[0,4,4,0]})]})})})}),e.jsx("div",{className:"space-y-3",children:n.map(r=>e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-neutral-100 font-medium mb-2",children:r.type}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Cantidad"}),e.jsx("span",{className:"text-sm font-semibold text-neutral-100",children:r.count.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Monto total"}),e.jsx("span",{className:"text-sm font-semibold text-neutral-100",children:r.total>0?gs(r.total):"N/A"})]})]})]},r.type))})]})]})}function Ns(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function vs(){return{cancellationRate:4.2,avgTicket:125500,peakHour:"14:00 - 15:00",weeklyTrend:"up",totalSales:634,totalCancelled:27}}function ys({startDate:t,endDate:o}){const n=i.useMemo(()=>vs(),[]);return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ“Š MÃ©tricas de Rendimiento"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"Indicadores clave de desempeÃ±o comercial"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸš«"}),e.jsx("h3",{className:"text-sm font-medium text-neutral-400",children:"Tasa de CancelaciÃ³n"})]}),e.jsxs("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:[n.cancellationRate.toFixed(1),"%"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-neutral-400",children:[n.totalCancelled," de ",n.totalSales," ventas"]}),n.cancellationRate<5?e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-green-950 text-green-400 border border-green-800",children:"ðŸŸ¢ Bajo"}):n.cancellationRate<10?e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-yellow-950 text-yellow-400 border border-yellow-800",children:"ðŸŸ¡ Medio"}):e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-red-950 text-red-400 border border-red-800",children:"ðŸ”´ Alto"})]})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŽ«"}),e.jsx("h3",{className:"text-sm font-medium text-neutral-400",children:"Ticket Promedio"})]}),e.jsx("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:Ns(n.avgTicket)}),e.jsx("p",{className:"text-xs text-neutral-400",children:"Por transacciÃ³n emitida"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"â°"}),e.jsx("h3",{className:"text-sm font-medium text-neutral-400",children:"Horario Pico"})]}),e.jsx("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:n.peakHour.split(" - ")[0]}),e.jsx("p",{className:"text-xs text-neutral-400",children:"Mayor volumen de ventas"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“ˆ"}),e.jsx("h3",{className:"text-sm font-medium text-neutral-400",children:"Tendencia Semanal"})]}),e.jsx("div",{className:"flex items-center gap-2 mb-1",children:n.weeklyTrend==="up"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-3xl font-bold text-green-400",children:"â†—"}),e.jsx("span",{className:"text-lg font-semibold text-neutral-100",children:"Crecimiento"})]}):n.weeklyTrend==="down"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-3xl font-bold text-red-400",children:"â†˜"}),e.jsx("span",{className:"text-lg font-semibold text-neutral-100",children:"Descenso"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-3xl font-bold text-neutral-400",children:"â†’"}),e.jsx("span",{className:"text-lg font-semibold text-neutral-100",children:"Estable"})]})}),e.jsx("p",{className:"text-xs text-neutral-400",children:"Comparado con semana anterior"})]})]}),e.jsxs("div",{className:"mt-6 bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-100",children:"Progreso del perÃ­odo"}),e.jsxs("span",{className:"text-sm text-neutral-400",children:[n.totalSales," ventas totales"]})]}),e.jsx("div",{className:"relative w-full h-3 bg-neutral-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-green-500 to-cyan-500 rounded-full",style:{width:`${(n.totalSales-n.totalCancelled)/n.totalSales*100}%`}})}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-xs text-green-400",children:[n.totalSales-n.totalCancelled," emitidas (",((1-n.cancellationRate/100)*100).toFixed(1),"%)"]}),e.jsxs("span",{className:"text-xs text-red-400",children:[n.totalCancelled," canceladas (",n.cancellationRate.toFixed(1),"%)"]})]})]})]})}function Xe(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function Cs(t){return new Date(t).toLocaleDateString("es-CL",{day:"numeric",month:"short"})}function ws(){return[{customerId:"C001",customerName:"Empresa TechSolutions SpA",totalRevenue:158e5,purchaseCount:42,avgTicket:376190,lastPurchaseDate:"2024-01-25"},{customerId:"C002",customerName:"Comercial Del Norte Ltda",totalRevenue:124e5,purchaseCount:38,avgTicket:326316,lastPurchaseDate:"2024-01-24"},{customerId:"C003",customerName:"Servicios Integrales SA",totalRevenue:98e5,purchaseCount:28,avgTicket:35e4,lastPurchaseDate:"2024-01-23"},{customerId:"C004",customerName:"Distribuidora Central",totalRevenue:85e5,purchaseCount:52,avgTicket:163462,lastPurchaseDate:"2024-01-25"},{customerId:"C005",customerName:"Constructora Horizonte",totalRevenue:72e5,purchaseCount:15,avgTicket:48e4,lastPurchaseDate:"2024-01-22"},{customerId:"C006",customerName:"Retail Express SpA",totalRevenue:69e5,purchaseCount:64,avgTicket:107813,lastPurchaseDate:"2024-01-25"},{customerId:"C007",customerName:"Alimentos Frescos SA",totalRevenue:58e5,purchaseCount:31,avgTicket:187097,lastPurchaseDate:"2024-01-21"},{customerId:"C008",customerName:"Transporte RÃ¡pido Ltda",totalRevenue:45e5,purchaseCount:22,avgTicket:204545,lastPurchaseDate:"2024-01-20"},{customerId:"C009",customerName:"Farmacia Salud Total",totalRevenue:38e5,purchaseCount:48,avgTicket:79167,lastPurchaseDate:"2024-01-25"},{customerId:"C010",customerName:"MueblerÃ­a El Roble",totalRevenue:32e5,purchaseCount:9,avgTicket:355556,lastPurchaseDate:"2024-01-19"}]}function Ss({startDate:t,endDate:o}){const n=i.useMemo(()=>ws(),[]),c=n.length>0?n[0].totalRevenue:1;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ‘¥ Top 10 Clientes"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"Clientes con mayor volumen de compras"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-700",children:[e.jsx("th",{className:"text-left py-3 px-2 text-xs font-semibold text-neutral-400 uppercase",children:"#"}),e.jsx("th",{className:"text-left py-3 px-2 text-xs font-semibold text-neutral-400 uppercase",children:"Cliente"}),e.jsx("th",{className:"text-right py-3 px-2 text-xs font-semibold text-neutral-400 uppercase",children:"Ingresos"}),e.jsx("th",{className:"text-center py-3 px-2 text-xs font-semibold text-neutral-400 uppercase",children:"Compras"}),e.jsx("th",{className:"text-right py-3 px-2 text-xs font-semibold text-neutral-400 uppercase",children:"Ticket Prom."}),e.jsx("th",{className:"text-center py-3 px-2 text-xs font-semibold text-neutral-400 uppercase",children:"Ãšltima Compra"})]})}),e.jsx("tbody",{children:n.map((r,a)=>{const l=r.totalRevenue/c*100,m=new Date(r.lastPurchaseDate)>new Date(Date.now()-4320*60*1e3);return e.jsxs("tr",{className:"border-b border-neutral-800 hover:bg-neutral-800 transition-colors",children:[e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-7 h-7 rounded-full bg-neutral-700 text-neutral-300 text-xs font-bold",children:a+1}),a<3&&e.jsx("span",{className:"text-lg",children:a===0?"ðŸ¥‡":a===1?"ðŸ¥ˆ":"ðŸ¥‰"})]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-100 font-medium",children:r.customerName}),e.jsx("div",{className:"relative w-full h-1.5 bg-neutral-700 rounded-full overflow-hidden mt-1",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full",style:{width:`${l}%`}})})]})}),e.jsx("td",{className:"py-4 px-2 text-right",children:e.jsx("p",{className:"text-neutral-100 font-bold",children:Xe(r.totalRevenue)})}),e.jsx("td",{className:"py-4 px-2 text-center",children:e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-neutral-800 text-neutral-300 border border-neutral-700",children:r.purchaseCount})}),e.jsx("td",{className:"py-4 px-2 text-right",children:e.jsx("p",{className:"text-neutral-300",children:Xe(r.avgTicket)})}),e.jsx("td",{className:"py-4 px-2 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${m?"bg-green-950 text-green-400 border border-green-800":"bg-neutral-800 text-neutral-400 border border-neutral-700"}`,children:[m&&"ðŸŸ¢ ",Cs(r.lastPurchaseDate)]})})]},r.customerId)})})]})})]})}function ke(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function Ps(){return[{hour:"09:00",sales:85e4,count:8},{hour:"10:00",sales:12e5,count:12},{hour:"11:00",sales:185e4,count:18},{hour:"12:00",sales:24e5,count:22},{hour:"13:00",sales:15e5,count:14},{hour:"14:00",sales:32e5,count:28},{hour:"15:00",sales:29e5,count:26},{hour:"16:00",sales:21e5,count:19},{hour:"17:00",sales:17e5,count:16},{hour:"18:00",sales:12e5,count:11},{hour:"19:00",sales:9e5,count:8}]}function Ds({date:t}){const o=i.useMemo(()=>Ps(),[]),n=o.reduce((l,m)=>l+m.sales,0),c=o.reduce((l,m)=>l+m.count,0),r=o.reduce((l,m)=>m.sales>l.sales?m:l,o[0]),a=o.map(l=>({hora:l.hour,ventas:l.sales/1e6,cantidad:l.count}));return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"â° Timeline Diario de Ventas"}),e.jsxs("p",{className:"text-sm text-neutral-400",children:["PatrÃ³n de ventas por hora | Total: ",ke(n)," (",c," ventas)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Hora Pico"}),e.jsx("p",{className:"text-2xl font-bold text-neutral-100",children:r.hour}),e.jsxs("p",{className:"text-xs text-neutral-400 mt-1",children:[ke(r.sales)," en ",r.count," ventas"]})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Promedio por Hora"}),e.jsx("p",{className:"text-2xl font-bold text-neutral-100",children:ke(n/o.length)}),e.jsxs("p",{className:"text-xs text-neutral-400 mt-1",children:[(c/o.length).toFixed(1)," ventas/hora"]})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Ticket Promedio"}),e.jsx("p",{className:"text-2xl font-bold text-neutral-100",children:ke(n/c)}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:"Por transacciÃ³n"})]})]}),e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:e.jsx("div",{style:{height:320},role:"img","aria-label":"Ventas por hora del dÃ­a",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(Oe,{data:a,margin:{top:10,right:10,left:10,bottom:10},children:[e.jsx(Ne,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(ve,{dataKey:"hora",stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:12}}),e.jsx(ye,{stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:12}}),e.jsx(ge,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:(l,m)=>m==="ventas"?[`${l.toFixed(2)}M`,"Ventas (millones)"]:m==="cantidad"?[l,"Cantidad"]:[l,m]}),e.jsx(Be,{dataKey:"ventas",fill:"#22d3ee",radius:[4,4,0,0]})]})})})}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium bg-green-950 text-green-400 border border-green-800",children:"ðŸŸ¢ Horario pico: 14:00-15:00"}),e.jsx("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium bg-yellow-950 text-yellow-400 border border-yellow-800",children:"ðŸŸ¡ Horario medio: 11:00-12:00, 16:00-17:00"}),e.jsx("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium bg-neutral-800 text-neutral-400 border border-neutral-700",children:"âšª Horario bajo: 09:00-10:00, 19:00"})]})]})}function Je(t){return`$${Math.round(t).toLocaleString("es-CL")}`}function ks(t){const o=[],n=[{date:xe(-7),actual:28e5},{date:xe(-6),actual:32e5},{date:xe(-5),actual:29e5},{date:xe(-4),actual:35e5},{date:xe(-3),actual:31e5},{date:xe(-2),actual:38e5},{date:xe(-1),actual:34e5}],c=n.reduce((a,l)=>a+l.actual,0)/n.length,r=(n[n.length-1].actual-n[0].actual)/n.length;n.forEach(a=>{o.push({date:a.date,actual:a.actual,predicted:a.actual,confidence:"high"})});for(let a=0;a<t;a++){const l=c+r*(n.length+a)+(Math.random()*2e5-1e5),m=a<3?"high":a<7?"medium":"low";o.push({date:xe(a),predicted:Math.max(0,l),confidence:m})}return o}function xe(t){const o=new Date;return o.setDate(o.getDate()+t),o.toLocaleDateString("es-CL",{day:"2-digit",month:"short"})}function Ts({days:t=7}){const o=i.useMemo(()=>ks(t),[t]),n=o.filter(u=>u.actual!==void 0),c=o.filter(u=>u.actual===void 0),r=c.reduce((u,f)=>u+f.predicted,0),a=r/c.length,l=n.reduce((u,f)=>u+(f.actual||0),0)/n.length,m=(a-l)/l*100,N=o.map(u=>({fecha:u.date,real:u.actual?u.actual/1e6:null,proyeccion:u.predicted/1e6}));return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-100 mb-1",children:"ðŸ”® PronÃ³stico de Ventas"}),e.jsxs("p",{className:"text-sm text-neutral-400",children:["ProyecciÃ³n prÃ³ximos ",t," dÃ­as basada en tendencia histÃ³rica"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Ventas Proyectadas"}),e.jsx("p",{className:"text-2xl font-bold text-neutral-100",children:Je(r)}),e.jsxs("p",{className:"text-xs text-neutral-400 mt-1",children:["PrÃ³ximos ",t," dÃ­as"]})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Promedio Diario"}),e.jsx("p",{className:"text-2xl font-bold text-neutral-100",children:Je(a)}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:"Estimado futuro"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Crecimiento Esperado"}),e.jsxs("p",{className:`text-2xl font-bold ${m>=0?"text-green-400":"text-red-400"}`,children:[m>=0?"+":"",m.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:"vs promedio histÃ³rico"})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-neutral-400 mb-1",children:"Confianza"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[c.filter(u=>u.confidence==="high").length>0&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-green-950 text-green-400 border border-green-800",children:"ðŸŸ¢ Alta"}),c.filter(u=>u.confidence==="medium").length>0&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-yellow-950 text-yellow-400 border border-yellow-800",children:"ðŸŸ¡ Media"}),c.filter(u=>u.confidence==="low").length>0&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-red-950 text-red-400 border border-red-800",children:"ðŸ”´ Baja"})]})]})]}),e.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:e.jsx("div",{style:{height:320},role:"img","aria-label":"GrÃ¡fico de pronÃ³stico de ventas",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(dt,{data:N,margin:{top:10,right:10,left:10,bottom:10},children:[e.jsx(Ne,{strokeDasharray:"3 3",stroke:"#404040"}),e.jsx(ve,{dataKey:"fecha",stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:11}}),e.jsx(ye,{stroke:"#a3a3a3",tick:{fill:"#a3a3a3",fontSize:12}}),e.jsx(ge,{contentStyle:{backgroundColor:"#171717",border:"1px solid #404040",borderRadius:"0.5rem",color:"#f5f5f5"},formatter:(u,f)=>f==="real"?[`${u.toFixed(2)}M`,"Ventas reales"]:f==="proyeccion"?[`${u.toFixed(2)}M`,"ProyecciÃ³n"]:[u,f]}),e.jsx(ot,{x:n[n.length-1]?.date,stroke:"#fb923c",strokeDasharray:"5 5",strokeWidth:2}),e.jsx(Fe,{type:"monotone",dataKey:"real",stroke:"#22d3ee",strokeWidth:3,dot:{r:5,fill:"#0891b2",stroke:"#22d3ee",strokeWidth:2},connectNulls:!1}),e.jsx(Fe,{type:"monotone",dataKey:"proyeccion",stroke:"#a78bfa",strokeWidth:2,strokeDasharray:"5 5",dot:{r:4,fill:"#7c3aed",stroke:"#a78bfa",strokeWidth:2}})]})})})}),e.jsx("div",{className:"mt-4 bg-blue-950 border border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-lg",children:"â„¹ï¸"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-blue-400 mb-1",children:"Acerca del pronÃ³stico"}),e.jsxs("ul",{className:"text-xs text-blue-300 space-y-1",children:[e.jsx("li",{children:"â€¢ Basado en promedio mÃ³vil de Ãºltimos 7 dÃ­as y tendencia detectada"}),e.jsx("li",{children:"â€¢ La confianza disminuye con dÃ­as mÃ¡s lejanos (alta: 1-3 dÃ­as, media: 4-7 dÃ­as, baja: 8+ dÃ­as)"}),e.jsx("li",{children:"â€¢ Factores externos (promociones, temporadas, eventos) pueden afectar la precisiÃ³n"})]})]})]})})]})}function Rs({isOpen:t,onClose:o,filters:n,totalRecords:c}){const[r,a]=i.useState("csv"),[l,m]=i.useState("filtered"),[N,u]=i.useState(!0),f=ie({mutationFn:async()=>{const h=l==="all"?{}:{status:n.status||void 0,docType:n.docType||void 0,paymentMethod:n.paymentMethod||void 0,search:n.search||void 0};if(r==="csv"){const v=await rt(h);p(v,`ventas-${new Date().toISOString().split("T")[0]}.csv`)}else{const v={metadata:N?{exportDate:new Date().toISOString(),filters:n,totalRecords:c,scope:l}:void 0,summary:{totalRecords:c,appliedFilters:Object.keys(n).filter(P=>n[P])},data:[]},T=new Blob([JSON.stringify(v,null,2)],{type:"application/json"});p(T,`ventas-${new Date().toISOString().split("T")[0]}.json`)}},onSuccess:()=>{o()}});function p(h,v){const T=URL.createObjectURL(h),P=document.createElement("a");P.href=T,P.download=v,P.rel="noopener",document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(T)}if(!t)return null;const b=Object.entries(n).filter(([h,v])=>v&&v!=="").map(([h,v])=>({key:h,value:v}));return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-2xl p-6 max-w-lg w-full mx-4",children:[e.jsxs("header",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-neutral-100 mb-2",children:"ðŸ“¥ Exportar Ventas"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"Configura las opciones de exportaciÃ³n para tus documentos de ventas"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-100 mb-3",children:"Formato de archivo"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>a("csv"),className:`p-4 rounded-lg border-2 transition-all ${r==="csv"?"border-cyan-500 bg-cyan-950 text-cyan-400":"border-neutral-700 bg-neutral-800 text-neutral-400 hover:border-neutral-600"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ“Š"}),e.jsx("div",{className:"font-semibold",children:"CSV"}),e.jsx("div",{className:"text-xs mt-1",children:"Excel compatible"})]}),e.jsxs("button",{type:"button",onClick:()=>a("json"),className:`p-4 rounded-lg border-2 transition-all ${r==="json"?"border-purple-500 bg-purple-950 text-purple-400":"border-neutral-700 bg-neutral-800 text-neutral-400 hover:border-neutral-600"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸ”§"}),e.jsx("div",{className:"font-semibold",children:"JSON"}),e.jsx("div",{className:"text-xs mt-1",children:"Desarrollo/API"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-100 mb-3",children:"Datos a exportar"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{type:"button",onClick:()=>m("filtered"),className:`w-full p-3 rounded-lg border text-left transition-all ${l==="filtered"?"border-cyan-500 bg-cyan-950 text-cyan-100":"border-neutral-700 bg-neutral-800 text-neutral-300 hover:border-neutral-600"}`,children:[e.jsxs("div",{className:"font-medium",children:["Resultados filtrados (",c,")"]}),e.jsx("div",{className:"text-xs mt-1 opacity-75",children:"Exportar solo los registros con filtros aplicados"})]}),e.jsxs("button",{type:"button",onClick:()=>m("all"),className:`w-full p-3 rounded-lg border text-left transition-all ${l==="all"?"border-cyan-500 bg-cyan-950 text-cyan-100":"border-neutral-700 bg-neutral-800 text-neutral-300 hover:border-neutral-600"}`,children:[e.jsx("div",{className:"font-medium",children:"Todas las ventas"}),e.jsx("div",{className:"text-xs mt-1 opacity-75",children:"Exportar todos los registros sin filtros"})]})]})]}),r==="json"&&e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg bg-neutral-800 border border-neutral-700 cursor-pointer hover:border-neutral-600 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:h=>u(h.target.checked),className:"w-4 h-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-100",children:"Incluir metadatos"}),e.jsx("div",{className:"text-xs text-neutral-400 mt-0.5",children:"Fecha, filtros aplicados, estadÃ­sticas"})]})]})}),b.length>0&&l==="filtered"&&e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-100 mb-2",children:"Filtros aplicados:"}),e.jsx("div",{className:"space-y-1",children:b.map(({key:h,value:v})=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded bg-neutral-700 text-neutral-300 font-medium",children:h}),e.jsx("span",{className:"text-neutral-400",children:"="}),e.jsx("span",{className:"text-neutral-100",children:v})]},h))})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-6 border-t border-neutral-800",children:[e.jsx("button",{type:"button",onClick:o,disabled:f.isPending,className:"flex-1 px-4 py-2.5 rounded-lg bg-neutral-800 border border-neutral-700 text-neutral-100 hover:bg-neutral-700 transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:()=>f.mutate(),disabled:f.isPending,className:"flex-1 px-4 py-2.5 rounded-lg bg-cyan-600 text-white font-medium hover:bg-cyan-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:f.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"â³"}),"Exportando..."]}):e.jsxs(e.Fragment,{children:["ðŸ“¥ Exportar ",r.toUpperCase()]})})]})]})})}function Fs(){const{data:t,isLoading:o,error:n}=$({queryKey:["salesKPIs"],queryFn:()=>Ct(),refetchInterval:3e5});if(o)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 animate-pulse",children:[1,2,3,4,5,6,7,8].map(m=>e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6 h-32"},m))});if(n)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar KPIs de ventas"})});if(!t)return null;const c=m=>`$${m.toLocaleString("es-CL",{maximumFractionDigits:0})}`,r=m=>`${m.toFixed(1)}%`,a=m=>m>0?"text-green-400":m<0?"text-red-400":"text-neutral-400",l=m=>m>0?"â†—ï¸":m<0?"â†˜ï¸":"â†’";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"ðŸ“Š KPIs Avanzados de Ventas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-900/30 to-blue-800/20 border border-blue-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-blue-400 mb-1",children:"Ingresos Totales"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:c(t.totalRevenue)}),e.jsxs("div",{className:"text-xs text-blue-300 mt-2",children:[t.totalOrders," Ã³rdenes emitidas"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-900/30 to-green-800/20 border border-green-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-green-400 mb-1",children:"Utilidad Bruta"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:c(t.grossProfit)}),e.jsxs("div",{className:"text-xs text-green-300 mt-2",children:["Margen: ",r(t.profitMargin)]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-900/30 to-purple-800/20 border border-purple-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-purple-400 mb-1",children:"Ticket Promedio"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:c(t.averageTicket)}),e.jsx("div",{className:"text-xs text-purple-300 mt-2",children:"Por orden emitida"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-900/30 to-orange-800/20 border border-orange-800 rounded-lg p-6",children:[e.jsx("div",{className:"text-sm text-orange-400 mb-1",children:"Crecimiento"}),e.jsxs("div",{className:`text-3xl font-bold ${a(t.salesGrowth)}`,children:[l(t.salesGrowth)," ",r(Math.abs(t.salesGrowth))]}),e.jsx("div",{className:"text-xs text-orange-300 mt-2",children:"vs perÃ­odo anterior"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Clientes Ãšnicos"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:t.uniqueCustomers}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:["RetenciÃ³n: ",r(t.customerRetentionRate)]})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Tasa de ConversiÃ³n"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:r(t.conversionRate)}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Emitidas vs total"})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Top Producto"}),e.jsx("div",{className:"text-lg font-semibold text-white truncate",title:t.topProductName,children:t.topProductName}),e.jsx("div",{className:"text-sm text-green-400 mt-1",children:c(t.topProductRevenue)})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-5",children:[e.jsx("div",{className:"text-sm text-neutral-400 mb-1",children:"Top Cliente"}),e.jsx("div",{className:"text-lg font-semibold text-white truncate",title:t.topCustomerName,children:t.topCustomerName}),e.jsx("div",{className:"text-sm text-blue-400 mt-1",children:c(t.topCustomerRevenue)})]})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Desglose de Ingresos"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-400",children:"Ingresos Totales"}),e.jsx("span",{className:"text-white font-semibold",children:c(t.totalRevenue)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-500 h-3 rounded-full",style:{width:"100%"}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-400",children:"Costo Estimado"}),e.jsx("span",{className:"text-red-400 font-semibold",children:c(t.totalCost)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-red-500 h-3 rounded-full",style:{width:`${t.totalCost/t.totalRevenue*100}%`}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-neutral-400",children:"Utilidad Bruta"}),e.jsx("span",{className:"text-green-400 font-bold text-lg",children:c(t.grossProfit)})]}),e.jsx("div",{className:"w-full bg-neutral-800 rounded-full h-3",children:e.jsx("div",{className:"bg-green-500 h-3 rounded-full",style:{width:`${t.profitMargin}%`}})})]})]}),e.jsx("div",{className:"bg-blue-900/20 border border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-blue-400",children:["ðŸ“… PerÃ­odo de anÃ¡lisis: ",new Date(t.periodStart).toLocaleDateString("es-CL")," -"," ",new Date(t.periodEnd).toLocaleDateString("es-CL")]}),e.jsx("span",{className:"text-xs text-blue-300",children:"Actualizado automÃ¡ticamente cada 5 minutos"})]})})]})}function Es(){const{data:t=[],isLoading:o}=$({queryKey:["salesABCAnalysis"],queryFn:()=>Ae(),refetchInterval:3e5});if(o)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-neutral-800 rounded"})]})});const n=t.filter(p=>p.classification==="A"),c=t.filter(p=>p.classification==="B"),r=t.filter(p=>p.classification==="C"),a=t.reduce((p,b)=>p+b.totalRevenue,0),l=n.reduce((p,b)=>p+b.totalRevenue,0),m=c.reduce((p,b)=>p+b.totalRevenue,0),N=r.reduce((p,b)=>p+b.totalRevenue,0),u=[{class:"Clase A",count:n.length,revenue:l,percentage:a>0?l/a*100:0},{class:"Clase B",count:c.length,revenue:m,percentage:a>0?m/a*100:0},{class:"Clase C",count:r.length,revenue:N,percentage:a>0?N/a*100:0}],f={"Clase A":"#ef4444","Clase B":"#f59e0b","Clase C":"#10b981"};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"DistribuciÃ³n ABC de Productos"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-red-950 border border-red-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-red-200",children:"Clase A - Productos Estrella"}),e.jsxs("span",{className:"text-xs bg-red-900 text-red-200 px-2 py-1 rounded",children:[n.length," productos"]})]}),e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:["$",l.toLocaleString("es-CL")]}),e.jsxs("div",{className:"text-sm text-red-300",children:[a>0?(l/a*100).toFixed(1):0,"% de ingresos"]})]}),e.jsxs("div",{className:"bg-amber-950 border border-amber-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-amber-200",children:"Clase B - Productos Importantes"}),e.jsxs("span",{className:"text-xs bg-amber-900 text-amber-200 px-2 py-1 rounded",children:[c.length," productos"]})]}),e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:["$",m.toLocaleString("es-CL")]}),e.jsxs("div",{className:"text-sm text-amber-300",children:[a>0?(m/a*100).toFixed(1):0,"% de ingresos"]})]}),e.jsxs("div",{className:"bg-emerald-950 border border-emerald-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-emerald-200",children:"Clase C - Productos Ocasionales"}),e.jsxs("span",{className:"text-xs bg-emerald-900 text-emerald-200 px-2 py-1 rounded",children:[r.length," productos"]})]}),e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:["$",N.toLocaleString("es-CL")]}),e.jsxs("div",{className:"text-sm text-emerald-300",children:[a>0?(N/a*100).toFixed(1):0,"% de ingresos"]})]})]}),e.jsx(be,{width:"100%",height:300,children:e.jsxs(Oe,{data:u,children:[e.jsx(Ne,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(ve,{dataKey:"class",stroke:"#9ca3af"}),e.jsx(ye,{stroke:"#9ca3af"}),e.jsx(ge,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"0.375rem",color:"#fff"},formatter:(p,b)=>b==="revenue"?[`$${p.toLocaleString("es-CL")}`,"Ingresos"]:b==="percentage"?[`${p.toFixed(1)}%`,"% del Total"]:[p,b]}),e.jsx(qe,{}),e.jsx(Be,{dataKey:"revenue",name:"Ingresos",radius:[4,4,0,0],children:u.map((p,b)=>e.jsx(ct,{fill:f[p.class]},`cell-${b}`))})]})}),e.jsxs("div",{className:"mt-6 bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"ðŸ“Š Principio de Pareto (80-15-5)"}),e.jsxs("p",{className:"text-xs text-neutral-300 leading-relaxed",children:["El anÃ¡lisis ABC clasifica productos segÃºn su contribuciÃ³n a los ingresos."," ",e.jsx("strong",{className:"text-white",children:"Clase A"})," (â‰¤80% acumulado) representa los productos estrella que generan la mayor parte de los ingresos."," ",e.jsx("strong",{className:"text-white",children:"Clase B"})," (80-95% acumulado) son productos importantes con potencial de crecimiento. ",e.jsx("strong",{className:"text-white",children:"Clase C"})," ","(>95%) son productos ocasionales que aportan poco, candidatos para evaluaciÃ³n o descontinuaciÃ³n."]})]})]})}function _s(){const{data:t=[],isLoading:o}=$({queryKey:["salesABCAnalysis"],queryFn:()=>Ae(),refetchInterval:3e5}),n=i.useMemo(()=>[...t].sort((r,a)=>a.totalRevenue-r.totalRevenue),[t]);if(o)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((r,a)=>e.jsx("div",{className:"h-12 bg-neutral-800 rounded"},a))})]})});const c={A:{bg:"bg-red-950",border:"border-red-900",text:"text-red-200"},B:{bg:"bg-amber-950",border:"border-amber-900",text:"text-amber-200"},C:{bg:"bg-emerald-950",border:"border-emerald-900",text:"text-emerald-200"}};return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"ClasificaciÃ³n Detallada de Productos"}),e.jsxs("span",{className:"text-sm text-neutral-400",children:[n.length," productos"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-3 px-2 text-neutral-400 font-medium",children:"Clase"}),e.jsx("th",{className:"text-left py-3 px-2 text-neutral-400 font-medium",children:"Producto"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"Ingresos"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"Ventas"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"% Total"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"% Acum."}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"Precio Prom."}),e.jsx("th",{className:"text-left py-3 px-2 text-neutral-400 font-medium",children:"AcciÃ³n Recomendada"})]})}),e.jsx("tbody",{children:n.map((r,a)=>{const l=c[r.classification]||c.C,m=a<10;return e.jsxs("tr",{className:`border-b border-neutral-800 hover:bg-neutral-800/50 transition-colors ${m?"bg-neutral-800/30":""}`,children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold ${l.bg} ${l.border} ${l.text}`,children:r.classification})}),e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-white font-medium",children:r.productName}),e.jsxs("span",{className:"text-xs text-neutral-400",children:["ID: ",r.productId]})]})}),e.jsxs("td",{className:"py-3 px-2 text-right text-white font-medium",children:["$",r.totalRevenue.toLocaleString("es-CL")]}),e.jsx("td",{className:"py-3 px-2 text-right text-neutral-300",children:r.salesCount}),e.jsxs("td",{className:"py-3 px-2 text-right text-neutral-300",children:[r.percentageOfTotal.toFixed(2),"%"]}),e.jsxs("td",{className:"py-3 px-2 text-right text-neutral-300",children:[r.cumulativePercentage.toFixed(2),"%"]}),e.jsxs("td",{className:"py-3 px-2 text-right text-neutral-300",children:["$",r.averagePrice.toLocaleString("es-CL")]}),e.jsx("td",{className:"py-3 px-2 text-neutral-400 text-xs max-w-xs truncate",children:r.recommendedAction})]},r.productId)})})]})}),n.length===0&&e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"No hay datos de clasificaciÃ³n ABC disponibles"}),n.length>0&&e.jsxs("div",{className:"mt-4 text-xs text-neutral-500 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-neutral-800/30 rounded"}),e.jsx("span",{children:"Top 10 productos destacados"})]})]})}function Ls(){const{data:t=[],isLoading:o}=$({queryKey:["salesABCAnalysis"],queryFn:()=>Ae(),refetchInterval:3e5});if(o)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3"}),e.jsx("div",{className:"h-32 bg-neutral-800 rounded"}),e.jsx("div",{className:"h-32 bg-neutral-800 rounded"})]})});const n=t.filter(p=>p.classification==="A"),c=t.filter(p=>p.classification==="B"),r=t.filter(p=>p.classification==="C"),a=t.reduce((p,b)=>p+b.totalRevenue,0),l=n.reduce((p,b)=>p+b.totalRevenue,0),m=c.reduce((p,b)=>p+b.totalRevenue,0),N=r.reduce((p,b)=>p+b.totalRevenue,0),u=a>0?l/a*100:0,f=r.length;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"Recomendaciones EstratÃ©gicas por Clase"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-red-950 border border-red-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"â­"}),e.jsxs("h4",{className:"text-base font-semibold text-red-100",children:["Clase A - Productos Estrella (",n.length," productos)"]})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-red-200",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Stock prioritario:"})," Mantener niveles de inventario elevados para evitar quiebres de stock"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"PromociÃ³n activa:"})," Destacar en campaÃ±as de marketing, vitrinas y canales digitales"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"AnÃ¡lisis de precio:"})," Optimizar mÃ¡rgenes sin sacrificar volumen de ventas"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"RelaciÃ³n con proveedores:"})," Negociar condiciones preferenciales y continuidad de suministro"]})]})]})]}),e.jsxs("div",{className:"bg-amber-950 border border-amber-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“ˆ"}),e.jsxs("h4",{className:"text-base font-semibold text-amber-100",children:["Clase B - Productos Importantes (",c.length," productos)"]})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-amber-200",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Potencial de crecimiento:"})," Evaluar estrategias para promover a Clase A mediante promociones dirigidas"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"RevisiÃ³n de pricing:"})," Ajustar precios para mejorar competitividad sin afectar mÃ¡rgenes"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"OptimizaciÃ³n de inventario:"})," Mantener stock equilibrado basado en demanda histÃ³rica"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Cross-selling:"})," Bundling con productos Clase A para aumentar ticket promedio"]})]})]})]}),e.jsxs("div",{className:"bg-emerald-950 border border-emerald-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ”"}),e.jsxs("h4",{className:"text-base font-semibold text-emerald-100",children:["Clase C - Productos Ocasionales (",r.length," productos)"]})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-emerald-200",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"EvaluaciÃ³n de continuidad:"})," Considerar descontinuar productos con baja rotaciÃ³n y bajo margen"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"ReducciÃ³n de stock:"})," Minimizar inventario para liberar capital de trabajo"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Promociones liquidaciÃ³n:"})," Lanzar ofertas especiales para rotar inventario estancado"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-400 mt-0.5",children:"â–ª"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Reemplazo estratÃ©gico:"})," Identificar alternativas con mejor potencial de ventas"]})]})]})]})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"ðŸ’¡ AnÃ¡lisis Global"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"ConcentraciÃ³n en Clase A"}),e.jsxs("span",{className:"text-sm font-semibold text-white",children:[u.toFixed(1),"%"]})]}),u>85&&e.jsx("p",{className:"text-xs text-red-300",children:"âš ï¸ Alta concentraciÃ³n de ingresos en pocos productos. Considerar diversificar portafolio."}),u>=70&&u<=85&&e.jsx("p",{className:"text-xs text-amber-300",children:"â„¹ï¸ ConcentraciÃ³n balanceada. Monitorear continuidad de productos Clase A."}),u<70&&e.jsx("p",{className:"text-xs text-emerald-300",children:"âœ“ Portafolio diversificado. Evaluar oportunidades de consolidaciÃ³n."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Productos con bajo impacto (Clase C)"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:f})]}),f>20&&e.jsxs("p",{className:"text-xs text-emerald-300",children:["ðŸ’¡ Oportunidad: Revisar ",f," productos para optimizar recursos y simplificar catÃ¡logo."]}),f>=10&&f<=20&&e.jsx("p",{className:"text-xs text-neutral-300",children:"â„¹ï¸ Portafolio manejable. Evaluar periÃ³dicamente productos de baja rotaciÃ³n."}),f<10&&e.jsx("p",{className:"text-xs text-neutral-300",children:"âœ“ CatÃ¡logo optimizado con pocos productos de baja rotaciÃ³n."})]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"Total Productos"}),e.jsx("div",{className:"text-xl font-bold text-white",children:t.length})]}),e.jsxs("div",{className:"bg-red-950 border border-red-900 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-red-300 mb-1",children:"Clase A"}),e.jsxs("div",{className:"text-xl font-bold text-white",children:[n.length," (",a>0?(l/a*100).toFixed(0):0,"%)"]})]}),e.jsxs("div",{className:"bg-amber-950 border border-amber-900 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-amber-300 mb-1",children:"Clase B"}),e.jsxs("div",{className:"text-xl font-bold text-white",children:[c.length," (",a>0?(m/a*100).toFixed(0):0,"%)"]})]}),e.jsxs("div",{className:"bg-emerald-950 border border-emerald-900 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-emerald-300 mb-1",children:"Clase C"}),e.jsxs("div",{className:"text-xl font-bold text-white",children:[r.length," (",a>0?(N/a*100).toFixed(0):0,"%)"]})]})]})]})}function As(){const{data:t=[],isLoading:o}=$({queryKey:["salesProductForecast"],queryFn:()=>Ie(),refetchInterval:3e5});if(o)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-neutral-800 rounded"})]})});const n=t.slice(0,5),c=n.map(l=>({name:l.productName,historical:l.historicalAverage,forecasted:l.forecastedDemand})),r=l=>l==="increasing"?"ðŸ“ˆ":l==="decreasing"?"ðŸ“‰":"âž¡ï¸",a=l=>l==="increasing"?"text-red-400":l==="decreasing"?"text-green-400":"text-neutral-400";return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"PronÃ³stico de Demanda - Top 5 Productos"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:n.map((l,m)=>{const N=l.historicalAverage>0?(l.forecastedDemand-l.historicalAverage)/l.historicalAverage*100:0;return e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs text-neutral-400",children:["#",m+1]}),e.jsx("span",{className:`text-lg ${a(l.trend)}`,children:r(l.trend)})]}),e.jsx("div",{className:"text-sm font-medium text-white mb-1 truncate",children:l.productName}),e.jsxs("div",{className:"text-xs text-neutral-400 mb-1",children:["PronÃ³stico:"," ",e.jsxs("span",{className:"text-white font-semibold",children:[l.forecastedDemand.toFixed(0)," u/mes"]})]}),e.jsxs("div",{className:"text-xs text-neutral-400",children:["HistÃ³rico: ",l.historicalAverage.toFixed(0)," u/mes"]}),e.jsxs("div",{className:`text-xs font-semibold mt-1 ${N>0?"text-red-400":N<0?"text-green-400":"text-neutral-400"}`,children:[N>0?"+":"",N.toFixed(1),"%"]}),e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("span",{className:"text-neutral-500",children:"Confianza: "}),e.jsxs("span",{className:`font-semibold ${l.confidence>=70?"text-green-400":l.confidence>=50?"text-amber-400":"text-red-400"}`,children:[l.confidence.toFixed(0),"%"]})]})]},l.productId)})}),e.jsx(be,{width:"100%",height:300,children:e.jsxs(dt,{data:c,children:[e.jsx(Ne,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(ve,{dataKey:"name",stroke:"#9ca3af",angle:-15,textAnchor:"end",height:80}),e.jsx(ye,{stroke:"#9ca3af"}),e.jsx(ge,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"0.375rem",color:"#fff"},formatter:l=>[l.toFixed(2)+" u/mes",""]}),e.jsx(qe,{}),e.jsx(Fe,{type:"monotone",dataKey:"historical",name:"Demanda HistÃ³rica",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4}}),e.jsx(Fe,{type:"monotone",dataKey:"forecasted",name:"Demanda Pronosticada",stroke:"#f59e0b",strokeWidth:2,strokeDasharray:"5 5",dot:{fill:"#f59e0b",r:4}})]})}),t.length===0&&e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"No hay datos de pronÃ³stico disponibles"})]})}function Is(){const{data:t=[],isLoading:o}=$({queryKey:["salesProductForecast"],queryFn:()=>Ie(),refetchInterval:3e5});if(o)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3 mb-4"}),e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((r,a)=>e.jsx("div",{className:"h-12 bg-neutral-800 rounded"},a))})]})});const n=r=>r==="increasing"?e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold bg-red-950 border-red-900 text-red-200",children:"â†— Creciente"}):r==="decreasing"?e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold bg-green-950 border-green-900 text-green-200",children:"â†˜ Decreciente"}):e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold bg-neutral-800 border-neutral-700 text-neutral-300",children:"â†’ Estable"}),c=r=>r>=70?e.jsxs("span",{className:"text-green-400 font-semibold",children:[r.toFixed(0),"%"]}):r>=50?e.jsxs("span",{className:"text-amber-400 font-semibold",children:[r.toFixed(0),"%"]}):e.jsxs("span",{className:"text-red-400 font-semibold",children:[r.toFixed(0),"%"]});return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"PronÃ³stico Detallado de Productos"}),e.jsxs("span",{className:"text-sm text-neutral-400",children:[t.length," productos"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-3 px-2 text-neutral-400 font-medium",children:"Producto"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"HistÃ³rico"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"PronÃ³stico"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"VariaciÃ³n"}),e.jsx("th",{className:"text-center py-3 px-2 text-neutral-400 font-medium",children:"Tendencia"}),e.jsx("th",{className:"text-center py-3 px-2 text-neutral-400 font-medium",children:"Confianza"}),e.jsx("th",{className:"text-right py-3 px-2 text-neutral-400 font-medium",children:"Stock Rec."}),e.jsx("th",{className:"text-left py-3 px-2 text-neutral-400 font-medium",children:"PrÃ³xima Venta"})]})}),e.jsx("tbody",{children:t.map((r,a)=>{const l=r.historicalAverage>0?(r.forecastedDemand-r.historicalAverage)/r.historicalAverage*100:0,m=a<10;return e.jsxs("tr",{className:`border-b border-neutral-800 hover:bg-neutral-800/50 transition-colors ${m?"bg-neutral-800/30":""}`,children:[e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-white font-medium",children:r.productName}),e.jsxs("span",{className:"text-xs text-neutral-400",children:["ID: ",r.productId]})]})}),e.jsxs("td",{className:"py-3 px-2 text-right text-neutral-300",children:[r.historicalAverage.toFixed(1)," u/mes"]}),e.jsxs("td",{className:"py-3 px-2 text-right text-white font-medium",children:[r.forecastedDemand.toFixed(1)," u/mes"]}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("span",{className:`font-semibold ${l>10?"text-red-400":l<-10?"text-green-400":"text-neutral-400"}`,children:[l>0?"+":"",l.toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-2 text-center",children:n(r.trend)}),e.jsx("td",{className:"py-3 px-2 text-center",children:c(r.confidence)}),e.jsxs("td",{className:"py-3 px-2 text-right text-neutral-300",children:[r.recommendedStock.toFixed(0)," u"]}),e.jsx("td",{className:"py-3 px-2 text-neutral-400 text-xs",children:r.nextSaleDate?new Date(r.nextSaleDate).toLocaleDateString("es-CL"):"N/A"})]},r.productId)})})]})}),t.length===0&&e.jsx("div",{className:"text-center py-12 text-neutral-500",children:"No hay datos de pronÃ³stico disponibles"}),t.length>0&&e.jsxs("div",{className:"mt-4 text-xs text-neutral-500 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-neutral-800/30 rounded"}),e.jsx("span",{children:"Top 10 productos destacados"})]})]})}function Ms(){const{data:t=[],isLoading:o}=$({queryKey:["salesProductForecast"],queryFn:()=>Ie(),refetchInterval:3e5});if(o)return e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-neutral-800 rounded w-1/3"}),e.jsx("div",{className:"h-32 bg-neutral-800 rounded"}),e.jsx("div",{className:"h-32 bg-neutral-800 rounded"})]})});const n=t.filter(u=>u.trend==="increasing"),c=t.filter(u=>u.trend==="decreasing"),r=t.filter(u=>u.confidence<60),a=t.filter(u=>{const f=t.reduce((p,b)=>p+b.forecastedDemand,0)/t.length;return u.forecastedDemand>f*2}),l=t.reduce((u,f)=>u+f.historicalAverage,0),m=t.reduce((u,f)=>u+f.forecastedDemand,0),N=l>0?(m-l)/l*100:0;return e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"Insights y Alertas de PronÃ³stico"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[n.length>0&&e.jsxs("div",{className:"bg-red-950 border border-red-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“ˆ"}),e.jsxs("h4",{className:"text-base font-semibold text-red-100",children:["Demanda Creciente (",n.length," productos)"]})]}),e.jsx("p",{className:"text-sm text-red-200 mb-3",children:"Los siguientes productos muestran tendencia de aumento en la demanda. Considere incrementar stock para evitar quiebres."}),e.jsx("div",{className:"space-y-2",children:n.slice(0,5).map(u=>{const f=u.historicalAverage>0?(u.forecastedDemand-u.historicalAverage)/u.historicalAverage*100:0;return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-red-100",children:u.productName}),e.jsxs("span",{className:"text-red-300 font-semibold",children:["+",f.toFixed(1),"%"]})]},u.productId)})}),e.jsxs("div",{className:"mt-3 text-xs text-red-300 bg-red-900/30 rounded p-2",children:["ðŸ’¡ ",e.jsx("strong",{children:"AcciÃ³n:"})," Revisar contratos con proveedores y ajustar Ã³rdenes de compra anticipadamente."]})]}),r.length>0&&e.jsxs("div",{className:"bg-amber-950 border border-amber-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"âš ï¸"}),e.jsxs("h4",{className:"text-base font-semibold text-amber-100",children:["Baja Confianza en PronÃ³stico (",r.length," productos)"]})]}),e.jsx("p",{className:"text-sm text-amber-200 mb-3",children:"Estos productos tienen datos histÃ³ricos limitados, lo que reduce la precisiÃ³n del pronÃ³stico."}),e.jsx("div",{className:"space-y-2",children:r.slice(0,5).map(u=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-amber-100",children:u.productName}),e.jsxs("span",{className:"text-amber-300 font-semibold",children:["Confianza: ",u.confidence.toFixed(0),"%"]})]},u.productId))}),e.jsxs("div",{className:"mt-3 text-xs text-amber-300 bg-amber-900/30 rounded p-2",children:["ðŸ’¡ ",e.jsx("strong",{children:"AcciÃ³n:"})," Recopilar mÃ¡s datos histÃ³ricos. Utilizar mÃ©todos de validaciÃ³n cruzada con ventas similares."]})]}),c.length>0&&e.jsxs("div",{className:"bg-green-950 border border-green-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“‰"}),e.jsxs("h4",{className:"text-base font-semibold text-green-100",children:["Demanda Decreciente (",c.length," productos)"]})]}),e.jsx("p",{className:"text-sm text-green-200 mb-3",children:"Productos con disminuciÃ³n en demanda pronosticada. Evaluar causas y ajustar inventario."}),e.jsx("div",{className:"space-y-2",children:c.slice(0,5).map(u=>{const f=u.historicalAverage>0?(u.forecastedDemand-u.historicalAverage)/u.historicalAverage*100:0;return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-green-100",children:u.productName}),e.jsxs("span",{className:"text-green-300 font-semibold",children:[f.toFixed(1),"%"]})]},u.productId)})}),e.jsxs("div",{className:"mt-3 text-xs text-green-300 bg-green-900/30 rounded p-2",children:["ðŸ’¡ ",e.jsx("strong",{children:"AcciÃ³n:"})," Reducir pedidos futuros. Considerar promociones para liquidar excedentes."]})]}),a.length>0&&e.jsxs("div",{className:"bg-purple-950 border border-purple-900 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-lg",children:"ðŸ”¥"}),e.jsxs("h4",{className:"text-base font-semibold text-purple-100",children:["Alto Volumen Pronosticado (",a.length," productos)"]})]}),e.jsx("p",{className:"text-sm text-purple-200 mb-3",children:"Productos con demanda significativamente superior al promedio. Requieren atenciÃ³n prioritaria."}),e.jsx("div",{className:"space-y-2",children:a.slice(0,5).map(u=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-purple-100",children:u.productName}),e.jsxs("span",{className:"text-purple-300 font-semibold",children:[u.forecastedDemand.toFixed(0)," u/mes"]})]},u.productId))}),e.jsxs("div",{className:"mt-3 text-xs text-purple-300 bg-purple-900/30 rounded p-2",children:["ðŸ’¡ ",e.jsx("strong",{children:"AcciÃ³n:"})," Asegurar disponibilidad con proveedores. Evaluar descuentos por volumen."]})]})]}),e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-3",children:"ðŸ“Š Resumen Global del PronÃ³stico"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Demanda HistÃ³rica Total"}),e.jsxs("span",{className:"text-sm font-semibold text-white",children:[l.toFixed(0)," u/mes"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Demanda Pronosticada Total"}),e.jsxs("span",{className:"text-sm font-semibold text-white",children:[m.toFixed(0)," u/mes"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"VariaciÃ³n Global"}),e.jsxs("span",{className:`text-sm font-semibold ${N>5?"text-red-400":N<-5?"text-green-400":"text-neutral-300"}`,children:[N>0?"+":"",N.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[N>10&&e.jsxs("p",{className:"text-xs text-red-300",children:["âš ï¸ Se espera un ",e.jsx("strong",{children:"aumento significativo"})," en la demanda global. Preparar recursos y capacidad operativa."]}),N>=-10&&N<=10&&e.jsxs("p",{className:"text-xs text-neutral-300",children:["â„¹ï¸ Demanda global ",e.jsx("strong",{children:"estable"}),". Mantener niveles actuales de inventario y operaciÃ³n."]}),N<-10&&e.jsxs("p",{className:"text-xs text-green-300",children:["â„¹ï¸ Se espera una ",e.jsx("strong",{children:"disminuciÃ³n"})," en la demanda global. Ajustar inventario y evaluar estrategias de marketing."]})]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"Productos Analizados"}),e.jsx("div",{className:"text-xl font-bold text-white",children:t.length})]}),e.jsxs("div",{className:"bg-red-950 border border-red-900 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-red-300 mb-1",children:"Demanda Creciente"}),e.jsx("div",{className:"text-xl font-bold text-white",children:n.length})]}),e.jsxs("div",{className:"bg-green-950 border border-green-900 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-green-300 mb-1",children:"Demanda Decreciente"}),e.jsx("div",{className:"text-xl font-bold text-white",children:c.length})]}),e.jsxs("div",{className:"bg-amber-950 border border-amber-900 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-amber-300 mb-1",children:"Baja Confianza"}),e.jsx("div",{className:"text-xl font-bold text-white",children:r.length})]})]})]})}const Te=10,$s=[{value:"",label:"Todos"},{value:"emitida",label:"Emitida"},{value:"cancelled",label:"Cancelada"}],qs=[{value:"",label:"Todos los documentos"},...Ke.map(t=>({value:t.value,label:t.label}))],Os=[{value:"",label:"Todos los pagos"},...ze.map(t=>({value:t.value,label:t.label}))];function Se(t,o){return t?t.toLowerCase().includes(o):!1}function X(t){return t==null||Number.isNaN(t)?"-":`$${Math.round(t).toLocaleString("es-CL")}`}function Re(t){return t==null||Number.isNaN(t)?"-":t.toLocaleString("es-CL")}function Bs(t,o){const n=[];return t&&t>0&&n.push(`- ${X(t)}`),o&&o>0&&n.push(`+ ${X(o)}`),n.length>0?n.join(" / "):"â€”"}function Le(t){return t.documentNumber&&t.documentNumber.trim()?t.documentNumber.trim():t.docNumber&&t.docNumber.trim()?t.docNumber.trim():t.series&&(t.folio??"")!==""?`${t.series}-${t.folio}`:t.id}function Ze(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]+/g,"_").replace(/^_+|_+$/g,"")}function Ks(t){if(!t)return".pdf";const o=t.toLowerCase();return o.includes("pdf")?".pdf":o.includes("html")?".html":o.includes("json")?".json":o.includes("xml")?".xml":".bin"}function et(t,o){if(o?.filename)return o.filename;const n=Ze(t.type||"documento"),c=Ze(t.number??t.id),r=Ks(o?.mimeType);return`${n||"documento"}-${c||t.id}${r}`}function zs(t){return`${t.type} ${t.number??t.id}`}function tt(t,o){const n=URL.createObjectURL(t.blob),c=document.createElement("a");c.href=n,c.download=o,c.rel="noopener",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(n)}async function Us(t,o){const n=URL.createObjectURL(t.blob),c=window.open("","_blank","noopener,noreferrer");if(!c)throw URL.revokeObjectURL(n),new Error("No se pudo abrir la ventana de impresiÃ³n. Revisa el bloqueador de ventanas emergentes.");const r=()=>{URL.revokeObjectURL(n)};if(c.addEventListener("beforeunload",r,{once:!0}),t.mimeType.toLowerCase().includes("pdf")){c.document.body.style.margin="0",c.document.body.style.height="100vh";const a=c.document.createElement("iframe");a.src=n,a.title=o,a.style.border="0",a.style.width="100%",a.style.height="100%",c.document.body.appendChild(a),a.onload=()=>{c.document.title=o,c.focus(),c.print()}}else{const a=await t.blob.text();c.document.open(),c.document.write(a),c.document.title=o,c.document.close(),c.focus(),c.print()}setTimeout(r,6e4)}function sa(){const t=st(),[o,n]=i.useState(0),[c,r]=i.useState(!1),[a,l]=i.useState("emitida"),[m,N]=i.useState(""),[u,f]=i.useState(""),[p,b]=i.useState(""),[h,v]=i.useState(null),[T,P]=i.useState(null),[J,O]=i.useState(!1),[q,W]=i.useState(!1),_=i.useRef(null),Y=i.useRef(null),oe=i.useRef(null),ce=14,he=new Date().toISOString().split("T")[0],se=new Date(Date.now()-(ce-1)*24*60*60*1e3).toISOString().split("T")[0],[B,ae]=i.useState(se),[M,re]=i.useState(he),D=nt(p,300);i.useEffect(()=>{n(0)},[a,m,u,D]),i.useEffect(()=>{J||requestAnimationFrame(()=>{_.current?.focus()})},[J]);const K=$({queryKey:["sales",o,a,m,u,D],queryFn:()=>Dt({page:o,size:Te,status:a||void 0,docType:m||void 0,paymentMethod:u||void 0,search:D||void 0}),placeholderData:at}),H=$({queryKey:["sales","metrics","summary","today"],queryFn:()=>Ee("today")}),te=$({queryKey:["sales","metrics","summary","week"],queryFn:()=>Ee("week")}),L=$({queryKey:["sales","metrics","summary","month"],queryFn:()=>Ee("month")}),A=$({queryKey:["sale-detail",h?.id],queryFn:()=>{if(!h)throw new Error("Documento no seleccionado");return kt(h.id)},enabled:!!h}),k=A.data??null,z=i.useMemo(()=>{if(!k)return{subtotal:0,discount:0,tax:0,total:0};const s=k.items.reduce((y,w)=>y+(w.discount??0),0),g=k.net,C=k.vat??0,d=k.total??g+C;return{subtotal:g,discount:s,tax:C,total:d}},[k]);i.useEffect(()=>{if(!h||!k)return;const s=Y.current;s&&requestAnimationFrame(()=>s.focus())},[h,k]);const ne=ie({mutationFn:s=>wt(s),onSuccess:()=>t.invalidateQueries({queryKey:["sales"]})}),le=ie({mutationFn:({id:s,payload:g})=>Pt(s,g),onSuccess:()=>t.invalidateQueries({queryKey:["sales"]})}),R=ie({mutationFn:async s=>{const g=await St(s.id);await Us(g,zs(s))},onMutate:()=>{P(null)},onError:s=>{P(s instanceof Error?s.message:"No se pudo preparar la impresiÃ³n. Intenta nuevamente.")}}),Z=ie({mutationFn:async s=>{const g=await Ue(s.id),C=et(s,g);tt(g,C)},onMutate:()=>{P(null)},onError:s=>{P(s instanceof Error?s.message:"No se pudo descargar el documento. Intenta nuevamente.")}}),G=ie({mutationFn:async s=>{const g={id:s.id,type:s.docType??"Documento",number:Le(s),issuedAt:s.issuedAt,total:s.total,status:s.status},C=await Ue(g.id),d=et(g,C);tt(C,d)}});ie({mutationFn:async()=>{const s=await rt({status:a||void 0,docType:m||void 0,paymentMethod:u||void 0,search:D||void 0}),g=URL.createObjectURL(s),C=document.createElement("a");C.href=g,C.download=`ventas-${new Date().toISOString().split("T")[0]}.csv`,C.rel="noopener",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(g)}});const ee=s=>{if(s.status?.toLowerCase()==="cancelled"){window.alert("La venta ya fue cancelada.");return}window.confirm(`Cancelar venta ${s.docType??"Factura"}?`)&&ne.mutate(s.id)},pe=s=>{const g=window.prompt("Documento",s.docType??"");if(g===null)return;const C=window.prompt("Metodo de pago",s.paymentMethod??"");if(C===null)return;const d={docType:g.trim()||s.docType,paymentMethod:C.trim()||s.paymentMethod};le.mutate({id:s.id,payload:d})},Ce=s=>{const g={id:s.id,direction:"sales",type:s.docType??"Documento",number:Le(s),issuedAt:s.issuedAt,total:s.total,status:s.status};v(g),P(null)},je=()=>{v(null),P(null),R.reset(),Z.reset()},de=()=>{O(!0)},ue=()=>{O(!1)},me=s=>{n(0);const g=p.trim().toLowerCase(),C=!a||s.status.toLowerCase()===a.toLowerCase(),d=!m||s.docType===m,y=!u||s.paymentMethod===u,w=!g||Se(s.docType,g)||Se(s.paymentMethod,g)||Se(s.customerName,g)||Se(s.customerId,g)||Se(s.id,g);C&&d&&y&&w&&t.setQueriesData({queryKey:["sales"]},S=>{if(!S||S.number!==0)return S;const I={id:s.id,customerId:s.customerId??void 0,customerName:s.customerName??void 0,docType:s.docType,docNumber:s.docNumber??s.documentNumber??s.id,paymentMethod:s.paymentMethod,status:s.status,net:s.net,vat:s.vat,total:s.total,issuedAt:s.issuedAt},E=S.content??[],F=[I,...E].slice(0,S.size??Te);return{...S,content:F,totalElements:(S.totalElements??0)+1}}),t.invalidateQueries({queryKey:["sales"]})},U=i.useMemo(()=>[{header:"Documento",accessorKey:"docType",cell:s=>s.getValue()??"Factura"},{header:"NÃºmero de documento",accessorFn:s=>Le(s),cell:s=>{const g=s.getValue()??"-";return e.jsx("span",{className:"mono",children:g})}},{header:"Cliente",accessorFn:s=>s.customerName??s.customerId??"-",cell:s=>s.getValue()??"-"},{header:"Pago",accessorKey:"paymentMethod",cell:s=>s.getValue()??"-"},{header:"Estado",accessorKey:"status",cell:s=>{const g=s.getValue()??"",C=g.toLowerCase();let d="";return C==="emitida"?d="ðŸŸ¢ Emitida":C==="cancelled"?d="ðŸ”´ Cancelada":d=g,e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${C==="emitida"?"bg-green-950 text-green-400 border border-green-800":C==="cancelled"?"bg-red-950 text-red-400 border border-red-800":"bg-neutral-800 text-neutral-400 border border-neutral-700"}`,children:d})}},{header:"Neto",accessorKey:"net",cell:s=>e.jsxs("span",{className:"text-neutral-100",children:["$",(s.getValue()??0).toLocaleString()]})},{header:"IVA",accessorKey:"vat",cell:s=>e.jsxs("span",{className:"text-neutral-100",children:["$",(s.getValue()??0).toLocaleString()]})},{header:"Total",accessorKey:"total",cell:s=>e.jsxs("span",{className:"font-semibold text-neutral-100",children:["$",(s.getValue()??0).toLocaleString()]})},{header:"Emitida",accessorKey:"issuedAt",cell:s=>e.jsx("span",{className:"text-neutral-400 text-sm",children:new Date(s.getValue()).toLocaleString()})},{id:"actions",header:"Acciones",cell:({row:s})=>e.jsxs("div",{className:"table-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>Ce(s.original),children:"Comprobante"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>G.mutate(s.original),disabled:G.isPending,children:G.isPending?"Descargando...":"Descargar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>pe(s.original),children:"Editar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>ee(s.original),disabled:ne.isPending,children:ne.isPending?"Cancelando...":"Cancelar"})]})}],[ne.isPending,G.isPending]),fe=Lt({data:K.data?.content??[],columns:U,getCoreRowModel:At(),manualPagination:!0,pageCount:K.data?.totalPages??-1,state:{pagination:{pageIndex:o,pageSize:Te}},onPaginationChange:s=>{const g=typeof s=="function"?s({pageIndex:o,pageSize:Te}).pageIndex:s.pageIndex;n(g)}}),V=H.data,x=te.data,j=L.data,Q=i.useMemo(()=>{const s=[];if(V&&x){const g=x.total/7;V.total>0&&V.total<g*.5&&s.push({id:"low-sales-today",type:"warning",message:`âš ï¸ Las ventas de hoy estÃ¡n un 50% por debajo del promedio semanal (${X(g)})`})}if(K.data?.content){const g=new Date().toISOString().split("T")[0],C=K.data.content.filter(d=>{const y=new Date(d.issuedAt).toISOString().split("T")[0];return d.status?.toLowerCase()==="cancelled"&&y===g});C.length>0&&s.push({id:"cancelled-today",type:"warning",message:`âš ï¸ ${C.length} documento${C.length>1?"s":""} cancelado${C.length>1?"s":""} hoy`})}return V&&V.total===0&&V.count===0&&s.push({id:"no-sales-today",type:"info",message:"â„¹ï¸ Sin ventas registradas hoy"}),s},[V,x,K.data]);return e.jsxs("div",{className:"page-section bg-neutral-950",children:[e.jsx(Tt,{title:"Ventas",description:"Gestiona documentos, monitorea cobranzas y analiza el desempeno.",actions:e.jsx("button",{className:"btn",onClick:()=>r(!0),children:"+ Registrar venta"})}),e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsx(Fs,{})}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"AnÃ¡lisis ABC de Productos"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(Es,{}),e.jsx(_s,{}),e.jsx(Ls,{})]})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"PronÃ³stico de Demanda"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(As,{}),e.jsx(Is,{}),e.jsx(Ms,{})]})]}),e.jsx(ts,{startDate:B,endDate:M,onStartDateChange:ae,onEndDateChange:re}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 text-sm font-medium mb-2",children:"ðŸ’° Ventas del dÃ­a"}),e.jsx("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:H.isLoading?"...":H.isError?"â€”":X(V?.total)}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-neutral-400",children:H.isError?"Sin datos disponibles.":`${Re(V?.count)} docs`}),!H.isLoading&&!H.isError&&V&&x&&x.total>0?(()=>{const s=x.total/7,g=(V.total-s)/s*100,C=g>0;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${C?"bg-green-950 text-green-400 border border-green-800":"bg-red-950 text-red-400 border border-red-800"}`,children:[C?"ðŸŸ¢":"ðŸ”´"," ",g>0?"+":"",g.toFixed(1),"%"]})})():null]})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 text-sm font-medium mb-2",children:"ðŸ“ˆ Ventas de la semana"}),e.jsx("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:te.isLoading?"...":te.isError?"â€”":X(x?.total)}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-neutral-400",children:te.isError?"Sin datos disponibles.":`${Re(x?.count)} docs`}),!te.isLoading&&!te.isError&&x&&j&&j.total>0?(()=>{const s=j.total/4,g=(x.total-s)/s*100,C=g>0;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${C?"bg-green-950 text-green-400 border border-green-800":"bg-red-950 text-red-400 border border-red-800"}`,children:[C?"ðŸŸ¢":"ðŸ”´"," ",g>0?"+":"",g.toFixed(1),"%"]})})():null]})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 text-sm font-medium mb-2",children:"ðŸ“Š Ventas del mes"}),e.jsx("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:L.isLoading?"...":L.isError?"â€”":X(j?.total)}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-neutral-400",children:L.isError?"Sin datos disponibles.":`${Re(j?.count)} docs`}),!L.isLoading&&!L.isError&&j&&x?(()=>{const s=x.count>0?j.count/x.count:0,g=s>=4?"tendencia alta":s>=2?"tendencia media":"tendencia baja";return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-neutral-800 text-neutral-400 border border-neutral-700",children:["ðŸ“Š ",g]})})():null]})]}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 text-sm font-medium mb-2",children:"ðŸ“„ Total documentos"}),e.jsx("p",{className:"text-3xl font-bold text-neutral-100 mb-1",children:K.isLoading?"...":K.isError?"â€”":(K.data?.totalElements??0).toLocaleString("es-CL")}),e.jsx("button",{type:"button",className:"text-sm text-blue-400 hover:text-blue-300 transition-colors",onClick:de,ref:_,children:"Ver documentos â†’"})]})]}),Q.length>0&&e.jsx("section",{className:"mb-6 space-y-3",children:Q.map(s=>e.jsxs("div",{className:`flex items-start gap-3 p-4 rounded-xl border ${s.type==="warning"?"bg-yellow-950 border-yellow-800 text-yellow-400":"bg-blue-950 border-blue-800 text-blue-400"}`,children:[e.jsx("span",{className:"text-lg",children:s.type==="warning"?"âš ï¸":"â„¹ï¸"}),e.jsx("p",{className:"text-sm font-medium flex-1",children:s.message})]},s.id))}),e.jsx(rs,{startDate:B,endDate:M,onStartDateChange:ae,onEndDateChange:re}),e.jsx(hs,{startDate:B,endDate:M}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(bs,{startDate:B,endDate:M}),e.jsx(fs,{startDate:B,endDate:M})]}),e.jsx(ys,{startDate:B,endDate:M}),e.jsx(Ss,{startDate:B,endDate:M}),e.jsx(Ds,{date:M}),e.jsx(Ts,{days:7}),e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5 mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-3 items-center mb-4",children:[e.jsx("input",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100 flex-1 min-w-[200px]",placeholder:"Buscar (cliente, doc, pago)",value:p,onChange:s=>b(s.target.value)}),p&&e.jsx("button",{className:"btn ghost text-neutral-400 hover:text-neutral-100",type:"button",onClick:()=>b(""),children:"Limpiar"}),e.jsx("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:a,onChange:s=>l(s.target.value),children:$s.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:m,onChange:s=>N(s.target.value),children:qs.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("select",{className:"input bg-neutral-800 border-neutral-700 text-neutral-100",value:u,onChange:s=>f(s.target.value),children:Os.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("button",{className:"btn bg-cyan-600 hover:bg-cyan-700 text-white font-medium",type:"button",onClick:()=>W(!0),children:"ðŸ“¥ Exportar"})]})}),e.jsxs("div",{className:"bg-neutral-900 border border-neutral-800 rounded-2xl shadow-lg p-5",children:[e.jsx("h3",{className:"text-neutral-100 mb-4",children:"Documentos recientes"}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:fe.getHeaderGroups().map(s=>e.jsx("tr",{children:s.headers.map(g=>e.jsx("th",{children:g.isPlaceholder?null:Ve(g.column.columnDef.header,g.getContext())},g.id))},s.id))}),e.jsx("tbody",{children:fe.getRowModel().rows.map(s=>e.jsx("tr",{children:s.getVisibleCells().map(g=>e.jsx("td",{children:Ve(g.column.columnDef.cell,g.getContext())},g.id))},s.id))})]})}),e.jsxs("div",{className:"flex gap-2 mt-4 justify-between items-center border-t border-neutral-700 pt-4",children:[e.jsx("button",{className:"btn bg-neutral-800 border-neutral-700 text-neutral-100 hover:bg-neutral-700",disabled:o===0,onClick:()=>n(s=>Math.max(0,s-1)),children:"â† Anterior"}),e.jsxs("span",{className:"text-neutral-400",children:["PÃ¡gina ",o+1," de ",K.data?.totalPages??1]}),e.jsx("button",{className:"btn bg-neutral-800 border-neutral-700 text-neutral-100 hover:bg-neutral-700",disabled:o+1>=(K.data?.totalPages??1),onClick:()=>n(s=>s+1),children:"Siguiente â†’"})]})]}),e.jsx(us,{isOpen:J,onClose:ue}),e.jsx(Jt,{open:c,onClose:()=>r(!1),onCreated:me}),e.jsxs(Me,{open:!!h,onClose:je,title:"Detalle del comprobante",initialFocusRef:Y,className:"modal--wide",children:[A.isLoading&&e.jsx("p",{children:"Cargando comprobante..."}),A.isError&&e.jsx("p",{className:"error",children:A.error?.message??"No se pudo cargar el comprobante."}),T&&!A.isLoading&&e.jsx("p",{className:"error",children:T}),k&&e.jsxs("div",{className:"document-detail","aria-live":"polite",children:[e.jsxs("section",{className:"document-detail__header",children:[e.jsxs("div",{className:"document-detail__headline",children:[e.jsx("p",{className:"document-detail__type",children:k.docType??h?.type??"Documento"}),e.jsxs("p",{className:"document-detail__number",children:["#",h?.number??k.id]})]}),e.jsxs("div",{className:"document-detail__meta-grid",children:[e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Fecha"}),e.jsx("span",{className:"document-detail__meta-value",children:h?.issuedAt?new Date(h.issuedAt).toLocaleString():"â€”"})]}),e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:k.customer?"Cliente":k.supplier?"Proveedor":"Contraparte"}),e.jsx("span",{className:"document-detail__meta-value",children:k.customer?.name??k.supplier?.name??"â€”"})]}),e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Pago"}),e.jsx("span",{className:"document-detail__meta-value",children:k.paymentMethod??"â€”"})]}),e.jsxs("div",{className:"document-detail__meta-item",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Estado"}),e.jsx("span",{className:"document-detail__meta-value",children:k.status})]}),e.jsxs("div",{className:"document-detail__meta-item document-detail__meta-item--highlight",children:[e.jsx("span",{className:"document-detail__meta-label",children:"Total"}),e.jsx("span",{className:"document-detail__meta-value document-detail__meta-value--highlight",children:X(z.total)})]})]})]}),e.jsx("div",{className:"document-detail__items table-wrapper compact",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"DescripciÃ³n"}),e.jsx("th",{className:"mono",children:"Cantidad"}),e.jsx("th",{className:"mono",children:"Precio unitario"}),e.jsx("th",{className:"mono",children:"Descuentos/Impuestos"}),e.jsx("th",{className:"mono",children:"Total Ã­tem"})]})}),e.jsx("tbody",{children:k.items.map((s,g)=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono",children:s.productId??"â€”"}),e.jsx("td",{children:e.jsx("span",{className:"document-detail__description",title:s.productName,children:s.productName})}),e.jsx("td",{className:"mono",children:Re(s.qty)}),e.jsx("td",{className:"mono",children:X(s.unitPrice)}),e.jsx("td",{className:"mono",children:Bs(s.discount,s.tax)}),e.jsx("td",{className:"mono",children:X(s.lineTotal)})]},`${s.productId??"item"}-${g}`))})]})}),e.jsxs("div",{className:"document-detail__totals",children:[e.jsxs("div",{className:"document-detail__totals-item",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("strong",{children:X(z.subtotal)})]}),e.jsxs("div",{className:"document-detail__totals-item",children:[e.jsx("span",{children:"Descuentos"}),e.jsx("strong",{children:z.discount>0?`- ${X(z.discount)}`:X(z.discount)})]}),e.jsxs("div",{className:"document-detail__totals-item",children:[e.jsx("span",{children:"Impuestos"}),e.jsx("strong",{children:X(z.tax)})]}),e.jsxs("div",{className:"document-detail__totals-item document-detail__totals-item--accent",children:[e.jsx("span",{children:"Total"}),e.jsx("strong",{children:X(z.total)})]})]}),e.jsxs("div",{className:"document-detail__actions",children:[e.jsx("button",{ref:Y,className:"btn",type:"button",onClick:()=>h&&k&&R.mutate(h),disabled:!h||!k||R.isPending||Z.isPending,children:R.isPending?"Preparando...":"Imprimir"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>h&&k&&Z.mutate(h),disabled:!h||!k||Z.isPending||R.isPending,children:Z.isPending?"Descargando...":"Descargar"}),e.jsx("button",{ref:oe,className:"btn ghost",type:"button",onClick:je,children:"Cerrar"})]})]})]}),e.jsx(Rs,{isOpen:q,onClose:()=>W(!1),filters:{status:a,docType:m,paymentMethod:u,search:D,startDate:B,endDate:M},totalRecords:K.data?.totalElements??0})]})}export{sa as default};
