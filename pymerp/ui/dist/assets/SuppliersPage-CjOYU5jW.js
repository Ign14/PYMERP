import{u as F,c as M,as as H,j as e,at as G,au as W,H as w,av as U,E as B,aw as $,ax as R,ay as D,az as K,k as Q,aA as V,aB as O,aC as T,aD as _,aE as z,aF as X}from"./index-BtVHljoa.js";import{r as v}from"./react-D8kvZI4c.js";import{P as Y}from"./PageHeader-BlxDVWRK.js";import{u as S}from"./useQuery-Dnian6zg.js";import{p as J}from"./problemDetail-C-xKLZeL.js";import{M as Z}from"./Modal-B2h9NkJO.js";function ee({supplierId:n,supplierName:d,isOpen:h,onClose:o}){const m=F(),[a,i]=v.useState(!1),[c,l]=v.useState({name:"",title:"",phone:"",email:""}),s=S({queryKey:["supplierContacts",n],queryFn:()=>G(n),enabled:h}),p=M({mutationFn:t=>H(n,t),onSuccess:()=>{m.invalidateQueries({queryKey:["supplierContacts",n]}),l({name:"",title:"",phone:"",email:""}),i(!1)}}),N=t=>{t.preventDefault(),c.name.trim()&&p.mutate(c)},x=()=>{l({name:"",title:"",phone:"",email:""}),i(!1)};return h?e.jsx("div",{className:"modal-overlay",onClick:o,children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Contactos de ",d]}),e.jsx("button",{className:"btn-close",onClick:o,"aria-label":"Cerrar",children:"âœ•"})]}),e.jsxs("div",{className:"modal-body",children:[s.isLoading&&e.jsx("p",{children:"Cargando contactos..."}),s.isError&&e.jsx("p",{className:"error",children:s.error?.message??"No se pudieron cargar los contactos"}),!s.isLoading&&!s.isError&&e.jsxs(e.Fragment,{children:[(s.data??[]).length===0&&!a&&e.jsx("p",{className:"muted",children:"No hay contactos registrados"}),(s.data??[]).length>0&&e.jsx("div",{className:"contacts-list",children:s.data.map(t=>e.jsxs("div",{className:"contact-card",children:[e.jsxs("div",{className:"contact-name",children:[e.jsx("strong",{children:t.name}),t.title&&e.jsx("span",{className:"contact-title",children:t.title})]}),e.jsxs("div",{className:"contact-details",children:[t.phone&&e.jsxs("div",{children:[e.jsx("span",{className:"label",children:"ðŸ“ž TelÃ©fono:"}),e.jsx("span",{children:t.phone})]}),t.email&&e.jsxs("div",{children:[e.jsx("span",{className:"label",children:"âœ‰ï¸ Email:"}),e.jsx("a",{href:`mailto:${t.email}`,children:t.email})]})]})]},t.id))}),a?e.jsxs("form",{onSubmit:N,className:"contact-form",children:[e.jsx("h3",{children:"Nuevo Contacto"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contact-name",children:"Nombre *"}),e.jsx("input",{id:"contact-name",type:"text",value:c.name,onChange:t=>l({...c,name:t.target.value}),required:!0,autoFocus:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contact-title",children:"Cargo"}),e.jsx("input",{id:"contact-title",type:"text",value:c.title||"",onChange:t=>l({...c,title:t.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contact-phone",children:"TelÃ©fono"}),e.jsx("input",{id:"contact-phone",type:"tel",value:c.phone||"",onChange:t=>l({...c,phone:t.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contact-email",children:"Email"}),e.jsx("input",{id:"contact-email",type:"email",value:c.email||"",onChange:t=>l({...c,email:t.target.value})})]}),p.isError&&e.jsx("p",{className:"error",children:p.error?.message??"No se pudo crear el contacto"}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn btn-ghost",onClick:x,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:p.isPending,children:p.isPending?"Guardando...":"Guardar"})]})]}):e.jsx("button",{className:"btn btn-primary",onClick:()=>i(!0),children:"+ Agregar contacto"})]})]})]})}):null}const q=v.forwardRef(({onOpenCreateDialog:n,onOpenEditDialog:d},h)=>{const o=F(),[m,a]=v.useState(null),[i,c]=v.useState(""),[l,s]=v.useState(!0),[p,N]=v.useState(!1),x=S({queryKey:["suppliers",i,l],queryFn:()=>w(i||void 0,l),refetchOnWindowFocus:!1}),t=v.useCallback(()=>{n?.()},[n]);v.useImperativeHandle(h,()=>({openCreate:t}),[t]),v.useEffect(()=>{if(!m)return;const f=x.data?.find(L=>L.id===m.id);f?f!==m&&a(f):a(null)},[x.data,m]);const r=M({mutationFn:f=>W(f),onSuccess:(f,L)=>{o.invalidateQueries({queryKey:["suppliers"]}),m?.id===L&&a(null)}}),j=()=>{m&&d?.(m)},b=()=>{!m||r.isPending||window.confirm(`Â¿Eliminar proveedor ${m.name}?`)&&r.mutate(m.id)},{data:u,isLoading:g,isError:y,error:C,refetch:P,isFetching:A}=x,I=f=>{if(!f)return"Sin informaciÃ³n";const L=f.trim();return L.length>0?L:"Sin informaciÃ³n"},k=m?[{label:"Nombre",value:m.name},{label:"RUT",value:m.rut??null},{label:"DirecciÃ³n",value:m.address??null},{label:"Comuna",value:m.commune??null},{label:"Giro / actividad",value:m.businessActivity??null},{label:"TelÃ©fono",value:m.phone??null},{label:"Email",value:m.email??null,type:"email"}]:[];return e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Proveedores"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>P(),disabled:A,children:A?"Cargando...":"ðŸ”„ Refrescar"})]}),e.jsx("div",{className:"search-box",children:e.jsx("input",{type:"text",placeholder:"Buscar por nombre, RUT, email o telÃ©fono...",value:i,onChange:f=>c(f.target.value)})}),e.jsxs("div",{className:"filter-buttons",children:[e.jsx("button",{className:`btn ${l===void 0?"btn-primary":"btn-ghost"}`,onClick:()=>s(void 0),children:"Todos"}),e.jsx("button",{className:`btn ${l===!0?"btn-primary":"btn-ghost"}`,onClick:()=>s(!0),children:"Activos"}),e.jsx("button",{className:`btn ${l===!1?"btn-primary":"btn-ghost"}`,onClick:()=>s(!1),children:"Inactivos"})]}),e.jsxs("div",{className:"inline-actions",children:[e.jsx("button",{className:"btn ghost",type:"button",onClick:j,disabled:!m,children:"âœï¸ Editar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:()=>N(!0),disabled:!m,children:"ðŸ‘¥ Contactos"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:b,disabled:!m||r.isPending,children:r.isPending?"Eliminando...":"ðŸ—‘ï¸ Eliminar"})]}),r.isError&&e.jsx("p",{className:"error",children:r.error?.message??"No se pudo eliminar el proveedor"}),g&&e.jsx("p",{children:"Cargando proveedores..."}),y&&e.jsx("p",{className:"error",children:C?.message??"No se pudieron cargar los proveedores"}),!g&&!y&&e.jsxs(e.Fragment,{children:[e.jsxs("ul",{className:"list",children:[(u??[]).map(f=>e.jsxs("li",{className:m?.id===f.id?"selected":void 0,onClick:()=>a(f),children:[e.jsx("strong",{children:f.name}),f.rut?e.jsxs("span",{className:"mono small",children:[" RUT ",f.rut]}):null]},f.id)),(u??[]).length===0&&e.jsx("li",{className:"muted",children:"No hay proveedores registrados"})]}),m?e.jsx("div",{className:"supplier-details","aria-live":"polite",children:k.map(f=>e.jsxs("div",{className:"supplier-detail-item",children:[e.jsx("span",{className:"supplier-detail-label",children:f.label}),e.jsx("span",{className:"supplier-detail-value",children:f.type==="email"&&f.value&&f.value.trim().length>0?e.jsx("a",{href:`mailto:${f.value.trim()}`,children:f.value.trim()}):I(f.value)})]},f.label))}):e.jsx("p",{className:"muted",children:"Selecciona un proveedor para ver sus datos."})]}),m&&e.jsx(ee,{supplierId:m.id,supplierName:m.name,isOpen:p,onClose:()=>N(!1)})]})});q.displayName="SuppliersCard";const E={name:"",rut:"",address:"",commune:"",businessActivity:"",phone:"",email:""},se=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function te({open:n,supplier:d,onClose:h,onSaved:o}){const[m,a]=v.useState(E),[i,c]=v.useState({}),[l,s]=v.useState(null),p=M({mutationFn:j=>d?U(d.id,j):B(j),onSuccess:j=>{c({}),s(null),o?.(j),h()},onError:j=>{const b=J(j),u={};for(const[g,y]of Object.entries(b.fieldErrors))g in E&&typeof y=="string"&&y.trim().length>0&&(u[g]=y);c(u),s(b.message??"No se pudo guardar el proveedor")}});v.useEffect(()=>{if(!n){a(E),c({}),s(null),p.reset();return}a(d?{name:d.name??"",rut:d.rut??"",address:d.address??"",commune:d.commune??"",businessActivity:d.businessActivity??"",phone:d.phone??"",email:d.email??""}:E),c({}),s(null),p.reset()},[n,d]);const N=j=>{c(b=>{if(!b[j])return b;const u={...b};return delete u[j],u})},x=j=>{j.preventDefault(),s(null);const b=m.name.trim(),u=m.rut.trim(),g=m.email.trim(),y={};if(b||(y.name="El nombre es obligatorio"),u||(y.rut="El RUT es obligatorio"),g&&!se.test(g)&&(y.email="Ingresa un email vÃ¡lido"),Object.keys(y).length>0){c(y);return}c({});const C=A=>{const I=A.trim();return I.length>0?I:null},P={name:b,rut:u,address:C(m.address),commune:C(m.commune),businessActivity:C(m.businessActivity),phone:C(m.phone),email:C(m.email)};p.mutate(P)},t=d?"Editar proveedor":"Nuevo proveedor",r=p.isPending;return e.jsx(Z,{open:n,title:t,onClose:()=>!r&&h(),children:e.jsxs("form",{className:"form-grid",onSubmit:x,noValidate:!0,children:[e.jsxs("label",{children:[e.jsx("span",{children:"Nombre *"}),e.jsx("input",{className:`input${i.name?" input-error":""}`,value:m.name,onChange:j=>{a(b=>({...b,name:j.target.value})),N("name"),s(null)},placeholder:"Proveedor demo",disabled:r,maxLength:100,required:!0,"data-autofocus":!0,"aria-invalid":i.name?"true":void 0,"aria-describedby":i.name?"supplier-form-name-error":void 0}),i.name?e.jsx("p",{id:"supplier-form-name-error",className:"error","aria-live":"polite",children:i.name}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"RUT *"}),e.jsx("input",{className:`input${i.rut?" input-error":""}`,value:m.rut,onChange:j=>{a(b=>({...b,rut:j.target.value})),N("rut"),s(null)},placeholder:"76.123.456-k",disabled:r,maxLength:20,required:!0,"aria-invalid":i.rut?"true":void 0,"aria-describedby":i.rut?"supplier-form-rut-error":void 0}),i.rut?e.jsx("p",{id:"supplier-form-rut-error",className:"error","aria-live":"polite",children:i.rut}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"DirecciÃ³n"}),e.jsx("input",{className:"input",value:m.address,onChange:j=>{a(b=>({...b,address:j.target.value})),N("address"),s(null)},placeholder:"Av. Principal 1234",disabled:r,maxLength:200}),i.address?e.jsx("p",{className:"error","aria-live":"polite",children:i.address}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"Comuna"}),e.jsx("input",{className:"input",value:m.commune,onChange:j=>{a(b=>({...b,commune:j.target.value})),N("commune"),s(null)},placeholder:"Providencia",disabled:r,maxLength:120}),i.commune?e.jsx("p",{className:"error","aria-live":"polite",children:i.commune}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"Giro / actividad"}),e.jsx("input",{className:"input",value:m.businessActivity,onChange:j=>{a(b=>({...b,businessActivity:j.target.value})),N("businessActivity"),s(null)},placeholder:"DistribuciÃ³n",disabled:r,maxLength:120}),i.businessActivity?e.jsx("p",{className:"error","aria-live":"polite",children:i.businessActivity}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"TelÃ©fono"}),e.jsx("input",{className:"input",value:m.phone,onChange:j=>{a(b=>({...b,phone:j.target.value})),N("phone"),s(null)},placeholder:"+56 9 1234 5678",disabled:r,maxLength:30}),i.phone?e.jsx("p",{className:"error","aria-live":"polite",children:i.phone}):null]}),e.jsxs("label",{children:[e.jsx("span",{children:"Email"}),e.jsx("input",{className:`input${i.email?" input-error":""}`,value:m.email,onChange:j=>{a(b=>({...b,email:j.target.value})),N("email"),s(null)},placeholder:"contacto@empresa.cl",type:"email",disabled:r,maxLength:120,"aria-invalid":i.email?"true":void 0,"aria-describedby":i.email?"supplier-form-email-error":void 0}),i.email?e.jsx("p",{id:"supplier-form-email-error",className:"error","aria-live":"polite",children:i.email}):null]}),e.jsxs("div",{className:"buttons",children:[e.jsx("button",{className:"btn",type:"submit",disabled:r,children:r?"Guardando...":"Guardar"}),e.jsx("button",{className:"btn ghost",type:"button",onClick:h,disabled:r,children:"Cancelar"})]}),l?e.jsx("p",{className:"error","aria-live":"polite",children:l}):null]})})}function re(){const n=S({queryKey:["suppliers"],queryFn:()=>w(),refetchOnWindowFocus:!1}),d=S({queryKey:["supplier-alerts"],queryFn:()=>$(),refetchOnWindowFocus:!1}),h=v.useMemo(()=>{const s=n.data??[],p=s.length,N=s.filter(j=>j.active!==!1).length,x=p-N,t=new Date;t.setDate(1),t.setHours(0,0,0,0);const r=s.filter(j=>{if(!j.createdAt)return!1;const b=new Date(j.createdAt);return Number.isNaN(b.getTime())?!1:b>=t}).length;return{total:p,active:N,inactive:x,newThisMonth:r}},[n.data]),o=v.useMemo(()=>(d.data??[]).filter(s=>s.severity==="CRITICAL"||s.severity==="WARNING"),[d.data]);if(n.isLoading)return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{children:"EstadÃ­sticas de Proveedores"}),e.jsx("p",{className:"text-neutral-400",children:"Cargando estadÃ­sticas..."})]});if(n.isError)return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{children:"EstadÃ­sticas de Proveedores"}),e.jsx("p",{className:"text-red-400",children:n.error?.message??"Error al cargar estadÃ­sticas"})]});const m=n.data??[],a=new Map;m.forEach(s=>{const p=s.commune?.trim()||"Sin especificar";a.set(p,(a.get(p)||0)+1)});const i=Array.from(a.entries()).sort((s,p)=>p[1]-s[1]).slice(0,5),c=new Map;m.forEach(s=>{const p=s.businessActivity?.trim()||"Sin especificar";c.set(p,(c.get(p)||0)+1)});const l=Array.from(c.entries()).sort((s,p)=>p[1]-s[1]).slice(0,5);return e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"ðŸ“Š EstadÃ­sticas de Proveedores"}),o.length>0&&e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded bg-yellow-950/50 text-yellow-400 border border-yellow-800",children:[o.length," alerta",o.length!==1?"s":""]})]}),o.length>0&&e.jsx("div",{className:"mb-4 space-y-2",children:o.slice(0,2).map((s,p)=>e.jsx("div",{className:`rounded-lg p-3 text-sm border ${s.severity==="CRITICAL"?"bg-red-950/30 border-red-800 text-red-400":"bg-yellow-950/30 border-yellow-800 text-yellow-400"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:s.severity==="CRITICAL"?"ðŸ”´":"âš ï¸"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.message}),s.supplierName&&s.supplierName!=="ConcentraciÃ³n de Compras"&&e.jsx("p",{className:"text-xs mt-1 opacity-80",children:s.supplierName})]})]})},p))}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"rounded-lg border border-neutral-800 bg-neutral-900/50 p-3",children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"Total"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-100",children:h.total}),h.newThisMonth>0&&e.jsxs("div",{className:"text-xs text-green-400 mt-1",children:["+",h.newThisMonth," este mes"]})]}),e.jsxs("div",{className:"rounded-lg border border-green-800 bg-green-950/30 p-3",children:[e.jsx("div",{className:"text-xs text-green-400 mb-1",children:"Activos"}),e.jsx("div",{className:"text-2xl font-bold text-green-300",children:h.active}),e.jsxs("div",{className:"text-xs text-green-500 mt-1",children:[h.total>0?Math.round(h.active/h.total*100):0,"% del total"]})]}),e.jsxs("div",{className:"rounded-lg border border-neutral-700 bg-neutral-800/30 p-3",children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"Inactivos"}),e.jsx("div",{className:"text-2xl font-bold text-neutral-300",children:h.inactive}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:[h.total>0?Math.round(h.inactive/h.total*100):0,"% del total"]})]})]}),h.inactive>h.active&&h.total>0&&e.jsx("div",{className:"mb-4 rounded-lg border border-orange-800 bg-orange-950/30 p-3 text-sm text-orange-400",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{children:"âš ï¸"}),e.jsx("p",{children:"MÃ¡s proveedores inactivos que activos - Revisar cartera"})]})}),i.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-300 mb-2",children:"ðŸ“ Por Comuna (Top 5)"}),e.jsx("ul",{className:"space-y-1.5",children:i.map(([s,p])=>e.jsxs("li",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-400",children:s}),e.jsx("span",{className:"px-2 py-0.5 rounded bg-neutral-800 text-neutral-100 font-medium text-xs",children:p})]},s))})]}),l.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-300 mb-2",children:"ðŸ¢ Por Actividad (Top 5)"}),e.jsx("ul",{className:"space-y-1.5",children:l.map(([s,p])=>e.jsxs("li",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-400 truncate flex-1",children:s}),e.jsx("span",{className:"px-2 py-0.5 rounded bg-neutral-800 text-neutral-100 font-medium text-xs ml-2",children:p})]},s))})]})]})}function ae(){const[n,d]=v.useState(null),h=S({queryKey:["suppliers",!0],queryFn:()=>w(void 0,!0),refetchOnWindowFocus:!1}),o=S({queryKey:["supplier-metrics",n],queryFn:()=>R(n),enabled:!!n,refetchOnWindowFocus:!1}),m=h.data??[],a=m.find(l=>l.id===n),i=v.useMemo(()=>{if(!o.data)return null;const{purchasesLastMonth:l,purchasesPreviousMonth:s,amountLastMonth:p,amountPreviousMonth:N}=o.data,x=s>0?(l-s)/s*100:0,t=N>0?(p-N)/N*100:0;return{purchasesChange:x,amountChange:t}},[o.data]),c=v.useMemo(()=>{if(!o.data?.lastPurchaseDate)return null;const l=new Date(o.data.lastPurchaseDate),p=Math.abs(new Date().getTime()-l.getTime());return Math.floor(p/(1e3*60*60*24))},[o.data]);return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100 mb-4",children:"ðŸ“ˆ DesempeÃ±o de Proveedores"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Selecciona un proveedor"}),e.jsxs("select",{value:n??"",onChange:l=>d(l.target.value||null),className:"w-full px-3 py-2 bg-neutral-900 border border-neutral-700 rounded-lg text-neutral-100 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"-- Seleccionar proveedor --"}),m.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),!n&&e.jsx("div",{className:"text-center py-8 text-neutral-400",children:e.jsx("p",{className:"text-sm",children:"Selecciona un proveedor para ver sus mÃ©tricas de desempeÃ±o"})}),n&&o.isLoading&&e.jsx("div",{className:"text-center py-8 text-neutral-400",children:e.jsx("p",{className:"text-sm",children:"Cargando mÃ©tricas..."})}),n&&o.isError&&e.jsxs("div",{className:"rounded-lg border border-red-800 bg-red-950/30 p-4 text-sm text-red-400",children:["Error al cargar mÃ©tricas: ",o.error.message]}),n&&o.data&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border border-neutral-800 bg-neutral-900/50 p-4",children:[e.jsx("h3",{className:"text-base font-semibold text-neutral-100",children:a?.name}),a?.businessActivity&&e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:a.businessActivity})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg border border-neutral-800 bg-neutral-900/50 p-3",children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-1",children:"Total Compras"}),e.jsx("div",{className:"text-xl font-bold text-neutral-100",children:o.data.totalPurchases}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"HistÃ³ricas"})]}),e.jsxs("div",{className:"rounded-lg border border-green-800 bg-green-950/30 p-3",children:[e.jsx("div",{className:"text-xs text-green-400 mb-1",children:"Monto Total"}),e.jsxs("div",{className:"text-xl font-bold text-green-300",children:["$",o.data.totalAmount.toLocaleString("es-CL")]}),e.jsx("div",{className:"text-xs text-green-500 mt-1",children:"Acumulado"})]}),e.jsxs("div",{className:"rounded-lg border border-blue-800 bg-blue-950/30 p-3",children:[e.jsx("div",{className:"text-xs text-blue-400 mb-1",children:"Promedio por Orden"}),e.jsxs("div",{className:"text-xl font-bold text-blue-300",children:["$",o.data.averageOrderValue.toLocaleString("es-CL")]}),e.jsx("div",{className:"text-xs text-blue-500 mt-1",children:"AOV"})]}),e.jsxs("div",{className:`rounded-lg border p-3 ${c&&c>90?"border-yellow-800 bg-yellow-950/30":"border-neutral-800 bg-neutral-900/50"}`,children:[e.jsx("div",{className:`text-xs mb-1 ${c&&c>90?"text-yellow-400":"text-neutral-400"}`,children:"Ãšltima Compra"}),e.jsx("div",{className:`text-lg font-bold ${c&&c>90?"text-yellow-300":"text-neutral-100"}`,children:o.data.lastPurchaseDate?new Date(o.data.lastPurchaseDate).toLocaleDateString("es-CL"):"Sin compras"}),e.jsx("div",{className:`text-xs mt-1 ${c&&c>90?"text-yellow-500":"text-neutral-500"}`,children:c!==null?`Hace ${c} dÃ­as`:"N/A"})]})]}),e.jsxs("div",{className:"rounded-lg border border-neutral-800 bg-neutral-900/50 p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-neutral-300 mb-3",children:"Actividad Reciente"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-neutral-400",children:"Ãšltimo mes"}),i&&i.purchasesChange!==0&&e.jsxs("span",{className:`text-xs font-medium ${i.purchasesChange>0?"text-green-400":"text-red-400"}`,children:[i.purchasesChange>0?"â†‘":"â†“"," ",Math.abs(Math.round(i.purchasesChange)),"%"]})]}),e.jsxs("div",{className:"flex items-baseline gap-3",children:[e.jsxs("span",{className:"text-sm text-neutral-300",children:[o.data.purchasesLastMonth," compra",o.data.purchasesLastMonth!==1?"s":""]}),e.jsxs("span",{className:"text-sm font-medium text-neutral-100",children:["$",o.data.amountLastMonth.toLocaleString("es-CL")]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("span",{className:"text-xs text-neutral-400",children:"Mes anterior"})}),e.jsxs("div",{className:"flex items-baseline gap-3",children:[e.jsxs("span",{className:"text-sm text-neutral-300",children:[o.data.purchasesPreviousMonth," compra",o.data.purchasesPreviousMonth!==1?"s":""]}),e.jsxs("span",{className:"text-sm font-medium text-neutral-100",children:["$",o.data.amountPreviousMonth.toLocaleString("es-CL")]})]})]})]})]}),c&&c>90&&e.jsx("div",{className:"rounded-lg border border-yellow-800 bg-yellow-950/30 p-3 text-sm text-yellow-400",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{children:"âš ï¸"}),e.jsxs("p",{children:["Sin compras hace ",c," dÃ­as - Considerar contacto"]})]})}),o.data.totalPurchases===0&&e.jsx("div",{className:"rounded-lg border border-blue-800 bg-blue-950/30 p-3 text-sm text-blue-400",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{children:"â„¹ï¸"}),e.jsx("p",{children:"Este proveedor no tiene compras registradas aÃºn"})]})})]})]})}function ne(){const n=S({queryKey:["supplier-alerts"],queryFn:()=>$(),refetchOnWindowFocus:!1}),d=v.useMemo(()=>{const a=n.data??[];return{critical:a.filter(i=>i.severity==="CRITICAL"),warning:a.filter(i=>i.severity==="WARNING"),info:a.filter(i=>i.severity==="INFO")}},[n.data]),h=(n.data??[]).length;if(n.isLoading)return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100 mb-4",children:"ðŸ”” Alertas de Proveedores"}),e.jsx("p",{className:"text-neutral-400 text-sm",children:"Cargando alertas..."})]});if(n.isError)return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100 mb-4",children:"ðŸ”” Alertas de Proveedores"}),e.jsxs("div",{className:"rounded-lg border border-red-800 bg-red-950/30 p-4 text-sm text-red-400",children:["Error al cargar alertas: ",n.error.message]})]});const o=a=>{switch(a){case"CRITICAL":return{container:"bg-red-950/30 border-red-800",text:"text-red-400",icon:"ðŸ”´"};case"WARNING":return{container:"bg-yellow-950/30 border-yellow-800",text:"text-yellow-400",icon:"âš ï¸"};case"INFO":return{container:"bg-blue-950/30 border-blue-800",text:"text-blue-400",icon:"â„¹ï¸"}}},m=a=>{switch(a){case"NO_RECENT_PURCHASES":return"Sin compras recientes";case"INACTIVE_SUPPLIER":return"Proveedor inactivo";case"HIGH_CONCENTRATION":return"Alta concentraciÃ³n";case"SINGLE_SOURCE":return"Fuente Ãºnica";default:return a}};return e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"ðŸ”” Alertas de Proveedores"}),h>0&&e.jsxs("span",{className:"px-2.5 py-1 text-xs font-medium rounded-full bg-neutral-800 text-neutral-100",children:[h," alerta",h!==1?"s":""]})]}),h===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-2",children:"âœ…"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"No hay alertas pendientes"}),e.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"Todos los proveedores estÃ¡n en buen estado"})]}),h>0&&e.jsxs("div",{className:"space-y-3",children:[d.critical.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-red-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”´"}),e.jsxs("span",{children:["CrÃ­ticas (",d.critical.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:d.critical.map((a,i)=>{const c=o(a.severity);return e.jsx("div",{className:`rounded-lg border p-3 ${c.container}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg flex-shrink-0",children:c.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${c.container}`,children:m(a.type)})}),e.jsx("p",{className:`text-sm font-medium ${c.text} mb-1`,children:a.message}),a.supplierName&&a.type!=="HIGH_CONCENTRATION"&&e.jsxs("p",{className:"text-xs text-neutral-400 mb-2",children:["Proveedor: ",a.supplierName]}),a.daysWithoutPurchases!==null&&e.jsxs("p",{className:"text-xs text-neutral-500",children:[a.daysWithoutPurchases," dÃ­as sin actividad"]}),a.concentrationPercentage!==null&&e.jsxs("p",{className:"text-xs text-neutral-500",children:[a.concentrationPercentage.toFixed(1),"% de concentraciÃ³n"]}),a.actionLabel&&e.jsx("button",{className:"mt-2 text-xs font-medium underline hover:no-underline",children:a.actionLabel})]})]})},i)})})]}),d.warning.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-yellow-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"âš ï¸"}),e.jsxs("span",{children:["Advertencias (",d.warning.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:d.warning.map((a,i)=>{const c=o(a.severity);return e.jsx("div",{className:`rounded-lg border p-3 ${c.container}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg flex-shrink-0",children:c.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${c.container}`,children:m(a.type)})}),e.jsx("p",{className:`text-sm font-medium ${c.text} mb-1`,children:a.message}),a.supplierName&&a.type!=="HIGH_CONCENTRATION"&&e.jsxs("p",{className:"text-xs text-neutral-400 mb-2",children:["Proveedor: ",a.supplierName]}),a.daysWithoutPurchases!==null&&e.jsxs("p",{className:"text-xs text-neutral-500",children:[a.daysWithoutPurchases," dÃ­as sin actividad"]}),a.concentrationPercentage!==null&&e.jsxs("p",{className:"text-xs text-neutral-500",children:[a.concentrationPercentage.toFixed(1),"% de concentraciÃ³n"]}),a.actionLabel&&e.jsx("button",{className:"mt-2 text-xs font-medium underline hover:no-underline",children:a.actionLabel})]})]})},i)})})]}),d.info.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-blue-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"â„¹ï¸"}),e.jsxs("span",{children:["Informativas (",d.info.length,")"]})]}),e.jsxs("div",{className:"space-y-2",children:[d.info.slice(0,3).map((a,i)=>{const c=o(a.severity);return e.jsx("div",{className:`rounded-lg border p-3 ${c.container}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg flex-shrink-0",children:c.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${c.container}`,children:m(a.type)})}),e.jsx("p",{className:`text-sm ${c.text} mb-1`,children:a.message}),a.supplierName&&e.jsxs("p",{className:"text-xs text-neutral-400",children:["Proveedor: ",a.supplierName]})]})]})},i)}),d.info.length>3&&e.jsxs("p",{className:"text-xs text-neutral-500 text-center py-2",children:["+",d.info.length-3," alerta",d.info.length-3!==1?"s":""," mÃ¡s..."]})]})]})]})]})}function le(){const[n,d]=v.useState("volume"),h=S({queryKey:["supplier-ranking",n],queryFn:()=>D(n),refetchOnWindowFocus:!1});if(h.isLoading)return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"ðŸ† Ranking de Proveedores"}),e.jsx("p",{className:"text-neutral-400 mt-4",children:"Cargando ranking..."})]});if(h.isError)return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"ðŸ† Ranking de Proveedores"}),e.jsx("p",{className:"text-red-400 mt-4",children:h.error?.message??"Error al cargar ranking"})]});const o=h.data??[],m=s=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),a=s=>s===1?"ðŸ¥‡":s===2?"ðŸ¥ˆ":s===3?"ðŸ¥‰":null,i=s=>s===1?"text-yellow-400":s===2?"text-neutral-300":s===3?"text-orange-400":"text-neutral-500",c=s=>s==="A"?"bg-red-950/50 text-red-400 border-red-800":s==="B"?"bg-yellow-950/50 text-yellow-400 border-yellow-800":"bg-neutral-800/50 text-neutral-400 border-neutral-700",l=s=>s==="A"?"CrÃ­tico":s==="B"?"Importante":"Ocasional";return e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"ðŸ† Ranking de Proveedores"}),e.jsxs("select",{value:n,onChange:s=>d(s.target.value),className:"px-3 py-1 text-sm rounded bg-neutral-900 text-neutral-200 border border-neutral-700 focus:outline-none focus:border-blue-600",children:[e.jsx("option",{value:"volume",children:"Por Volumen"}),e.jsx("option",{value:"reliability",children:"Por Confiabilidad"}),e.jsx("option",{value:"value",children:"Por Valor"})]})]}),o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-neutral-400",children:"No hay datos de compras en el Ãºltimo aÃ±o"}),e.jsx("p",{className:"text-sm text-neutral-500 mt-2",children:"Realiza compras para ver el ranking de proveedores"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-2 px-2 text-neutral-400 font-medium",children:"#"}),e.jsx("th",{className:"text-left py-2 px-2 text-neutral-400 font-medium",children:"Proveedor"}),e.jsx("th",{className:"text-right py-2 px-2 text-neutral-400 font-medium",children:"Score"}),e.jsx("th",{className:"text-right py-2 px-2 text-neutral-400 font-medium",children:"Compras"}),e.jsx("th",{className:"text-right py-2 px-2 text-neutral-400 font-medium",children:"Monto"}),e.jsx("th",{className:"text-right py-2 px-2 text-neutral-400 font-medium",children:"Confiabilidad"}),e.jsx("th",{className:"text-center py-2 px-2 text-neutral-400 font-medium",children:"CategorÃ­a"})]})}),e.jsx("tbody",{children:o.map(s=>{const p=a(s.rank),N=i(s.rank);return e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-900/30 transition-colors",children:[e.jsx("td",{className:`py-3 px-2 font-semibold ${N}`,children:p?e.jsx("span",{className:"text-xl",children:p}):e.jsx("span",{children:s.rank})}),e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-neutral-200 font-medium",children:s.supplierName}),s.rank<=3&&e.jsx("span",{className:"text-xs text-neutral-500",children:s.rank===1?"Top proveedor":`Top ${s.rank}`})]})}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"font-semibold text-blue-400",children:s.score.toFixed(1)}),e.jsx("div",{className:"w-16 bg-neutral-800 rounded-full h-1 mt-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all",style:{width:`${Math.min(s.score,100)}%`}})})]})}),e.jsx("td",{className:"py-3 px-2 text-right text-neutral-300",children:s.totalPurchases.toLocaleString("es-CL")}),e.jsx("td",{className:"py-3 px-2 text-right text-neutral-300 font-medium",children:m(s.totalAmount)}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsx("div",{className:"flex flex-col items-end",children:e.jsxs("span",{className:`text-sm ${s.reliability>=80?"text-green-400":s.reliability>=50?"text-yellow-400":"text-orange-400"}`,children:[s.reliability.toFixed(0),"%"]})})}),e.jsx("td",{className:"py-3 px-2 text-center",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded border ${c(s.category)}`,title:l(s.category),children:s.category})})]},s.supplierId)})})]})}),e.jsx("div",{className:"mt-4 pt-3 border-t border-neutral-800",children:e.jsxs("div",{className:"flex items-center gap-6 text-xs text-neutral-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ¥‡"}),e.jsx("span",{children:"Oro: #1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ¥ˆ"}),e.jsx("span",{children:"Plata: #2"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ¥‰"}),e.jsx("span",{children:"Bronce: #3"})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsx("span",{children:"A: CrÃ­tico (80%)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500"}),e.jsx("span",{children:"B: Importante (15%)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-neutral-500"}),e.jsx("span",{children:"C: Ocasional (5%)"})]})]})})]})}function ie(){const n=S({queryKey:["supplier-risk-analysis"],queryFn:()=>K(),refetchOnWindowFocus:!1});if(n.isLoading)return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"âš ï¸ AnÃ¡lisis de Riesgo ABC"}),e.jsx("p",{className:"text-neutral-400 mt-4",children:"Cargando anÃ¡lisis de riesgo..."})]});if(n.isError)return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"âš ï¸ AnÃ¡lisis de Riesgo ABC"}),e.jsx("p",{className:"text-red-400 mt-4",children:n.error?.message??"Error al cargar anÃ¡lisis"})]});const d=n.data;if(!d)return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"âš ï¸ AnÃ¡lisis de Riesgo ABC"}),e.jsx("p",{className:"text-neutral-400 mt-4",children:"No hay datos disponibles"})]});const h=l=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),o=d.categoryA.length+d.categoryB.length+d.categoryC.length,m=l=>({A:{label:"CategorÃ­a A - CrÃ­ticos",description:"Top 80% del volumen",color:"text-red-400",bgColor:"bg-red-950/50",borderColor:"border-red-800",icon:"ðŸ”´",suppliers:d.categoryA},B:{label:"CategorÃ­a B - Importantes",description:"15% del volumen",color:"text-yellow-400",bgColor:"bg-yellow-950/50",borderColor:"border-yellow-800",icon:"ðŸŸ¡",suppliers:d.categoryB},C:{label:"CategorÃ­a C - Ocasionales",description:"5% del volumen",color:"text-neutral-400",bgColor:"bg-neutral-800/50",borderColor:"border-neutral-700",icon:"âšª",suppliers:d.categoryC}})[l],a=d.concentrationIndex>.25,i=d.concentrationIndex>.4?"Muy Alto":d.concentrationIndex>.25?"Alto":d.concentrationIndex>.15?"Moderado":"Bajo",c=d.concentrationIndex>.4?"text-red-400":d.concentrationIndex>.25?"text-orange-400":d.concentrationIndex>.15?"text-yellow-400":"text-green-400";return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100 mb-4",children:"âš ï¸ AnÃ¡lisis de Riesgo ABC"}),e.jsxs("div",{className:`p-3 rounded border mb-4 ${a?"bg-orange-950/30 border-orange-800/50":"bg-neutral-900/50 border-neutral-800"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-neutral-400",children:"Ãndice de ConcentraciÃ³n (Herfindahl)"}),e.jsxs("span",{className:`text-lg font-bold ${c}`,children:[(d.concentrationIndex*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-neutral-500",children:"Nivel de riesgo:"}),e.jsx("span",{className:`text-sm font-medium ${c}`,children:i})]}),a&&e.jsx("div",{className:"mt-2 pt-2 border-t border-orange-800/30",children:e.jsx("p",{className:"text-xs text-orange-300",children:"âš ï¸ Alta concentraciÃ³n detectada. Considere diversificar proveedores para reducir riesgo."})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"p-3 rounded bg-neutral-900/50 border border-neutral-800",children:[e.jsx("div",{className:"text-xs text-neutral-500 mb-1",children:"Total Proveedores"}),e.jsx("div",{className:"text-xl font-bold text-neutral-200",children:o})]}),e.jsxs("div",{className:"p-3 rounded bg-neutral-900/50 border border-neutral-800",children:[e.jsx("div",{className:"text-xs text-neutral-500 mb-1",children:"Volumen Total"}),e.jsx("div",{className:"text-sm font-bold text-neutral-200",children:h(d.totalPurchaseVolume)})]}),e.jsxs("div",{className:"p-3 rounded bg-neutral-900/50 border border-neutral-800",children:[e.jsx("div",{className:"text-xs text-neutral-500 mb-1",children:"Productos Exclusivos"}),e.jsx("div",{className:"text-xl font-bold text-neutral-200",children:d.singleSourceProductsCount})]})]}),e.jsx("div",{className:"space-y-3",children:["A","B","C"].map(l=>{const s=m(l),p=s.suppliers.reduce((N,x)=>N+x.percentage,0);return e.jsxs("div",{className:`p-3 rounded border ${s.bgColor} ${s.borderColor}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:s.icon}),e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-semibold ${s.color}`,children:s.label}),e.jsx("div",{className:"text-xs text-neutral-500",children:s.description})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-bold ${s.color}`,children:s.suppliers.length}),e.jsxs("div",{className:"text-xs text-neutral-500",children:[p.toFixed(1),"%"]})]})]}),s.suppliers.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-current/10",children:[e.jsx("div",{className:"text-xs text-neutral-400 mb-2",children:"Top proveedores en esta categorÃ­a:"}),e.jsxs("div",{className:"space-y-1.5 max-h-32 overflow-y-auto",children:[s.suppliers.slice(0,5).map(N=>e.jsxs("div",{className:"flex items-center justify-between text-xs py-1 px-2 rounded bg-black/20",children:[e.jsx("span",{className:"text-neutral-300 truncate flex-1 mr-2",children:N.supplierName}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("span",{className:"text-neutral-400",children:h(N.purchaseAmount)}),e.jsxs("span",{className:`font-medium ${s.color}`,children:[N.percentage.toFixed(1),"%"]})]})]},N.supplierId)),s.suppliers.length>5&&e.jsxs("div",{className:"text-xs text-neutral-500 text-center pt-1",children:["+",s.suppliers.length-5," proveedor",s.suppliers.length-5!==1?"es":""," mÃ¡s"]})]})]})]},l)})}),e.jsx("div",{className:"mt-4 pt-3 border-t border-neutral-800",children:e.jsxs("details",{className:"text-xs text-neutral-500",children:[e.jsx("summary",{className:"cursor-pointer hover:text-neutral-400 transition-colors",children:"â„¹ï¸ Â¿QuÃ© significa el anÃ¡lisis ABC?"}),e.jsxs("div",{className:"mt-2 space-y-1 pl-4",children:[e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"CategorÃ­a A (CrÃ­ticos):"})," Proveedores que representan el 80% del volumen de compras. Requieren gestiÃ³n prioritaria."]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"CategorÃ­a B (Importantes):"})," Proveedores que representan el 15% del volumen. GestiÃ³n regular."]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"CategorÃ­a C (Ocasionales):"})," Proveedores que representan el 5% del volumen. GestiÃ³n simplificada."]}),e.jsxs("p",{className:"mt-2",children:["â€¢ ",e.jsx("strong",{children:"Ãndice de ConcentraciÃ³n:"})," Mide quÃ© tan dependiente es la empresa de pocos proveedores. >25% indica alta concentraciÃ³n de riesgo."]})]})]})})]})}function ce(){const[n,d]=v.useState(""),[h,o]=v.useState(""),m=S({queryKey:["suppliers"],queryFn:()=>w(),refetchOnWindowFocus:!1}),a=S({queryKey:["products"],queryFn:()=>Q({page:0,size:1e3}).then(r=>r.content),refetchOnWindowFocus:!1}),i=S({queryKey:["supplier-price-history",n,h],queryFn:()=>V(n,h),enabled:!!n&&!!h,refetchOnWindowFocus:!1}),c=r=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(r),l=r=>new Date(r).toLocaleDateString("es-CL",{year:"numeric",month:"short",day:"numeric"}),s=v.useMemo(()=>(m.data??[]).filter(r=>r.active!==!1),[m.data]),p=r=>r==="UP"?"ðŸ“ˆ":r==="DOWN"?"ðŸ“‰":"âž¡ï¸",N=r=>r==="UP"?"text-red-400":r==="DOWN"?"text-green-400":"text-neutral-400",x=(r,j)=>r==="STABLE"?"Estable":`${j>0?"+":""}${j.toFixed(1)}%`,t=i.data;return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100 mb-4",children:"ðŸ“Š Historial de Precios"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-neutral-400 mb-1",children:"Proveedor"}),e.jsxs("select",{value:n,onChange:r=>d(r.target.value),className:"w-full px-3 py-2 text-sm rounded bg-neutral-900 text-neutral-200 border border-neutral-700 focus:outline-none focus:border-blue-600",children:[e.jsx("option",{value:"",children:"Seleccionar proveedor..."}),s.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-neutral-400 mb-1",children:"Producto"}),e.jsxs("select",{value:h,onChange:r=>o(r.target.value),className:"w-full px-3 py-2 text-sm rounded bg-neutral-900 text-neutral-200 border border-neutral-700 focus:outline-none focus:border-blue-600",disabled:!n,children:[e.jsx("option",{value:"",children:"Seleccionar producto..."}),(a.data??[]).map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]})]}),i.isLoading&&n&&h&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-neutral-400",children:"Cargando historial de precios..."})}),i.isError&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-400",children:i.error?.message??"Error al cargar historial"})}),!n||!h?e.jsxs("div",{className:"text-center py-12 bg-neutral-900/50 rounded border border-neutral-800",children:[e.jsx("p",{className:"text-neutral-400",children:"Selecciona un proveedor y producto para ver el historial de precios"}),e.jsx("p",{className:"text-xs text-neutral-500 mt-2",children:"Analiza la evoluciÃ³n de precios en el Ãºltimo aÃ±o"})]}):null,t&&!i.isLoading&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"p-3 rounded bg-neutral-900/50 border border-neutral-800",children:[e.jsx("div",{className:"text-xs text-neutral-500 mb-1",children:"Precio Actual"}),e.jsx("div",{className:"text-lg font-bold text-blue-400",children:c(t.currentPrice)})]}),e.jsxs("div",{className:"p-3 rounded bg-neutral-900/50 border border-neutral-800",children:[e.jsx("div",{className:"text-xs text-neutral-500 mb-1",children:"Precio Promedio"}),e.jsx("div",{className:"text-lg font-bold text-neutral-200",children:c(t.averagePrice)})]}),e.jsxs("div",{className:"p-3 rounded bg-neutral-900/50 border border-neutral-800",children:[e.jsx("div",{className:"text-xs text-neutral-500 mb-1",children:"MÃ­nimo"}),e.jsx("div",{className:"text-lg font-bold text-green-400",children:c(t.minPrice)})]}),e.jsxs("div",{className:"p-3 rounded bg-neutral-900/50 border border-neutral-800",children:[e.jsx("div",{className:"text-xs text-neutral-500 mb-1",children:"MÃ¡ximo"}),e.jsx("div",{className:"text-lg font-bold text-red-400",children:c(t.maxPrice)})]})]}),e.jsxs("div",{className:`p-3 rounded border mb-4 ${t.trend==="UP"?"bg-red-950/30 border-red-800/50":t.trend==="DOWN"?"bg-green-950/30 border-green-800/50":"bg-neutral-900/50 border-neutral-800"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:p(t.trend)}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold text-neutral-200",children:["Tendencia:"," ",t.trend==="UP"?"Al alza":t.trend==="DOWN"?"A la baja":"Estable"]}),e.jsx("div",{className:"text-xs text-neutral-500",children:"Ãšltimos 3 meses vs 3 meses anteriores"})]})]}),e.jsx("div",{className:`text-xl font-bold ${N(t.trend)}`,children:x(t.trend,t.trendPercentage)})]}),t.trend==="UP"&&t.trendPercentage>10&&e.jsx("div",{className:"mt-2 pt-2 border-t border-red-800/30",children:e.jsx("p",{className:"text-xs text-red-300",children:"âš ï¸ Precio ha aumentado mÃ¡s del 10% en los Ãºltimos 3 meses. Considere negociar o buscar alternativas."})})]}),t.priceHistory.length>0?e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-neutral-300 mb-2",children:"Historial de Compras (Ãšltimo AÃ±o)"}),e.jsx("div",{className:"max-h-64 overflow-y-auto border border-neutral-800 rounded",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"sticky top-0 bg-neutral-900 border-b border-neutral-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-2 px-3 text-neutral-400 font-medium",children:"Fecha"}),e.jsx("th",{className:"text-right py-2 px-3 text-neutral-400 font-medium",children:"Precio Unit."}),e.jsx("th",{className:"text-right py-2 px-3 text-neutral-400 font-medium",children:"Cantidad"}),e.jsx("th",{className:"text-right py-2 px-3 text-neutral-400 font-medium",children:"Total"}),e.jsx("th",{className:"text-right py-2 px-3 text-neutral-400 font-medium",children:"vs Promedio"})]})}),e.jsx("tbody",{children:t.priceHistory.map((r,j)=>{const b=r.unitPrice*r.quantity,u=t.averagePrice>0?(r.unitPrice-t.averagePrice)/t.averagePrice*100:0,g=u>0;return e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-900/30",children:[e.jsx("td",{className:"py-2 px-3 text-neutral-300",children:l(r.date)}),e.jsx("td",{className:"py-2 px-3 text-right font-medium text-neutral-200",children:c(r.unitPrice)}),e.jsx("td",{className:"py-2 px-3 text-right text-neutral-400",children:r.quantity.toLocaleString("es-CL")}),e.jsx("td",{className:"py-2 px-3 text-right font-medium text-neutral-200",children:c(b)}),e.jsxs("td",{className:`py-2 px-3 text-right text-xs ${g?"text-red-400":"text-green-400"}`,children:[u>0?"+":"",u.toFixed(1),"%"]})]},j)})})]})}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-2",children:["Total de compras en el perÃ­odo: ",t.priceHistory.length]})]}):e.jsxs("div",{className:"text-center py-8 bg-neutral-900/50 rounded border border-neutral-800",children:[e.jsx("p",{className:"text-neutral-400",children:"No hay historial de compras para este producto con este proveedor"}),e.jsx("p",{className:"text-xs text-neutral-500 mt-2",children:"Los datos se mostrarÃ¡n despuÃ©s de realizar compras"})]})]})]})}function de(){const[n,d]=v.useState([]),h=S({queryKey:["suppliers"],queryFn:()=>w(),refetchOnWindowFocus:!1}),o=v.useMemo(()=>(h.data??[]).filter(x=>x.active!==!1),[h.data]),m=n.map(x=>S({queryKey:["supplier-metrics",x],queryFn:()=>R(x),enabled:!!x,refetchOnWindowFocus:!1})),a=x=>{n.includes(x)?d(n.filter(t=>t!==x)):n.length<4&&d([...n,x])},i=x=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(x),c=x=>x?new Date(x).toLocaleDateString("es-CL",{year:"numeric",month:"short",day:"numeric"}):"Nunca",l=(x,t)=>{const r=t.filter(u=>u!==void 0);if(r.length===0)return-1;const j=r.map(u=>{const g=u[x];return typeof g=="number"?g:typeof g=="string"?new Date(g).getTime():0}),b=Math.max(...j);return j.indexOf(b)},s=m.map(x=>x.data),p=m.every(x=>!x.isLoading),N=m.some(x=>x.isError);return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100 mb-4",children:"âš–ï¸ ComparaciÃ³n de Proveedores"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-xs text-neutral-400",children:"Seleccionar proveedores para comparar (mÃ¡x. 4)"}),e.jsxs("span",{className:"text-xs text-neutral-500",children:[n.length,"/4 seleccionados"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.map(x=>{const t=n.includes(x.id),r=n.length<4||t;return e.jsx("button",{onClick:()=>a(x.id),disabled:!r,className:`px-3 py-1.5 text-sm rounded border transition-colors ${t?"bg-blue-600 text-white border-blue-600":r?"bg-neutral-900 text-neutral-300 border-neutral-700 hover:border-blue-600":"bg-neutral-900/50 text-neutral-600 border-neutral-800 cursor-not-allowed"}`,children:x.name},x.id)})})]}),n.length===0&&e.jsxs("div",{className:"text-center py-12 bg-neutral-900/50 rounded border border-neutral-800",children:[e.jsx("p",{className:"text-neutral-400",children:"Selecciona al menos 2 proveedores para compararlos"}),e.jsx("p",{className:"text-xs text-neutral-500 mt-2",children:"Compara mÃ©tricas lado a lado para tomar mejores decisiones"})]}),n.length===1&&e.jsx("div",{className:"text-center py-8 bg-neutral-900/50 rounded border border-neutral-800",children:e.jsx("p",{className:"text-neutral-400",children:"Selecciona al menos un proveedor mÃ¡s para comparar"})}),n.length>=2&&!p&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-neutral-400",children:"Cargando mÃ©tricas..."})}),N&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-400",children:"Error al cargar algunas mÃ©tricas"})}),n.length>=2&&p&&!N&&e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-3 px-3 text-neutral-400 font-medium",children:"MÃ©trica"}),n.map((x,t)=>{const r=o.find(j=>j.id===x);return e.jsx("th",{className:"text-right py-3 px-3 text-neutral-200 font-semibold",children:e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{children:r?.name}),e.jsx("button",{onClick:()=>a(x),className:"text-xs text-red-400 hover:text-red-300 mt-1",children:"âœ• Quitar"})]})},x)})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-900/30",children:[e.jsx("td",{className:"py-3 px-3 text-neutral-300",children:"Total Compras"}),s.map((x,t)=>{const r=l("totalPurchases",s)===t;return e.jsxs("td",{className:`py-3 px-3 text-right font-medium ${r?"text-yellow-400":"text-neutral-200"}`,children:[x?.totalPurchases.toLocaleString("es-CL")??"-",r&&" ðŸ†"]},t)})]}),e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-900/30",children:[e.jsx("td",{className:"py-3 px-3 text-neutral-300",children:"Monto Total"}),s.map((x,t)=>{const r=l("totalAmount",s)===t;return e.jsxs("td",{className:`py-3 px-3 text-right font-medium ${r?"text-yellow-400":"text-neutral-200"}`,children:[x?i(x.totalAmount):"-",r&&" ðŸ†"]},t)})]}),e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-900/30",children:[e.jsx("td",{className:"py-3 px-3 text-neutral-300",children:"Valor Promedio Orden"}),s.map((x,t)=>{const r=l("averageOrderValue",s)===t;return e.jsxs("td",{className:`py-3 px-3 text-right font-medium ${r?"text-yellow-400":"text-neutral-200"}`,children:[x?i(x.averageOrderValue):"-",r&&" ðŸ†"]},t)})]}),e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-900/30",children:[e.jsx("td",{className:"py-3 px-3 text-neutral-300",children:"Ãšltima Compra"}),s.map((x,t)=>{const r=l("lastPurchaseDate",s)===t;return e.jsxs("td",{className:`py-3 px-3 text-right ${r?"text-yellow-400 font-medium":"text-neutral-300"}`,children:[c(x?.lastPurchaseDate??null),r&&" ðŸ†"]},t)})]}),e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-900/30",children:[e.jsx("td",{className:"py-3 px-3 text-neutral-300",children:"Compras Ãšltimo Mes"}),s.map((x,t)=>{const r=l("purchasesLastMonth",s)===t;return e.jsxs("td",{className:`py-3 px-3 text-right font-medium ${r?"text-yellow-400":"text-neutral-200"}`,children:[x?.purchasesLastMonth.toLocaleString("es-CL")??"-",r&&" ðŸ†"]},t)})]}),e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-900/30",children:[e.jsx("td",{className:"py-3 px-3 text-neutral-300",children:"Monto Ãšltimo Mes"}),s.map((x,t)=>{const r=l("amountLastMonth",s)===t;return e.jsxs("td",{className:`py-3 px-3 text-right font-medium ${r?"text-yellow-400":"text-neutral-200"}`,children:[x?i(x.amountLastMonth):"-",r&&" ðŸ†"]},t)})]}),e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-900/30",children:[e.jsx("td",{className:"py-3 px-3 text-neutral-300",children:"Compras Mes Anterior"}),s.map((x,t)=>e.jsx("td",{className:"py-3 px-3 text-right text-neutral-300",children:x?.purchasesPreviousMonth.toLocaleString("es-CL")??"-"},t))]}),e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-900/30",children:[e.jsx("td",{className:"py-3 px-3 text-neutral-300",children:"Monto Mes Anterior"}),s.map((x,t)=>e.jsx("td",{className:"py-3 px-3 text-right text-neutral-300",children:x?i(x.amountPreviousMonth):"-"},t))]})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-neutral-800 text-xs text-neutral-500 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ†"}),e.jsx("span",{children:"Indica el mejor valor en cada mÃ©trica"})]})]})]})}function oe(){const n=S({queryKey:["negotiation-opportunities"],queryFn:()=>O(),refetchOnWindowFocus:!1}),d=l=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),h=l=>l==="HIGH"?"bg-red-950/50 text-red-400 border-red-800":l==="MEDIUM"?"bg-orange-950/50 text-orange-400 border-orange-800":"bg-yellow-950/50 text-yellow-400 border-yellow-800",o=l=>l==="HIGH"?"ðŸ”´":l==="MEDIUM"?"ðŸŸ ":"ðŸŸ¡",m=l=>l==="HIGH"?"Alta":l==="MEDIUM"?"Media":"Baja";if(n.isLoading)return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"ðŸ’° Oportunidades de NegociaciÃ³n"}),e.jsx("p",{className:"text-neutral-400 mt-4",children:"Cargando oportunidades..."})]});if(n.isError)return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"ðŸ’° Oportunidades de NegociaciÃ³n"}),e.jsx("p",{className:"text-red-400 mt-4",children:n.error?.message??"Error al cargar oportunidades"})]});const a=n.data??[],i=a.reduce((l,s)=>l+s.potentialSavings,0),c=a.filter(l=>l.priority==="HIGH").length;return e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"ðŸ’° Oportunidades de NegociaciÃ³n"}),a.length>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-neutral-500",children:"Savings Potenciales"}),e.jsx("div",{className:"text-lg font-bold text-green-400",children:d(i)})]}),c>0&&e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded bg-red-950/50 text-red-400 border border-red-800",children:[c," urgente",c!==1?"s":""]})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-12 bg-neutral-900/50 rounded border border-neutral-800",children:[e.jsx("p",{className:"text-neutral-400",children:"âœ… No se detectaron oportunidades de negociaciÃ³n"}),e.jsx("p",{className:"text-xs text-neutral-500 mt-2",children:"Tus precios estÃ¡n alineados con el mercado o no hay suficientes proveedores para comparar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-2 px-2 text-neutral-400 font-medium",children:"Prioridad"}),e.jsx("th",{className:"text-left py-2 px-2 text-neutral-400 font-medium",children:"Proveedor"}),e.jsx("th",{className:"text-left py-2 px-2 text-neutral-400 font-medium",children:"Producto"}),e.jsx("th",{className:"text-right py-2 px-2 text-neutral-400 font-medium",children:"Precio Actual"}),e.jsx("th",{className:"text-right py-2 px-2 text-neutral-400 font-medium",children:"Promedio Mercado"}),e.jsx("th",{className:"text-right py-2 px-2 text-neutral-400 font-medium",children:"% Sobre"}),e.jsx("th",{className:"text-right py-2 px-2 text-neutral-400 font-medium",children:"Compras (12m)"}),e.jsx("th",{className:"text-right py-2 px-2 text-neutral-400 font-medium",children:"Savings Potencial"}),e.jsx("th",{className:"text-left py-2 px-2 text-neutral-400 font-medium",children:"RecomendaciÃ³n"})]})}),e.jsx("tbody",{children:a.map((l,s)=>e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-900/30 transition-colors",children:[e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:o(l.priority)}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded border ${h(l.priority)}`,children:m(l.priority)})]})}),e.jsx("td",{className:"py-3 px-2 text-neutral-200 font-medium",children:l.supplierName}),e.jsx("td",{className:"py-3 px-2 text-neutral-300",children:l.productName}),e.jsx("td",{className:"py-3 px-2 text-right text-neutral-200 font-medium",children:d(l.currentPrice)}),e.jsx("td",{className:"py-3 px-2 text-right text-green-400",children:d(l.marketAverage)}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("span",{className:"text-red-400 font-semibold",children:["+",l.pricePercentageAboveMarket.toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-2 text-right text-neutral-300",children:l.purchasesLast12Months.toLocaleString("es-CL")}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-green-400 font-bold",children:d(l.potentialSavings)}),e.jsx("span",{className:"text-xs text-neutral-500",children:"si iguala mercado"})]})}),e.jsx("td",{className:"py-3 px-2 text-neutral-400 text-xs max-w-xs",children:l.recommendation})]},s))})]})}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-neutral-800",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-neutral-200",children:a.length}),e.jsx("div",{className:"text-xs text-neutral-500",children:"Oportunidades Detectadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:d(i)}),e.jsx("div",{className:"text-xs text-neutral-500",children:"Savings Potenciales Totales"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:c}),e.jsx("div",{className:"text-xs text-neutral-500",children:"Prioridad Alta (Urgente)"})]})]}),e.jsxs("details",{className:"text-xs text-neutral-500",children:[e.jsx("summary",{className:"cursor-pointer hover:text-neutral-400 transition-colors",children:"â„¹ï¸ Â¿CÃ³mo se calculan las oportunidades?"}),e.jsxs("div",{className:"mt-2 space-y-1 pl-4",children:[e.jsx("p",{children:"â€¢ Se comparan los precios de cada proveedor contra el promedio del mercado (otros proveedores del mismo producto)"}),e.jsxs("p",{children:["â€¢ Se detectan casos donde el precio actual estÃ¡ ",e.jsx("strong",{children:">10%"})," por encima del promedio"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Savings potenciales"})," = Diferencia de precio Ã— Cantidad comprada en Ãºltimos 12 meses"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Prioridad Alta"}),": Savings > $100,000 | ",e.jsx("strong",{children:"Media"}),": $50,000-$100,000 | ",e.jsx("strong",{children:"Baja"}),": < $50,000"]}),e.jsxs("p",{className:"mt-2",children:["ðŸ’¡ ",e.jsx("strong",{children:"AcciÃ³n recomendada"}),": Contactar proveedores de prioridad alta y negociar reducciÃ³n de precios"]})]})]})]})]})]})}function xe(){const n=S({queryKey:["single-source-products"],queryFn:()=>T(),refetchOnWindowFocus:!1}),d=s=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),h=s=>new Date(s).toLocaleDateString("es-CL",{year:"numeric",month:"short",day:"numeric"}),o=s=>s==="CRITICAL"?"bg-red-950/50 text-red-400 border-red-800":s==="HIGH"?"bg-orange-950/50 text-orange-400 border-orange-800":s==="MEDIUM"?"bg-yellow-950/50 text-yellow-400 border-yellow-800":"bg-neutral-800/50 text-neutral-400 border-neutral-700",m=s=>s==="CRITICAL"?"ðŸ”´":s==="HIGH"?"ðŸŸ ":s==="MEDIUM"?"ðŸŸ¡":"ðŸŸ¢",a=s=>s==="CRITICAL"?"CrÃ­tico":s==="HIGH"?"Alto":s==="MEDIUM"?"Medio":"Bajo";if(n.isLoading)return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"âš ï¸ Productos con Proveedor Ãšnico"}),e.jsx("p",{className:"text-neutral-400 mt-4",children:"Cargando productos..."})]});if(n.isError)return e.jsxs("div",{className:"card-content",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"âš ï¸ Productos con Proveedor Ãšnico"}),e.jsx("p",{className:"text-red-400 mt-4",children:n.error?.message??"Error al cargar productos"})]});const i=n.data??[],c=i.filter(s=>s.riskLevel==="CRITICAL"||s.riskLevel==="HIGH").length,l=i.reduce((s,p)=>s+p.totalSpentLast12Months,0);return e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"âš ï¸ Productos con Proveedor Ãšnico"}),i.length>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-neutral-500",children:"ExposiciÃ³n Total"}),e.jsx("div",{className:"text-lg font-bold text-orange-400",children:d(l)})]}),c>0&&e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded bg-red-950/50 text-red-400 border border-red-800",children:[c," crÃ­tico",c!==1?"s":""]})]})]}),i.length===0?e.jsxs("div",{className:"text-center py-12 bg-neutral-900/50 rounded border border-neutral-800",children:[e.jsx("p",{className:"text-neutral-400",children:"âœ… Excelente diversificaciÃ³n de proveedores"}),e.jsx("p",{className:"text-xs text-neutral-500 mt-2",children:"Todos los productos tienen mÃºltiples proveedores alternativos"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-neutral-800",children:[e.jsx("th",{className:"text-left py-2 px-2 text-neutral-400 font-medium",children:"Riesgo"}),e.jsx("th",{className:"text-left py-2 px-2 text-neutral-400 font-medium",children:"Producto"}),e.jsx("th",{className:"text-left py-2 px-2 text-neutral-400 font-medium",children:"Proveedor Ãšnico"}),e.jsx("th",{className:"text-right py-2 px-2 text-neutral-400 font-medium",children:"Precio Actual"}),e.jsx("th",{className:"text-right py-2 px-2 text-neutral-400 font-medium",children:"Compras (12m)"}),e.jsx("th",{className:"text-right py-2 px-2 text-neutral-400 font-medium",children:"Gasto Total"}),e.jsx("th",{className:"text-right py-2 px-2 text-neutral-400 font-medium",children:"Ãšltima Compra"}),e.jsx("th",{className:"text-left py-2 px-2 text-neutral-400 font-medium",children:"RecomendaciÃ³n"})]})}),e.jsx("tbody",{children:i.map((s,p)=>e.jsxs("tr",{className:"border-b border-neutral-800/50 hover:bg-neutral-900/30 transition-colors",children:[e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:m(s.riskLevel)}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded border ${o(s.riskLevel)}`,children:a(s.riskLevel)})]})}),e.jsx("td",{className:"py-3 px-2 text-neutral-200 font-medium",children:s.productName}),e.jsx("td",{className:"py-3 px-2 text-neutral-300",children:s.supplierName}),e.jsx("td",{className:"py-3 px-2 text-right text-neutral-200",children:d(s.currentPrice)}),e.jsx("td",{className:"py-3 px-2 text-right text-neutral-300",children:s.purchasesLast12Months.toLocaleString("es-CL")}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsx("span",{className:`font-bold ${s.riskLevel==="CRITICAL"?"text-red-400":s.riskLevel==="HIGH"?"text-orange-400":"text-neutral-200"}`,children:d(s.totalSpentLast12Months)})}),e.jsx("td",{className:"py-3 px-2 text-right text-neutral-400 text-xs",children:h(s.lastPurchaseDate)}),e.jsx("td",{className:"py-3 px-2 text-neutral-400 text-xs max-w-xs",children:s.recommendation})]},p))})]})}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-neutral-800",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-neutral-200",children:i.length}),e.jsx("div",{className:"text-xs text-neutral-500",children:"Productos Afectados"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:i.filter(s=>s.riskLevel==="CRITICAL").length}),e.jsx("div",{className:"text-xs text-neutral-500",children:"Riesgo CrÃ­tico"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-400",children:i.filter(s=>s.riskLevel==="HIGH").length}),e.jsx("div",{className:"text-xs text-neutral-500",children:"Riesgo Alto"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-400",children:d(l)}),e.jsx("div",{className:"text-xs text-neutral-500",children:"ExposiciÃ³n Total"})]})]}),e.jsxs("details",{className:"text-xs text-neutral-500",children:[e.jsx("summary",{className:"cursor-pointer hover:text-neutral-400 transition-colors",children:"â„¹ï¸ Â¿Por quÃ© es importante diversificar proveedores?"}),e.jsxs("div",{className:"mt-2 space-y-1 pl-4",children:[e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Continuidad del negocio"}),": Si el Ãºnico proveedor falla, no hay alternativas inmediatas"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Poder de negociaciÃ³n"}),": Proveedores Ãºnicos pueden subir precios sin competencia"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Calidad y servicio"}),": MÃºltiples proveedores permiten comparar y exigir mejor calidad"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Resiliencia ante crisis"}),": DiversificaciÃ³n reduce impacto de problemas externos"]}),e.jsxs("p",{className:"mt-2",children:["â€¢ ",e.jsx("strong",{children:"Niveles de riesgo"}),":"]}),e.jsxs("p",{className:"pl-2",children:["Â· ",e.jsx("strong",{children:"CrÃ­tico"}),": Gasto > $500,000 | ",e.jsx("strong",{children:"Alto"}),": $200,000-$500,000"]}),e.jsxs("p",{className:"pl-2",children:["Â· ",e.jsx("strong",{children:"Medio"}),": $50,000-$200,000 | ",e.jsx("strong",{children:"Bajo"}),": < $50,000"]}),e.jsxs("p",{className:"mt-2",children:["ðŸ’¡ ",e.jsx("strong",{children:"AcciÃ³n recomendada"}),": Buscar proveedores alternativos para productos de riesgo crÃ­tico/alto"]})]})]})]})]})]})}function me(){const[n,d]=v.useState(""),{data:h=[]}=S({queryKey:["suppliers",{active:!0}],queryFn:()=>w(void 0,!0)}),{data:o,isLoading:m,error:a}=S({queryKey:["supplier-forecast",n],queryFn:()=>_(n),enabled:!!n}),i=o?.monthlyForecasts.filter(t=>!t.isForecast)??[],c=o?.monthlyForecasts.filter(t=>t.isForecast)??[],l=i.reduce((t,r)=>t+(r.actualSpend??0),0),s=c.reduce((t,r)=>t+(r.forecastSpend??0),0),p=o?.trend==="INCREASING"?"ðŸ“ˆ":o?.trend==="DECREASING"?"ðŸ“‰":"âž¡ï¸",N=o?.trend==="INCREASING"?"text-green-400":o?.trend==="DECREASING"?"text-red-400":"text-blue-400",x=o?.trend==="INCREASING"?"En Aumento":o?.trend==="DECREASING"?"Decreciente":"Estable";return e.jsxs("div",{className:"rounded-lg border border-neutral-800 bg-neutral-900 p-6",children:[e.jsx("h2",{className:"mb-4 text-lg font-medium text-neutral-100",children:"ðŸ“Š Forecast de Compras por Proveedor"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"mb-2 block text-sm text-neutral-400",children:"Seleccionar Proveedor"}),e.jsxs("select",{value:n,onChange:t=>d(t.target.value),className:"w-full rounded border border-neutral-700 bg-neutral-800 px-3 py-2 text-neutral-100 focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"-- Seleccione un proveedor --"}),h.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),!n&&e.jsx("p",{className:"text-center text-neutral-500",children:"Seleccione un proveedor para ver el forecast"}),n&&m&&e.jsx("p",{className:"text-center text-neutral-400",children:"Cargando forecast..."}),n&&a&&e.jsx("p",{className:"text-center text-red-400",children:"Error al cargar forecast"}),o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("p",{className:"text-sm text-neutral-400",children:"Promedio Mensual"}),e.jsxs("p",{className:"mt-1 text-2xl font-semibold text-neutral-100",children:["$",o.averageMonthlySpend.toLocaleString("es-CL")]})]}),e.jsxs("div",{className:"rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("p",{className:"text-sm text-neutral-400",children:"ProyecciÃ³n PrÃ³ximo Mes"}),e.jsxs("p",{className:"mt-1 text-2xl font-semibold text-blue-400",children:["$",o.projectedNextMonthSpend.toLocaleString("es-CL")]})]}),e.jsxs("div",{className:"rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("p",{className:"text-sm text-neutral-400",children:"Ã“rdenes Promedio"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-neutral-100",children:o.averageMonthlyOrders})]}),e.jsxs("div",{className:"rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("p",{className:"text-sm text-neutral-400",children:"Tendencia"}),e.jsxs("p",{className:`mt-1 text-2xl font-semibold ${N}`,children:[p," ",x]})]})]}),e.jsxs("div",{className:"rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("h3",{className:"mb-4 text-sm font-medium text-neutral-300",children:"Gasto Mensual (Ãšltimos 6 Meses + ProyecciÃ³n 3 Meses)"}),e.jsx("div",{className:"space-y-3",children:o.monthlyForecasts.map((t,r)=>{const j=t.isForecast?t.forecastSpend??0:t.actualSpend??0,b=Math.max(...o.monthlyForecasts.map(g=>g.isForecast?g.forecastSpend??0:g.actualSpend??0)),u=b>0?j/b*100:0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-20 text-right text-sm text-neutral-400",children:t.month}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:`rounded px-3 py-2 text-sm ${t.isForecast?"bg-blue-500/30 text-blue-300":"bg-green-500/30 text-green-300"}`,style:{width:`${u}%`},children:["$",j.toLocaleString("es-CL"),t.isForecast&&" (proyectado)"]})}),!t.isForecast&&e.jsxs("div",{className:"w-24 text-right text-xs text-neutral-500",children:[t.actualOrders," Ã³rdenes"]}),t.isForecast&&e.jsxs("div",{className:"w-24 text-right text-xs text-neutral-500",children:["~",t.forecastOrders," Ã³rdenes"]})]},r)})}),e.jsxs("div",{className:"mt-4 flex gap-4 border-t border-neutral-800 pt-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded bg-green-500/30"}),e.jsx("span",{className:"text-neutral-400",children:"Real"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded bg-blue-500/30"}),e.jsx("span",{className:"text-neutral-400",children:"Proyectado"})]})]})]}),o.recommendation&&e.jsx("div",{className:"rounded border border-blue-500/30 bg-blue-500/10 p-4",children:e.jsxs("p",{className:"text-sm text-blue-300",children:["ðŸ’¡ ",e.jsx("strong",{children:"RecomendaciÃ³n:"})," ",o.recommendation]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b border-neutral-800 text-neutral-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"pb-2 text-left font-medium",children:"Mes"}),e.jsx("th",{className:"pb-2 text-right font-medium",children:"Gasto Real"}),e.jsx("th",{className:"pb-2 text-right font-medium",children:"Gasto Proyectado"}),e.jsx("th",{className:"pb-2 text-right font-medium",children:"Ã“rdenes Reales"}),e.jsx("th",{className:"pb-2 text-right font-medium",children:"Ã“rdenes Proyectadas"}),e.jsx("th",{className:"pb-2 text-center font-medium",children:"Tipo"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-800",children:o.monthlyForecasts.map((t,r)=>e.jsxs("tr",{className:"text-neutral-300",children:[e.jsx("td",{className:"py-2",children:t.month}),e.jsx("td",{className:"py-2 text-right",children:t.actualSpend!==null?`$${t.actualSpend.toLocaleString("es-CL")}`:"-"}),e.jsx("td",{className:"py-2 text-right",children:t.forecastSpend!==null?`$${t.forecastSpend.toLocaleString("es-CL")}`:"-"}),e.jsx("td",{className:"py-2 text-right",children:t.actualOrders!==null?t.actualOrders:"-"}),e.jsx("td",{className:"py-2 text-right",children:t.forecastOrders!==null?t.forecastOrders:"-"}),e.jsx("td",{className:"py-2 text-center",children:t.isForecast?e.jsx("span",{className:"rounded-full bg-blue-500/20 px-2 py-0.5 text-xs text-blue-400",children:"ProyecciÃ³n"}):e.jsx("span",{className:"rounded-full bg-green-500/20 px-2 py-0.5 text-xs text-green-400",children:"Real"})})]},r))}),e.jsx("tfoot",{className:"border-t-2 border-neutral-700 text-neutral-200",children:e.jsxs("tr",{children:[e.jsx("td",{className:"pt-2 font-medium",children:"Totales"}),e.jsxs("td",{className:"pt-2 text-right font-medium",children:["$",l.toLocaleString("es-CL")]}),e.jsxs("td",{className:"pt-2 text-right font-medium",children:["$",s.toLocaleString("es-CL")]}),e.jsx("td",{className:"pt-2 text-right font-medium",children:i.reduce((t,r)=>t+(r.actualOrders??0),0)}),e.jsx("td",{className:"pt-2 text-right font-medium",children:c.reduce((t,r)=>t+(r.forecastOrders??0),0)}),e.jsx("td",{})]})})]})}),e.jsxs("details",{className:"rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-neutral-400 hover:text-neutral-300",children:"Â¿CÃ³mo funciona el forecast?"}),e.jsxs("div",{className:"mt-3 space-y-2 text-sm text-neutral-500",children:[e.jsx("p",{children:"El forecast analiza las compras de los Ãºltimos 6 meses para proyectar las necesidades futuras del proveedor seleccionado."}),e.jsxs("ul",{className:"list-inside list-disc space-y-1 pl-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Tendencia:"})," Compara los Ãºltimos 3 meses vs los 3 anteriores para detectar si la demanda estÃ¡ aumentando, disminuyendo o estable."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"ProyecciÃ³n:"})," Usa promedios mÃ³viles simples ajustados por tendencia para estimar los prÃ³ximos 3 meses."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PrecisiÃ³n:"})," Esta es una estimaciÃ³n estadÃ­stica bÃ¡sica. Considere factores estacionales y cambios de negocio al tomar decisiones."]})]})]})]})]})]})}function ue(){const{data:n=[]}=S({queryKey:["suppliers"],queryFn:()=>w()}),{data:d=[]}=S({queryKey:["suppliers-ranking"],queryFn:()=>D()}),{data:h=[]}=S({queryKey:["negotiation-opportunities"],queryFn:O}),{data:o=[]}=S({queryKey:["single-source-products"],queryFn:T}),{data:m=[]}=S({queryKey:["supplier-alerts"],queryFn:$}),a=n.length,i=n.filter(u=>u.active!==!1).length,c=d.length>0?d.reduce((u,g)=>u+g.reliability,0)/d.length:0,l=d.filter(u=>u.category==="A").length,s=o.filter(u=>u.riskLevel==="CRITICAL").length,p=h.filter(u=>u.priority==="HIGH").length,N=h.filter(u=>u.priority==="HIGH"||u.priority==="MEDIUM").reduce((u,g)=>u+g.potentialSavings,0),x=[];s>0&&x.push({icon:"âš ï¸",title:`${s} Productos en Riesgo CrÃ­tico`,description:"Productos con un solo proveedor y alta exposiciÃ³n. Buscar alternativas.",severity:"critical",link:"#single-source"}),p>0&&x.push({icon:"ðŸ’°",title:`${p} Oportunidades de Ahorro`,description:`Potencial de ahorro: $${N.toLocaleString("es-CL")}`,severity:"high",link:"#negotiation"});const t=m.filter(u=>u.severity==="CRITICAL");t.length>0&&x.push({icon:"ðŸ”´",title:`${t.length} Alertas CrÃ­ticas`,description:t[0]?.message??"Requieren atenciÃ³n inmediata",severity:"critical",link:"#alerts"});const r=m.filter(u=>u.severity==="WARNING");r.length>0&&x.length<3&&x.push({icon:"ðŸŸ ",title:`${r.length} Alertas de Advertencia`,description:r[0]?.message??"Requieren revisiÃ³n pronta",severity:"high",link:"#alerts"});const j=[];l<5&&j.push({icon:"ðŸ“Š",text:`Solo ${l} proveedores clase A. Considere expandir su base estratÃ©gica.`,action:"Ver ranking completo"}),c<90&&j.push({icon:"â±ï¸",text:`Tasa de entrega a tiempo: ${c.toFixed(1)}%. Revisar SLAs con proveedores.`,action:"Ver performance"}),o.length>10&&j.push({icon:"ðŸ”„",text:`${o.length} productos con Ãºnico proveedor. Riesgo de dependencia.`,action:"Diversificar fuentes"});const b={critical:"border-red-500/30 bg-red-500/10 text-red-300",high:"border-orange-500/30 bg-orange-500/10 text-orange-300",medium:"border-yellow-500/30 bg-yellow-500/10 text-yellow-300"};return e.jsxs("div",{className:"rounded-lg border border-neutral-800 bg-neutral-900 p-6",children:[e.jsx("h2",{className:"mb-6 text-xl font-semibold text-neutral-100",children:"ðŸŽ¯ Dashboard Ejecutivo de Proveedores"}),e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("p",{className:"text-sm text-neutral-400",children:"Total Proveedores"}),e.jsx("p",{className:"mt-1 text-3xl font-bold text-neutral-100",children:a}),e.jsxs("p",{className:"mt-1 text-xs text-neutral-500",children:[i," activos"]})]}),e.jsxs("div",{className:"rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("p",{className:"text-sm text-neutral-400",children:"Proveedores Clase A"}),e.jsx("p",{className:"mt-1 text-3xl font-bold text-green-400",children:l}),e.jsx("p",{className:"mt-1 text-xs text-neutral-500",children:"EstratÃ©gicos (80% volumen)"})]}),e.jsxs("div",{className:"rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("p",{className:"text-sm text-neutral-400",children:"Entrega a Tiempo"}),e.jsxs("p",{className:"mt-1 text-3xl font-bold text-blue-400",children:[c.toFixed(1),"%"]}),e.jsx("p",{className:"mt-1 text-xs text-neutral-500",children:"Promedio Ãºltimos 12 meses"})]}),e.jsxs("div",{className:"rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("p",{className:"text-sm text-neutral-400",children:"Ahorro Potencial"}),e.jsxs("p",{className:"mt-1 text-3xl font-bold text-yellow-400",children:["$",(N/1e3).toFixed(0),"k"]}),e.jsx("p",{className:"mt-1 text-xs text-neutral-500",children:"Oportunidades detectadas"})]})]}),x.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"mb-3 text-sm font-medium text-neutral-300",children:"ðŸš¨ Acciones Prioritarias"}),e.jsx("div",{className:"space-y-2",children:x.slice(0,3).map((u,g)=>e.jsxs("div",{className:`flex items-start gap-3 rounded border p-3 ${b[u.severity]}`,children:[e.jsx("span",{className:"text-2xl",children:u.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:u.title}),e.jsx("p",{className:"mt-1 text-sm opacity-80",children:u.description})]}),u.link&&e.jsx("a",{href:u.link,className:"rounded bg-neutral-900/50 px-3 py-1 text-sm hover:bg-neutral-900",children:"Ver"})]},g))})]}),e.jsxs("div",{className:"mb-6 rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("h3",{className:"mb-3 text-sm font-medium text-neutral-300",children:"ðŸ“Š ClasificaciÃ³n ABC de Proveedores"}),e.jsx("div",{className:"space-y-2",children:["A","B","C"].map(u=>{const g=d.filter(P=>P.category===u).length,y=a>0?g/a*100:0,C={A:"bg-green-500",B:"bg-yellow-500",C:"bg-blue-500"};return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-16 text-sm text-neutral-400",children:["Clase ",u]}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"h-6 w-full rounded bg-neutral-800",children:e.jsx("div",{className:`h-full rounded ${C[u]} flex items-center justify-center text-xs font-medium text-white`,style:{width:`${y}%`},children:y>5&&`${g} (${y.toFixed(0)}%)`})})}),e.jsxs("div",{className:"w-20 text-right text-sm text-neutral-400",children:[g," prov."]})]},u)})})]}),j.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"mb-3 text-sm font-medium text-neutral-300",children:"ðŸ’¡ Recomendaciones EstratÃ©gicas"}),e.jsx("div",{className:"space-y-2",children:j.map((u,g)=>e.jsxs("div",{className:"flex items-start gap-3 rounded border border-blue-500/30 bg-blue-500/10 p-3 text-blue-300",children:[e.jsx("span",{className:"text-xl",children:u.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm",children:u.text}),e.jsx("p",{className:"mt-1 text-xs opacity-70",children:u.action})]})]},g))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-medium text-neutral-300",children:"Productos en Riesgo"}),e.jsx("div",{className:"space-y-2",children:["CRITICAL","HIGH","MEDIUM","LOW"].map(u=>{const g=o.filter(C=>C.riskLevel===u).length,y={CRITICAL:"text-red-400",HIGH:"text-orange-400",MEDIUM:"text-yellow-400",LOW:"text-green-400"};return g>0?e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-neutral-400",children:u}),e.jsx("span",{className:y[u],children:g})]},u):null})})]}),e.jsxs("div",{className:"rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-medium text-neutral-300",children:"Oportunidades de Ahorro"}),e.jsx("div",{className:"space-y-2",children:["HIGH","MEDIUM","LOW"].map(u=>{const g=h.filter(P=>P.priority===u).length,y=h.filter(P=>P.priority===u).reduce((P,A)=>P+A.potentialSavings,0),C={HIGH:"text-red-400",MEDIUM:"text-orange-400",LOW:"text-yellow-400"};return g>0?e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-neutral-400",children:[u," (",g,")"]}),e.jsxs("span",{className:C[u],children:["$",(y/1e3).toFixed(0),"k"]})]},u):null})})]})]}),e.jsxs("details",{className:"mt-6 rounded border border-neutral-800 bg-neutral-950 p-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-neutral-400 hover:text-neutral-300",children:"â„¹ï¸ Acerca de este dashboard"}),e.jsxs("div",{className:"mt-3 space-y-2 text-sm text-neutral-500",children:[e.jsx("p",{children:"Este dashboard ejecutivo consolida los principales indicadores de gestiÃ³n de proveedores para facilitar la toma de decisiones estratÃ©gicas."}),e.jsxs("ul",{className:"list-inside list-disc space-y-1 pl-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Acciones Prioritarias:"})," Identifica automÃ¡ticamente las acciones mÃ¡s urgentes basadas en riesgos y oportunidades detectadas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"ClasificaciÃ³n ABC:"})," Proveedores A (80% volumen), B (15%), C (5%)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Riesgos:"})," Productos con Ãºnico proveedor clasificados por exposiciÃ³n."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Ahorro:"})," Oportunidades de negociaciÃ³n por precios sobre mercado."]})]})]})]})]})}function ve(){const n=v.useRef(null),d=F(),[h,o]=v.useState(!1),[m,a]=v.useState(null),[i,c]=v.useState(!1),[l,s]=v.useState(null),[p,N]=v.useState(null),x=()=>{a(null),o(!0)},t=g=>{a(g),o(!0)},r=()=>{o(!1),a(null)},j=()=>{d.invalidateQueries({queryKey:["suppliers"]}),r()},b=async()=>{try{const g=await z(),y=window.URL.createObjectURL(g),C=document.createElement("a");C.href=y,C.download=`proveedores_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(y)}catch(g){console.error("Error exportando proveedores:",g),alert("Error al exportar proveedores")}},u=async g=>{const y=g.target.files?.[0];if(y){c(!0),s(null),N(null);try{const C=await X(y);d.invalidateQueries({queryKey:["suppliers"]}),C.errors.length>0?s(`Se crearon ${C.created} proveedores con ${C.errors.length} errores`):N(`Se importaron ${C.created} proveedores exitosamente`)}catch(C){s(C?.message??"Error al importar proveedores")}finally{c(!1),g.target.value=""}}};return e.jsxs("div",{className:"page-section",children:[e.jsx(Y,{title:"Proveedores",description:"Consolida contratos, contactos y desempeÃ±o de abastecimiento.",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-ghost",onClick:b,children:"ðŸ“¥ Exportar CSV"}),e.jsxs("label",{className:"btn btn-ghost",style:{cursor:"pointer"},children:["ðŸ“¤ Importar CSV",e.jsx("input",{type:"file",accept:".csv",onChange:u,disabled:i,style:{display:"none"}})]}),e.jsx("button",{className:"btn",onClick:x,children:"+ Nuevo proveedor"})]})}),l&&e.jsx("div",{className:"alert alert-error",children:l}),p&&e.jsx("div",{className:"alert alert-success",children:p}),e.jsx(te,{open:h,supplier:m,onClose:r,onSaved:j}),e.jsxs("section",{className:"responsive-grid",children:[e.jsx("div",{className:"card",children:e.jsx(q,{ref:n,onOpenCreateDialog:x,onOpenEditDialog:t})}),e.jsx("div",{className:"card",children:e.jsx(re,{})})]}),e.jsxs("section",{className:"responsive-grid mt-6",children:[e.jsx("div",{className:"card",children:e.jsx(ae,{})}),e.jsx("div",{className:"card",children:e.jsx(ne,{})})]}),e.jsxs("section",{className:"responsive-grid mt-6",children:[e.jsx("div",{className:"card",children:e.jsx(le,{})}),e.jsx("div",{className:"card",children:e.jsx(ie,{})})]}),e.jsxs("section",{className:"responsive-grid mt-6",children:[e.jsx("div",{className:"card",children:e.jsx(ce,{})}),e.jsx("div",{className:"card",children:e.jsx(de,{})})]}),e.jsxs("section",{className:"responsive-grid mt-6",children:[e.jsx("div",{className:"card",children:e.jsx(oe,{})}),e.jsx("div",{className:"card",children:e.jsx(xe,{})})]}),e.jsxs("section",{className:"responsive-grid mt-6",children:[e.jsx("div",{className:"card",children:e.jsx(ue,{})}),e.jsx("div",{className:"card",children:e.jsx(me,{})})]})]})}export{ve as default};
