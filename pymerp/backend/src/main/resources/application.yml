server:
  port: 8081

spring:
  datasource:
    url: jdbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:55432}/${POSTGRES_DB:pymes}
    username: ${POSTGRES_USER:pymes}
    password: ${POSTGRES_PASSWORD:pymes}
  jpa:
    hibernate:
      ddl-auto: validate
    open-in-view: false
    properties:
      hibernate:
        '[jdbc.time_zone]': UTC
        '[format_sql]': true
        dialect: org.hibernate.dialect.PostgreSQLDialect
  flyway:
    enabled: true
    baseline-on-migrate: true
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
  mail:
    host: ${MAIL_HOST:localhost}
    port: ${MAIL_PORT:1025}
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: ${MAIL_SMTP_AUTH:false}
          '[starttls.enable]': ${MAIL_SMTP_STARTTLS_ENABLE:false}
    default-encoding: UTF-8
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI:http://localhost:8082/realms/pymerp}
      client:
        registration:
          keycloak:
            client-id: ${SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK_CLIENT_ID:pymerp-frontend}
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
            scope:
              - openid
              - profile
              - email
        provider:
          keycloak:
            issuer-uri: ${SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_KEYCLOAK_ISSUER_URI:${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI:http://localhost:8082/realms/pymerp}}

billing:
  crypto:
    secret: ${BILLING_CRYPTO_SECRET:?BILLING_CRYPTO_SECRET is required}
  webhook:
    # Billing webhook secret must be >=24 characters and not a placeholder.
    secret: ${BILLING_WEBHOOK_SECRET:?BILLING_WEBHOOK_SECRET is required}
    tolerance: PT5M
  offline:
    enabled: true
    legend: "Emitido en contingencia; sujeto a validaciÃ³n"
    retry:
      maxAttempts: 5
      backoffMs: 60000
  pdf:
    documents-base-url: ${BILLING_DOCUMENTS_BASE_URL:http://localhost:8081/api/v1}
    branding:
      primary-color: "#1f2937"
      accent-color: "#2563eb"
      text-color: "#111827"
      table-header-color: "#e5e7eb"
  idempotency:
    ttl: PT6H
    wait-timeout: PT5S
    wait-poll-interval: PT0.25S

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always

app:
  tenancy:
    default-company-id: 00000000-0000-0000-0000-000000000001
  cors:
    allowed-origins:
      - http://localhost:5173
      - http://localhost:5174
      - http://172.29.0.1:5173
    allowed-origin-patterns:
      - http://localhost:*
      - http://127.0.0.1:*
      - http://0.0.0.0:*
      - http://172.29.0.1:*
  security:
    secrets-validation:
      enabled: true
    jwt:
      # JWT secret must be at least 32 characters long.
      secret: ${JWT_SECRET:?JWT_SECRET is required}
      expiration-seconds: 86400
      refresh-expiration-seconds: 2592000
    captcha:
      enabled: ${CAPTCHA_ENABLED:true}
      min-operand: 2
      max-operand: 10

storage:
  s3:
    bucket: ${STORAGE_S3_BUCKET:?STORAGE_S3_BUCKET is required}
    access-key: ${STORAGE_S3_ACCESS_KEY:?STORAGE_S3_ACCESS_KEY is required}
    secret-key: ${STORAGE_S3_SECRET_KEY:?STORAGE_S3_SECRET_KEY is required}
    region: ${STORAGE_S3_REGION:us-east-1}

webhooks:
  hmac:
    # HMAC key should be >=32 characters and unique per environment.
    secret: ${WEBHOOKS_HMAC_SECRET:?WEBHOOKS_HMAC_SECRET is required}
